Sjasm Z80 Assembler v0.42c - www.xl2s.tk             [2025.10.29 - 09:57:26]

BALDY.asm
Errors: 0

       1   00:0000                      ifexists game.cfg
       2   00:0000                      include game.cfg
       1.  00:0000                      ; Flags saved by AGD Compiler
       2.  00:0000                      
       3.  00:0000  (00:0000)           DISTYPE=0 ; Memory model & size
       4.  00:0000  (00:0020)           DISSIZE=32 ; Memory size
       5.  00:0000  (00:0000)           AFLAG=0 ; Adventure mode
       6.  00:0000  (00:0000)           MFLAG=0 ; Menu/Inventory
       7.  00:0000  (00:0001)           PFLAG=1 ; Particles
       8.  00:0000  (00:0000)           SFLAG=0 ; Scrolling
       9.  00:0000  (00:0000)           DFLAG=0 ; Digging
      10.  00:0000  (00:0000)           CFLAG=0 ; Collectables
      11.  00:0000  (00:0001)           OFLAG=1 ; Objects
      12.  00:0000  (00:0000)           LFLAG=0 ; Ladders
      13.  00:0000  (00:0001)           EFLAG=1 ; Beeper
      14.  00:0000  (00:0000)           YFLAG=0 ; PSG Music
      15.  00:0000  (00:0001)           XFLAG=1 ; PSG SFX
      16.  00:0000  (00:0000)           QFLAG=0 ; Marquee
      17.  00:0000  (00:0000)           CRFLAG=0 ; Crumbling blocks
      18.  00:0000  (00:0000)           MBFLAG=0 ; Metablocks
      19.  00:0000  (00:0000)           UFLAG=0 ; User routines
      20.  00:0000  (00:0000)           RTFLAG=0 ; Thrust for rotational control
      21.  00:0000  (00:0000)           HCFLAG=0 ; HW sprite collisions
      22.  00:0000  (00:0000)           TVFREQ=0 ; TV Mode
      23.  00:0000  (00:0000)           FX_RELATIVE=0 ; Relative SFX volume
      24.  00:0000  (00:0000)           FX_MODE=0 ; SFX replayer mode (0 = fixed channel, 1 = dynamic channel)
      25.  00:0000  (00:0001)           FX_CHANNEL=1 ; SFX fixed channel
       3   00:0000                      endif
       4   00:0000                      
       5   00:0000                          output BALDY.rom
       6   00:0000                      
       7   00:0000  (00:4000)           PageSize	equ	$4000
       8   00:0000                      
       9   00:0000                          defpage 0, $8000, $8000
      10   00:0000                      
      11   00:0000                          code @ $8000, #1, page 0
      12   00:8000                      
      13   00:8000                              include "header1.asm"
       1.  00:8000                      ;--------------------------------------------------------------------------
       2.  00:8000                      ; Cartridge header part 1
       3.  00:8000                      ;--------------------------------------------------------------------------
       4.  00:8000                      
       5.  00:8000                      ; Define cartridge header
       6.  00:8000                      
       7.  00:8000  AA 55               	db $aa,$55		; Cartridge type
       8.  00:8002  00 00               	dw $0000		; LOCAL_SPR_TBL
       9.  00:8004  00 00               	dw $0000		; SPRITE_ORDER
      10.  00:8006  00 00               	dw $0000		; WORK_BUFFER
      11.  00:8008  97 40               	dw CONTROLLER_BUFFER	; CONTROLLER_MAP
      12.  00:800A  3D 80               	dw init			; START_GAME
      13.  00:800C                      
      14.  00:800C                      ; Define rst vectors
      15.  00:800C                      
      16.  00:800C                      rst_8:
      17.  00:800C  ED 4D               	reti
      18.  00:800E  00                  	nop
      19.  00:800F                      rst_10:
      20.  00:800F  ED 4D               	reti
      21.  00:8011  00                  	nop
      22.  00:8012                      rst_18:
      23.  00:8012  ED 4D               	reti
      24.  00:8014  00                          nop
      25.  00:8015                      rst_20:
      26.  00:8015  ED 4D               	reti
      27.  00:8017  00                  	nop
      28.  00:8018                      rst_28:
      29.  00:8018  ED 4D               	reti
      30.  00:801A  00                  	nop
      31.  00:801B                      rst_30:
      32.  00:801B  ED 4D               	reti
      33.  00:801D  00                  	nop
      34.  00:801E                      rst_38:
      35.  00:801E  ED 4D               	reti
      36.  00:8020  00                  	nop
      37.  00:8021                      
      38.  00:8021                      ; Define NMI vector
      39.  00:8021                      
      40.  00:8021                      nmi_vec:			; NMI_INT_VECT
      41.  00:8021  C3 49 80            	jp NMI
      42.  00:8024                      
      14   00:8024                              include "name.txt"
       1.  00:8024                            db "BALDY/PRESENTS MPAGD/2025" 
       1.  00:8024  42 41 4C 44 59 2F 50 52 45 53 45 4E 54 53 20 4D 
       1.  00:8034  50 41 47 44 2F 32 30 32 35 
      15   00:803D                              include "header2.asm"
       1.  00:803D                      ;--------------------------------------------------------------------------
       2.  00:803D                      ; Cartridge header part 2
       3.  00:803D                      ;--------------------------------------------------------------------------
       4.  00:803D                      
       5.  00:803D                      ; Declare variables
       6.  00:803D                      
       7.  00:803D  (00:1FDC)           READ_REGISTER:	equ $1fdc	; Read VDP register to clear NMI flag
       8.  00:803D                      
       9.  00:803D                      ;--------------------------------------------------------------------------
      10.  00:803D                      ; Initialisation routine for Super Game Module (SGM)
      11.  00:803D                      ;--------------------------------------------------------------------------
      12.  00:803D                      
      13.  00:803D                      init:
      14.  00:803D  F3                  	di
      15.  00:803E  3E 01               	ld a,1			; Enable SGM
      16.  00:8040  D3 53               	out ($53),a
      17.  00:8042                      
      18.  00:8042  3E 1F               	ld a,00011111b		; Enable BIOS
      19.  00:8044  D3 7F               	out ($7f),a
      20.  00:8046                      
      21.  00:8046  C3 DB B4            	jp start
      22.  00:8049                      
      23.  00:8049                      ;--------------------------------------------------------------------------
      24.  00:8049                      ; NMI routine at 60 Hz
      25.  00:8049                      ;--------------------------------------------------------------------------
      26.  00:8049                      
      27.  00:8049                      NMI:
      28.  00:8049                      
      29.  00:8049                      ; Save registers
      30.  00:8049                      
      31.  00:8049  F5                  	PUSH	AF
      32.  00:804A  C5                  	PUSH	BC
      33.  00:804B  D5                  	PUSH	DE
      34.  00:804C  E5                  	PUSH	HL
      35.  00:804D  DD E5               	PUSH	IX
      36.  00:804F  FD E5               	PUSH	IY
      37.  00:8051                      ;	EX	AF,AF'
      38.  00:8051                      ;	PUSH	AF
      39.  00:8051                      ;	EXX
      40.  00:8051                      ;	PUSH	BC
      41.  00:8051                      ;	PUSH	DE
      42.  00:8051                      ;	PUSH	HL
      43.  00:8051                      
      44.  00:8051                      ; Increment time to sync framerate at 25 Hz
      45.  00:8051                      
      46.  00:8051  21 7C 40            	ld hl,time
      47.  00:8054  7E                  	ld a,(hl)
      48.  00:8055  3C                  	inc a
      49.  00:8056  77                  	ld (hl),a
      50.  00:8057                      
      51.  00:8057                      ; Increment clock
      52.  00:8057                      
      53.  00:8057  21 9E 5C            	ld hl,MSX_JIFFY
      54.  00:805A  7E                  	ld a,(hl)
      55.  00:805B  3C                  	inc a
      56.  00:805C  77                  	ld (hl),a
      57.  00:805D                      
      58.  00:805D                      ; Scan keys
      59.  00:805D                      
      60.  00:805D  CD EB 1F            	call POLLER
      61.  00:8060                      
      62.  00:8060                      ;Now restore everything
      63.  00:8060                      
      64.  00:8060                      ;	POP	HL
      65.  00:8060                      ;	POP	DE
      66.  00:8060                      ;	POP	BC
      67.  00:8060                      ;	EXX
      68.  00:8060                      ;	POP	AF
      69.  00:8060                      ;	EX	AF,AF'
      70.  00:8060  FD E1               	POP	IY
      71.  00:8062  DD E1               	POP	IX
      72.  00:8064  E1                  	POP	HL
      73.  00:8065  D1                  	POP	DE
      74.  00:8066  C1                  	POP	BC
      75.  00:8067                      
      76.  00:8067  CD DC 1F            	call READ_REGISTER	;Side effect allows another NMI to happen
      77.  00:806A  F1                  	pop af
      78.  00:806B                      
      79.  00:806B  ED 45               	retn
      80.  00:806D                      
      16   00:806D                          include "MSX_Defs.asm"
       1.  00:806D                      ; All MSX 1 BIOS calls ===========================================
       2.  00:806D                      	if (DISSIZE!=48)
       3.  00:806D                      
       4.  00:806D  (00:0000)           MSX_CHKRAM	equ $0000
       5.  00:806D  (00:0010)           MSX_CHRGTR	equ $0010
       6.  00:806D  (00:0014)           MSX_WRSLT	equ $0014
       7.  00:806D  (00:0018)           MSX_OUTDO	equ $0018
       8.  00:806D  (00:0020)           MSX_DCOMPR	equ $0020
       9.  00:806D  (00:0028)           MSX_GETYPR	equ $0028
      10.  00:806D  (00:0030)           MSX_CALLF	equ $0030
      11.  00:806D  (00:0038)           MSX_KEYINT	equ $0038
      12.  00:806D  (00:003B)           MSX_INITIO	equ $003B
      13.  00:806D  (00:003E)           MSX_INIFNK	equ $003E
      14.  00:806D  (00:005F)           MSX_CHGMOD	equ $005F
      15.  00:806D  (00:0062)           MSX_CHGCLR	equ $0062
      16.  00:806D  (00:0066)           MSX_NMI		equ $0066
      17.  00:806D  (00:0069)           MSX_CLRSPR	equ $0069
      18.  00:806D  (00:006C)           MSX_INITXT	equ $006C
      19.  00:806D  (00:006F)           MSX_INIT32	equ $006F
      20.  00:806D  (00:0075)           MSX_INIMLT	equ $0075
      21.  00:806D  (00:0078)           MSX_SETTXT	equ $0078
      22.  00:806D  (00:007B)           MSX_SETT32	equ $007B
      23.  00:806D  (00:007E)           MSX_SETGRP	equ $007E
      24.  00:806D  (00:0081)           MSX_SETMLT	equ $0081
      25.  00:806D  (00:0084)           MSX_CALPAT	equ $0084
      26.  00:806D  (00:0087)           MSX_CALATR	equ $0087
      27.  00:806D  (00:008A)           MSX_GSPSIZ	equ $008A
      28.  00:806D  (00:008D)           MSX_GRPPRT	equ $008D
      29.  00:806D  (00:0090)           MSX_GICINI	equ $0090
      30.  00:806D  (00:0093)           MSX_WRTPSG	equ $0093
      31.  00:806D  (00:0096)           MSX_RDPSG	equ $0096
      32.  00:806D  (00:0099)           MSX_STRTMS	equ $0099
      33.  00:806D  (00:009C)           MSX_CHSNS	equ $009C
      34.  00:806D  (00:009F)           MSX_CHGET	equ $009F
      35.  00:806D  (00:00A2)           MSX_CHPUT	equ $00A2
      36.  00:806D  (00:00A5)           MSX_LPTOUT	equ $00A5
      37.  00:806D  (00:00A8)           MSX_LPTSTT	equ $00A8
      38.  00:806D  (00:00AB)           MSX_CNVCHR	equ $00AB
      39.  00:806D  (00:00AE)           MSX_PINLIN	equ $00AE
      40.  00:806D  (00:00B1)           MSX_INLIN	equ $00B1
      41.  00:806D  (00:00B4)           MSX_QINLIN	equ $00B4
      42.  00:806D  (00:00B7)           MSX_BREAKX	equ $00B7
      43.  00:806D  (00:00BA)           MSX_ISCNTC	equ $00BA
      44.  00:806D  (00:00BD)           MSX_CKCNTC	equ $00BD
      45.  00:806D  (00:00C0)           MSX_BEEP	equ $00C0
      46.  00:806D  (00:00C6)           MSX_POSIT	equ $00C6
      47.  00:806D  (00:00C9)           MSX_FNKSB	equ $00C9
      48.  00:806D  (00:00CC)           MSX_ERAFNK	equ $00CC
      49.  00:806D  (00:00CF)           MSX_DSPFNK	equ $00CF
      50.  00:806D  (00:00D2)           MSX_TOTEXT	equ $00D2
      51.  00:806D  (00:00DB)           MSX_GTPAD	equ $00DB
      52.  00:806D  (00:00DE)           MSX_GTPDL	equ $00DE
      53.  00:806D  (00:00E1)           MSX_TAPION	equ $00E1
      54.  00:806D  (00:00E4)           MSX_TAPIN	equ $00E4
      55.  00:806D  (00:00E7)           MSX_TAPIOF	equ $00E7
      56.  00:806D  (00:00EA)           MSX_TAPOON	equ $00EA
      57.  00:806D  (00:00ED)           MSX_TAPOUT	equ $00ED
      58.  00:806D  (00:00F0)           MSX_TAPOOF	equ $00F0
      59.  00:806D  (00:00F3)           MSX_STMOTR	equ $00F3
      60.  00:806D  (00:00F6)           MSX_LFTQ	equ $00F6
      61.  00:806D  (00:00F9)           MSX_PUTQ	equ $00F9
      62.  00:806D  (00:00FC)           MSX_RIGHTC	equ $00FC
      63.  00:806D  (00:00FF)           MSX_LEFTC	equ $00FF
      64.  00:806D  (00:0102)           MSX_UPC		equ $0102
      65.  00:806D  (00:0105)           MSX_TUPC	equ $0105
      66.  00:806D  (00:0108)           MSX_DOWNC	equ $0108
      67.  00:806D  (00:010B)           MSX_TDOWNC	equ $010B
      68.  00:806D  (00:010E)           MSX_SCALXY	equ $010E
      69.  00:806D  (00:0111)           MSX_MAPXY	equ $0111
      70.  00:806D  (00:0114)           MSX_FETCHC	equ $0114
      71.  00:806D  (00:0117)           MSX_STOREC	equ $0117
      72.  00:806D  (00:011A)           MSX_SETATR	equ $011A
      73.  00:806D  (00:011D)           MSX_READC	equ $011D
      74.  00:806D  (00:0120)           MSX_SETC	equ $0120
      75.  00:806D  (00:0123)           MSX_NSETCX	equ $0123
      76.  00:806D  (00:0126)           MSX_GTASPC	equ $0126
      77.  00:806D  (00:0129)           MSX_PNTINI	equ $0129
      78.  00:806D  (00:012C)           MSX_SCANR	equ $012C
      79.  00:806D  (00:012F)           MSX_SCANL	equ $012F
      80.  00:806D  (00:0132)           MSX_CHGCAP	equ $0132
      81.  00:806D  (00:0135)           MSX_CHGSND	equ $0135
      82.  00:806D  (00:013B)           MSX_WSLREG	equ $013B
      83.  00:806D  (00:013E)           MSX_RDVDP	equ $013E
      84.  00:806D  (00:0144)           MSX_PHYDIO	equ $0144
      85.  00:806D  (00:0147)           MSX_FORMAT	equ $0147
      86.  00:806D  (00:014A)           MSX_ISFLIO	equ $014A
      87.  00:806D  (00:014D)           MSX_OUTDLP	equ $014D
      88.  00:806D  (00:0150)           MSX_GETVCP	equ $0150
      89.  00:806D  (00:0153)           MSX_GETVC2	equ $0153
      90.  00:806D  (00:0156)           MSX_KILBUF	equ $0156
      91.  00:806D  (00:0159)           MSX_CALBAS	equ $0159
      92.  00:806D                      	
      93.  00:806D                      	endif
      94.  00:806D                      
      95.  00:806D  (00:000C)           MSX_RDSLT	equ $000C
      96.  00:806D  (00:001C)           MSX_CALSLT	equ $001C
      97.  00:806D  (00:0138)           MSX_RSLREG	equ $0138
      98.  00:806D                      
      99.  00:806D                      ; --- end of all MSX 1 BIOS calls ---
     100.  00:806D                      ; BIOS routine - Turbo-R computers only!
     101.  00:806D  (00:0180)           MSX_CHGCPU	equ $0180
     102.  00:806D                      
     103.  00:806D                      ; Diskrom motor off entry point
     104.  00:806D  (00:4029)           MSX_MTOFF	equ	$4029
     105.  00:806D                      
     106.  00:806D                      ; VRAM addresses =================================================
     107.  00:806D                      
     108.  00:806D  (00:0000)           MSX_CHRTBL	equ $0000 ; (GRPCGP)
     109.  00:806D  (00:1800)           MSX_NAMTBL	equ $1800 ; (GRPNAM)
     110.  00:806D  (00:2000)           MSX_CLRTBL	equ $2000 ; (GRPCOL)
     111.  00:806D  (00:3800)           MSX_SPRTBL	equ $3800 ; (GRPPAT)
     112.  00:806D  (00:1B00)           MSX_SPRATR	equ $1B00 ; (GRPATR)
     113.  00:806D                      
     114.  00:806D                      ; BIOS constants =================================================
     115.  00:806D  (00:0007)           MSX_VDPPRT	equ	$0007	; VDP port 0
     116.  00:806D  (00:002D)           MSX_MSXVER	equ $002D
     117.  00:806D                      
     118.  00:806D                      ; System variables addresses =====================================
     119.  00:806D  (00:5348)           MSX_MSLOT	equ	$5348
     120.  00:806D  (00:53C7)           MSX_GRPNAM  	equ	$53C7
     121.  00:806D  (00:53C9)           MSX_GRPCOL  	equ	$53C9
     122.  00:806D  (00:53CB)           MSX_GRPCGP  	equ	$53CB
     123.  00:806D  (00:53CD)           MSX_GRPATR  	equ	$53CD
     124.  00:806D  (00:53CF)           MSX_GRPPAT  	equ	$53CF
     125.  00:806D  (00:53DB)           MSX_CLIKSW	equ	$53DB	; Keyboard click sound
     126.  00:806D  (00:53E9)           MSX_FORCLR	equ	$53E9	; Foreground colour
     127.  00:806D  (00:53EA)           MSX_BAKCLR	equ	$53EA	; Background colour
     128.  00:806D  (00:53EB)           MSX_BDRCLR	equ	$53EB	; Border colour
     129.  00:806D  (00:53DF)           MSX_RG0SAV	equ	$53DF 	; 	Mirror of VDP register 0 (Basic: VDP(0))
     130.  00:806D  (00:53E0)           MSX_RG1SAV	equ	$53E0 	; 	Mirror of VDP register 1 (Basic: VDP(1))
     131.  00:806D  (00:53E1)           MSX_RG2SAV	equ	$53E1 	; 	Mirror of VDP register 2 (Basic: VDP(2))
     132.  00:806D  (00:53E2)           MSX_RG3SAV	equ	$53E2 	; 	Mirror of VDP register 3 (Basic: VDP(3))
     133.  00:806D  (00:53E3)           MSX_RG4SAV	equ	$53E3 	; 	Mirror of VDP register 4 (Basic: VDP(4))
     134.  00:806D  (00:53E4)           MSX_RG5SAV	equ	$53E4 	; 	Mirror of VDP register 5 (Basic: VDP(5))
     135.  00:806D  (00:53E5)           MSX_RG6SAV	equ	$53E5 	; 	Mirror of VDP register 6 (Basic: VDP(6))
     136.  00:806D  (00:53E6)           MSX_RG7SAV	equ	$53E6 	; Mirror of VDP register 7 (Basic: VDP(7))
     137.  00:806D  (00:5FE7)           MSX_RG8SAV	equ	$5FE7	; Mirror of VDP register 9 (Basic: VDP(9))
     138.  00:806D  (00:5FE8)           MSX_RG9SAV	equ	$5FE8	; Mirror of VDP register 9 (Basic: VDP(9))
     139.  00:806D  (00:53E7)           MSX_STATFL	equ	$53E7 	; 	Mirror of VDP(8) status register (S#0)
     140.  00:806D  (00:53F6)           MSX_SCNCNT  	equ	$53F6
     141.  00:806D  (00:53F7)           MSX_REPCNT  	equ	$53F7
     142.  00:806D  (00:587F)           MSX_FNKSTR	equ	$587F	; Ubicacion textos teclas funcion (se reaprovecha como RAM, 160 bytes)
     143.  00:806D  (00:5BE5)           MSX_NEWKEY	equ	$5BE5
     144.  00:806D  (00:5C4A)           MSX_HIMEM	equ	$5C4A	; Highest available RAM
     145.  00:806D  (00:5C9E)           MSX_JIFFY	equ	$5C9E
     146.  00:806D  (00:5CA2)           MSX_INTCNT  	equ	$5CA2
     147.  00:806D  (00:5CC1)           MSX_EXPTBL	equ	$5CC1	; Bios Slot / Expansion Slot	
     148.  00:806D  (00:5CC5)           MSX_SLTTBL	equ	$5CC5
     149.  00:806D  (00:5D9A)           MSX_HKEYI	equ	$5D9A	 
     150.  00:806D  (00:5D9F)           MSX_HTIMI   	equ	$5D9F
     151.  00:806D  (00:5FFF)           MSX_SSSREG	equ	$5FFF	; secondary slot select register
     152.  00:806D                      
     153.  00:806D                      ; ================================================================
     154.  00:806D                      
     155.  00:806D                      ; Maximum stack address
     156.  00:806D  (00:3000)           CV_STACK	equ $3000
     157.  00:806D                      
     158.  00:806D                      ; I/O PORTS ================================================================
     159.  00:806D  (00:0040)           MSX_DEVID	equ	$40
     160.  00:806D  (00:0041)           MSX_SWTIO	equ $41
     161.  00:806D                      
     162.  00:806D                      ; PSG PORTS
     163.  00:806D  (00:00A0)           MSX_PSGLW	equ $A0 ;A0H    latch address for PSG
     164.  00:806D  (00:00A1)           MSX_PSGDW	equ $A1 ;A1H    write data to PSG
     165.  00:806D  (00:00A2)           MSX_PSGDR	equ $A2 ;A2H    read data from PSG
     166.  00:806D                      ;
     167.  00:806D  (00:000E)           MSX_PSGPA	equ 14  ;Port A of PSG
     168.  00:806D  (00:000F)           MSX_PSGPB	equ 15  ;Port B of PSG
     169.  00:806D                      
     170.  00:806D                      
     171.  00:806D                      ; VDP PORTS
     172.  00:806D  (00:00BE)           MSX_VDPDRW	equ	$be	;98H    Read/write data VDP
     173.  00:806D  (00:00BF)           MSX_VDPCW	equ	$bf	;99H    write command to VDP
     174.  00:806D  (00:00BF)           MSX_VDPSR	equ	$bf	;99H    read status from VDP
     175.  00:806D  (00:009B)           MSX_VDPPAL	equ	$9B     ; palette register (only MSX2)
     176.  00:806D                      
     177.  00:806D                      ; PPI / Programmable Peripheral Interface / 8255 I/O ports
     178.  00:806D  (00:00A8)           MSX_PPIA	equ $A8 ; PPI- register A. Primary slot select register
     179.  00:806D  (00:00A9)           MSX_PPIB	equ $A9 ; PPI- register B. Keyboard matrix row input register (read only)
     180.  00:806D  (00:00AA)           MSX_PPIC	equ $AA ; PPI- register C. Keyboard and cassette interface
     181.  00:806D  (00:00AB)           MSX_PPICM	equ $AB ; PPI- Command register (write only)
     182.  00:806D                      
     183.  00:806D  (00:00FC)           MSX_MMAP0	equ	$FC
     184.  00:806D  (00:00FD)           MSX_MMAP1	equ	$FD
     185.  00:806D  (00:00FE)           MSX_MMAP2	equ	$FE
     186.  00:806D  (00:00FF)           MSX_MMAP3	equ	$FF
     187.  00:806D                      
     188.  00:806D                      ; ================================================================
     189.  00:806D                      
     190.  00:806D                      ; Disable sprites magic numbers
     191.  00:806D  (00:00D0)           MSX_HIDE_SPRITES	equ	208
     192.  00:806D  (00:00D1)           MSX_HIDE_SPRITE		equ	209
     193.  00:806D                      
     194.  00:806D                      ; Replaced BIOS calls
     195.  00:806D                      
     196.  00:806D                      	ifdef NOBIOS
     197.  00:806D                    ~ 
     198.  00:806D                    ~ 		include "MSX_BIOS.asm"
     199.  00:806D                    ~ 		
     200.  00:806D                    ~ MSX_SNSMAT	equ 	BIOS_SNSMAT  
     201.  00:806D                    ~ MSX_INIGRP	equ	BIOS_INIGRP  
     202.  00:806D                    ~ MSX_ENASCR	equ	BIOS_ENASCR  
     203.  00:806D                    ~ MSX_DISSCR	equ	BIOS_DISSCR  
     204.  00:806D                    ~ MSX_WRTVDP	equ	BIOS_WRTVDP
     205.  00:806D                    ~ MSX_SETRD	equ	BIOS_SETRD
     206.  00:806D                    ~ MSX_SETWRT	equ	BIOS_SETWRT
     207.  00:806D                    ~ MSX_WRTVRM	equ	BIOS_WRTVRM 
     208.  00:806D                    ~ MSX_RDVRM	equ	BIOS_RDVRM
     209.  00:806D                    ~ MSX_LDIRMV	equ	BIOS_LDIRMV
     210.  00:806D                    ~ MSX_LDIRVM	equ	BIOS_LDIRVM
     211.  00:806D                    ~ MSX_CLS		equ	BIOS_CLS
     212.  00:806D                    ~ MSX_FILVRM	equ	BIOS_FILVRM
     213.  00:806D                    ~ MSX_ENASLT	equ	BIOS_ENASLT
     214.  00:806D                    ~ MSX_GTSTCK	equ	BIOS_GTSTCK
     215.  00:806D                    ~ MSX_GTTRIG	equ	BIOS_GTTRIG
     216.  00:806D                    ~ 
     217.  00:806D                    ~ 	else
     218.  00:806D                      
     219.  00:806D  (00:0024)           MSX_ENASLT	equ $0024
     220.  00:806D  (00:0041)           MSX_DISSCR	equ $0041
     221.  00:806D  (00:0044)           MSX_ENASCR	equ $0044
     222.  00:806D  (00:0047)           MSX_WRTVDP	equ $0047
     223.  00:806D  (00:004A)           MSX_RDVRM	equ $004A
     224.  00:806D  (00:CBA3)           MSX_WRTVRM	equ CV_WRTVRM	; $004D
     225.  00:806D  (00:0050)           MSX_SETRD	equ $0050
     226.  00:806D  (00:CB96)           MSX_SETWRT	equ CV_SETWRT	; $0053
     227.  00:806D  (00:0056)           MSX_FILVRM	equ $0056
     228.  00:806D  (00:0059)           MSX_LDIRMV	equ $0059
     229.  00:806D  (00:005C)           MSX_LDIRVM	equ $005C
     230.  00:806D  (00:0072)           MSX_INIGRP	equ $0072
     231.  00:806D  (00:CB71)           MSX_CLS		equ CV_CLS	; $00C3
     232.  00:806D  (00:00D5)           MSX_GTSTCK	equ $00D5
     233.  00:806D  (00:00D8)           MSX_GTTRIG	equ $00D8
     234.  00:806D  (00:0141)           MSX_SNSMAT	equ $0141
     235.  00:806D                      		
     236.  00:806D                      	endif
     237.  00:806D                      
      17   00:806D                          include "MSX_Macros.asm"
       1.  00:806D                      ; MSX MACROS
       2.  00:806D                      
       3.  00:806D                      	macro BORDER clr
       4.  00:806D                    < 		push af
       5.  00:806D                    <         ld a,clr             ;Get data to set
       6.  00:806D                    <         di
       7.  00:806D                    <         out (MSX_VDPCW),a
       8.  00:806D                    <         ld a,$87             ;Set register #
       9.  00:806D                    <         out (MSX_VDPCW),a
      10.  00:806D                    < 		pop af
      11.  00:806D                    <         ei
      12.  00:806D                    < 	endmacro
      13.  00:806D                      
      14.  00:806D                      	; Set VDP for write (based on DE or HL)
      15.  00:806D                      	macro SETWRT reg
      16.  00:806D                    < 	ifdifi reg,de
      17.  00:806D                    < 		ld a,l
      18.  00:806D                    < 		di
      19.  00:806D                    < 		out (MSX_VDPCW),a
      20.  00:806D                    < 		ld a,h
      21.  00:806D                    < 	else
      22.  00:806D                    < 		ld a,e
      23.  00:806D                    < 		di
      24.  00:806D                    < 		out (MSX_VDPCW),a
      25.  00:806D                    < 		ld a,d
      26.  00:806D                    < 	endif
      27.  00:806D                    < 		or $40
      28.  00:806D                    < 		out (MSX_VDPCW),a
      29.  00:806D                    < 		ei		
      30.  00:806D                    < 	endmacro
      31.  00:806D                      
      32.  00:806D                      	; Set VDP for read (based on DE or HL)
      33.  00:806D                      	macro SETRD reg
      34.  00:806D                    < 	ifdifi reg,de
      35.  00:806D                    < 		ld a,l
      36.  00:806D                    < 		di
      37.  00:806D                    < 		out (MSX_VDPCW),a
      38.  00:806D                    < 		ld a,h
      39.  00:806D                    < 	else
      40.  00:806D                    < 		ld a,e
      41.  00:806D                    < 		di
      42.  00:806D                    < 		out (MSX_VDPCW),a
      43.  00:806D                    < 		ld a,d
      44.  00:806D                    < 	endif
      45.  00:806D                    < 		and $3F
      46.  00:806D                    < 		out (MSX_VDPCW),a
      47.  00:806D                    < 		ei
      48.  00:806D                    < 	endmacro
      49.  00:806D                      
      50.  00:806D                      	/*
      51.  00:806D                    ~ 	macro HALT1
      52.  00:806D                    ~ 		ld hl,clock         ; previous clock setting.		
      53.  00:806D                    ~ 		inc (hl)
      54.  00:806D                    ~ .wait:
      55.  00:806D                    ~ 		ld a,(MSX_JIFFY)        ; current clock setting.
      56.  00:806D                    ~ 		cp (hl)             ; subtract last reading.
      57.  00:806D                    ~ 		jp z,.wait        ; yes, no more processing please.
      58.  00:806D                    ~ 		ld (hl),a
      59.  00:806D                    ~ 	endmacro 
      60.  00:806D                    ~ 	*/
      61.  00:806D                      
      62.  00:806D                      	macro WAITFRAME
      63.  00:806D                    < 		ifdef DEBUG
      64.  00:806D                    < 		BORDER 13
      65.  00:806D                    < 		endif
      66.  00:806D                    < 		ei
      67.  00:806D                    < 		ld hl,MSX_JIFFY
      68.  00:806D                    < 		ld a,(hl)
      69.  00:806D                    < .wait:
      70.  00:806D                    < 		cp (hl)
      71.  00:806D                    < 		jr z,.wait
      72.  00:806D                    < 		ifdef DEBUG
      73.  00:806D                    < 		BORDER 14
      74.  00:806D                    < 		endif
      75.  00:806D                    < 	endmacro
      76.  00:806D                      
      77.  00:806D                      	macro ADD_HL_A
      78.  00:806D                    < 		add a,l			; 5
      79.  00:806D                    < 		ld l,a			; 5
      80.  00:806D                    < 		adc a,h			; 5
      81.  00:806D                    < 		sub l			; 5
      82.  00:806D                    < 		ld h,a			; 5
      83.  00:806D                    < 	endmacro
      84.  00:806D                      
      85.  00:806D                      	macro ADD_DE_A
      86.  00:806D                    < 		add a,e
      87.  00:806D                    < 		ld e,a
      88.  00:806D                    < 		adc a,d
      89.  00:806D                    < 		sub e
      90.  00:806D                    < 		ld d,a	
      91.  00:806D                    < 	endmacro
      92.  00:806D                      
      93.  00:806D                      	macro ADD_BC_A
      94.  00:806D                    < 		add a,c
      95.  00:806D                    < 		ld c,a
      96.  00:806D                    < 		adc a,b
      97.  00:806D                    < 		sub c
      98.  00:806D                    < 		ld b,a	
      99.  00:806D                    < 	endmacro
     100.  00:806D                      
     101.  00:806D                      	macro EX_SP_DE
     102.  00:806D                    < 		ex de,hl
     103.  00:806D                    < 		ex (sp),hl
     104.  00:806D                    < 		ex de,hl
     105.  00:806D                    < 	endmacro
     106.  00:806D                      	
      18   00:806D                      
      19   00:806D                      
      20   00:806D  (00:0001)           WINDOWTOP equ 1
      21   00:806D  (00:0001)           WINDOWLFT equ 1
      22   00:806D  (00:0014)           WINDOWHGT equ 20
      23   00:806D  (00:001E)           WINDOWWID equ 30
      24   00:806D  (00:000D)           MAPWID	equ 13
      25   00:806D                      mapedge: 
      26   00:806D                             db 255,255,255,255,255,255,255,255,255,255,255,255,255
      26   00:806D  FF FF FF FF FF FF FF FF FF FF FF FF FF 
      27   00:807A                      mapdat:
      28   00:807A                             db 255,0,1,2,3,4,5,6,7,8,9,10,255
      28   00:807A  FF 00 01 02 03 04 05 06 07 08 09 0A FF 
      29   00:8087                             db 255,11,12,13,14,15,16,17,18,19,20,255,255
      29   00:8087  FF 0B 0C 0D 0E 0F 10 11 12 13 14 FF FF 
      30   00:8094                             db 255,255,255,255,255,255,255,255,255,255,255,255,255
      30   00:8094  FF FF FF FF FF FF FF FF FF FF FF FF FF 
      31   00:80A1  01                  stmap: db 1
      32   00:80A2                      
      33   00:80A2  (00:80A2)           evnt00:	equ $
      34   00:80A2  CD 38 BC                   call skobj
      35   00:80A5  32 57 40                   ld (varobj),a
      36   00:80A8  3E FF                      ld a,255
      37   00:80AA  21 57 40                   ld hl,varobj
      38   00:80AD  BE                         cp (hl)
      39   00:80AE  CA B6 80                   jp z,a00039
      40   00:80B1  3E 02                      ld a,2
      41   00:80B3  32 22 40                   ld (varg),a
      42   00:80B6  3E 02               a00039 ld a,2
      43   00:80B8  21 22 40                   ld hl,varg
      44   00:80BB  BE                         cp (hl)
      45   00:80BC  C2 FA 80                   jp nz,a00161
      46   00:80BF  DD 7E 03                   ld a,(ix+3)
      47   00:80C2  32 25 40                   ld (varj),a
      48   00:80C5  3A 25 40                   ld a,(varj)
      49   00:80C8  1F                         rra
      50   00:80C9  1F                         rra
      51   00:80CA  E6 3F                      and 63
      52   00:80CC  32 25 40                   ld (varj),a
      53   00:80CF  3A 25 40                   ld a,(varj)
      54   00:80D2  E6 7F                      and 127
      55   00:80D4  32 16 40                   ld (sndtyp),a
      56   00:80D7  3E 10                      ld a,16
      57   00:80D9  DD 77 01                   ld (ix+1),a
      58   00:80DC  3E A0                      ld a,160
      59   00:80DE  DD BE 03                   cp (ix+3)
      60   00:80E1  DA F6 80                   jp c,a00152
      61   00:80E4  AF                         xor a
      62   00:80E5  21 1E 40                   ld hl,varc
      63   00:80E8  BE                         cp (hl)
      64   00:80E9  C2 F0 80                   jp nz,a00143
      65   00:80EC  AF                         xor a
      66   00:80ED  CD C1 C3                   call animsp
      67   00:80F0  DD 34 03            a00143 inc (ix+3)
      68   00:80F3  C3 FA 80                   jp a00161
      69   00:80F6  21 52 40            a00152 ld hl,deadf
      70   00:80F9  74                         ld (hl),h
      71   00:80FA  AF                  a00161 xor a
      72   00:80FB  21 22 40                   ld hl,varg
      73   00:80FE  BE                         cp (hl)
      74   00:80FF  C2 E9 82                   jp nz,a01062
      75   00:8102  AF                         xor a
      76   00:8103  21 27 40                   ld hl,varl
      77   00:8106  BE                         cp (hl)
      78   00:8107  C2 15 82                   jp nz,a00678
      79   00:810A  3A 40 40                   ld a,(joyval)
      80   00:810D  E6 01                      and 1
      81   00:810F  CA 65 81                   jp z,a00357
      82   00:8112  3E 01                      ld a,1
      83   00:8114  21 20 40                   ld hl,vare
      84   00:8117  BE                         cp (hl)
      85   00:8118  C2 28 81                   jp nz,a00248
      86   00:811B  AF                         xor a
      87   00:811C  32 20 40                   ld (vare),a
      88   00:811F  0E 08                      ld c,8
      89   00:8121  DD 7E 03                   ld a,(ix+3)
      90   00:8124  91                         sub c
      91   00:8125  DD 77 03                   ld (ix+3),a
      92   00:8128  3E DA               a00248 ld a,218
      93   00:812A  DD BE 04                   cp (ix+4)
      94   00:812D  DA 65 81                   jp c,a00357
      95   00:8130  AF                         xor a
      96   00:8131  21 26 40                   ld hl,vark
      97   00:8134  BE                         cp (hl)
      98   00:8135  C2 65 81                   jp nz,a00357
      99   00:8138  DD 7E 04                   ld a,(ix+4)
     100   00:813B  32 1C 40                   ld (vara),a
     101   00:813E  0E 14                      ld c,20
     102   00:8140  3A 1C 40                   ld a,(vara)
     103   00:8143  81                         add a,c
     104   00:8144  32 1C 40                   ld (vara),a
     105   00:8147  0E 04                      ld c,4
     106   00:8149  DD 7E 03                   ld a,(ix+3)
     107   00:814C  91                         sub c
     108   00:814D  DD 77 03                   ld (ix+3),a
     109   00:8150  3E 01                      ld a,1
     110   00:8152  32 1F 40                   ld (vard),a
     111   00:8155  3E 01                      ld a,1
     112   00:8157  32 26 40                   ld (vark),a
     113   00:815A  3E 01                      ld a,1
     114   00:815C  DD 77 01                   ld (ix+1),a
     115   00:815F  AF                         xor a
     116   00:8160  0E 00                      ld c,0
     117   00:8162  CD 20 C9                   call sfx_set
     118   00:8165  3A 40 40            a00357 ld a,(joyval)
     119   00:8168  E6 02                      and 2
     120   00:816A  CA C0 81                   jp z,a00520
     121   00:816D  3E 01                      ld a,1
     122   00:816F  21 20 40                   ld hl,vare
     123   00:8172  BE                         cp (hl)
     124   00:8173  C2 83 81                   jp nz,a00411
     125   00:8176  AF                         xor a
     126   00:8177  32 20 40                   ld (vare),a
     127   00:817A  0E 08                      ld c,8
     128   00:817C  DD 7E 03                   ld a,(ix+3)
     129   00:817F  91                         sub c
     130   00:8180  DD 77 03                   ld (ix+3),a
     131   00:8183  3E 1E               a00411 ld a,30
     132   00:8185  DD BE 04                   cp (ix+4)
     133   00:8188  D2 C0 81                   jp nc,a00520
     134   00:818B  AF                         xor a
     135   00:818C  21 26 40                   ld hl,vark
     136   00:818F  BE                         cp (hl)
     137   00:8190  C2 C0 81                   jp nz,a00520
     138   00:8193  DD 7E 04                   ld a,(ix+4)
     139   00:8196  32 1C 40                   ld (vara),a
     140   00:8199  0E 26                      ld c,38
     141   00:819B  3A 1C 40                   ld a,(vara)
     142   00:819E  91                         sub c
     143   00:819F  32 1C 40                   ld (vara),a
     144   00:81A2  0E 04                      ld c,4
     145   00:81A4  DD 7E 03                   ld a,(ix+3)
     146   00:81A7  91                         sub c
     147   00:81A8  DD 77 03                   ld (ix+3),a
     148   00:81AB  3E 02                      ld a,2
     149   00:81AD  32 1F 40                   ld (vard),a
     150   00:81B0  3E 01                      ld a,1
     151   00:81B2  32 26 40                   ld (vark),a
     152   00:81B5  3E 03                      ld a,3
     153   00:81B7  DD 77 01                   ld (ix+1),a
     154   00:81BA  AF                         xor a
     155   00:81BB  0E 00                      ld c,0
     156   00:81BD  CD 20 C9                   call sfx_set
     157   00:81C0  3A 40 40            a00520 ld a,(joyval)
     158   00:81C3  E6 04                      and 4
     159   00:81C5  CA EB 81                   jp z,a00599
     160   00:81C8  AF                         xor a
     161   00:81C9  21 26 40                   ld hl,vark
     162   00:81CC  BE                         cp (hl)
     163   00:81CD  C2 EB 81                   jp nz,a00599
     164   00:81D0  AF                         xor a
     165   00:81D1  21 20 40                   ld hl,vare
     166   00:81D4  BE                         cp (hl)
     167   00:81D5  C2 EB 81                   jp nz,a00599
     168   00:81D8  3E 01                      ld a,1
     169   00:81DA  32 20 40                   ld (vare),a
     170   00:81DD  3E 04                      ld a,4
     171   00:81DF  DD 77 01                   ld (ix+1),a
     172   00:81E2  0E 08                      ld c,8
     173   00:81E4  DD 7E 03                   ld a,(ix+3)
     174   00:81E7  81                         add a,c
     175   00:81E8  DD 77 03                   ld (ix+3),a
     176   00:81EB  3A 40 40            a00599 ld a,(joyval)
     177   00:81EE  E6 08                      and 8
     178   00:81F0  CA 15 82                   jp z,a00678
     179   00:81F3  AF                         xor a
     180   00:81F4  21 26 40                   ld hl,vark
     181   00:81F7  BE                         cp (hl)
     182   00:81F8  C2 15 82                   jp nz,a00678
     183   00:81FB  3E 01                      ld a,1
     184   00:81FD  21 20 40                   ld hl,vare
     185   00:8200  BE                         cp (hl)
     186   00:8201  C2 15 82                   jp nz,a00678
     187   00:8204  AF                         xor a
     188   00:8205  32 20 40                   ld (vare),a
     189   00:8208  AF                         xor a
     190   00:8209  DD 77 01                   ld (ix+1),a
     191   00:820C  0E 08                      ld c,8
     192   00:820E  DD 7E 03                   ld a,(ix+3)
     193   00:8211  91                         sub c
     194   00:8212  DD 77 03                   ld (ix+3),a
     195   00:8215  3E 01               a00678 ld a,1
     196   00:8217  21 1F 40                   ld hl,vard
     197   00:821A  BE                         cp (hl)
     198   00:821B  C2 44 82                   jp nz,a00763
     199   00:821E  DD 7E 04                   ld a,(ix+4)
     200   00:8221  21 1C 40                   ld hl,vara
     201   00:8224  BE                         cp (hl)
     202   00:8225  D2 38 82                   jp nc,a00739
     203   00:8228  DD 34 04                   inc (ix+4)
     204   00:822B  DD 34 04                   inc (ix+4)
     205   00:822E  3A 1C 40                   ld a,(vara)
     206   00:8231  3C                         inc a
     207   00:8232  32 1C 40                   ld (vara),a
     208   00:8235  C3 44 82                   jp a00763
     209   00:8238  AF                  a00739 xor a
     210   00:8239  32 1F 40                   ld (vard),a
     211   00:823C  AF                         xor a
     212   00:823D  32 26 40                   ld (vark),a
     213   00:8240  AF                         xor a
     214   00:8241  DD 77 01                   ld (ix+1),a
     215   00:8244  3A 40 40            a00763 ld a,(joyval)
     216   00:8247  E6 10                      and 16
     217   00:8249  CA 98 82                   jp z,a00918
     218   00:824C  AF                         xor a
     219   00:824D  21 1D 40                   ld hl,varb
     220   00:8250  BE                         cp (hl)
     221   00:8251  C2 72 82                   jp nz,a00847
     222   00:8254  06 05                      ld b,DEADLY
     223   00:8256  CD 85 BF                   call tded
     224   00:8259  B8                         cp b
     225   00:825A  C2 72 82                   jp nz,a00847
     226   00:825D  0E 28                      ld c,40
     227   00:825F  DD 7E 03                   ld a,(ix+3)
     228   00:8262  81                         add a,c
     229   00:8263  DD 77 03                   ld (ix+3),a
     230   00:8266  3E 01                      ld a,1
     231   00:8268  0E 00                      ld c,0
     232   00:826A  CD 20 C9                   call sfx_set
     233   00:826D  3E 0A                      ld a,10
     234   00:826F  32 1D 40                   ld (varb),a
     235   00:8272  AF                  a00847 xor a
     236   00:8273  21 1D 40                   ld hl,varb
     237   00:8276  BE                         cp (hl)
     238   00:8277  C2 98 82                   jp nz,a00918
     239   00:827A  06 06                      ld b,CUSTOM
     240   00:827C  CD 85 BF                   call tded
     241   00:827F  B8                         cp b
     242   00:8280  C2 98 82                   jp nz,a00918
     243   00:8283  0E 28                      ld c,40
     244   00:8285  DD 7E 03                   ld a,(ix+3)
     245   00:8288  91                         sub c
     246   00:8289  DD 77 03                   ld (ix+3),a
     247   00:828C  3E 01                      ld a,1
     248   00:828E  0E 00                      ld c,0
     249   00:8290  CD 20 C9                   call sfx_set
     250   00:8293  3E 0A                      ld a,10
     251   00:8295  32 1D 40                   ld (varb),a
     252   00:8298  3E 02               a00918 ld a,2
     253   00:829A  21 1F 40                   ld hl,vard
     254   00:829D  BE                         cp (hl)
     255   00:829E  C2 C1 82                   jp nz,a00990
     256   00:82A1  DD 7E 04                   ld a,(ix+4)
     257   00:82A4  21 1C 40                   ld hl,vara
     258   00:82A7  BE                         cp (hl)
     259   00:82A8  DA B4 82                   jp c,a00965
     260   00:82AB  DD 35 04                   dec (ix+4)
     261   00:82AE  DD 35 04                   dec (ix+4)
     262   00:82B1  C3 C1 82                   jp a00990
     263   00:82B4  AF                  a00965 xor a
     264   00:82B5  32 1F 40                   ld (vard),a
     265   00:82B8  AF                         xor a
     266   00:82B9  32 26 40                   ld (vark),a
     267   00:82BC  3E 02                      ld a,2
     268   00:82BE  DD 77 01                   ld (ix+1),a
     269   00:82C1  AF                  a00990 xor a
     270   00:82C2  21 1F 40                   ld hl,vard
     271   00:82C5  BE                         cp (hl)
     272   00:82C6  C2 E9 82                   jp nz,a01062
     273   00:82C9  AF                         xor a
     274   00:82CA  21 20 40                   ld hl,vare
     275   00:82CD  BE                         cp (hl)
     276   00:82CE  C2 E9 82                   jp nz,a01062
     277   00:82D1  CD 13 BF                   call cangd
     278   00:82D4  C2 E5 82                   jp nz,a01054
     279   00:82D7  DD 34 03                   inc (ix+3)
     280   00:82DA  DD 34 03                   inc (ix+3)
     281   00:82DD  3E 01                      ld a,1
     282   00:82DF  32 27 40                   ld (varl),a
     283   00:82E2  C3 E9 82                   jp a01062
     284   00:82E5  AF                  a01054 xor a
     285   00:82E6  32 27 40                   ld (varl),a
     286   00:82E9  3E 01               a01062 ld a,1
     287   00:82EB  21 22 40                   ld hl,varg
     288   00:82EE  BE                         cp (hl)
     289   00:82EF  C2 5C 83                   jp nz,a01285
     290   00:82F2  3E 72                      ld a,114
     291   00:82F4  21 21 40                   ld hl,varf
     292   00:82F7  BE                         cp (hl)
     293   00:82F8  D2 05 83                   jp nc,a01113
     294   00:82FB  CD 42 B6                   call cls
     295   00:82FE  21 50 40                   ld hl,nexlev
     296   00:8301  74                         ld (hl),h
     297   00:8302  C3 5C 83                   jp a01285
     298   00:8305  3E 0B               a01113 ld a,11
     299   00:8307  32 35 40                   ld (charx),a
     300   00:830A  3E 0A                      ld a,10
     301   00:830C  32 36 40                   ld (chary),a
     302   00:830F  3E 06                      ld a,6
     303   00:8311  87                         add a,a
     304   00:8312  87                         add a,a
     305   00:8313  87                         add a,a
     306   00:8314  87                         add a,a
     307   00:8315  5F                         ld e,a
     308   00:8316  3A 39 40                   ld a,(clratt)
     309   00:8319  E6 0F                      and $0F
     310   00:831B  B3                         or e
     311   00:831C  32 39 40                   ld (clratt),a
     312   00:831F  3E 0B                      ld a,11
     313   00:8321  5F                         ld e,a
     314   00:8322  3A 39 40                   ld a,(clratt)
     315   00:8325  E6 F0                      and $F0
     316   00:8327  B3                         or e
     317   00:8328  32 39 40                   ld (clratt),a
     318   00:832B  3E 02                      ld a,2
     319   00:832D  CD 88 C0                   call dmsg
     320   00:8330  3E 04                      ld a,4
     321   00:8332  32 19 40                   ld (loopa),a
     322   00:8335  3E 02               a01211 ld a,2
     323   00:8337  0E 00                      ld c,0
     324   00:8339  CD 20 C9                   call sfx_set
     325   00:833C  21 19 40                   ld hl,loopa
     326   00:833F  35                         dec (hl)
     327   00:8340  C2 35 83                   jp nz,a01211
     328   00:8343  DD E5                      push ix
     329   00:8345  06 64                      ld b,100
     330   00:8347  CD B0 B5                   call delay
     331   00:834A  DD E1                      pop ix
     332   00:834C  AF                         xor a
     333   00:834D  32 22 40                   ld (varg),a
     334   00:8350  AF                         xor a
     335   00:8351  32 26 40                   ld (vark),a
     336   00:8354  AF                         xor a
     337   00:8355  32 1F 40                   ld (vard),a
     338   00:8358  21 50 40                   ld hl,nexlev
     339   00:835B  74                         ld (hl),h
     340   00:835C  C9                  a01285 ret
     341   00:835D                      
     342   00:835D  (00:835D)           evnt01:	equ $
     343   00:835D  0E 00                      ld c,0
     344   00:835F  CD EF C3                   call sktyp
     345   00:8362  D2 6A 83                   jp nc,b00025
     346   00:8365  3E 02                      ld a,2
     347   00:8367  32 22 40                   ld (varg),a
     348   00:836A  CD 55 BF            b00025 call cangr
     349   00:836D  C2 0A 84                   jp nz,b00321
     350   00:8370  3E 05                      ld a,5
     351   00:8372  21 41 40                   ld hl,scno
     352   00:8375  BE                         cp (hl)
     353   00:8376  C2 81 83                   jp nz,b00066
     354   00:8379  3E 07                      ld a,7
     355   00:837B  E6 0F                      and $0F
     356   00:837D  4F                         ld c,a
     357   00:837E  CD 9D B6                   call cspr
     358   00:8381  3E 06               b00066 ld a,6
     359   00:8383  21 41 40                   ld hl,scno
     360   00:8386  BE                         cp (hl)
     361   00:8387  C2 92 83                   jp nz,b00098
     362   00:838A  3E 07                      ld a,7
     363   00:838C  E6 0F                      and $0F
     364   00:838E  4F                         ld c,a
     365   00:838F  CD 9D B6                   call cspr
     366   00:8392  3E 07               b00098 ld a,7
     367   00:8394  21 41 40                   ld hl,scno
     368   00:8397  BE                         cp (hl)
     369   00:8398  C2 A3 83                   jp nz,b00129
     370   00:839B  3E 07                      ld a,7
     371   00:839D  E6 0F                      and $0F
     372   00:839F  4F                         ld c,a
     373   00:83A0  CD 9D B6                   call cspr
     374   00:83A3  3E 09               b00129 ld a,9
     375   00:83A5  21 41 40                   ld hl,scno
     376   00:83A8  BE                         cp (hl)
     377   00:83A9  D2 B4 83                   jp nc,b00161
     378   00:83AC  3E 07                      ld a,7
     379   00:83AE  E6 0F                      and $0F
     380   00:83B0  4F                         ld c,a
     381   00:83B1  CD 9D B6                   call cspr
     382   00:83B4  DD 34 04            b00161 inc (ix+4)
     383   00:83B7  3E 05                      ld a,5
     384   00:83B9  21 41 40                   ld hl,scno
     385   00:83BC  BE                         cp (hl)
     386   00:83BD  C2 C8 83                   jp nz,b00197
     387   00:83C0  3E 02                      ld a,2
     388   00:83C2  E6 0F                      and $0F
     389   00:83C4  4F                         ld c,a
     390   00:83C5  CD 9D B6                   call cspr
     391   00:83C8  3E 06               b00197 ld a,6
     392   00:83CA  21 41 40                   ld hl,scno
     393   00:83CD  BE                         cp (hl)
     394   00:83CE  C2 D9 83                   jp nz,b00229
     395   00:83D1  3E 02                      ld a,2
     396   00:83D3  E6 0F                      and $0F
     397   00:83D5  4F                         ld c,a
     398   00:83D6  CD 9D B6                   call cspr
     399   00:83D9  3E 07               b00229 ld a,7
     400   00:83DB  21 41 40                   ld hl,scno
     401   00:83DE  BE                         cp (hl)
     402   00:83DF  C2 EA 83                   jp nz,b00261
     403   00:83E2  3E 03                      ld a,3
     404   00:83E4  E6 0F                      and $0F
     405   00:83E6  4F                         ld c,a
     406   00:83E7  CD 9D B6                   call cspr
     407   00:83EA  3E 09               b00261 ld a,9
     408   00:83EC  21 41 40                   ld hl,scno
     409   00:83EF  BE                         cp (hl)
     410   00:83F0  D2 FB 83                   jp nc,b00293
     411   00:83F3  3E 02                      ld a,2
     412   00:83F5  E6 0F                      and $0F
     413   00:83F7  4F                         ld c,a
     414   00:83F8  CD 9D B6                   call cspr
     415   00:83FB  AF                  b00293 xor a
     416   00:83FC  21 1E 40                   ld hl,varc
     417   00:83FF  BE                         cp (hl)
     418   00:8400  C2 07 84                   jp nz,b00317
     419   00:8403  AF                         xor a
     420   00:8404  CD C1 C3                   call animsp
     421   00:8407  C3 13 84            b00317 jp b00338
     422   00:840A  AF                  b00321 xor a
     423   00:840B  DD 77 04                   ld (ix+4),a
     424   00:840E  3E 04                      ld a,4
     425   00:8410  32 16 40                   ld (sndtyp),a
     426   00:8413  C9                  b00338 ret
     427   00:8414                      
     428   00:8414  (00:8414)           evnt02:	equ $
     429   00:8414  0E 00                      ld c,0
     430   00:8416  CD EF C3                   call sktyp
     431   00:8419  D2 21 84                   jp nc,c00025
     432   00:841C  3E 02                      ld a,2
     433   00:841E  32 22 40                   ld (varg),a
     434   00:8421  CD 55 BF            c00025 call cangr
     435   00:8424  C2 3C 84                   jp nz,c00072
     436   00:8427  DD 34 04                   inc (ix+4)
     437   00:842A  DD 34 04                   inc (ix+4)
     438   00:842D  AF                         xor a
     439   00:842E  21 1E 40                   ld hl,varc
     440   00:8431  BE                         cp (hl)
     441   00:8432  C2 39 84                   jp nz,c00068
     442   00:8435  AF                         xor a
     443   00:8436  CD C1 C3                   call animsp
     444   00:8439  C3 45 84            c00068 jp c00089
     445   00:843C  AF                  c00072 xor a
     446   00:843D  DD 77 04                   ld (ix+4),a
     447   00:8440  3E 04                      ld a,4
     448   00:8442  32 16 40                   ld (sndtyp),a
     449   00:8445  C9                  c00089 ret
     450   00:8446                      
     451   00:8446  (00:8446)           evnt03:	equ $
     452   00:8446  0E 00                      ld c,0
     453   00:8448  CD EF C3                   call sktyp
     454   00:844B  D2 53 84                   jp nc,d00025
     455   00:844E  3E 02                      ld a,2
     456   00:8450  32 22 40                   ld (varg),a
     457   00:8453  CD 4A BF            d00025 call cangl
     458   00:8456  C2 7B 84                   jp nz,d00097
     459   00:8459  3E 07                      ld a,7
     460   00:845B  E6 0F                      and $0F
     461   00:845D  4F                         ld c,a
     462   00:845E  CD 9D B6                   call cspr
     463   00:8461  DD 35 04                   dec (ix+4)
     464   00:8464  3E 06                      ld a,6
     465   00:8466  E6 0F                      and $0F
     466   00:8468  4F                         ld c,a
     467   00:8469  CD 9D B6                   call cspr
     468   00:846C  AF                         xor a
     469   00:846D  21 1E 40                   ld hl,varc
     470   00:8470  BE                         cp (hl)
     471   00:8471  C2 78 84                   jp nz,d00093
     472   00:8474  AF                         xor a
     473   00:8475  CD C1 C3                   call animsp
     474   00:8478  C3 85 84            d00093 jp d00115
     475   00:847B  3E 04               d00097 ld a,4
     476   00:847D  32 16 40                   ld (sndtyp),a
     477   00:8480  3E F0                      ld a,240
     478   00:8482  DD 77 04                   ld (ix+4),a
     479   00:8485  C9                  d00115 ret
     480   00:8486                      
     481   00:8486  (00:8486)           evnt04:	equ $
     482   00:8486  0E 00                      ld c,0
     483   00:8488  CD EF C3                   call sktyp
     484   00:848B  D2 93 84                   jp nc,e00025
     485   00:848E  3E 02                      ld a,2
     486   00:8490  32 22 40                   ld (varg),a
     487   00:8493  3E 14               e00025 ld a,20
     488   00:8495  21 41 40                   ld hl,scno
     489   00:8498  BE                         cp (hl)
     490   00:8499  C2 AB 84                   jp nz,e00070
     491   00:849C  AF                         xor a
     492   00:849D  21 1E 40                   ld hl,varc
     493   00:84A0  BE                         cp (hl)
     494   00:84A1  C2 A8 84                   jp nz,e00066
     495   00:84A4  AF                         xor a
     496   00:84A5  CD C1 C3                   call animsp
     497   00:84A8  C3 D0 84            e00066 jp e00135
     498   00:84AB  CD 4A BF            e00070 call cangl
     499   00:84AE  C2 C6 84                   jp nz,e00118
     500   00:84B1  DD 35 04                   dec (ix+4)
     501   00:84B4  DD 35 04                   dec (ix+4)
     502   00:84B7  AF                         xor a
     503   00:84B8  21 1E 40                   ld hl,varc
     504   00:84BB  BE                         cp (hl)
     505   00:84BC  C2 C3 84                   jp nz,e00113
     506   00:84BF  AF                         xor a
     507   00:84C0  CD C1 C3                   call animsp
     508   00:84C3  C3 D0 84            e00113 jp e00135
     509   00:84C6  3E 04               e00118 ld a,4
     510   00:84C8  32 16 40                   ld (sndtyp),a
     511   00:84CB  3E F0                      ld a,240
     512   00:84CD  DD 77 04                   ld (ix+4),a
     513   00:84D0  C9                  e00135 ret
     514   00:84D1                      
     515   00:84D1  (00:84D1)           evnt05:	equ $
     516   00:84D1  0E 00                      ld c,0
     517   00:84D3  CD EF C3                   call sktyp
     518   00:84D6  D2 DE 84                   jp nc,f00025
     519   00:84D9  3E 02                      ld a,2
     520   00:84DB  32 22 40                   ld (varg),a
     521   00:84DE  3E 96               f00025 ld a,150
     522   00:84E0  DD BE 03                   cp (ix+3)
     523   00:84E3  DA F8 84                   jp c,f00071
     524   00:84E6  DD 34 03                   inc (ix+3)
     525   00:84E9  AF                         xor a
     526   00:84EA  21 1E 40                   ld hl,varc
     527   00:84ED  BE                         cp (hl)
     528   00:84EE  C2 F5 84                   jp nz,f00067
     529   00:84F1  AF                         xor a
     530   00:84F2  CD C1 C3                   call animsp
     531   00:84F5  C3 1C 85            f00067 jp f00139
     532   00:84F8  AF                  f00071 xor a
     533   00:84F9  DD 77 03                   ld (ix+3),a
     534   00:84FC  3E A0                      ld a,160
     535   00:84FE  57                         ld d,a
     536   00:84FF  CD 05 C0                   call random
     537   00:8502  67                         ld h,a
     538   00:8503  CD DB BA                   call imul
     539   00:8506  7C                         ld a,h
     540   00:8507  32 56 40                   ld (varrnd),a
     541   00:850A  3A 56 40                   ld a,(varrnd)
     542   00:850D  DD 77 04                   ld (ix+4),a
     543   00:8510  0E 3C                      ld c,60
     544   00:8512  DD 7E 04                   ld a,(ix+4)
     545   00:8515  81                         add a,c
     546   00:8516  DD 77 04                   ld (ix+4),a
     547   00:8519  C3 1C 85                   jp f00139
     548   00:851C  C9                  f00139 ret
     549   00:851D                      
     550   00:851D  (00:851D)           evnt06:	equ $
     551   00:851D  0E 00                      ld c,0
     552   00:851F  CD EF C3                   call sktyp
     553   00:8522  D2 2A 85                   jp nc,g00025
     554   00:8525  3E 02                      ld a,2
     555   00:8527  32 22 40                   ld (varg),a
     556   00:852A  AF                  g00025 xor a
     557   00:852B  21 1E 40                   ld hl,varc
     558   00:852E  BE                         cp (hl)
     559   00:852F  C2 56 85                   jp nz,g00105
     560   00:8532  AF                         xor a
     561   00:8533  CD C1 C3                   call animsp
     562   00:8536  CD 55 BF                   call cangr
     563   00:8539  C2 52 85                   jp nz,g00097
     564   00:853C  3E 07                      ld a,7
     565   00:853E  E6 0F                      and $0F
     566   00:8540  4F                         ld c,a
     567   00:8541  CD 9D B6                   call cspr
     568   00:8544  DD 34 04                   inc (ix+4)
     569   00:8547  3E 05                      ld a,5
     570   00:8549  E6 0F                      and $0F
     571   00:854B  4F                         ld c,a
     572   00:854C  CD 9D B6                   call cspr
     573   00:854F  C3 56 85                   jp g00105
     574   00:8552  AF                  g00097 xor a
     575   00:8553  DD 77 04                   ld (ix+4),a
     576   00:8556  C9                  g00105 ret
     577   00:8557                      
     578   00:8557  (00:8557)           evnt07:	equ $
     579   00:8557  AF                         xor a
     580   00:8558  21 1E 40                   ld hl,varc
     581   00:855B  BE                         cp (hl)
     582   00:855C  C2 6B 85                   jp nz,h00043
     583   00:855F  3E 03                      ld a,3
     584   00:8561  E6 0F                      and $0F
     585   00:8563  4F                         ld c,a
     586   00:8564  CD 9D B6                   call cspr
     587   00:8567  AF                         xor a
     588   00:8568  CD C1 C3                   call animsp
     589   00:856B  0E 00               h00043 ld c,0
     590   00:856D  CD EF C3                   call sktyp
     591   00:8570  D2 8E 85                   jp nc,h00104
     592   00:8573  3E 07                      ld a,7
     593   00:8575  E6 0F                      and $0F
     594   00:8577  4F                         ld c,a
     595   00:8578  CD 9D B6                   call cspr
     596   00:857B  3E 04                      ld a,4
     597   00:857D  CD D0 B8                   call explod
     598   00:8580  3A 21 40                   ld a,(varf)
     599   00:8583  3C                         inc a
     600   00:8584  32 21 40                   ld (varf),a
     601   00:8587  3E 03                      ld a,3
     602   00:8589  0E 00                      ld c,0
     603   00:858B  CD 20 C9                   call sfx_set
     604   00:858E  3E 72               h00104 ld a,114
     605   00:8590  21 21 40                   ld hl,varf
     606   00:8593  BE                         cp (hl)
     607   00:8594  C2 F8 85                   jp nz,h00314
     608   00:8597  CD 42 B6                   call cls
     609   00:859A  3E FA                      ld a,250
     610   00:859C  32 1D 40                   ld (varb),a
     611   00:859F  3E 73                      ld a,115
     612   00:85A1  32 21 40                   ld (varf),a
     613   00:85A4  3E 63                      ld a,99
     614   00:85A6  32 34 40                   ld (contrl),a
     615   00:85A9  3E 63               h00152 ld a,99
     616   00:85AB  21 34 40                   ld hl,contrl
     617   00:85AE  BE                         cp (hl)
     618   00:85AF  C2 F3 85                   jp nz,h00305
     619   00:85B2  21 8B 40                   ld hl,keys+14
     620   00:85B5  7E                         ld a,(hl)
     621   00:85B6  23                         inc hl
     622   00:85B7  56                         ld d,(hl)
     623   00:85B8  CD 17 C0                   call ktest
     624   00:85BB  DA C2 85                   jp c,h00204
     625   00:85BE  AF                         xor a
     626   00:85BF  32 34 40                   ld (contrl),a
     627   00:85C2  21 8D 40            h00204 ld hl,keys+16
     628   00:85C5  7E                         ld a,(hl)
     629   00:85C6  23                         inc hl
     630   00:85C7  56                         ld d,(hl)
     631   00:85C8  CD 17 C0                   call ktest
     632   00:85CB  DA D3 85                   jp c,h00239
     633   00:85CE  3E 01                      ld a,1
     634   00:85D0  32 34 40                   ld (contrl),a
     635   00:85D3  21 8F 40            h00239 ld hl,keys+18
     636   00:85D6  7E                         ld a,(hl)
     637   00:85D7  23                         inc hl
     638   00:85D8  56                         ld d,(hl)
     639   00:85D9  CD 17 C0                   call ktest
     640   00:85DC  DA E4 85                   jp c,h00275
     641   00:85DF  3E 02                      ld a,2
     642   00:85E1  32 34 40                   ld (contrl),a
     643   00:85E4  21 91 40            h00275 ld hl,keys+20
     644   00:85E7  7E                         ld a,(hl)
     645   00:85E8  23                         inc hl
     646   00:85E9  56                         ld d,(hl)
     647   00:85EA  CD 17 C0                   call ktest
     648   00:85ED  DA F0 85                   jp c,h00301
     649   00:85F0  C3 A9 85            h00301 jp h00152
     650   00:85F3  3E 01               h00305 ld a,1
     651   00:85F5  32 22 40                   ld (varg),a
     652   00:85F8  3E 70               h00314 ld a,112
     653   00:85FA  21 21 40                   ld hl,varf
     654   00:85FD  BE                         cp (hl)
     655   00:85FE  C2 14 86                   jp nz,h00362
     656   00:8601  DD 36 00 FF                ld (ix+0),255
     657   00:8605  3E 71                      ld a,113
     658   00:8607  32 21 40                   ld (varf),a
     659   00:860A  3E 01                      ld a,1
     660   00:860C  32 22 40                   ld (varg),a
     661   00:860F  3E 14                      ld a,20
     662   00:8611  32 23 40                   ld (varh),a
     663   00:8614  3E 6F               h00362 ld a,111
     664   00:8616  21 21 40                   ld hl,varf
     665   00:8619  BE                         cp (hl)
     666   00:861A  C2 22 86                   jp nz,h00388
     667   00:861D  3E 88                      ld a,136
     668   00:861F  DD 77 03                   ld (ix+3),a
     669   00:8622  3E 6E               h00388 ld a,110
     670   00:8624  21 21 40                   ld hl,varf
     671   00:8627  BE                         cp (hl)
     672   00:8628  C2 30 86                   jp nz,h00413
     673   00:862B  3E 36                      ld a,54
     674   00:862D  DD 77 03                   ld (ix+3),a
     675   00:8630  3E 6D               h00413 ld a,109
     676   00:8632  21 21 40                   ld hl,varf
     677   00:8635  BE                         cp (hl)
     678   00:8636  C2 3E 86                   jp nz,h00439
     679   00:8639  3E 10                      ld a,16
     680   00:863B  DD 77 03                   ld (ix+3),a
     681   00:863E  3E 6C               h00439 ld a,108
     682   00:8640  21 21 40                   ld hl,varf
     683   00:8643  BE                         cp (hl)
     684   00:8644  C2 51 86                   jp nz,h00473
     685   00:8647  3E 3C                      ld a,60
     686   00:8649  DD 77 04                   ld (ix+4),a
     687   00:864C  3E 36                      ld a,54
     688   00:864E  DD 77 03                   ld (ix+3),a
     689   00:8651  3E 6A               h00473 ld a,106
     690   00:8653  21 21 40                   ld hl,varf
     691   00:8656  BE                         cp (hl)
     692   00:8657  C2 6D 86                   jp nz,h00521
     693   00:865A  DD 36 00 FF                ld (ix+0),255
     694   00:865E  3E 6B                      ld a,107
     695   00:8660  32 21 40                   ld (varf),a
     696   00:8663  3E 01                      ld a,1
     697   00:8665  32 22 40                   ld (varg),a
     698   00:8668  3E 13                      ld a,19
     699   00:866A  32 23 40                   ld (varh),a
     700   00:866D  3E 69               h00521 ld a,105
     701   00:866F  21 21 40                   ld hl,varf
     702   00:8672  BE                         cp (hl)
     703   00:8673  C2 80 86                   jp nz,h00556
     704   00:8676  3E DC                      ld a,220
     705   00:8678  DD 77 04                   ld (ix+4),a
     706   00:867B  3E 10                      ld a,16
     707   00:867D  DD 77 03                   ld (ix+3),a
     708   00:8680  3E 68               h00556 ld a,104
     709   00:8682  21 21 40                   ld hl,varf
     710   00:8685  BE                         cp (hl)
     711   00:8686  C2 93 86                   jp nz,h00590
     712   00:8689  3E 3C                      ld a,60
     713   00:868B  DD 77 04                   ld (ix+4),a
     714   00:868E  3E 86                      ld a,134
     715   00:8690  DD 77 03                   ld (ix+3),a
     716   00:8693  3E 67               h00590 ld a,103
     717   00:8695  21 21 40                   ld hl,varf
     718   00:8698  BE                         cp (hl)
     719   00:8699  C2 A6 86                   jp nz,h00625
     720   00:869C  3E DC                      ld a,220
     721   00:869E  DD 77 04                   ld (ix+4),a
     722   00:86A1  3E 36                      ld a,54
     723   00:86A3  DD 77 03                   ld (ix+3),a
     724   00:86A6  3E 66               h00625 ld a,102
     725   00:86A8  21 21 40                   ld hl,varf
     726   00:86AB  BE                         cp (hl)
     727   00:86AC  C2 B9 86                   jp nz,h00659
     728   00:86AF  3E B4                      ld a,180
     729   00:86B1  DD 77 04                   ld (ix+4),a
     730   00:86B4  3E 5C                      ld a,92
     731   00:86B6  DD 77 03                   ld (ix+3),a
     732   00:86B9  3E 65               h00659 ld a,101
     733   00:86BB  21 21 40                   ld hl,varf
     734   00:86BE  BE                         cp (hl)
     735   00:86BF  C2 CC 86                   jp nz,h00694
     736   00:86C2  3E DC                      ld a,220
     737   00:86C4  DD 77 04                   ld (ix+4),a
     738   00:86C7  3E 10                      ld a,16
     739   00:86C9  DD 77 03                   ld (ix+3),a
     740   00:86CC  3E 63               h00694 ld a,99
     741   00:86CE  21 21 40                   ld hl,varf
     742   00:86D1  BE                         cp (hl)
     743   00:86D2  C2 E8 86                   jp nz,h00742
     744   00:86D5  DD 36 00 FF                ld (ix+0),255
     745   00:86D9  3E 64                      ld a,100
     746   00:86DB  32 21 40                   ld (varf),a
     747   00:86DE  3E 01                      ld a,1
     748   00:86E0  32 22 40                   ld (varg),a
     749   00:86E3  3E 12                      ld a,18
     750   00:86E5  32 23 40                   ld (varh),a
     751   00:86E8  3E 62               h00742 ld a,98
     752   00:86EA  21 21 40                   ld hl,varf
     753   00:86ED  BE                         cp (hl)
     754   00:86EE  C2 F6 86                   jp nz,h00767
     755   00:86F1  3E 36                      ld a,54
     756   00:86F3  DD 77 03                   ld (ix+3),a
     757   00:86F6  3E 61               h00767 ld a,97
     758   00:86F8  21 21 40                   ld hl,varf
     759   00:86FB  BE                         cp (hl)
     760   00:86FC  C2 04 87                   jp nz,h00793
     761   00:86FF  3E 14                      ld a,20
     762   00:8701  DD 77 04                   ld (ix+4),a
     763   00:8704  3E 60               h00793 ld a,96
     764   00:8706  21 21 40                   ld hl,varf
     765   00:8709  BE                         cp (hl)
     766   00:870A  C2 12 87                   jp nz,h00818
     767   00:870D  3E 86                      ld a,134
     768   00:870F  DD 77 03                   ld (ix+3),a
     769   00:8712  3E 5F               h00818 ld a,95
     770   00:8714  21 21 40                   ld hl,varf
     771   00:8717  BE                         cp (hl)
     772   00:8718  C2 20 87                   jp nz,h00844
     773   00:871B  3E 10                      ld a,16
     774   00:871D  DD 77 03                   ld (ix+3),a
     775   00:8720  3E 5D               h00844 ld a,93
     776   00:8722  21 21 40                   ld hl,varf
     777   00:8725  BE                         cp (hl)
     778   00:8726  C2 3C 87                   jp nz,h00891
     779   00:8729  DD 36 00 FF                ld (ix+0),255
     780   00:872D  3E 5E                      ld a,94
     781   00:872F  32 21 40                   ld (varf),a
     782   00:8732  3E 01                      ld a,1
     783   00:8734  32 22 40                   ld (varg),a
     784   00:8737  3E 11                      ld a,17
     785   00:8739  32 23 40                   ld (varh),a
     786   00:873C  3E 5C               h00891 ld a,92
     787   00:873E  21 21 40                   ld hl,varf
     788   00:8741  BE                         cp (hl)
     789   00:8742  C2 4F 87                   jp nz,h00925
     790   00:8745  3E 14                      ld a,20
     791   00:8747  DD 77 04                   ld (ix+4),a
     792   00:874A  3E 10                      ld a,16
     793   00:874C  DD 77 03                   ld (ix+3),a
     794   00:874F  3E 5B               h00925 ld a,91
     795   00:8751  21 21 40                   ld hl,varf
     796   00:8754  BE                         cp (hl)
     797   00:8755  C2 62 87                   jp nz,h00960
     798   00:8758  3E B4                      ld a,180
     799   00:875A  DD 77 04                   ld (ix+4),a
     800   00:875D  3E 86                      ld a,134
     801   00:875F  DD 77 03                   ld (ix+3),a
     802   00:8762  3E 5A               h00960 ld a,90
     803   00:8764  21 21 40                   ld hl,varf
     804   00:8767  BE                         cp (hl)
     805   00:8768  C2 75 87                   jp nz,h00994
     806   00:876B  3E DC                      ld a,220
     807   00:876D  DD 77 04                   ld (ix+4),a
     808   00:8770  3E 10                      ld a,16
     809   00:8772  DD 77 03                   ld (ix+3),a
     810   00:8775  3E 59               h00994 ld a,89
     811   00:8777  21 21 40                   ld hl,varf
     812   00:877A  BE                         cp (hl)
     813   00:877B  C2 83 87                   jp nz,h01020
     814   00:877E  3E B4                      ld a,180
     815   00:8780  DD 77 04                   ld (ix+4),a
     816   00:8783  3E 57               h01020 ld a,87
     817   00:8785  21 21 40                   ld hl,varf
     818   00:8788  BE                         cp (hl)
     819   00:8789  C2 9F 87                   jp nz,h01067
     820   00:878C  DD 36 00 FF                ld (ix+0),255
     821   00:8790  3E 58                      ld a,88
     822   00:8792  32 21 40                   ld (varf),a
     823   00:8795  3E 01                      ld a,1
     824   00:8797  32 22 40                   ld (varg),a
     825   00:879A  3E 10                      ld a,16
     826   00:879C  32 23 40                   ld (varh),a
     827   00:879F  3E 56               h01067 ld a,86
     828   00:87A1  21 21 40                   ld hl,varf
     829   00:87A4  BE                         cp (hl)
     830   00:87A5  C2 B2 87                   jp nz,h01101
     831   00:87A8  3E 14                      ld a,20
     832   00:87AA  DD 77 04                   ld (ix+4),a
     833   00:87AD  3E 5C                      ld a,92
     834   00:87AF  DD 77 03                   ld (ix+3),a
     835   00:87B2  3E 55               h01101 ld a,85
     836   00:87B4  21 21 40                   ld hl,varf
     837   00:87B7  BE                         cp (hl)
     838   00:87B8  C2 C5 87                   jp nz,h01136
     839   00:87BB  3E 64                      ld a,100
     840   00:87BD  DD 77 04                   ld (ix+4),a
     841   00:87C0  3E 88                      ld a,136
     842   00:87C2  DD 77 03                   ld (ix+3),a
     843   00:87C5  3E 54               h01136 ld a,84
     844   00:87C7  21 21 40                   ld hl,varf
     845   00:87CA  BE                         cp (hl)
     846   00:87CB  C2 D8 87                   jp nz,h01170
     847   00:87CE  3E DC                      ld a,220
     848   00:87D0  DD 77 04                   ld (ix+4),a
     849   00:87D3  3E 10                      ld a,16
     850   00:87D5  DD 77 03                   ld (ix+3),a
     851   00:87D8  3E 53               h01170 ld a,83
     852   00:87DA  21 21 40                   ld hl,varf
     853   00:87DD  BE                         cp (hl)
     854   00:87DE  C2 EB 87                   jp nz,h01204
     855   00:87E1  3E 14                      ld a,20
     856   00:87E3  DD 77 04                   ld (ix+4),a
     857   00:87E6  3E 5C                      ld a,92
     858   00:87E8  DD 77 03                   ld (ix+3),a
     859   00:87EB  3E 52               h01204 ld a,82
     860   00:87ED  21 21 40                   ld hl,varf
     861   00:87F0  BE                         cp (hl)
     862   00:87F1  C2 F9 87                   jp nz,h01230
     863   00:87F4  3E 10                      ld a,16
     864   00:87F6  DD 77 03                   ld (ix+3),a
     865   00:87F9  3E 50               h01230 ld a,80
     866   00:87FB  21 21 40                   ld hl,varf
     867   00:87FE  BE                         cp (hl)
     868   00:87FF  C2 15 88                   jp nz,h01277
     869   00:8802  DD 36 00 FF                ld (ix+0),255
     870   00:8806  3E 51                      ld a,81
     871   00:8808  32 21 40                   ld (varf),a
     872   00:880B  3E 01                      ld a,1
     873   00:880D  32 22 40                   ld (varg),a
     874   00:8810  3E 0F                      ld a,15
     875   00:8812  32 23 40                   ld (varh),a
     876   00:8815  3E 4F               h01277 ld a,79
     877   00:8817  21 21 40                   ld hl,varf
     878   00:881A  BE                         cp (hl)
     879   00:881B  C2 28 88                   jp nz,h01312
     880   00:881E  3E B4                      ld a,180
     881   00:8820  DD 77 04                   ld (ix+4),a
     882   00:8823  3E 86                      ld a,134
     883   00:8825  DD 77 03                   ld (ix+3),a
     884   00:8828  3E 4E               h01312 ld a,78
     885   00:882A  21 21 40                   ld hl,varf
     886   00:882D  BE                         cp (hl)
     887   00:882E  C2 3B 88                   jp nz,h01346
     888   00:8831  3E DC                      ld a,220
     889   00:8833  DD 77 04                   ld (ix+4),a
     890   00:8836  3E 10                      ld a,16
     891   00:8838  DD 77 03                   ld (ix+3),a
     892   00:883B  3E 4D               h01346 ld a,77
     893   00:883D  21 21 40                   ld hl,varf
     894   00:8840  BE                         cp (hl)
     895   00:8841  C2 4E 88                   jp nz,h01380
     896   00:8844  3E 14                      ld a,20
     897   00:8846  DD 77 04                   ld (ix+4),a
     898   00:8849  3E 86                      ld a,134
     899   00:884B  DD 77 03                   ld (ix+3),a
     900   00:884E  3E 4C               h01380 ld a,76
     901   00:8850  21 21 40                   ld hl,varf
     902   00:8853  BE                         cp (hl)
     903   00:8854  C2 5C 88                   jp nz,h01406
     904   00:8857  3E DC                      ld a,220
     905   00:8859  DD 77 04                   ld (ix+4),a
     906   00:885C  3E 4B               h01406 ld a,75
     907   00:885E  21 21 40                   ld hl,varf
     908   00:8861  BE                         cp (hl)
     909   00:8862  C2 6F 88                   jp nz,h01440
     910   00:8865  3E 14                      ld a,20
     911   00:8867  DD 77 04                   ld (ix+4),a
     912   00:886A  3E 36                      ld a,54
     913   00:886C  DD 77 03                   ld (ix+3),a
     914   00:886F  3E 49               h01440 ld a,73
     915   00:8871  21 21 40                   ld hl,varf
     916   00:8874  BE                         cp (hl)
     917   00:8875  C2 8B 88                   jp nz,h01487
     918   00:8878  DD 36 00 FF                ld (ix+0),255
     919   00:887C  3E 4A                      ld a,74
     920   00:887E  32 21 40                   ld (varf),a
     921   00:8881  3E 01                      ld a,1
     922   00:8883  32 22 40                   ld (varg),a
     923   00:8886  3E 0E                      ld a,14
     924   00:8888  32 23 40                   ld (varh),a
     925   00:888B  3E 48               h01487 ld a,72
     926   00:888D  21 21 40                   ld hl,varf
     927   00:8890  BE                         cp (hl)
     928   00:8891  C2 99 88                   jp nz,h01513
     929   00:8894  3E 10                      ld a,16
     930   00:8896  DD 77 03                   ld (ix+3),a
     931   00:8899  3E 47               h01513 ld a,71
     932   00:889B  21 21 40                   ld hl,varf
     933   00:889E  BE                         cp (hl)
     934   00:889F  C2 AC 88                   jp nz,h01547
     935   00:88A2  3E 14                      ld a,20
     936   00:88A4  DD 77 04                   ld (ix+4),a
     937   00:88A7  3E 88                      ld a,136
     938   00:88A9  DD 77 03                   ld (ix+3),a
     939   00:88AC  3E 46               h01547 ld a,70
     940   00:88AE  21 21 40                   ld hl,varf
     941   00:88B1  BE                         cp (hl)
     942   00:88B2  C2 BA 88                   jp nz,h01573
     943   00:88B5  3E 36                      ld a,54
     944   00:88B7  DD 77 03                   ld (ix+3),a
     945   00:88BA  3E 45               h01573 ld a,69
     946   00:88BC  21 21 40                   ld hl,varf
     947   00:88BF  BE                         cp (hl)
     948   00:88C0  C2 CD 88                   jp nz,h01607
     949   00:88C3  3E B4                      ld a,180
     950   00:88C5  DD 77 04                   ld (ix+4),a
     951   00:88C8  3E 5C                      ld a,92
     952   00:88CA  DD 77 03                   ld (ix+3),a
     953   00:88CD  3E 43               h01607 ld a,67
     954   00:88CF  21 21 40                   ld hl,varf
     955   00:88D2  BE                         cp (hl)
     956   00:88D3  C2 E9 88                   jp nz,h01654
     957   00:88D6  DD 36 00 FF                ld (ix+0),255
     958   00:88DA  3E 44                      ld a,68
     959   00:88DC  32 21 40                   ld (varf),a
     960   00:88DF  3E 01                      ld a,1
     961   00:88E1  32 22 40                   ld (varg),a
     962   00:88E4  3E 0D                      ld a,13
     963   00:88E6  32 23 40                   ld (varh),a
     964   00:88E9  3E 42               h01654 ld a,66
     965   00:88EB  21 21 40                   ld hl,varf
     966   00:88EE  BE                         cp (hl)
     967   00:88EF  C2 FC 88                   jp nz,h01688
     968   00:88F2  3E 14                      ld a,20
     969   00:88F4  DD 77 04                   ld (ix+4),a
     970   00:88F7  3E 10                      ld a,16
     971   00:88F9  DD 77 03                   ld (ix+3),a
     972   00:88FC  3E 41               h01688 ld a,65
     973   00:88FE  21 21 40                   ld hl,varf
     974   00:8901  BE                         cp (hl)
     975   00:8902  C2 0F 89                   jp nz,h01723
     976   00:8905  3E 8C                      ld a,140
     977   00:8907  DD 77 04                   ld (ix+4),a
     978   00:890A  3E 36                      ld a,54
     979   00:890C  DD 77 03                   ld (ix+3),a
     980   00:890F  3E 40               h01723 ld a,64
     981   00:8911  21 21 40                   ld hl,varf
     982   00:8914  BE                         cp (hl)
     983   00:8915  C2 22 89                   jp nz,h01757
     984   00:8918  3E 3C                      ld a,60
     985   00:891A  DD 77 04                   ld (ix+4),a
     986   00:891D  3E 88                      ld a,136
     987   00:891F  DD 77 03                   ld (ix+3),a
     988   00:8922  3E 3F               h01757 ld a,63
     989   00:8924  21 21 40                   ld hl,varf
     990   00:8927  BE                         cp (hl)
     991   00:8928  C2 35 89                   jp nz,h01791
     992   00:892B  3E 14                      ld a,20
     993   00:892D  DD 77 04                   ld (ix+4),a
     994   00:8930  3E 36                      ld a,54
     995   00:8932  DD 77 03                   ld (ix+3),a
     996   00:8935  3E 3D               h01791 ld a,61
     997   00:8937  21 21 40                   ld hl,varf
     998   00:893A  BE                         cp (hl)
     999   00:893B  C2 51 89                   jp nz,h01838
    1000   00:893E  DD 36 00 FF                ld (ix+0),255
    1001   00:8942  3E 3E                      ld a,62
    1002   00:8944  32 21 40                   ld (varf),a
    1003   00:8947  3E 01                      ld a,1
    1004   00:8949  32 22 40                   ld (varg),a
    1005   00:894C  3E 0C                      ld a,12
    1006   00:894E  32 23 40                   ld (varh),a
    1007   00:8951  3E 3C               h01838 ld a,60
    1008   00:8953  21 21 40                   ld hl,varf
    1009   00:8956  BE                         cp (hl)
    1010   00:8957  C2 64 89                   jp nz,h01872
    1011   00:895A  3E 14                      ld a,20
    1012   00:895C  DD 77 04                   ld (ix+4),a
    1013   00:895F  3E 10                      ld a,16
    1014   00:8961  DD 77 03                   ld (ix+3),a
    1015   00:8964  3E 3B               h01872 ld a,59
    1016   00:8966  21 21 40                   ld hl,varf
    1017   00:8969  BE                         cp (hl)
    1018   00:896A  C2 77 89                   jp nz,h01907
    1019   00:896D  3E 3C                      ld a,60
    1020   00:896F  DD 77 04                   ld (ix+4),a
    1021   00:8972  3E 88                      ld a,136
    1022   00:8974  DD 77 03                   ld (ix+3),a
    1023   00:8977  3E 3A               h01907 ld a,58
    1024   00:8979  21 21 40                   ld hl,varf
    1025   00:897C  BE                         cp (hl)
    1026   00:897D  C2 85 89                   jp nz,h01932
    1027   00:8980  3E 10                      ld a,16
    1028   00:8982  DD 77 03                   ld (ix+3),a
    1029   00:8985  3E 39               h01932 ld a,57
    1030   00:8987  21 21 40                   ld hl,varf
    1031   00:898A  BE                         cp (hl)
    1032   00:898B  C2 98 89                   jp nz,h01966
    1033   00:898E  3E 3C                      ld a,60
    1034   00:8990  DD 77 04                   ld (ix+4),a
    1035   00:8993  3E 5C                      ld a,92
    1036   00:8995  DD 77 03                   ld (ix+3),a
    1037   00:8998  3E 38               h01966 ld a,56
    1038   00:899A  21 21 40                   ld hl,varf
    1039   00:899D  BE                         cp (hl)
    1040   00:899E  C2 A6 89                   jp nz,h01992
    1041   00:89A1  3E 10                      ld a,16
    1042   00:89A3  DD 77 03                   ld (ix+3),a
    1043   00:89A6  3E 36               h01992 ld a,54
    1044   00:89A8  21 21 40                   ld hl,varf
    1045   00:89AB  BE                         cp (hl)
    1046   00:89AC  C2 C2 89                   jp nz,h02039
    1047   00:89AF  DD 36 00 FF                ld (ix+0),255
    1048   00:89B3  3E 01                      ld a,1
    1049   00:89B5  32 22 40                   ld (varg),a
    1050   00:89B8  3E 37                      ld a,55
    1051   00:89BA  32 21 40                   ld (varf),a
    1052   00:89BD  3E 0B                      ld a,11
    1053   00:89BF  32 23 40                   ld (varh),a
    1054   00:89C2  3E 35               h02039 ld a,53
    1055   00:89C4  21 21 40                   ld hl,varf
    1056   00:89C7  BE                         cp (hl)
    1057   00:89C8  C2 D5 89                   jp nz,h02073
    1058   00:89CB  3E 14                      ld a,20
    1059   00:89CD  DD 77 04                   ld (ix+4),a
    1060   00:89D0  3E 10                      ld a,16
    1061   00:89D2  DD 77 03                   ld (ix+3),a
    1062   00:89D5  3E 34               h02073 ld a,52
    1063   00:89D7  21 21 40                   ld hl,varf
    1064   00:89DA  BE                         cp (hl)
    1065   00:89DB  C2 E8 89                   jp nz,h02108
    1066   00:89DE  3E 64                      ld a,100
    1067   00:89E0  DD 77 04                   ld (ix+4),a
    1068   00:89E3  3E 88                      ld a,136
    1069   00:89E5  DD 77 03                   ld (ix+3),a
    1070   00:89E8  3E 33               h02108 ld a,51
    1071   00:89EA  21 21 40                   ld hl,varf
    1072   00:89ED  BE                         cp (hl)
    1073   00:89EE  C2 F6 89                   jp nz,h02133
    1074   00:89F1  3E 10                      ld a,16
    1075   00:89F3  DD 77 03                   ld (ix+3),a
    1076   00:89F6  3E 32               h02133 ld a,50
    1077   00:89F8  21 21 40                   ld hl,varf
    1078   00:89FB  BE                         cp (hl)
    1079   00:89FC  C2 09 8A                   jp nz,h02167
    1080   00:89FF  3E 3C                      ld a,60
    1081   00:8A01  DD 77 04                   ld (ix+4),a
    1082   00:8A04  3E 5C                      ld a,92
    1083   00:8A06  DD 77 03                   ld (ix+3),a
    1084   00:8A09  3E 31               h02167 ld a,49
    1085   00:8A0B  21 21 40                   ld hl,varf
    1086   00:8A0E  BE                         cp (hl)
    1087   00:8A0F  C2 1C 8A                   jp nz,h02201
    1088   00:8A12  3E DC                      ld a,220
    1089   00:8A14  DD 77 04                   ld (ix+4),a
    1090   00:8A17  3E 10                      ld a,16
    1091   00:8A19  DD 77 03                   ld (ix+3),a
    1092   00:8A1C  C9                  h02201 ret
    1093   00:8A1D                      
    1094   00:8A1D  (00:8A1D)           evnt08:	equ $
    1095   00:8A1D  AF                         xor a
    1096   00:8A1E  21 1E 40                   ld hl,varc
    1097   00:8A21  BE                         cp (hl)
    1098   00:8A22  C2 29 8A                   jp nz,i00028
    1099   00:8A25  AF                         xor a
    1100   00:8A26  CD C1 C3                   call animsp
    1101   00:8A29  3E 03               i00028 ld a,3
    1102   00:8A2B  E6 0F                      and $0F
    1103   00:8A2D  4F                         ld c,a
    1104   00:8A2E  CD 9D B6                   call cspr
    1105   00:8A31  0E 00                      ld c,0
    1106   00:8A33  CD EF C3                   call sktyp
    1107   00:8A36  D2 54 8A                   jp nc,i00104
    1108   00:8A39  3E 07                      ld a,7
    1109   00:8A3B  E6 0F                      and $0F
    1110   00:8A3D  4F                         ld c,a
    1111   00:8A3E  CD 9D B6                   call cspr
    1112   00:8A41  3E 04                      ld a,4
    1113   00:8A43  CD D0 B8                   call explod
    1114   00:8A46  3E 03                      ld a,3
    1115   00:8A48  0E 00                      ld c,0
    1116   00:8A4A  CD 20 C9                   call sfx_set
    1117   00:8A4D  3A 21 40                   ld a,(varf)
    1118   00:8A50  3C                         inc a
    1119   00:8A51  32 21 40                   ld (varf),a
    1120   00:8A54  3E 30               i00104 ld a,48
    1121   00:8A56  21 21 40                   ld hl,varf
    1122   00:8A59  BE                         cp (hl)
    1123   00:8A5A  C2 70 8A                   jp nz,i00151
    1124   00:8A5D  DD 36 00 FF                ld (ix+0),255
    1125   00:8A61  3E 31                      ld a,49
    1126   00:8A63  32 21 40                   ld (varf),a
    1127   00:8A66  3E 01                      ld a,1
    1128   00:8A68  32 22 40                   ld (varg),a
    1129   00:8A6B  3E 0A                      ld a,10
    1130   00:8A6D  32 23 40                   ld (varh),a
    1131   00:8A70  3E 2F               i00151 ld a,47
    1132   00:8A72  21 21 40                   ld hl,varf
    1133   00:8A75  BE                         cp (hl)
    1134   00:8A76  C2 83 8A                   jp nz,i00186
    1135   00:8A79  3E DC                      ld a,220
    1136   00:8A7B  DD 77 04                   ld (ix+4),a
    1137   00:8A7E  3E 5C                      ld a,92
    1138   00:8A80  DD 77 03                   ld (ix+3),a
    1139   00:8A83  3E 2E               i00186 ld a,46
    1140   00:8A85  21 21 40                   ld hl,varf
    1141   00:8A88  BE                         cp (hl)
    1142   00:8A89  C2 96 8A                   jp nz,i00220
    1143   00:8A8C  3E 3C                      ld a,60
    1144   00:8A8E  DD 77 04                   ld (ix+4),a
    1145   00:8A91  3E 10                      ld a,16
    1146   00:8A93  DD 77 03                   ld (ix+3),a
    1147   00:8A96  3E 2D               i00220 ld a,45
    1148   00:8A98  21 21 40                   ld hl,varf
    1149   00:8A9B  BE                         cp (hl)
    1150   00:8A9C  C2 A9 8A                   jp nz,i00254
    1151   00:8A9F  3E DC                      ld a,220
    1152   00:8AA1  DD 77 04                   ld (ix+4),a
    1153   00:8AA4  3E 36                      ld a,54
    1154   00:8AA6  DD 77 03                   ld (ix+3),a
    1155   00:8AA9  3E 2C               i00254 ld a,44
    1156   00:8AAB  21 21 40                   ld hl,varf
    1157   00:8AAE  BE                         cp (hl)
    1158   00:8AAF  C2 BC 8A                   jp nz,i00288
    1159   00:8AB2  3E 14                      ld a,20
    1160   00:8AB4  DD 77 04                   ld (ix+4),a
    1161   00:8AB7  3E 10                      ld a,16
    1162   00:8AB9  DD 77 03                   ld (ix+3),a
    1163   00:8ABC  3E 2A               i00288 ld a,42
    1164   00:8ABE  21 21 40                   ld hl,varf
    1165   00:8AC1  BE                         cp (hl)
    1166   00:8AC2  C2 D8 8A                   jp nz,i00335
    1167   00:8AC5  DD 36 00 FF                ld (ix+0),255
    1168   00:8AC9  3E 2B                      ld a,43
    1169   00:8ACB  32 21 40                   ld (varf),a
    1170   00:8ACE  3E 01                      ld a,1
    1171   00:8AD0  32 22 40                   ld (varg),a
    1172   00:8AD3  3E 09                      ld a,9
    1173   00:8AD5  32 23 40                   ld (varh),a
    1174   00:8AD8  3E 29               i00335 ld a,41
    1175   00:8ADA  21 21 40                   ld hl,varf
    1176   00:8ADD  BE                         cp (hl)
    1177   00:8ADE  C2 EB 8A                   jp nz,i00369
    1178   00:8AE1  3E DC                      ld a,220
    1179   00:8AE3  DD 77 04                   ld (ix+4),a
    1180   00:8AE6  3E 5C                      ld a,92
    1181   00:8AE8  DD 77 03                   ld (ix+3),a
    1182   00:8AEB  3E 28               i00369 ld a,40
    1183   00:8AED  21 21 40                   ld hl,varf
    1184   00:8AF0  BE                         cp (hl)
    1185   00:8AF1  C2 FE 8A                   jp nz,i00404
    1186   00:8AF4  3E 64                      ld a,100
    1187   00:8AF6  DD 77 04                   ld (ix+4),a
    1188   00:8AF9  3E 88                      ld a,136
    1189   00:8AFB  DD 77 03                   ld (ix+3),a
    1190   00:8AFE  3E 27               i00404 ld a,39
    1191   00:8B00  21 21 40                   ld hl,varf
    1192   00:8B03  BE                         cp (hl)
    1193   00:8B04  C2 11 8B                   jp nz,i00438
    1194   00:8B07  3E 8C                      ld a,140
    1195   00:8B09  DD 77 04                   ld (ix+4),a
    1196   00:8B0C  3E 10                      ld a,16
    1197   00:8B0E  DD 77 03                   ld (ix+3),a
    1198   00:8B11  3E 26               i00438 ld a,38
    1199   00:8B13  21 21 40                   ld hl,varf
    1200   00:8B16  BE                         cp (hl)
    1201   00:8B17  C2 1F 8B                   jp nz,i00464
    1202   00:8B1A  3E 14                      ld a,20
    1203   00:8B1C  DD 77 04                   ld (ix+4),a
    1204   00:8B1F  3E 24               i00464 ld a,36
    1205   00:8B21  21 21 40                   ld hl,varf
    1206   00:8B24  BE                         cp (hl)
    1207   00:8B25  C2 3B 8B                   jp nz,i00511
    1208   00:8B28  DD 36 00 FF                ld (ix+0),255
    1209   00:8B2C  3E 25                      ld a,37
    1210   00:8B2E  32 21 40                   ld (varf),a
    1211   00:8B31  3E 01                      ld a,1
    1212   00:8B33  32 22 40                   ld (varg),a
    1213   00:8B36  3E 08                      ld a,8
    1214   00:8B38  32 23 40                   ld (varh),a
    1215   00:8B3B  3E 23               i00511 ld a,35
    1216   00:8B3D  21 21 40                   ld hl,varf
    1217   00:8B40  BE                         cp (hl)
    1218   00:8B41  C2 4E 8B                   jp nz,i00545
    1219   00:8B44  3E DC                      ld a,220
    1220   00:8B46  DD 77 04                   ld (ix+4),a
    1221   00:8B49  3E 10                      ld a,16
    1222   00:8B4B  DD 77 03                   ld (ix+3),a
    1223   00:8B4E  3E 22               i00545 ld a,34
    1224   00:8B50  21 21 40                   ld hl,varf
    1225   00:8B53  BE                         cp (hl)
    1226   00:8B54  C2 5C 8B                   jp nz,i00571
    1227   00:8B57  3E 3C                      ld a,60
    1228   00:8B59  DD 77 04                   ld (ix+4),a
    1229   00:8B5C  3E 21               i00571 ld a,33
    1230   00:8B5E  21 21 40                   ld hl,varf
    1231   00:8B61  BE                         cp (hl)
    1232   00:8B62  C2 6F 8B                   jp nz,i00605
    1233   00:8B65  3E 8C                      ld a,140
    1234   00:8B67  DD 77 04                   ld (ix+4),a
    1235   00:8B6A  3E 88                      ld a,136
    1236   00:8B6C  DD 77 03                   ld (ix+3),a
    1237   00:8B6F  3E 20               i00605 ld a,32
    1238   00:8B71  21 21 40                   ld hl,varf
    1239   00:8B74  BE                         cp (hl)
    1240   00:8B75  C2 82 8B                   jp nz,i00639
    1241   00:8B78  3E 64                      ld a,100
    1242   00:8B7A  DD 77 04                   ld (ix+4),a
    1243   00:8B7D  3E 5C                      ld a,92
    1244   00:8B7F  DD 77 03                   ld (ix+3),a
    1245   00:8B82  3E 1E               i00639 ld a,30
    1246   00:8B84  21 21 40                   ld hl,varf
    1247   00:8B87  BE                         cp (hl)
    1248   00:8B88  C2 9E 8B                   jp nz,i00687
    1249   00:8B8B  DD 36 00 FF                ld (ix+0),255
    1250   00:8B8F  3E 1F                      ld a,31
    1251   00:8B91  32 21 40                   ld (varf),a
    1252   00:8B94  3E 01                      ld a,1
    1253   00:8B96  32 22 40                   ld (varg),a
    1254   00:8B99  3E 07                      ld a,7
    1255   00:8B9B  32 23 40                   ld (varh),a
    1256   00:8B9E  3E 1D               i00687 ld a,29
    1257   00:8BA0  21 21 40                   ld hl,varf
    1258   00:8BA3  BE                         cp (hl)
    1259   00:8BA4  C2 B1 8B                   jp nz,i00721
    1260   00:8BA7  3E DC                      ld a,220
    1261   00:8BA9  DD 77 04                   ld (ix+4),a
    1262   00:8BAC  3E 10                      ld a,16
    1263   00:8BAE  DD 77 03                   ld (ix+3),a
    1264   00:8BB1  3E 1C               i00721 ld a,28
    1265   00:8BB3  21 21 40                   ld hl,varf
    1266   00:8BB6  BE                         cp (hl)
    1267   00:8BB7  C2 C4 8B                   jp nz,i00755
    1268   00:8BBA  3E 3C                      ld a,60
    1269   00:8BBC  DD 77 04                   ld (ix+4),a
    1270   00:8BBF  3E 36                      ld a,54
    1271   00:8BC1  DD 77 03                   ld (ix+3),a
    1272   00:8BC4  3E 1B               i00755 ld a,27
    1273   00:8BC6  21 21 40                   ld hl,varf
    1274   00:8BC9  BE                         cp (hl)
    1275   00:8BCA  C2 D7 8B                   jp nz,i00789
    1276   00:8BCD  3E DC                      ld a,220
    1277   00:8BCF  DD 77 04                   ld (ix+4),a
    1278   00:8BD2  3E 88                      ld a,136
    1279   00:8BD4  DD 77 03                   ld (ix+3),a
    1280   00:8BD7  3E 1A               i00789 ld a,26
    1281   00:8BD9  21 21 40                   ld hl,varf
    1282   00:8BDC  BE                         cp (hl)
    1283   00:8BDD  C2 EA 8B                   jp nz,i00823
    1284   00:8BE0  3E 14                      ld a,20
    1285   00:8BE2  DD 77 04                   ld (ix+4),a
    1286   00:8BE5  3E 10                      ld a,16
    1287   00:8BE7  DD 77 03                   ld (ix+3),a
    1288   00:8BEA  3E 18               i00823 ld a,24
    1289   00:8BEC  21 21 40                   ld hl,varf
    1290   00:8BEF  BE                         cp (hl)
    1291   00:8BF0  C2 06 8C                   jp nz,i00871
    1292   00:8BF3  DD 36 00 FF                ld (ix+0),255
    1293   00:8BF7  3E 19                      ld a,25
    1294   00:8BF9  32 21 40                   ld (varf),a
    1295   00:8BFC  3E 01                      ld a,1
    1296   00:8BFE  32 22 40                   ld (varg),a
    1297   00:8C01  3E 06                      ld a,6
    1298   00:8C03  32 23 40                   ld (varh),a
    1299   00:8C06  3E 17               i00871 ld a,23
    1300   00:8C08  21 21 40                   ld hl,varf
    1301   00:8C0B  BE                         cp (hl)
    1302   00:8C0C  C2 19 8C                   jp nz,i00905
    1303   00:8C0F  3E 14                      ld a,20
    1304   00:8C11  DD 77 04                   ld (ix+4),a
    1305   00:8C14  3E 10                      ld a,16
    1306   00:8C16  DD 77 03                   ld (ix+3),a
    1307   00:8C19  3E 16               i00905 ld a,22
    1308   00:8C1B  21 21 40                   ld hl,varf
    1309   00:8C1E  BE                         cp (hl)
    1310   00:8C1F  C2 2C 8C                   jp nz,i00939
    1311   00:8C22  3E DC                      ld a,220
    1312   00:8C24  DD 77 04                   ld (ix+4),a
    1313   00:8C27  3E 5C                      ld a,92
    1314   00:8C29  DD 77 03                   ld (ix+3),a
    1315   00:8C2C  3E 15               i00939 ld a,21
    1316   00:8C2E  21 21 40                   ld hl,varf
    1317   00:8C31  BE                         cp (hl)
    1318   00:8C32  C2 3F 8C                   jp nz,i00973
    1319   00:8C35  3E 14                      ld a,20
    1320   00:8C37  DD 77 04                   ld (ix+4),a
    1321   00:8C3A  3E 88                      ld a,136
    1322   00:8C3C  DD 77 03                   ld (ix+3),a
    1323   00:8C3F  3E 13               i00973 ld a,19
    1324   00:8C41  21 21 40                   ld hl,varf
    1325   00:8C44  BE                         cp (hl)
    1326   00:8C45  C2 5B 8C                   jp nz,i01020
    1327   00:8C48  DD 36 00 FF                ld (ix+0),255
    1328   00:8C4C  3E 14                      ld a,20
    1329   00:8C4E  32 21 40                   ld (varf),a
    1330   00:8C51  3E 01                      ld a,1
    1331   00:8C53  32 22 40                   ld (varg),a
    1332   00:8C56  3E 05                      ld a,5
    1333   00:8C58  32 23 40                   ld (varh),a
    1334   00:8C5B  3E 12               i01020 ld a,18
    1335   00:8C5D  21 21 40                   ld hl,varf
    1336   00:8C60  BE                         cp (hl)
    1337   00:8C61  C2 6E 8C                   jp nz,i01054
    1338   00:8C64  3E 3C                      ld a,60
    1339   00:8C66  DD 77 04                   ld (ix+4),a
    1340   00:8C69  3E 5C                      ld a,92
    1341   00:8C6B  DD 77 03                   ld (ix+3),a
    1342   00:8C6E  3E 11               i01054 ld a,17
    1343   00:8C70  21 21 40                   ld hl,varf
    1344   00:8C73  BE                         cp (hl)
    1345   00:8C74  C2 81 8C                   jp nz,i01089
    1346   00:8C77  3E DC                      ld a,220
    1347   00:8C79  DD 77 04                   ld (ix+4),a
    1348   00:8C7C  3E 10                      ld a,16
    1349   00:8C7E  DD 77 03                   ld (ix+3),a
    1350   00:8C81  3E 01               i01089 ld a,1
    1351   00:8C83  21 21 40                   ld hl,varf
    1352   00:8C86  BE                         cp (hl)
    1353   00:8C87  C2 94 8C                   jp nz,i01122
    1354   00:8C8A  3E 3C                      ld a,60
    1355   00:8C8C  DD 77 04                   ld (ix+4),a
    1356   00:8C8F  3E 36                      ld a,54
    1357   00:8C91  DD 77 03                   ld (ix+3),a
    1358   00:8C94  3E 02               i01122 ld a,2
    1359   00:8C96  21 21 40                   ld hl,varf
    1360   00:8C99  BE                         cp (hl)
    1361   00:8C9A  C2 A2 8C                   jp nz,i01148
    1362   00:8C9D  3E DC                      ld a,220
    1363   00:8C9F  DD 77 04                   ld (ix+4),a
    1364   00:8CA2  3E 03               i01148 ld a,3
    1365   00:8CA4  21 21 40                   ld hl,varf
    1366   00:8CA7  BE                         cp (hl)
    1367   00:8CA8  C2 B5 8C                   jp nz,i01182
    1368   00:8CAB  3E 14                      ld a,20
    1369   00:8CAD  DD 77 04                   ld (ix+4),a
    1370   00:8CB0  3E 10                      ld a,16
    1371   00:8CB2  DD 77 03                   ld (ix+3),a
    1372   00:8CB5  3E 04               i01182 ld a,4
    1373   00:8CB7  21 21 40                   ld hl,varf
    1374   00:8CBA  BE                         cp (hl)
    1375   00:8CBB  C2 D1 8C                   jp nz,i01228
    1376   00:8CBE  DD 36 00 FF                ld (ix+0),255
    1377   00:8CC2  3E 01                      ld a,1
    1378   00:8CC4  32 22 40                   ld (varg),a
    1379   00:8CC7  3E 05                      ld a,5
    1380   00:8CC9  32 21 40                   ld (varf),a
    1381   00:8CCC  3E 02                      ld a,2
    1382   00:8CCE  32 23 40                   ld (varh),a
    1383   00:8CD1  3E 06               i01228 ld a,6
    1384   00:8CD3  21 21 40                   ld hl,varf
    1385   00:8CD6  BE                         cp (hl)
    1386   00:8CD7  C2 E4 8C                   jp nz,i01263
    1387   00:8CDA  3E 64                      ld a,100
    1388   00:8CDC  DD 77 04                   ld (ix+4),a
    1389   00:8CDF  3E 88                      ld a,136
    1390   00:8CE1  DD 77 03                   ld (ix+3),a
    1391   00:8CE4  3E 07               i01263 ld a,7
    1392   00:8CE6  21 21 40                   ld hl,varf
    1393   00:8CE9  BE                         cp (hl)
    1394   00:8CEA  C2 F2 8C                   jp nz,i01288
    1395   00:8CED  3E DC                      ld a,220
    1396   00:8CEF  DD 77 04                   ld (ix+4),a
    1397   00:8CF2  3E 08               i01288 ld a,8
    1398   00:8CF4  21 21 40                   ld hl,varf
    1399   00:8CF7  BE                         cp (hl)
    1400   00:8CF8  C2 00 8D                   jp nz,i01313
    1401   00:8CFB  3E 14                      ld a,20
    1402   00:8CFD  DD 77 04                   ld (ix+4),a
    1403   00:8D00  3E 09               i01313 ld a,9
    1404   00:8D02  21 21 40                   ld hl,varf
    1405   00:8D05  BE                         cp (hl)
    1406   00:8D06  C2 1C 8D                   jp nz,i01360
    1407   00:8D09  DD 36 00 FF                ld (ix+0),255
    1408   00:8D0D  3E 0A                      ld a,10
    1409   00:8D0F  32 21 40                   ld (varf),a
    1410   00:8D12  3E 01                      ld a,1
    1411   00:8D14  32 22 40                   ld (varg),a
    1412   00:8D17  3E 03                      ld a,3
    1413   00:8D19  32 23 40                   ld (varh),a
    1414   00:8D1C  3E 0B               i01360 ld a,11
    1415   00:8D1E  21 21 40                   ld hl,varf
    1416   00:8D21  BE                         cp (hl)
    1417   00:8D22  C2 2F 8D                   jp nz,i01394
    1418   00:8D25  3E 14                      ld a,20
    1419   00:8D27  DD 77 04                   ld (ix+4),a
    1420   00:8D2A  3E 36                      ld a,54
    1421   00:8D2C  DD 77 03                   ld (ix+3),a
    1422   00:8D2F  3E 0C               i01394 ld a,12
    1423   00:8D31  21 21 40                   ld hl,varf
    1424   00:8D34  BE                         cp (hl)
    1425   00:8D35  C2 42 8D                   jp nz,i01429
    1426   00:8D38  3E B4                      ld a,180
    1427   00:8D3A  DD 77 04                   ld (ix+4),a
    1428   00:8D3D  3E 5C                      ld a,92
    1429   00:8D3F  DD 77 03                   ld (ix+3),a
    1430   00:8D42  3E 0D               i01429 ld a,13
    1431   00:8D44  21 21 40                   ld hl,varf
    1432   00:8D47  BE                         cp (hl)
    1433   00:8D48  C2 55 8D                   jp nz,i01463
    1434   00:8D4B  3E 14                      ld a,20
    1435   00:8D4D  DD 77 04                   ld (ix+4),a
    1436   00:8D50  3E 88                      ld a,136
    1437   00:8D52  DD 77 03                   ld (ix+3),a
    1438   00:8D55  3E 0E               i01463 ld a,14
    1439   00:8D57  21 21 40                   ld hl,varf
    1440   00:8D5A  BE                         cp (hl)
    1441   00:8D5B  C2 71 8D                   jp nz,i01510
    1442   00:8D5E  DD 36 00 FF                ld (ix+0),255
    1443   00:8D62  3E 0F                      ld a,15
    1444   00:8D64  32 21 40                   ld (varf),a
    1445   00:8D67  3E 01                      ld a,1
    1446   00:8D69  32 22 40                   ld (varg),a
    1447   00:8D6C  3E 04                      ld a,4
    1448   00:8D6E  32 23 40                   ld (varh),a
    1449   00:8D71  3E 10               i01510 ld a,16
    1450   00:8D73  21 21 40                   ld hl,varf
    1451   00:8D76  BE                         cp (hl)
    1452   00:8D77  C2 7F 8D                   jp nz,i01536
    1453   00:8D7A  3E 14                      ld a,20
    1454   00:8D7C  DD 77 04                   ld (ix+4),a
    1455   00:8D7F  C9                  i01536 ret
    1456   00:8D80                      
    1457   00:8D80  (00:8D80)           evnt09:	equ $
    1458   00:8D80  AF                         xor a
    1459   00:8D81  DD BE 00                   cp (ix+0)
    1460   00:8D84  C2 8C 8D                   jp nz,j00024
    1461   00:8D87  3E 14                      ld a,20
    1462   00:8D89  DD 77 04                   ld (ix+4),a
    1463   00:8D8C  3E 01               j00024 ld a,1
    1464   00:8D8E  DD BE 00                   cp (ix+0)
    1465   00:8D91  C2 9D 8D                   jp nz,j00054
    1466   00:8D94  0E 04                      ld c,4
    1467   00:8D96  DD 7E 03                   ld a,(ix+3)
    1468   00:8D99  81                         add a,c
    1469   00:8D9A  DD 77 03                   ld (ix+3),a
    1470   00:8D9D  3E 02               j00054 ld a,2
    1471   00:8D9F  DD BE 00                   cp (ix+0)
    1472   00:8DA2  C2 AE 8D                   jp nz,j00083
    1473   00:8DA5  0E 04                      ld c,4
    1474   00:8DA7  DD 7E 03                   ld a,(ix+3)
    1475   00:8DAA  81                         add a,c
    1476   00:8DAB  DD 77 03                   ld (ix+3),a
    1477   00:8DAE  3E 03               j00083 ld a,3
    1478   00:8DB0  DD BE 00                   cp (ix+0)
    1479   00:8DB3  C2 BF 8D                   jp nz,j00113
    1480   00:8DB6  0E 02                      ld c,2
    1481   00:8DB8  DD 7E 03                   ld a,(ix+3)
    1482   00:8DBB  81                         add a,c
    1483   00:8DBC  DD 77 03                   ld (ix+3),a
    1484   00:8DBF  3E 04               j00113 ld a,4
    1485   00:8DC1  DD BE 00                   cp (ix+0)
    1486   00:8DC4  C2 D0 8D                   jp nz,j00142
    1487   00:8DC7  0E 04                      ld c,4
    1488   00:8DC9  DD 7E 03                   ld a,(ix+3)
    1489   00:8DCC  81                         add a,c
    1490   00:8DCD  DD 77 03                   ld (ix+3),a
    1491   00:8DD0  C9                  j00142 ret
    1492   00:8DD1                      
    1493   00:8DD1  (00:8DD1)           evnt10:	equ $
    1494   00:8DD1  3E 06                      ld a,6
    1495   00:8DD3  87                         add a,a
    1496   00:8DD4  87                         add a,a
    1497   00:8DD5  87                         add a,a
    1498   00:8DD6  87                         add a,a
    1499   00:8DD7  5F                         ld e,a
    1500   00:8DD8  3A 39 40                   ld a,(clratt)
    1501   00:8DDB  E6 0F                      and $0F
    1502   00:8DDD  B3                         or e
    1503   00:8DDE  32 39 40                   ld (clratt),a
    1504   00:8DE1  AF                         xor a
    1505   00:8DE2  32 35 40                   ld (charx),a
    1506   00:8DE5  3E 07                      ld a,7
    1507   00:8DE7  32 36 40                   ld (chary),a
    1508   00:8DEA  3A 23 40                   ld a,(varh)
    1509   00:8DED  CD 4D C4                   call disply
    1510   00:8DF0  AF                         xor a
    1511   00:8DF1  32 35 40                   ld (charx),a
    1512   00:8DF4  3E 1E                      ld a,30
    1513   00:8DF6  32 36 40                   ld (chary),a
    1514   00:8DF9  AF                         xor a
    1515   00:8DFA  5F                         ld e,a
    1516   00:8DFB  3A 39 40                   ld a,(clratt)
    1517   00:8DFE  E6 F0                      and $F0
    1518   00:8E00  B3                         or e
    1519   00:8E01  32 39 40                   ld (clratt),a
    1520   00:8E04  3A 45 40                   ld a,(numlif)
    1521   00:8E07  CD 4D C4                   call disply
    1522   00:8E0A  C9                         ret
    1523   00:8E0B                      
    1524   00:8E0B  (00:8E0B)           evnt11:	equ $
    1525   00:8E0B  3E 02                      ld a,2
    1526   00:8E0D  21 1E 40                   ld hl,varc
    1527   00:8E10  BE                         cp (hl)
    1528   00:8E11  C2 1B 8E                   jp nz,l00032
    1529   00:8E14  AF                         xor a
    1530   00:8E15  32 1E 40                   ld (varc),a
    1531   00:8E18  C3 22 8E                   jp l00045
    1532   00:8E1B  3A 1E 40            l00032 ld a,(varc)
    1533   00:8E1E  3C                         inc a
    1534   00:8E1F  32 1E 40                   ld (varc),a
    1535   00:8E22  AF                  l00045 xor a
    1536   00:8E23  21 1D 40                   ld hl,varb
    1537   00:8E26  BE                         cp (hl)
    1538   00:8E27  C2 2D 8E                   jp nz,l00066
    1539   00:8E2A  C3 34 8E                   jp l00079
    1540   00:8E2D  3A 1D 40            l00066 ld a,(varb)
    1541   00:8E30  3D                         dec a
    1542   00:8E31  32 1D 40                   ld (varb),a
    1543   00:8E34  3E 14               l00079 ld a,20
    1544   00:8E36  21 41 40                   ld hl,scno
    1545   00:8E39  BE                         cp (hl)
    1546   00:8E3A  C2 AC 8E                   jp nz,l00313
    1547   00:8E3D  3E 0A                      ld a,10
    1548   00:8E3F  32 35 40                   ld (charx),a
    1549   00:8E42  3E 05                      ld a,5
    1550   00:8E44  32 36 40                   ld (chary),a
    1551   00:8E47  3E 05                      ld a,5
    1552   00:8E49  87                         add a,a
    1553   00:8E4A  87                         add a,a
    1554   00:8E4B  87                         add a,a
    1555   00:8E4C  87                         add a,a
    1556   00:8E4D  5F                         ld e,a
    1557   00:8E4E  3A 39 40                   ld a,(clratt)
    1558   00:8E51  E6 0F                      and $0F
    1559   00:8E53  B3                         or e
    1560   00:8E54  32 39 40                   ld (clratt),a
    1561   00:8E57  AF                         xor a
    1562   00:8E58  5F                         ld e,a
    1563   00:8E59  3A 39 40                   ld a,(clratt)
    1564   00:8E5C  E6 F0                      and $F0
    1565   00:8E5E  B3                         or e
    1566   00:8E5F  32 39 40                   ld (clratt),a
    1567   00:8E62  3E 0B                      ld a,11
    1568   00:8E64  CD 88 C0                   call dmsg
    1569   00:8E67  3E 0C                      ld a,12
    1570   00:8E69  32 35 40                   ld (charx),a
    1571   00:8E6C  3E 0A                      ld a,10
    1572   00:8E6E  32 36 40                   ld (chary),a
    1573   00:8E71  3E 0C                      ld a,12
    1574   00:8E73  CD 88 C0                   call dmsg
    1575   00:8E76  3E 03                      ld a,3
    1576   00:8E78  57                         ld d,a
    1577   00:8E79  CD 05 C0                   call random
    1578   00:8E7C  67                         ld h,a
    1579   00:8E7D  CD DB BA                   call imul
    1580   00:8E80  7C                         ld a,h
    1581   00:8E81  32 56 40                   ld (varrnd),a
    1582   00:8E84  3A 56 40                   ld a,(varrnd)
    1583   00:8E87  3C                         inc a
    1584   00:8E88  32 56 40                   ld (varrnd),a
    1585   00:8E8B  3E 07                      ld a,7
    1586   00:8E8D  32 35 40                   ld (charx),a
    1587   00:8E90  3E 09                      ld a,9
    1588   00:8E92  32 36 40                   ld (chary),a
    1589   00:8E95  3A 56 40                   ld a,(varrnd)
    1590   00:8E98  32 36 40                   ld (chary),a
    1591   00:8E9B  3E 0A                      ld a,10
    1592   00:8E9D  CD 88 C0                   call dmsg
    1593   00:8EA0  AF                         xor a
    1594   00:8EA1  21 1D 40                   ld hl,varb
    1595   00:8EA4  BE                         cp (hl)
    1596   00:8EA5  C2 AC 8E                   jp nz,l00313
    1597   00:8EA8  21 53 40                   ld hl,gamwon
    1598   00:8EAB  74                         ld (hl),h
    1599   00:8EAC  C9                  l00313 ret
    1600   00:8EAD                      
    1601   00:8EAD  (00:8EAD)           evnt12:	equ $
    1602   00:8EAD  3E 01                      ld a,1
    1603   00:8EAF  32 EB 53                   ld (MSX_BDRCLR),a
    1604   00:8EB2  47                         ld b,a
    1605   00:8EB3  0E 07                      ld c,7
    1606   00:8EB5  CD 47 00                   call MSX_WRTVDP
    1607   00:8EB8  3E 04                      ld a,4
    1608   00:8EBA  87                         add a,a
    1609   00:8EBB  87                         add a,a
    1610   00:8EBC  87                         add a,a
    1611   00:8EBD  87                         add a,a
    1612   00:8EBE  5F                         ld e,a
    1613   00:8EBF  3A 39 40                   ld a,(clratt)
    1614   00:8EC2  E6 0F                      and $0F
    1615   00:8EC4  B3                         or e
    1616   00:8EC5  32 39 40                   ld (clratt),a
    1617   00:8EC8  AF                         xor a
    1618   00:8EC9  5F                         ld e,a
    1619   00:8ECA  3A 39 40                   ld a,(clratt)
    1620   00:8ECD  E6 F0                      and $F0
    1621   00:8ECF  B3                         or e
    1622   00:8ED0  32 39 40                   ld (clratt),a
    1623   00:8ED3  CD 42 B6                   call cls
    1624   00:8ED6  3E 03                      ld a,3
    1625   00:8ED8  32 35 40                   ld (charx),a
    1626   00:8EDB  3E 0B                      ld a,11
    1627   00:8EDD  32 36 40                   ld (chary),a
    1628   00:8EE0  3E 0B                      ld a,11
    1629   00:8EE2  87                         add a,a
    1630   00:8EE3  87                         add a,a
    1631   00:8EE4  87                         add a,a
    1632   00:8EE5  87                         add a,a
    1633   00:8EE6  5F                         ld e,a
    1634   00:8EE7  3A 39 40                   ld a,(clratt)
    1635   00:8EEA  E6 0F                      and $0F
    1636   00:8EEC  B3                         or e
    1637   00:8EED  32 39 40                   ld (clratt),a
    1638   00:8EF0  AF                         xor a
    1639   00:8EF1  5F                         ld e,a
    1640   00:8EF2  3A 39 40                   ld a,(clratt)
    1641   00:8EF5  E6 F0                      and $F0
    1642   00:8EF7  B3                         or e
    1643   00:8EF8  32 39 40                   ld (clratt),a
    1644   00:8EFB  3E 01                      ld a,1
    1645   00:8EFD  32 EB 53                   ld (MSX_BDRCLR),a
    1646   00:8F00  47                         ld b,a
    1647   00:8F01  0E 07                      ld c,7
    1648   00:8F03  CD 47 00                   call MSX_WRTVDP
    1649   00:8F06  3E 01                      ld a,1
    1650   00:8F08  CD 88 C0                   call dmsg
    1651   00:8F0B  3E 05                      ld a,5
    1652   00:8F0D  32 35 40                   ld (charx),a
    1653   00:8F10  3E 08                      ld a,8
    1654   00:8F12  32 36 40                   ld (chary),a
    1655   00:8F15  3E 05                      ld a,5
    1656   00:8F17  87                         add a,a
    1657   00:8F18  87                         add a,a
    1658   00:8F19  87                         add a,a
    1659   00:8F1A  87                         add a,a
    1660   00:8F1B  5F                         ld e,a
    1661   00:8F1C  3A 39 40                   ld a,(clratt)
    1662   00:8F1F  E6 0F                      and $0F
    1663   00:8F21  B3                         or e
    1664   00:8F22  32 39 40                   ld (clratt),a
    1665   00:8F25  AF                         xor a
    1666   00:8F26  5F                         ld e,a
    1667   00:8F27  3A 39 40                   ld a,(clratt)
    1668   00:8F2A  E6 F0                      and $F0
    1669   00:8F2C  B3                         or e
    1670   00:8F2D  32 39 40                   ld (clratt),a
    1671   00:8F30  3E 05                      ld a,5
    1672   00:8F32  CD 88 C0                   call dmsg
    1673   00:8F35  3E 08                      ld a,8
    1674   00:8F37  32 35 40                   ld (charx),a
    1675   00:8F3A  3E 04                      ld a,4
    1676   00:8F3C  32 36 40                   ld (chary),a
    1677   00:8F3F  3E 0D                      ld a,13
    1678   00:8F41  87                         add a,a
    1679   00:8F42  87                         add a,a
    1680   00:8F43  87                         add a,a
    1681   00:8F44  87                         add a,a
    1682   00:8F45  5F                         ld e,a
    1683   00:8F46  3A 39 40                   ld a,(clratt)
    1684   00:8F49  E6 0F                      and $0F
    1685   00:8F4B  B3                         or e
    1686   00:8F4C  32 39 40                   ld (clratt),a
    1687   00:8F4F  AF                         xor a
    1688   00:8F50  5F                         ld e,a
    1689   00:8F51  3A 39 40                   ld a,(clratt)
    1690   00:8F54  E6 F0                      and $F0
    1691   00:8F56  B3                         or e
    1692   00:8F57  32 39 40                   ld (clratt),a
    1693   00:8F5A  3E 06                      ld a,6
    1694   00:8F5C  CD 88 C0                   call dmsg
    1695   00:8F5F  3E 09                      ld a,9
    1696   00:8F61  32 35 40                   ld (charx),a
    1697   00:8F64  3E 04                      ld a,4
    1698   00:8F66  32 36 40                   ld (chary),a
    1699   00:8F69  3E 07                      ld a,7
    1700   00:8F6B  CD 88 C0                   call dmsg
    1701   00:8F6E  3E 0A                      ld a,10
    1702   00:8F70  32 35 40                   ld (charx),a
    1703   00:8F73  3E 04                      ld a,4
    1704   00:8F75  32 36 40                   ld (chary),a
    1705   00:8F78  3E 08                      ld a,8
    1706   00:8F7A  CD 88 C0                   call dmsg
    1707   00:8F7D  3E 13                      ld a,19
    1708   00:8F7F  32 35 40                   ld (charx),a
    1709   00:8F82  3E 05                      ld a,5
    1710   00:8F84  32 36 40                   ld (chary),a
    1711   00:8F87  3E 06                      ld a,6
    1712   00:8F89  87                         add a,a
    1713   00:8F8A  87                         add a,a
    1714   00:8F8B  87                         add a,a
    1715   00:8F8C  87                         add a,a
    1716   00:8F8D  5F                         ld e,a
    1717   00:8F8E  3A 39 40                   ld a,(clratt)
    1718   00:8F91  E6 0F                      and $0F
    1719   00:8F93  B3                         or e
    1720   00:8F94  32 39 40                   ld (clratt),a
    1721   00:8F97  AF                         xor a
    1722   00:8F98  5F                         ld e,a
    1723   00:8F99  3A 39 40                   ld a,(clratt)
    1724   00:8F9C  E6 F0                      and $F0
    1725   00:8F9E  B3                         or e
    1726   00:8F9F  32 39 40                   ld (clratt),a
    1727   00:8FA2  3E 09                      ld a,9
    1728   00:8FA4  CD 88 C0                   call dmsg
    1729   00:8FA7  3E 01                      ld a,1
    1730   00:8FA9  32 EB 53                   ld (MSX_BDRCLR),a
    1731   00:8FAC  47                         ld b,a
    1732   00:8FAD  0E 07                      ld c,7
    1733   00:8FAF  CD 47 00                   call MSX_WRTVDP
    1734   00:8FB2  3E 63                      ld a,99
    1735   00:8FB4  32 34 40                   ld (contrl),a
    1736   00:8FB7  3E 63               m00550 ld a,99
    1737   00:8FB9  21 34 40                   ld hl,contrl
    1738   00:8FBC  BE                         cp (hl)
    1739   00:8FBD  C2 01 90                   jp nz,m00704
    1740   00:8FC0  21 8B 40                   ld hl,keys+14
    1741   00:8FC3  7E                         ld a,(hl)
    1742   00:8FC4  23                         inc hl
    1743   00:8FC5  56                         ld d,(hl)
    1744   00:8FC6  CD 17 C0                   call ktest
    1745   00:8FC9  DA D0 8F                   jp c,m00602
    1746   00:8FCC  AF                         xor a
    1747   00:8FCD  32 34 40                   ld (contrl),a
    1748   00:8FD0  21 8D 40            m00602 ld hl,keys+16
    1749   00:8FD3  7E                         ld a,(hl)
    1750   00:8FD4  23                         inc hl
    1751   00:8FD5  56                         ld d,(hl)
    1752   00:8FD6  CD 17 C0                   call ktest
    1753   00:8FD9  DA E1 8F                   jp c,m00638
    1754   00:8FDC  3E 01                      ld a,1
    1755   00:8FDE  32 34 40                   ld (contrl),a
    1756   00:8FE1  21 8F 40            m00638 ld hl,keys+18
    1757   00:8FE4  7E                         ld a,(hl)
    1758   00:8FE5  23                         inc hl
    1759   00:8FE6  56                         ld d,(hl)
    1760   00:8FE7  CD 17 C0                   call ktest
    1761   00:8FEA  DA F2 8F                   jp c,m00673
    1762   00:8FED  3E 02                      ld a,2
    1763   00:8FEF  32 34 40                   ld (contrl),a
    1764   00:8FF2  21 91 40            m00673 ld hl,keys+20
    1765   00:8FF5  7E                         ld a,(hl)
    1766   00:8FF6  23                         inc hl
    1767   00:8FF7  56                         ld d,(hl)
    1768   00:8FF8  CD 17 C0                   call ktest
    1769   00:8FFB  DA FE 8F                   jp c,m00699
    1770   00:8FFE  C3 B7 8F            m00699 jp m00550
    1771   00:9001  3E 03               m00704 ld a,3
    1772   00:9003  32 EB 53                   ld (MSX_BDRCLR),a
    1773   00:9006  47                         ld b,a
    1774   00:9007  0E 07                      ld c,7
    1775   00:9009  CD 47 00                   call MSX_WRTVDP
    1776   00:900C  C9                         ret
    1777   00:900D                      
    1778   00:900D  (00:900D)           evnt13:	equ $
    1779   00:900D  3E 03                      ld a,3
    1780   00:900F  32 45 40                   ld (numlif),a
    1781   00:9012  3E 0F                      ld a,15
    1782   00:9014  87                         add a,a
    1783   00:9015  87                         add a,a
    1784   00:9016  87                         add a,a
    1785   00:9017  87                         add a,a
    1786   00:9018  5F                         ld e,a
    1787   00:9019  3A 39 40                   ld a,(clratt)
    1788   00:901C  E6 0F                      and $0F
    1789   00:901E  B3                         or e
    1790   00:901F  32 39 40                   ld (clratt),a
    1791   00:9022  3E 08                      ld a,8
    1792   00:9024  5F                         ld e,a
    1793   00:9025  3A 39 40                   ld a,(clratt)
    1794   00:9028  E6 F0                      and $F0
    1795   00:902A  B3                         or e
    1796   00:902B  32 39 40                   ld (clratt),a
    1797   00:902E  AF                         xor a
    1798   00:902F  32 EB 53                   ld (MSX_BDRCLR),a
    1799   00:9032  47                         ld b,a
    1800   00:9033  0E 07                      ld c,7
    1801   00:9035  CD 47 00                   call MSX_WRTVDP
    1802   00:9038  CD 42 B6                   call cls
    1803   00:903B  3E 18                      ld a,24
    1804   00:903D  32 1C 40                   ld (vara),a
    1805   00:9040  AF                         xor a
    1806   00:9041  32 1D 40                   ld (varb),a
    1807   00:9044  AF                         xor a
    1808   00:9045  32 1E 40                   ld (varc),a
    1809   00:9048  AF                         xor a
    1810   00:9049  32 1F 40                   ld (vard),a
    1811   00:904C  AF                         xor a
    1812   00:904D  32 20 40                   ld (vare),a
    1813   00:9050  AF                         xor a
    1814   00:9051  32 21 40                   ld (varf),a
    1815   00:9054  AF                         xor a
    1816   00:9055  32 22 40                   ld (varg),a
    1817   00:9058  3E 01                      ld a,1
    1818   00:905A  32 23 40                   ld (varh),a
    1819   00:905D  AF                         xor a
    1820   00:905E  32 24 40                   ld (vari),a
    1821   00:9061  AF                         xor a
    1822   00:9062  32 25 40                   ld (varj),a
    1823   00:9065  AF                         xor a
    1824   00:9066  32 26 40                   ld (vark),a
    1825   00:9069  AF                         xor a
    1826   00:906A  32 27 40                   ld (varl),a
    1827   00:906D  AF                         xor a
    1828   00:906E  32 28 40                   ld (varm),a
    1829   00:9071  C9                         ret
    1830   00:9072                      
    1831   00:9072  (00:9072)           evnt14:	equ $
    1832   00:9072  CD 18 C9                   call sfx_mute
    1833   00:9075  AF                         xor a
    1834   00:9076  32 EB 53                   ld (MSX_BDRCLR),a
    1835   00:9079  47                         ld b,a
    1836   00:907A  0E 07                      ld c,7
    1837   00:907C  CD 47 00                   call MSX_WRTVDP
    1838   00:907F  3E 07                      ld a,7
    1839   00:9081  87                         add a,a
    1840   00:9082  87                         add a,a
    1841   00:9083  87                         add a,a
    1842   00:9084  87                         add a,a
    1843   00:9085  5F                         ld e,a
    1844   00:9086  3A 39 40                   ld a,(clratt)
    1845   00:9089  E6 0F                      and $0F
    1846   00:908B  B3                         or e
    1847   00:908C  32 39 40                   ld (clratt),a
    1848   00:908F  AF                         xor a
    1849   00:9090  5F                         ld e,a
    1850   00:9091  3A 39 40                   ld a,(clratt)
    1851   00:9094  E6 F0                      and $F0
    1852   00:9096  B3                         or e
    1853   00:9097  32 39 40                   ld (clratt),a
    1854   00:909A  CD 42 B6                   call cls
    1855   00:909D  AF                         xor a
    1856   00:909E  32 1C 40                   ld (vara),a
    1857   00:90A1  AF                         xor a
    1858   00:90A2  32 22 40                   ld (varg),a
    1859   00:90A5  AF                         xor a
    1860   00:90A6  32 1F 40                   ld (vard),a
    1861   00:90A9  AF                         xor a
    1862   00:90AA  32 25 40                   ld (varj),a
    1863   00:90AD  AF                         xor a
    1864   00:90AE  32 26 40                   ld (vark),a
    1865   00:90B1  3E 72                      ld a,114
    1866   00:90B3  21 21 40                   ld hl,varf
    1867   00:90B6  BE                         cp (hl)
    1868   00:90B7  C2 BD 90                   jp nz,o00160
    1869   00:90BA  C3 38 91                   jp o00424
    1870   00:90BD  AF                  o00160 xor a
    1871   00:90BE  32 35 40                   ld (charx),a
    1872   00:90C1  3E 01                      ld a,1
    1873   00:90C3  32 36 40                   ld (chary),a
    1874   00:90C6  3E 06                      ld a,6
    1875   00:90C8  87                         add a,a
    1876   00:90C9  87                         add a,a
    1877   00:90CA  87                         add a,a
    1878   00:90CB  87                         add a,a
    1879   00:90CC  5F                         ld e,a
    1880   00:90CD  3A 39 40                   ld a,(clratt)
    1881   00:90D0  E6 0F                      and $0F
    1882   00:90D2  B3                         or e
    1883   00:90D3  32 39 40                   ld (clratt),a
    1884   00:90D6  AF                         xor a
    1885   00:90D7  5F                         ld e,a
    1886   00:90D8  3A 39 40                   ld a,(clratt)
    1887   00:90DB  E6 F0                      and $F0
    1888   00:90DD  B3                         or e
    1889   00:90DE  32 39 40                   ld (clratt),a
    1890   00:90E1  3E 03                      ld a,3
    1891   00:90E3  CD 88 C0                   call dmsg
    1892   00:90E6  AF                         xor a
    1893   00:90E7  32 35 40                   ld (charx),a
    1894   00:90EA  3E 0C                      ld a,12
    1895   00:90EC  32 36 40                   ld (chary),a
    1896   00:90EF  3E 0D                      ld a,13
    1897   00:90F1  87                         add a,a
    1898   00:90F2  87                         add a,a
    1899   00:90F3  87                         add a,a
    1900   00:90F4  87                         add a,a
    1901   00:90F5  5F                         ld e,a
    1902   00:90F6  3A 39 40                   ld a,(clratt)
    1903   00:90F9  E6 0F                      and $0F
    1904   00:90FB  B3                         or e
    1905   00:90FC  32 39 40                   ld (clratt),a
    1906   00:90FF  AF                         xor a
    1907   00:9100  5F                         ld e,a
    1908   00:9101  3A 39 40                   ld a,(clratt)
    1909   00:9104  E6 F0                      and $F0
    1910   00:9106  B3                         or e
    1911   00:9107  32 39 40                   ld (clratt),a
    1912   00:910A  3E 01                      ld a,1
    1913   00:910C  CD 88 C0                   call dmsg
    1914   00:910F  AF                         xor a
    1915   00:9110  32 35 40                   ld (charx),a
    1916   00:9113  3E 18                      ld a,24
    1917   00:9115  32 36 40                   ld (chary),a
    1918   00:9118  3E 06                      ld a,6
    1919   00:911A  87                         add a,a
    1920   00:911B  87                         add a,a
    1921   00:911C  87                         add a,a
    1922   00:911D  87                         add a,a
    1923   00:911E  5F                         ld e,a
    1924   00:911F  3A 39 40                   ld a,(clratt)
    1925   00:9122  E6 0F                      and $0F
    1926   00:9124  B3                         or e
    1927   00:9125  32 39 40                   ld (clratt),a
    1928   00:9128  AF                         xor a
    1929   00:9129  5F                         ld e,a
    1930   00:912A  3A 39 40                   ld a,(clratt)
    1931   00:912D  E6 F0                      and $F0
    1932   00:912F  B3                         or e
    1933   00:9130  32 39 40                   ld (clratt),a
    1934   00:9133  3E 04                      ld a,4
    1935   00:9135  CD 88 C0                   call dmsg
    1936   00:9138  C9                  o00424 ret
    1937   00:9139                      
    1938   00:9139  (00:9139)           evnt15:	equ $
    1939   00:9139  AF                         xor a
    1940   00:913A  DD BE 00                   cp (ix+0)
    1941   00:913D  C2 44 91                   jp nz,p00025
    1942   00:9140  21 52 40                   ld hl,deadf
    1943   00:9143  74                         ld (hl),h
    1944   00:9144  C9                  p00025 ret
    1945   00:9145                      
    1946   00:9145  (00:9145)           evnt16:	equ $
    1947   00:9145  3A 45 40                   ld a,(numlif)
    1948   00:9148  3D                         dec a
    1949   00:9149  32 45 40                   ld (numlif),a
    1950   00:914C  DD 36 00 FF                ld (ix+0),255
    1951   00:9150  AF                         xor a
    1952   00:9151  32 22 40                   ld (varg),a
    1953   00:9154  CD 42 B6                   call cls
    1954   00:9157  C9                         ret
    1955   00:9158                      
    1956   00:9158  (00:9158)           evnt17:	equ $
    1957   00:9158  3E 0A                      ld a,10
    1958   00:915A  32 35 40                   ld (charx),a
    1959   00:915D  3E 0C                      ld a,12
    1960   00:915F  32 36 40                   ld (chary),a
    1961   00:9162  3E 02                      ld a,2
    1962   00:9164  32 EB 53                   ld (MSX_BDRCLR),a
    1963   00:9167  47                         ld b,a
    1964   00:9168  0E 07                      ld c,7
    1965   00:916A  CD 47 00                   call MSX_WRTVDP
    1966   00:916D  CD 42 B6                   call cls
    1967   00:9170  3E 04                      ld a,4
    1968   00:9172  87                         add a,a
    1969   00:9173  87                         add a,a
    1970   00:9174  87                         add a,a
    1971   00:9175  87                         add a,a
    1972   00:9176  5F                         ld e,a
    1973   00:9177  3A 39 40                   ld a,(clratt)
    1974   00:917A  E6 0F                      and $0F
    1975   00:917C  B3                         or e
    1976   00:917D  32 39 40                   ld (clratt),a
    1977   00:9180  AF                         xor a
    1978   00:9181  5F                         ld e,a
    1979   00:9182  3A 39 40                   ld a,(clratt)
    1980   00:9185  E6 F0                      and $F0
    1981   00:9187  B3                         or e
    1982   00:9188  32 39 40                   ld (clratt),a
    1983   00:918B  AF                         xor a
    1984   00:918C  CD 88 C0                   call dmsg
    1985   00:918F  3E 0C                      ld a,12
    1986   00:9191  32 35 40                   ld (charx),a
    1987   00:9194  3E 04                      ld a,4
    1988   00:9196  32 36 40                   ld (chary),a
    1989   00:9199  3E 03                      ld a,3
    1990   00:919B  87                         add a,a
    1991   00:919C  87                         add a,a
    1992   00:919D  87                         add a,a
    1993   00:919E  87                         add a,a
    1994   00:919F  5F                         ld e,a
    1995   00:91A0  3A 39 40                   ld a,(clratt)
    1996   00:91A3  E6 0F                      and $0F
    1997   00:91A5  B3                         or e
    1998   00:91A6  32 39 40                   ld (clratt),a
    1999   00:91A9  AF                         xor a
    2000   00:91AA  5F                         ld e,a
    2001   00:91AB  3A 39 40                   ld a,(clratt)
    2002   00:91AE  E6 F0                      and $F0
    2003   00:91B0  B3                         or e
    2004   00:91B1  32 39 40                   ld (clratt),a
    2005   00:91B4  3E 0D                      ld a,13
    2006   00:91B6  CD 88 C0                   call dmsg
    2007   00:91B9  CD 74 B5                   call prskey
    2008   00:91BC  C9                         ret
    2009   00:91BD                      
    2010   00:91BD  (00:91BD)           evnt18:	equ $
    2011   00:91BD  DD E5                      push ix
    2012   00:91BF  06 32                      ld b,50
    2013   00:91C1  CD B0 B5                   call delay
    2014   00:91C4  DD E1                      pop ix
    2015   00:91C6  C9                         ret
    2016   00:91C7                      
    2017   00:91C7  (00:91C7)           evnt19:	equ $
    2018   00:91C7  C9                         ret
    2019   00:91C8                      
    2020   00:91C8  (00:91C8)           evnt20:	equ $
    2021   00:91C8  C9                         ret
    2022   00:91C9  C9                  ptcusr ret
    2023   00:91CA  (00:91CA)           msgdat:	equ $
    2024   00:91CA                             db "GAME OVE",210
    2024   00:91CA  47 41 4D 45 20 4F 56 45 D2 
    2025   00:91D3                             db "BALDY Z",216
    2025   00:91D3  42 41 4C 44 59 20 5A D8 
    2026   00:91DB                             db "-NEXT LEVEL",173
    2026   00:91DB  2D 4E 45 58 54 20 4C 45 56 45 4C AD 
    2027   00:91E7  4C 45 56 45 4C BA          db "LEVEL",186
    2028   00:91ED  4C 49 56 45 53 BA          db "LIVES",186
    2029   00:91F3                             db "SELECT CONTRO",204
    2029   00:91F3  53 45 4C 45 43 54 20 43 4F 4E 54 52 4F CC 
    2030   00:9201                             db "1.............KEYBOAR",196
    2030   00:9201  31 2E 2E 2E 2E 2E 2E 2E 2E 2E 2E 2E 2E 2E 4B 45 
    2030   00:9211  59 42 4F 41 52 C4 
    2031   00:9217                             db "2...........JOYSTICK ",177
    2031   00:9217  32 2E 2E 2E 2E 2E 2E 2E 2E 2E 2E 2E 4A 4F 59 53 
    2031   00:9227  54 49 43 4B 20 B1 
    2032   00:922D                             db "3...........JOYSTICK ",178
    2032   00:922D  33 2E 2E 2E 2E 2E 2E 2E 2E 2E 2E 2E 4A 4F 59 53 
    2032   00:923D  54 49 43 4B 20 B2 
    2033   00:9243                             db ";PAUL JENKINSON 201",181
    2033   00:9243  3B 50 41 55 4C 20 4A 45 4E 4B 49 4E 53 4F 4E 20 
    2033   00:9253  32 30 31 B5 
    2034   00:9257                             db "CONGRATULATION",211
    2034   00:9257  43 4F 4E 47 52 41 54 55 4C 41 54 49 4F 4E D3 
    2035   00:9266                             db "BALDY HAS COLLECTED AL",204
    2035   00:9266  42 41 4C 44 59 20 48 41 53 20 43 4F 4C 4C 45 43 
    2035   00:9276  54 45 44 20 41 4C CC 
    2036   00:927D                             db "OF HIS GAME",211
    2036   00:927D  4F 46 20 48 49 53 20 47 41 4D 45 D3 
    2037   00:9289                             db "BALDY IS IN NEED OF WINE",161
    2037   00:9289  42 41 4C 44 59 20 49 53 20 49 4E 20 4E 45 45 44 
    2037   00:9299  20 4F 46 20 57 49 4E 45 A1 
    2038   00:92A2  0E                  nummsg db 14
    2039   00:92A3  (00:92A3)           scdat:	equ $
    2040   00:92A3                             defw 83,72,72,57,62,58,52,60,53,101,56,43,60,70,50,65,48,49,41,37,21
    2040   00:92A3  53 00 48 00 48 00 39 00 3E 00 3A 00 34 00 3C 00 
    2040   00:92B3  35 00 65 00 38 00 2B 00 3C 00 46 00 32 00 41 00 
    2040   00:92C3  30 00 31 00 29 00 25 00 15 00 
    2041   00:92CD                             db 30,0,172,0,6,183,0,97,24,31,8,31,143,5,7,135,14,1,1,2,163,4,19,208,14,3,5,123,4,159,4,189
    2041   00:92CD  1E 00 AC 00 06 B7 00 61 18 1F 08 1F 8F 05 07 87 
    2041   00:92DD  0E 01 01 02 A3 04 13 D0 0E 03 05 7B 04 9F 04 BD 
    2042   00:92ED                             db 139,181,134,0,224,139,31,9,31,222,19,181,134,199,149,19,255,127,149,222,154,125,134,159,253,154,188,149,19,254,154,215
    2042   00:92ED  8B B5 86 00 E0 8B 1F 09 1F DE 13 B5 86 C7 95 13 
    2042   00:92FD  FF 7F 95 DE 9A 7D 86 9F FD 9A BC 95 13 FE 9A D7 
    2043   00:930D                             db 211,149,212,0,239,159,235,14,134,92,149,107,1,167,149,255,255,255,254,26,0,187,13,0,31,8,31,80,9,10,11,124
    2043   00:930D  D3 95 D4 00 EF 9F EB 0E 86 5C 95 6B 01 A7 95 FF 
    2043   00:931D  FF FF FE 1A 00 BB 0D 00 1F 08 1F 50 09 0A 0B 7C 
    2044   00:932D                             db 12,4,17,213,135,9,13,14,15,185,4,171,227,139,9,159,9,16,105,9,24,111,139,205,149,17,253,181,149,47,129,144
    2044   00:932D  0C 04 11 D5 87 09 0D 0E 0F B9 04 AB E3 8B 09 9F 
    2044   00:933D  09 10 69 09 18 6F 8B CD 95 11 FD B5 95 2F 81 90 
    2045   00:934D                             db 78,169,24,220,129,189,144,222,149,251,154,231,10,16,165,14,134,191,63,149,11,239,149,255,255,255,252,26,0,187,13,0
    2045   00:934D  4E A9 18 DC 81 BD 90 DE 95 FB 9A E7 0A 10 A5 0E 
    2045   00:935D  86 BF 3F 95 0B EF 95 FF FF FF FC 1A 00 BB 0D 00 
    2046   00:936D                             db 31,8,31,80,14,20,21,124,22,4,26,191,9,135,14,23,24,25,185,4,171,176,139,31,9,31,222,19,211,14,239,139
    2046   00:936D  1F 08 1F 50 0E 14 15 7C 16 04 1A BF 09 87 0E 17 
    2046   00:937D  18 19 B9 04 AB B0 8B 1F 09 1F DE 13 D3 0E EF 8B 
    2047   00:938D                             db 239,9,85,58,149,124,154,254,144,242,14,124,223,45,144,14,253,62,149,154,254,9,219,0,239,139,237,9,92,149,255,255
    2047   00:938D  EF 09 55 3A 95 7C 9A FE 90 F2 0E 7C DF 2D 90 0E 
    2047   00:939D  FD 3E 95 9A FE 09 DB 00 EF 8B ED 09 5C 95 FF FF 
    2048   00:93AD                             db 255,255,192,58,0,170,8,0,31,8,31,4,18,18,251,9,88,0,27,28,123,29,155,4,235,113,0,134,62,4,9,139
    2048   00:93AD  FF FF C0 3A 00 AA 08 00 1F 08 1F 04 12 12 FB 09 
    2048   00:93BD  58 00 1B 1C 7B 1D 9B 04 EB 71 00 86 3E 04 09 8B 
    2049   00:93CD                             db 55,47,9,24,247,8,149,134,221,155,171,24,253,195,149,227,129,225,149,9,171,245,193,255,255,255,255,128,26,0,170,13
    2049   00:93CD  37 2F 09 18 F7 08 95 86 DD 9B AB 18 FD C3 95 E3 
    2049   00:93DD  81 E1 95 09 AB F5 C1 FF FF FF FF 80 1A 00 AA 0D 
    2050   00:93ED                             db 0,31,8,31,216,14,32,33,123,34,131,4,35,36,37,209,4,30,233,14,255,209,144,4,9,31,253,14,191,159,149,106
    2050   00:93ED  00 1F 08 1F D8 0E 20 21 7B 22 83 04 23 24 25 D1 
    2050   00:93FD  04 1E E9 0E FF D1 90 04 09 1F FD 0E BF 9F 95 6A 
    2051   00:940D                             db 144,253,149,123,144,155,159,169,149,174,106,159,237,0,223,144,222,14,185,149,247,4,255,255,255,254,31,0,188,0,31,49
    2051   00:940D  90 FD 95 7B 90 9B 9F A9 95 AE 6A 9F ED 00 DF 90 
    2051   00:941D  DE 0E B9 95 F7 04 FF FF FF FE 1F 00 BC 00 1F 31 
    2052   00:942D                             db 8,31,5,18,174,112,19,0,38,39,40,247,7,4,41,42,43,185,4,254,139,149,9,129,251,159,187,19,14,253,111,149
    2052   00:942D  08 1F 05 12 AE 70 13 00 26 27 28 F7 07 04 29 2A 
    2052   00:943D  2B B9 04 FE 8B 95 09 81 FB 9F BB 13 0E FD 6F 95 
    2053   00:944D                             db 190,144,159,122,18,127,14,237,149,110,144,223,14,185,149,255,255,255,255,128,31,0,188,0,31,61,8,31,193,14,44,45
    2053   00:944D  BE 90 9F 7A 12 7F 0E ED 95 6E 90 DF 0E B9 95 FF 
    2053   00:945D  FF FF FF 80 1F 00 BC 00 1F 3D 08 1F C1 0E 2C 2D 
    2054   00:946D                             db 46,238,111,4,172,0,31,60,9,31,139,62,6,6,14,251,159,253,203,149,124,123,139,190,154,19,255,123,149,219,144,243
    2054   00:946D  2E EE 6F 04 AC 00 1F 3C 09 1F 8B 3E 06 06 0E FB 
    2054   00:947D  9F FD CB 95 7C 7B 8B BE 9A 13 FF 7B 95 DB 90 F3 
    2055   00:948D                             db 19,247,63,149,255,255,255,240,58,0,170,13,0,31,8,31,216,19,47,48,124,49,4,50,212,9,251,4,125,206,0,124
    2055   00:948D  13 F7 3F 95 FF FF FF F0 3A 00 AA 0D 00 1F 08 1F 
    2055   00:949D  D8 13 2F 30 7C 31 04 32 D4 09 FB 04 7D CE 00 7C 
    2056   00:94AD                             db 143,4,9,31,227,159,191,19,143,134,119,14,149,124,252,139,62,14,255,89,171,248,139,221,191,14,150,161,50,235,31,149
    2056   00:94AD  8F 04 09 1F E3 9F BF 13 8F 86 77 0E 95 7C FC 8B 
    2056   00:94BD  3E 0E FF 59 AB F8 8B DD BF 0E 96 A1 32 EB 1F 95 
    2057   00:94CD                             db 255,255,255,248,31,0,188,0,31,55,8,31,143,14,18,18,65,24,51,52,53,238,111,4,172,0,31,55,9,31,175,154
    2057   00:94CD  FF FF FF F8 1F 00 BC 00 1F 37 08 1F 8F 0E 12 12 
    2057   00:94DD  41 18 33 34 35 EE 6F 04 AC 00 1F 37 09 1F AF 9A 
    2058   00:94ED                             db 149,175,144,24,247,190,149,129,254,144,239,0,245,175,149,129,115,14,247,63,149,255,255,255,240,58,0,187,12,0,31,8
    2058   00:94ED  95 AF 90 18 F7 BE 95 81 FE 90 EF 00 F5 AF 95 81 
    2058   00:94FD  73 0E F7 3F 95 FF FF FF F0 3A 00 BB 0C 00 1F 08 
    2059   00:950D                             db 31,5,106,6,112,9,0,54,55,56,244,4,122,50,7,14,65,64,65,0,119,5,3,151,8,0,45,19,64,10,95,131
    2059   00:950D  1F 05 6A 06 70 09 00 36 37 38 F4 04 7A 32 07 0E 
    2059   00:951D  41 40 41 00 77 05 03 97 08 00 2D 13 40 0A 5F 83 
    2060   00:952D                             db 144,31,9,227,139,78,9,19,239,124,115,4,195,129,67,139,227,150,107,15,14,93,67,144,217,166,239,19,89,166,235,4
    2060   00:952D  90 1F 09 E3 8B 4E 09 13 EF 7C 73 04 C3 81 43 8B 
    2060   00:953D  E3 96 6B 0F 0E 5D 43 90 D9 A6 EF 13 59 A6 EB 04 
    2061   00:954D                             db 123,81,166,180,3,149,26,65,191,61,171,124,235,126,14,206,171,221,123,5,225,149,223,3,31,154,255,255,255,248,58,0
    2061   00:954D  7B 51 A6 B4 03 95 1A 41 BF 3D AB 7C EB 7E 0E CE 
    2061   00:955D  AB DD 7B 05 E1 95 DF 03 1F 9A FF FF FF F8 3A 00 
    2062   00:956D                             db 255,15,0,31,8,31,7,9,32,33,34,184,4,57,61,58,59,205,4,119,13,134,155,14,9,252,149,53,58,252,149,56
    2062   00:956D  FF 0F 00 1F 08 1F 07 09 20 21 22 B8 04 39 3D 3A 
    2062   00:957D  3B CD 04 77 0D 86 9B 0E 09 FC 95 35 3A FC 95 38 
    2063   00:958D                             db 144,227,134,248,159,255,217,171,214,144,23,18,0,106,14,252,149,127,255,255,255,224,27,0,186,8,0,31,8,31,4,60
    2063   00:958D  90 E3 86 F8 9F FF D9 AB D6 90 17 12 00 6A 0E FC 
    2063   00:959D  95 7F FF FF FF E0 1B 00 BA 08 00 1F 08 1F 04 3C 
    2064   00:95AD                             db 61,123,62,139,4,63,0,220,4,255,237,124,217,24,9,254,245,149,124,238,126,159,253,149,253,159,174,167,149,255,255,255
    2064   00:95AD  3D 7B 3E 8B 04 3F 00 DC 04 FF ED 7C D9 18 09 FE 
    2064   00:95BD  F5 95 7C EE 7E 9F FD 95 FD 9F AE A7 95 FF FF FF 
    2065   00:95CD                             db 254,58,0,187,13,0,31,8,31,80,19,66,67,123,68,154,4,171,61,0,72,224,139,69,70,98,71,9,9,9,239,14
    2065   00:95CD  FE 3A 00 BB 0D 00 1F 08 1F 50 13 42 43 7B 44 9A 
    2065   00:95DD  04 AB 3D 00 48 E0 8B 45 46 62 47 09 09 09 EF 0E 
    2066   00:95ED                             db 119,141,149,251,0,240,139,211,14,227,174,221,227,149,249,181,244,139,57,181,251,19,253,143,149,255,255,255,252,58,0,187
    2066   00:95ED  77 8D 95 FB 00 F0 8B D3 0E E3 AE DD E3 95 F9 B5 
    2066   00:95FD  F4 8B 39 B5 FB 13 FD 8F 95 FF FF FF FC 3A 00 BB 
    2067   00:960D                             db 13,0,31,8,31,80,19,73,74,123,75,155,4,179,0,64,251,127,253,131,149,9,31,248,159,223,225,149,65,246,127,235
    2067   00:960D  0D 00 1F 08 1F 50 13 49 4A 7B 4B 9B 04 B3 00 40 
    2067   00:961D  FB 7F FD 83 95 09 1F F8 9F DF E1 95 41 F6 7F EB 
    2068   00:962D                             db 207,166,27,159,127,19,199,149,243,151,187,226,166,69,55,30,71,191,19,135,139,1,224,149,65,244,166,91,59,223,83,255
    2068   00:962D  CF A6 1B 9F 7F 13 C7 95 F3 97 BB E2 A6 45 37 1E 
    2068   00:963D  47 BF 13 87 8B 01 E0 95 41 F4 A6 5B 3B DF 53 FF 
    2069   00:964D                             db 255,255,248,31,0,188,0,31,61,8,31,193,29,76,77,78,238,111,4,172,0,31,61,9,31,207,174,223,181,149,135,129
    2069   00:964D  FF FF F8 1F 00 BC 00 1F 3D 08 1F C1 1D 4C 4D 4E 
    2069   00:965D  EE 6F 04 AC 00 1F 3D 09 1F CF AE DF B5 95 87 81 
    2070   00:966D                             db 69,70,71,157,4,14,223,174,255,91,149,129,183,14,238,127,149,255,255,255,224,26,0,187,8,0,31,8,31,4,82,83
    2070   00:966D  45 46 47 9D 04 0E DF AE FF 5B 95 81 B7 0E EE 7F 
    2070   00:967D  95 FF FF FF E0 1A 00 BB 08 00 1F 08 1F 04 52 53 
    2071   00:968D                             db 121,84,9,160,0,79,80,81,247,7,4,3,5,4,185,4,255,222,139,30,9,9,31,95,14,9,255,107,149,15,139,82
    2071   00:968D  79 54 09 A0 00 4F 50 51 F7 07 04 03 05 04 B9 04 
    2071   00:969D  FF DE 8B 1E 09 09 1F 5F 0E 09 FF 6B 95 0F 8B 52 
    2072   00:96AD                             db 83,84,62,14,174,255,91,149,183,0,59,139,154,239,19,246,149,255,255,255,255,192,58,0,170,13,0,31,8,31,216,24
    2072   00:96AD  53 54 3E 0E AE FF 5B 95 B7 00 3B 8B 9A EF 13 F6 
    2072   00:96BD  95 FF FF FF FF C0 3A 00 AA 0D 00 1F 08 1F D8 18 
    2073   00:96CD                             db 85,86,123,85,155,4,254,13,0,31,9,31,216,169,253,248,149,27,82,83,84,179,171,196,169,124,50,213,252,171,127,250
    2073   00:96CD  55 56 7B 55 9B 04 FE 0D 00 1F 09 1F D8 A9 FD F8 
    2073   00:96DD  95 1B 52 53 54 B3 AB C4 A9 7C 32 D5 FC AB 7F FA 
    2074   00:96ED                             db 193,255,255,255,255,192,58,0,170,13,0,31,8,31,216,14,51,48,111,49,126,4,123,19,236,0,31,122,9,31,149,199
    2074   00:96ED  C1 FF FF FF FF C0 3A 00 AA 0D 00 1F 08 1F D8 0E 
    2074   00:96FD  33 30 6F 31 7E 04 7B 13 EC 00 1F 7A 09 1F 95 C7 
    2075   00:970D                             db 159,190,195,149,9,251,18,253,103,171,159,151,88,164,249,161,245,199,171,255,255,255,255,59,0,235,15,0,87,88,87,237
    2075   00:970D  9F BE C3 95 09 FB 12 FD 67 AB 9F 97 58 A4 F9 A1 
    2075   00:971D  F5 C7 AB FF FF FF FF 3B 00 EB 0F 00 57 58 57 ED 
    2076   00:972D                             db 4,207,24,117,6,0,31,9,31,236,149,107,199,164,186,135,134,231,24,239,207,171,171,26,149,248,171,255,255,255,255,224
    2076   00:972D  04 CF 18 75 06 00 1F 09 1F EC 95 6B C7 A4 BA 87 
    2076   00:973D  86 E7 18 EF CF AB AB 1A 95 F8 AB FF FF FF FF E0 
    2077   00:974D                             db 27,0,235,13,0,90,89,90,219,4,65,0,91,92,91,187,127,4,223,0,255,126,154,187,126,144,221,149,4,235,119,149
    2077   00:974D  1B 00 EB 0D 00 5A 59 5A DB 04 41 00 5B 5C 5B BB 
    2077   00:975D  7F 04 DF 00 FF 7E 9A BB 7E 90 DD 95 04 EB 77 95 
    2078   00:976D                             db 4,255,255,255,254,63,87,160,0,93,94,0,245,47,0,27,255,219,29,246,185,255,255,255,255,240
    2078   00:976D  04 FF FF FF FE 3F 57 A0 00 5D 5E 00 F5 2F 00 1B 
    2078   00:977D  FF DB 1D F6 B9 FF FF FF FF F0 
    2079   00:9787  15                  numsc  db 21
    2080   00:9788  (00:9788)           chgfx:	equ $
    2081   00:9788                             db 0,0,0,0,0,0,0,0,241,241,241,241,241,241,241,241
    2081   00:9788  00 00 00 00 00 00 00 00 F1 F1 F1 F1 F1 F1 F1 F1 
    2082   00:9798                             db 0,175,191,0,183,181,0,91,129,129,129,129,129,129,129,129
    2082   00:9798  00 AF BF 00 B7 B5 00 5B 81 81 81 81 81 81 81 81 
    2083   00:97A8                             db 0,253,189,0,211,219,0,246,97,97,97,97,97,97,97,97
    2083   00:97A8  00 FD BD 00 D3 DB 00 F6 61 61 61 61 61 61 61 61 
    2084   00:97B8                             db 87,0,23,23,0,0,0,0,97,97,97,97,97,97,97,97
    2084   00:97B8  57 00 17 17 00 00 00 00 61 61 61 61 61 61 61 61 
    2085   00:97C8                             db 250,0,212,212,0,0,0,0,97,97,97,97,97,97,97,97
    2085   00:97C8  FA 00 D4 D4 00 00 00 00 61 61 61 61 61 61 61 61 
    2086   00:97D8                             db 247,0,239,239,0,0,0,0,97,97,97,97,97,97,97,97
    2086   00:97D8  F7 00 EF EF 00 00 00 00 61 61 61 61 61 61 61 61 
    2087   00:97E8                             db 0,0,0,0,0,0,0,0,129,129,129,129,129,129,129,129
    2087   00:97E8  00 00 00 00 00 00 00 00 81 81 81 81 81 81 81 81 
    2088   00:97F8                             db 0,0,0,0,0,0,0,0,177,177,177,177,177,177,177,177
    2088   00:97F8  00 00 00 00 00 00 00 00 B1 B1 B1 B1 B1 B1 B1 B1 
    2089   00:9808                             db 0,0,0,0,0,0,0,170,241,241,241,241,241,241,241,241
    2089   00:9808  00 00 00 00 00 00 00 AA F1 F1 F1 F1 F1 F1 F1 F1 
    2090   00:9818                             db 0,0,0,0,0,0,0,170,241,241,241,241,241,241,241,241
    2090   00:9818  00 00 00 00 00 00 00 AA F1 F1 F1 F1 F1 F1 F1 F1 
    2091   00:9828                             db 0,255,165,231,165,231,165,255,33,33,33,33,33,33,33,33
    2091   00:9828  00 FF A5 E7 A5 E7 A5 FF 21 21 21 21 21 21 21 21 
    2092   00:9838                             db 0,223,223,181,191,177,191,181,33,33,33,33,33,33,33,33
    2092   00:9838  00 DF DF B5 BF B1 BF B5 21 21 21 21 21 21 21 21 
    2093   00:9848                             db 0,255,251,245,245,59,223,223,193,193,193,193,193,193,193,193
    2093   00:9848  00 FF FB F5 F5 3B DF DF C1 C1 C1 C1 C1 C1 C1 C1 
    2094   00:9858                             db 0,127,49,31,0,0,0,0,193,193,193,193,193,193,193,193
    2094   00:9858  00 7F 31 1F 00 00 00 00 C1 C1 C1 C1 C1 C1 C1 C1 
    2095   00:9868                             db 0,253,195,223,0,0,0,0,193,193,193,193,193,193,193,193
    2095   00:9868  00 FD C3 DF 00 00 00 00 C1 C1 C1 C1 C1 C1 C1 C1 
    2096   00:9878                             db 0,222,140,136,0,0,0,0,193,193,193,193,193,193,193,193
    2096   00:9878  00 DE 8C 88 00 00 00 00 C1 C1 C1 C1 C1 C1 C1 C1 
    2097   00:9888                             db 0,0,0,0,0,0,0,0,18,18,18,18,18,18,18,18
    2097   00:9888  00 00 00 00 00 00 00 00 12 12 12 12 12 12 12 12 
    2098   00:9898                             db 0,223,193,253,165,228,167,255,33,33,33,33,33,33,33,33
    2098   00:9898  00 DF C1 FD A5 E4 A7 FF 21 21 21 21 21 21 21 21 
    2099   00:98A8                             db 0,0,0,0,0,0,0,0,97,97,97,97,97,97,97,97
    2099   00:98A8  00 00 00 00 00 00 00 00 61 61 61 61 61 61 61 61 
    2100   00:98B8                             db 0,239,235,0,253,237,0,191,97,97,97,97,97,97,97,97
    2100   00:98B8  00 EF EB 00 FD ED 00 BF 61 61 61 61 61 61 61 61 
    2101   00:98C8                             db 0,125,187,188,81,43,21,29,113,113,113,113,113,113,113,113
    2101   00:98C8  00 7D BB BC 51 2B 15 1D 71 71 71 71 71 71 71 71 
    2102   00:98D8                             db 0,246,181,111,143,70,216,181,113,113,113,113,113,113,113,113
    2102   00:98D8  00 F6 B5 6F 8F 46 D8 B5 71 71 71 71 71 71 71 71 
    2103   00:98E8                             db 0,242,85,47,15,70,240,184,113,113,113,113,113,113,113,113
    2103   00:98E8  00 F2 55 2F 0F 46 F0 B8 71 71 71 71 71 71 71 71 
    2104   00:98F8                             db 8,3,2,1,0,0,0,0,113,113,113,113,113,113,113,113
    2104   00:98F8  08 03 02 01 00 00 00 00 71 71 71 71 71 71 71 71 
    2105   00:9908                             db 186,48,0,0,0,0,0,0,113,113,113,113,113,113,113,113
    2105   00:9908  BA 30 00 00 00 00 00 00 71 71 71 71 71 71 71 71 
    2106   00:9918                             db 240,96,0,0,0,0,0,0,113,113,113,113,113,113,113,113
    2106   00:9918  F0 60 00 00 00 00 00 00 71 71 71 71 71 71 71 71 
    2107   00:9928                             db 0,247,111,109,143,70,216,181,113,113,113,113,113,113,113,113
    2107   00:9928  00 F7 6F 6D 8F 46 D8 B5 71 71 71 71 71 71 71 71 
    2108   00:9938                             db 0,222,218,76,49,61,24,0,209,209,209,209,209,209,209,209
    2108   00:9938  00 DE DA 4C 31 3D 18 00 D1 D1 D1 D1 D1 D1 D1 D1 
    2109   00:9948                             db 0,247,215,99,156,239,198,56,209,209,209,209,209,209,209,209
    2109   00:9948  00 F7 D7 63 9C EF C6 38 D1 D1 D1 D1 D1 D1 D1 D1 
    2110   00:9958                             db 0,223,93,142,112,118,44,0,209,209,209,209,209,209,209,209
    2110   00:9958  00 DF 5D 8E 70 76 2C 00 D1 D1 D1 D1 D1 D1 D1 D1 
    2111   00:9968                             db 60,90,90,126,44,0,52,24,225,225,225,225,225,225,225,225
    2111   00:9968  3C 5A 5A 7E 2C 00 34 18 E1 E1 E1 E1 E1 E1 E1 E1 
    2112   00:9978                             db 0,0,0,0,0,0,0,170,241,241,241,241,241,241,241,241
    2112   00:9978  00 00 00 00 00 00 00 AA F1 F1 F1 F1 F1 F1 F1 F1 
    2113   00:9988                             db 0,213,122,213,171,101,188,104,33,33,33,33,33,33,33,33
    2113   00:9988  00 D5 7A D5 AB 65 BC 68 21 21 21 21 21 21 21 21 
    2114   00:9998                             db 0,106,191,117,174,85,170,5,33,33,33,33,33,33,33,33
    2114   00:9998  00 6A BF 75 AE 55 AA 05 21 21 21 21 21 21 21 21 
    2115   00:99A8                             db 0,174,117,174,117,170,85,160,193,193,193,193,193,193,193,193
    2115   00:99A8  00 AE 75 AE 75 AA 55 A0 C1 C1 C1 C1 C1 C1 C1 C1 
    2116   00:99B8                             db 14,237,167,216,21,10,1,0,129,129,129,129,129,129,129,129
    2116   00:99B8  0E ED A7 D8 15 0A 01 00 81 81 81 81 81 81 81 81 
    2117   00:99C8                             db 113,119,165,90,21,170,145,0,129,129,129,129,129,129,129,129
    2117   00:99C8  71 77 A5 5A 15 AA 91 00 81 81 81 81 81 81 81 81 
    2118   00:99D8                             db 6,234,164,90,52,168,0,0,129,129,129,129,129,129,129,129
    2118   00:99D8  06 EA A4 5A 34 A8 00 00 81 81 81 81 81 81 81 81 
    2119   00:99E8                             db 0,255,255,0,118,118,6,22,81,81,81,81,81,81,81,81
    2119   00:99E8  00 FF FF 00 76 76 06 16 51 51 51 51 51 51 51 51 
    2120   00:99F8                             db 0,255,255,0,222,222,0,123,81,81,81,81,81,81,81,81
    2120   00:99F8  00 FF FF 00 DE DE 00 7B 51 51 51 51 51 51 51 51 
    2121   00:9A08                             db 0,255,255,0,222,222,0,246,65,65,65,65,65,65,65,65
    2121   00:9A08  00 FF FF 00 DE DE 00 F6 41 41 41 41 41 41 41 41 
    2122   00:9A18                             db 6,0,0,0,0,0,0,0,65,65,65,65,65,65,65,65
    2122   00:9A18  06 00 00 00 00 00 00 00 41 41 41 41 41 41 41 41 
    2123   00:9A28                             db 123,120,120,0,0,0,0,0,65,65,65,65,65,65,65,65
    2123   00:9A28  7B 78 78 00 00 00 00 00 41 41 41 41 41 41 41 41 
    2124   00:9A38                             db 246,6,0,0,0,0,0,0,65,65,65,65,65,65,65,65
    2124   00:9A38  F6 06 00 00 00 00 00 00 41 41 41 41 41 41 41 41 
    2125   00:9A48                             db 0,222,222,222,0,189,189,189,97,97,97,97,97,97,97,97
    2125   00:9A48  00 DE DE DE 00 BD BD BD 61 61 61 61 61 61 61 61 
    2126   00:9A58                             db 0,247,247,247,0,253,253,253,129,129,129,129,129,129,129,129
    2126   00:9A58  00 F7 F7 F7 00 FD FD FD 81 81 81 81 81 81 81 81 
    2127   00:9A68                             db 0,247,247,247,0,221,221,221,97,97,97,97,97,97,97,97
    2127   00:9A68  00 F7 F7 F7 00 DD DD DD 61 61 61 61 61 61 61 61 
    2128   00:9A78                             db 0,111,165,66,24,53,25,3,33,33,33,33,33,33,33,33
    2128   00:9A78  00 6F A5 42 18 35 19 03 21 21 21 21 21 21 21 21 
    2129   00:9A88                             db 0,111,165,66,24,53,153,195,113,113,113,113,113,113,113,113
    2129   00:9A88  00 6F A5 42 18 35 99 C3 71 71 71 71 71 71 71 71 
    2130   00:9A98                             db 0,111,165,66,24,52,152,192,113,113,113,113,113,113,113,113
    2130   00:9A98  00 6F A5 42 18 34 98 C0 71 71 71 71 71 71 71 71 
    2131   00:9AA8                             db 0,111,181,254,54,164,4,32,129,129,129,129,129,129,129,129
    2131   00:9AA8  00 6F B5 FE 36 A4 04 20 81 81 81 81 81 81 81 81 
    2132   00:9AB8                             db 0,189,189,89,32,14,23,11,225,225,225,225,225,225,225,225
    2132   00:9AB8  00 BD BD 59 20 0E 17 0B E1 E1 E1 E1 E1 E1 E1 E1 
    2133   00:9AC8                             db 0,173,239,231,200,158,54,92,241,241,241,241,241,241,241,241
    2133   00:9AC8  00 AD EF E7 C8 9E 36 5C F1 F1 F1 F1 F1 F1 F1 F1 
    2134   00:9AD8                             db 0,215,222,140,32,92,116,120,225,225,225,225,225,225,225,225
    2134   00:9AD8  00 D7 DE 8C 20 5C 74 78 E1 E1 E1 E1 E1 E1 E1 E1 
    2135   00:9AE8                             db 0,255,255,169,175,169,255,255,193,193,193,193,193,193,193,193
    2135   00:9AE8  00 FF FF A9 AF A9 FF FF C1 C1 C1 C1 C1 C1 C1 C1 
    2136   00:9AF8                             db 0,255,215,131,131,131,215,255,33,33,33,33,33,33,33,33
    2136   00:9AF8  00 FF D7 83 83 83 D7 FF 21 21 21 21 21 21 21 21 
    2137   00:9B08                             db 0,255,165,191,161,161,191,255,193,193,193,193,193,193,193,193
    2137   00:9B08  00 FF A5 BF A1 A1 BF FF C1 C1 C1 C1 C1 C1 C1 C1 
    2138   00:9B18                             db 6,214,209,44,0,0,0,0,97,97,97,97,97,97,97,97
    2138   00:9B18  06 D6 D1 2C 00 00 00 00 61 61 61 61 61 61 61 61 
    2139   00:9B28                             db 208,214,38,1,0,0,0,0,129,129,129,129,129,129,129,129
    2139   00:9B28  D0 D6 26 01 00 00 00 00 81 81 81 81 81 81 81 81 
    2140   00:9B38                             db 218,218,4,64,0,0,0,0,97,97,97,97,97,97,97,97
    2140   00:9B38  DA DA 04 40 00 00 00 00 61 61 61 61 61 61 61 61 
    2141   00:9B48                             db 0,255,0,85,74,85,74,85,65,65,65,65,65,65,65,65
    2141   00:9B48  00 FF 00 55 4A 55 4A 55 41 41 41 41 41 41 41 41 
    2142   00:9B58                             db 0,255,0,61,188,65,170,85,81,81,81,81,81,81,81,81
    2142   00:9B58  00 FF 00 3D BC 41 AA 55 51 51 51 51 51 51 51 51 
    2143   00:9B68                             db 0,255,0,82,170,82,170,82,65,65,65,65,65,65,65,65
    2143   00:9B68  00 FF 00 52 AA 52 AA 52 41 41 41 41 41 41 41 41 
    2144   00:9B78                             db 0,255,0,0,0,0,0,0,81,81,81,81,81,81,81,81
    2144   00:9B78  00 FF 00 00 00 00 00 00 51 51 51 51 51 51 51 51 
    2145   00:9B88                             db 68,32,68,64,0,0,0,0,241,241,241,241,241,241,241,241
    2145   00:9B88  44 20 44 40 00 00 00 00 F1 F1 F1 F1 F1 F1 F1 F1 
    2146   00:9B98                             db 40,4,36,0,4,0,0,0,177,177,177,177,177,177,177,177
    2146   00:9B98  28 04 24 00 04 00 00 00 B1 B1 B1 B1 B1 B1 B1 B1 
    2147   00:9BA8                             db 0,255,0,111,111,55,27,13,113,113,113,113,113,113,113,113
    2147   00:9BA8  00 FF 00 6F 6F 37 1B 0D 71 71 71 71 71 71 71 71 
    2148   00:9BB8                             db 0,255,0,232,244,232,244,232,113,113,113,113,113,113,113,113
    2148   00:9BB8  00 FF 00 E8 F4 E8 F4 E8 71 71 71 71 71 71 71 71 
    2149   00:9BC8                             db 0,255,0,94,190,92,188,88,161,161,161,161,161,161,161,161
    2149   00:9BC8  00 FF 00 5E BE 5C BC 58 A1 A1 A1 A1 A1 A1 A1 A1 
    2150   00:9BD8                             db 255,152,170,168,170,154,255,0,129,129,129,129,129,129,129,129
    2150   00:9BD8  FF 98 AA A8 AA 9A FF 00 81 81 81 81 81 81 81 81 
    2151   00:9BE8                             db 255,136,171,170,170,168,255,0,129,129,129,129,129,129,129,129
    2151   00:9BE8  FF 88 AB AA AA A8 FF 00 81 81 81 81 81 81 81 81 
    2152   00:9BF8                             db 255,147,181,147,181,149,255,0,97,97,97,97,97,97,97,97
    2152   00:9BF8  FF 93 B5 93 B5 95 FF 00 61 61 61 61 61 61 61 61 
    2153   00:9C08                             db 0,8,0,8,42,8,42,42,241,241,241,241,241,241,241,241
    2153   00:9C08  00 08 00 08 2A 08 2A 2A F1 F1 F1 F1 F1 F1 F1 F1 
    2154   00:9C18                             db 0,246,246,6,174,174,32,0,161,161,161,161,161,161,161,161
    2154   00:9C18  00 F6 F6 06 AE AE 20 00 A1 A1 A1 A1 A1 A1 A1 A1 
    2155   00:9C28                             db 0,221,221,0,247,247,3,0,177,177,177,177,177,177,177,177
    2155   00:9C28  00 DD DD 00 F7 F7 03 00 B1 B1 B1 B1 B1 B1 B1 B1 
    2156   00:9C38                             db 0,111,111,99,11,120,123,3,225,225,225,225,225,225,225,225
    2156   00:9C38  00 6F 6F 63 0B 78 7B 03 E1 E1 E1 E1 E1 E1 E1 E1 
    2157   00:9C48                             db 96,147,148,100,3,8,20,8,33,33,33,33,33,33,33,33
    2157   00:9C48  60 93 94 64 03 08 14 08 21 21 21 21 21 21 21 21 
    2158   00:9C58                             db 24,36,165,153,64,164,74,4,177,177,177,177,177,177,177,177
    2158   00:9C58  18 24 A5 99 40 A4 4A 04 B1 B1 B1 B1 B1 B1 B1 B1 
    2159   00:9C68                             db 6,201,41,38,200,20,8,0,113,113,113,113,113,113,113,113
    2159   00:9C68  06 C9 29 26 C8 14 08 00 71 71 71 71 71 71 71 71 
    2160   00:9C78                             db 0,255,0,183,170,157,174,4,209,209,209,209,209,209,209,209
    2160   00:9C78  00 FF 00 B7 AA 9D AE 04 D1 D1 D1 D1 D1 D1 D1 D1 
    2161   00:9C88                             db 0,255,0,119,187,85,238,68,209,209,209,209,209,209,209,209
    2161   00:9C88  00 FF 00 77 BB 55 EE 44 D1 D1 D1 D1 D1 D1 D1 D1 
    2162   00:9C98                             db 0,255,0,117,169,93,237,68,209,209,209,209,209,209,209,209
    2162   00:9C98  00 FF 00 75 A9 5D ED 44 D1 D1 D1 D1 D1 D1 D1 D1 
    2163   00:9CA8                             db 0,0,16,25,141,77,38,22,241,241,241,241,241,241,241,241
    2163   00:9CA8  00 00 10 19 8D 4D 26 16 F1 F1 F1 F1 F1 F1 F1 F1 
    2164   00:9CB8                             db 4,128,148,133,147,214,206,220,177,177,177,177,177,177,177,177
    2164   00:9CB8  04 80 94 85 93 D6 CE DC B1 B1 B1 B1 B1 B1 B1 B1 
    2165   00:9CC8                             db 8,0,16,50,36,101,234,212,225,225,225,225,225,225,225,225
    2165   00:9CC8  08 00 10 32 24 65 EA D4 E1 E1 E1 E1 E1 E1 E1 E1 
    2166   00:9CD8                             db 0,218,85,109,42,41,68,4,97,97,97,97,97,97,97,97
    2166   00:9CD8  00 DA 55 6D 2A 29 44 04 61 61 61 61 61 61 61 61 
    2167   00:9CE8                             db 0,154,81,77,21,84,4,16,129,129,129,129,129,129,129,129
    2167   00:9CE8  00 9A 51 4D 15 54 04 10 81 81 81 81 81 81 81 81 
    2168   00:9CF8                             db 0,255,0,102,102,102,0,255,161,161,161,161,161,161,161,161
    2168   00:9CF8  00 FF 00 66 66 66 00 FF A1 A1 A1 A1 A1 A1 A1 A1 
    2169   00:9D08                             db 0,255,0,126,126,126,0,255,177,177,177,177,177,177,177,177
    2169   00:9D08  00 FF 00 7E 7E 7E 00 FF B1 B1 B1 B1 B1 B1 B1 B1 
    2170   00:9D18                             db 0,133,86,187,237,183,93,10,81,81,81,81,81,81,81,81
    2170   00:9D18  00 85 56 BB ED B7 5D 0A 51 51 51 51 51 51 51 51 
    2171   00:9D28                             db 0,162,213,106,221,115,88,160,65,65,65,65,65,65,65,65
    2171   00:9D28  00 A2 D5 6A DD 73 58 A0 41 41 41 41 41 41 41 41 
    2172   00:9D38                             db 6,213,108,8,0,0,0,0,241,241,241,241,241,241,241,241
    2172   00:9D38  06 D5 6C 08 00 00 00 00 F1 F1 F1 F1 F1 F1 F1 F1 
    2173   00:9D48                             db 208,106,181,40,8,0,0,0,225,225,225,225,225,225,225,225
    2173   00:9D48  D0 6A B5 28 08 00 00 00 E1 E1 E1 E1 E1 E1 E1 E1 
    2174   00:9D58                             db 94,157,94,77,86,89,92,94,113,113,113,113,113,113,113,113
    2174   00:9D58  5E 9D 5E 4D 56 59 5C 5E 71 71 71 71 71 71 71 71 
    2175   00:9D68                             db 30,14,14,38,26,45,30,46,241,241,241,241,241,241,241,241
    2175   00:9D68  1E 0E 0E 26 1A 2D 1E 2E F1 F1 F1 F1 F1 F1 F1 F1 
    2176   00:9D78  (00:9D78)           bprop  equ $
    2177   00:9D78  00                         db 0
    2178   00:9D79  02                         db 2
    2179   00:9D7A  02                         db 2
    2180   00:9D7B  00                         db 0
    2181   00:9D7C  00                         db 0
    2182   00:9D7D  00                         db 0
    2183   00:9D7E  00                         db 0
    2184   00:9D7F  00                         db 0
    2185   00:9D80  05                         db 5
    2186   00:9D81  06                         db 6
    2187   00:9D82  02                         db 2
    2188   00:9D83  02                         db 2
    2189   00:9D84  02                         db 2
    2190   00:9D85  00                         db 0
    2191   00:9D86  00                         db 0
    2192   00:9D87  00                         db 0
    2193   00:9D88  00                         db 0
    2194   00:9D89  00                         db 0
    2195   00:9D8A  00                         db 0
    2196   00:9D8B  00                         db 0
    2197   00:9D8C  02                         db 2
    2198   00:9D8D  02                         db 2
    2199   00:9D8E  02                         db 2
    2200   00:9D8F  00                         db 0
    2201   00:9D90  00                         db 0
    2202   00:9D91  00                         db 0
    2203   00:9D92  02                         db 2
    2204   00:9D93  01                         db 1
    2205   00:9D94  01                         db 1
    2206   00:9D95  01                         db 1
    2207   00:9D96  00                         db 0
    2208   00:9D97  00                         db 0
    2209   00:9D98  01                         db 1
    2210   00:9D99  01                         db 1
    2211   00:9D9A  01                         db 1
    2212   00:9D9B  00                         db 0
    2213   00:9D9C  00                         db 0
    2214   00:9D9D  00                         db 0
    2215   00:9D9E  01                         db 1
    2216   00:9D9F  01                         db 1
    2217   00:9DA0  01                         db 1
    2218   00:9DA1  00                         db 0
    2219   00:9DA2  00                         db 0
    2220   00:9DA3  00                         db 0
    2221   00:9DA4  01                         db 1
    2222   00:9DA5  01                         db 1
    2223   00:9DA6  01                         db 1
    2224   00:9DA7  01                         db 1
    2225   00:9DA8  01                         db 1
    2226   00:9DA9  01                         db 1
    2227   00:9DAA  01                         db 1
    2228   00:9DAB  01                         db 1
    2229   00:9DAC  01                         db 1
    2230   00:9DAD  01                         db 1
    2231   00:9DAE  01                         db 1
    2232   00:9DAF  01                         db 1
    2233   00:9DB0  01                         db 1
    2234   00:9DB1  00                         db 0
    2235   00:9DB2  00                         db 0
    2236   00:9DB3  00                         db 0
    2237   00:9DB4  01                         db 1
    2238   00:9DB5  01                         db 1
    2239   00:9DB6  01                         db 1
    2240   00:9DB7  00                         db 0
    2241   00:9DB8  00                         db 0
    2242   00:9DB9  00                         db 0
    2243   00:9DBA  01                         db 1
    2244   00:9DBB  01                         db 1
    2245   00:9DBC  01                         db 1
    2246   00:9DBD  00                         db 0
    2247   00:9DBE  00                         db 0
    2248   00:9DBF  00                         db 0
    2249   00:9DC0  00                         db 0
    2250   00:9DC1  01                         db 1
    2251   00:9DC2  00                         db 0
    2252   00:9DC3  01                         db 1
    2253   00:9DC4  01                         db 1
    2254   00:9DC5  01                         db 1
    2255   00:9DC6  01                         db 1
    2256   00:9DC7  01                         db 1
    2257   00:9DC8  01                         db 1
    2258   00:9DC9  01                         db 1
    2259   00:9DCA  00                         db 0
    2260   00:9DCB  00                         db 0
    2261   00:9DCC  00                         db 0
    2262   00:9DCD  01                         db 1
    2263   00:9DCE  01                         db 1
    2264   00:9DCF  01                         db 1
    2265   00:9DD0  01                         db 1
    2266   00:9DD1  01                         db 1
    2267   00:9DD2  01                         db 1
    2268   00:9DD3  00                         db 0
    2269   00:9DD4  00                         db 0
    2270   00:9DD5  00                         db 0
    2271   00:9DD6  00                         db 0
    2272   00:9DD7  (00:9DD7)           sprgfx:	equ $
    2273   00:9DD7                             db 15,30,3,7,30,15,0,30,53,43,29,24,37,88,60,116,192,160,96,224,32,192,0,208,224,232,220,8,224,192,184,116
    2273   00:9DD7  0F 1E 03 07 1E 0F 00 1E 35 2B 1D 18 25 58 3C 74 
    2273   00:9DE7  C0 A0 60 E0 20 C0 00 D0 E0 E8 DC 08 E0 C0 B8 74 
    2274   00:9DF7                             db 15,30,3,7,30,15,0,62,93,235,65,0,237,232,168,192,192,160,96,224,32,194,7,218,236,224,192,48,251,119,10,28
    2274   00:9DF7  0F 1E 03 07 1E 0F 00 3E 5D EB 41 00 ED E8 A8 C0 
    2274   00:9E07  C0 A0 60 E0 20 C2 07 DA EC E0 C0 30 FB 77 0A 1C 
    2275   00:9E17                             db 3,5,6,7,4,3,0,11,7,23,59,16,7,3,29,46,240,120,192,224,120,240,0,120,172,212,184,24,164,26,60,46
    2275   00:9E17  03 05 06 07 04 03 00 0B 07 17 3B 10 07 03 1D 2E 
    2275   00:9E27  F0 78 C0 E0 78 F0 00 78 AC D4 B8 18 A4 1A 3C 2E 
    2276   00:9E37                             db 3,5,6,7,4,67,224,91,55,7,3,12,223,238,80,56,240,120,192,224,120,240,0,124,186,215,130,0,183,23,21,3
    2276   00:9E37  03 05 06 07 04 43 E0 5B 37 07 03 0C DF EE 50 38 
    2276   00:9E47  F0 78 C0 E0 78 F0 00 7C BA D7 82 00 B7 17 15 03 
    2277   00:9E57                             db 5,15,14,15,183,219,76,218,0,0,0,0,0,0,0,0,160,240,112,240,237,219,50,91,0,0,0,0,0,0,0,0
    2277   00:9E57  05 0F 0E 0F B7 DB 4C DA 00 00 00 00 00 00 00 00 
    2277   00:9E67  A0 F0 70 F0 ED DB 32 5B 00 00 00 00 00 00 00 00 
    2278   00:9E77                             db 0,0,0,0,0,0,0,0,0,0,0,0,8,255,8,0,0,0,0,0,0,0,0,0,0,0,0,4,2,253,2,4
    2278   00:9E77  00 00 00 00 00 00 00 00 00 00 00 00 08 FF 08 00 
    2278   00:9E87  00 00 00 00 00 00 00 00 00 00 00 04 02 FD 02 04 
    2279   00:9E97                             db 0,0,0,0,0,0,0,0,0,0,0,0,248,15,248,0,0,0,0,0,0,0,0,0,0,0,0,0,6,253,6,0
    2279   00:9E97  00 00 00 00 00 00 00 00 00 00 00 00 F8 0F F8 00 
    2279   00:9EA7  00 00 00 00 00 00 00 00 00 00 00 00 06 FD 06 00 
    2280   00:9EB7                             db 0,0,0,0,0,0,0,0,0,0,0,240,8,15,8,240,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0,0
    2280   00:9EB7  00 00 00 00 00 00 00 00 00 00 00 F0 08 0F 08 F0 
    2280   00:9EC7  00 00 00 00 00 00 00 00 00 00 00 00 00 FF 00 00 
    2281   00:9ED7                             db 0,0,0,0,0,0,0,0,0,0,0,0,248,15,248,0,0,0,0,0,0,0,0,0,0,0,0,0,6,253,6,0
    2281   00:9ED7  00 00 00 00 00 00 00 00 00 00 00 00 F8 0F F8 00 
    2281   00:9EE7  00 00 00 00 00 00 00 00 00 00 00 00 06 FD 06 00 
    2282   00:9EF7                             db 0,0,0,0,0,0,127,231,195,231,255,128,191,182,63,0,0,0,0,0,0,0,254,231,195,231,255,1,253,109,252,0
    2282   00:9EF7  00 00 00 00 00 00 7F E7 C3 E7 FF 80 BF B6 3F 00 
    2282   00:9F07  00 00 00 00 00 00 FE E7 C3 E7 FF 01 FD 6D FC 00 
    2283   00:9F17                             db 0,0,0,0,0,0,29,43,42,43,43,42,42,42,42,0,0,0,0,0,0,0,240,88,72,88,248,8,232,168,232,0
    2283   00:9F17  00 00 00 00 00 00 1D 2B 2A 2B 2B 2A 2A 2A 2A 00 
    2283   00:9F27  00 00 00 00 00 00 F0 58 48 58 F8 08 E8 A8 E8 00 
    2284   00:9F37                             db 0,0,0,0,0,0,1,3,3,3,3,0,3,3,3,0,0,0,0,0,0,0,128,64,192,192,192,0,192,192,192,0
    2284   00:9F37  00 00 00 00 00 00 01 03 03 03 03 00 03 03 03 00 
    2284   00:9F47  00 00 00 00 00 00 80 40 C0 C0 C0 00 C0 C0 C0 00 
    2285   00:9F57                             db 0,0,0,0,0,0,31,53,36,53,63,32,46,42,46,0,0,0,0,0,0,0,112,168,168,168,168,168,168,168,168,0
    2285   00:9F57  00 00 00 00 00 00 1F 35 24 35 3F 20 2E 2A 2E 00 
    2285   00:9F67  00 00 00 00 00 00 70 A8 A8 A8 A8 A8 A8 A8 A8 00 
    2286   00:9F77                             db 0,0,0,0,0,0,0,0,0,224,177,83,173,83,177,224,0,0,0,0,0,0,0,0,0,0,240,88,85,88,240,0
    2286   00:9F77  00 00 00 00 00 00 00 00 00 E0 B1 53 AD 53 B1 E0 
    2286   00:9F87  00 00 00 00 00 00 00 00 00 00 F0 58 55 58 F0 00 
    2287   00:9F97                             db 0,0,0,0,0,0,0,0,0,1,243,86,170,86,243,1,0,0,0,0,0,0,0,0,0,224,240,184,170,184,240,224
    2287   00:9F97  00 00 00 00 00 00 00 00 00 01 F3 56 AA 56 F3 01 
    2287   00:9FA7  00 00 00 00 00 00 00 00 00 E0 F0 B8 AA B8 F0 E0 
    2288   00:9FB7                             db 0,0,0,0,0,0,0,0,0,1,3,5,253,5,3,1,0,0,0,0,0,0,0,0,0,224,240,120,108,120,240,224
    2288   00:9FB7  00 00 00 00 00 00 00 00 00 01 03 05 FD 05 03 01 
    2288   00:9FC7  00 00 00 00 00 00 00 00 00 E0 F0 78 6C 78 F0 E0 
    2289   00:9FD7                             db 0,0,0,0,0,0,0,0,0,0,241,83,173,83,241,0,0,0,0,0,0,0,0,0,0,0,240,88,85,88,240,0
    2289   00:9FD7  00 00 00 00 00 00 00 00 00 00 F1 53 AD 53 F1 00 
    2289   00:9FE7  00 00 00 00 00 00 00 00 00 00 F0 58 55 58 F0 00 
    2290   00:9FF7                             db 0,0,0,0,0,0,0,0,0,0,0,31,32,223,63,31,0,0,0,0,0,0,0,0,0,0,0,135,205,186,205,135
    2290   00:9FF7  00 00 00 00 00 00 00 00 00 00 00 1F 20 DF 3F 1F 
    2290   00:A007  00 00 00 00 00 00 00 00 00 00 00 87 CD BA CD 87 
    2291   00:A017                             db 0,0,0,0,0,0,0,0,0,0,0,31,63,255,63,31,0,0,0,0,0,0,0,0,0,0,0,128,207,186,207,128
    2291   00:A017  00 00 00 00 00 00 00 00 00 00 00 1F 3F FF 3F 1F 
    2291   00:A027  00 00 00 00 00 00 00 00 00 00 00 80 CF BA CF 80 
    2292   00:A037                             db 0,0,0,0,0,0,0,0,0,0,0,31,63,223,32,31,0,0,0,0,0,0,0,0,0,0,0,128,192,191,192,128
    2292   00:A037  00 00 00 00 00 00 00 00 00 00 00 1F 3F DF 20 1F 
    2292   00:A047  00 00 00 00 00 00 00 00 00 00 00 80 C0 BF C0 80 
    2293   00:A057                             db 0,0,0,0,0,0,0,0,0,0,0,31,63,192,63,31,0,0,0,0,0,0,0,0,0,0,0,128,207,186,207,128
    2293   00:A057  00 00 00 00 00 00 00 00 00 00 00 1F 3F C0 3F 1F 
    2293   00:A067  00 00 00 00 00 00 00 00 00 00 00 80 CF BA CF 80 
    2294   00:A077                             db 0,0,0,0,0,0,0,0,0,0,0,0,0,32,79,32,0,0,0,0,0,0,0,0,0,0,0,0,0,6,248,6
    2294   00:A077  00 00 00 00 00 00 00 00 00 00 00 00 00 20 4F 20 
    2294   00:A087  00 00 00 00 00 00 00 00 00 00 00 00 00 06 F8 06 
    2295   00:A097                             db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,111,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,240,12
    2295   00:A097  00 00 00 00 00 00 00 00 00 00 00 00 00 00 6F 00 
    2295   00:A0A7  00 00 00 00 00 00 00 00 00 00 00 00 00 0C F0 0C 
    2296   00:A0B7                             db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,111,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,224,24
    2296   00:A0B7  00 00 00 00 00 00 00 00 00 00 00 00 00 00 6F 00 
    2296   00:A0C7  00 00 00 00 00 00 00 00 00 00 00 00 00 18 E0 18 
    2297   00:A0D7                             db 0,0,0,0,0,0,0,0,0,0,0,0,0,32,79,32,0,0,0,0,0,0,0,0,0,0,0,0,0,12,240,12
    2297   00:A0D7  00 00 00 00 00 00 00 00 00 00 00 00 00 20 4F 20 
    2297   00:A0E7  00 00 00 00 00 00 00 00 00 00 00 00 00 0C F0 0C 
    2298   00:A0F7                             db 3,29,114,110,64,9,29,45,125,0,15,22,46,14,0,27,128,112,156,236,4,0,0,64,0,64,128,0,0,0,0,0
    2298   00:A0F7  03 1D 72 6E 40 09 1D 2D 7D 00 0F 16 2E 0E 00 1B 
    2298   00:A107  80 70 9C EC 04 00 00 40 00 40 80 00 00 00 00 00 
    2299   00:A117                             db 3,29,114,110,64,9,29,45,125,0,15,22,39,3,0,6,128,112,156,236,4,0,0,64,0,64,128,0,0,0,64,128
    2299   00:A117  03 1D 72 6E 40 09 1D 2D 7D 00 0F 16 27 03 00 06 
    2299   00:A127  80 70 9C EC 04 00 00 40 00 40 80 00 00 00 40 80 
    2300   00:A137                             db 3,29,114,110,64,9,29,45,125,0,15,22,46,14,0,27,128,112,156,236,4,0,0,64,0,64,128,0,0,0,0,0
    2300   00:A137  03 1D 72 6E 40 09 1D 2D 7D 00 0F 16 2E 0E 00 1B 
    2300   00:A147  80 70 9C EC 04 00 00 40 00 40 80 00 00 00 00 00 
    2301   00:A157                             db 3,29,114,110,64,9,29,45,125,0,15,54,12,24,64,44,128,112,156,236,4,0,0,64,0,64,128,0,0,0,0,0
    2301   00:A157  03 1D 72 6E 40 09 1D 2D 7D 00 0F 36 0C 18 40 2C 
    2301   00:A167  80 70 9C EC 04 00 00 40 00 40 80 00 00 00 00 00 
    2302   00:A177                             db 0,0,0,0,0,0,0,0,0,55,109,0,222,0,122,45,0,0,0,0,0,0,0,0,0,116,174,0,219,0,238,188
    2302   00:A177  00 00 00 00 00 00 00 00 00 37 6D 00 DE 00 7A 2D 
    2302   00:A187  00 00 00 00 00 00 00 00 00 74 AE 00 DB 00 EE BC 
    2303   00:A197                             db 0,0,0,0,0,0,0,0,55,109,0,183,222,0,122,45,0,0,0,0,0,0,0,0,116,174,0,119,219,0,238,188
    2303   00:A197  00 00 00 00 00 00 00 00 37 6D 00 B7 DE 00 7A 2D 
    2303   00:A1A7  00 00 00 00 00 00 00 00 74 AE 00 77 DB 00 EE BC 
    2304   00:A1B7                             db 0,0,0,0,0,0,0,0,55,109,0,183,222,0,122,45,0,0,0,0,0,0,0,0,116,174,0,119,219,0,238,188
    2304   00:A1B7  00 00 00 00 00 00 00 00 37 6D 00 B7 DE 00 7A 2D 
    2304   00:A1C7  00 00 00 00 00 00 00 00 74 AE 00 77 DB 00 EE BC 
    2305   00:A1D7                             db 0,0,0,0,0,0,0,0,0,55,109,0,222,0,122,45,0,0,0,0,0,0,0,0,0,116,174,0,219,0,238,188
    2305   00:A1D7  00 00 00 00 00 00 00 00 00 37 6D 00 DE 00 7A 2D 
    2305   00:A1E7  00 00 00 00 00 00 00 00 00 74 AE 00 DB 00 EE BC 
    2306   00:A1F7                             db 3,15,24,48,50,56,63,62,30,15,2,0,4,6,7,3,224,248,140,130,164,138,116,42,52,232,160,0,16,176,240,224
    2306   00:A1F7  03 0F 18 30 32 38 3F 3E 1E 0F 02 00 04 06 07 03 
    2306   00:A207  E0 F8 8C 82 A4 8A 74 2A 34 E8 A0 00 10 B0 F0 E0 
    2307   00:A217                             db 3,15,24,49,48,56,63,62,30,15,2,4,6,7,3,0,224,248,140,194,132,138,116,42,52,232,160,16,176,240,224,0
    2307   00:A217  03 0F 18 31 30 38 3F 3E 1E 0F 02 04 06 07 03 00 
    2307   00:A227  E0 F8 8C C2 84 8A 74 2A 34 E8 A0 10 B0 F0 E0 00 
    2308   00:A237                             db 3,15,24,52,48,56,63,62,30,15,6,6,7,3,0,0,224,248,140,146,132,138,116,42,52,232,176,176,240,224,0,0
    2308   00:A237  03 0F 18 34 30 38 3F 3E 1E 0F 06 06 07 03 00 00 
    2308   00:A247  E0 F8 8C 92 84 8A 74 2A 34 E8 B0 B0 F0 E0 00 00 
    2309   00:A257                             db 3,15,24,48,52,56,63,62,30,15,2,4,6,7,3,0,224,248,140,130,148,138,116,42,52,232,160,16,176,240,224,0
    2309   00:A257  03 0F 18 30 34 38 3F 3E 1E 0F 02 04 06 07 03 00 
    2309   00:A267  E0 F8 8C 82 94 8A 74 2A 34 E8 A0 10 B0 F0 E0 00 
    2310   00:A277                             db 0,12,82,33,81,0,0,0,15,15,15,15,15,0,7,0,0,0,24,36,78,132,128,0,232,232,232,232,232,0,208,0
    2310   00:A277  00 0C 52 21 51 00 00 00 0F 0F 0F 0F 0F 00 07 00 
    2310   00:A287  00 00 18 24 4E 84 80 00 E8 E8 E8 E8 E8 00 D0 00 
    2311   00:A297                             db 0,0,22,9,21,0,0,0,15,15,15,15,15,0,7,0,0,0,0,48,120,144,128,0,248,248,248,248,248,0,240,0
    2311   00:A297  00 00 16 09 15 00 00 00 0F 0F 0F 0F 0F 00 07 00 
    2311   00:A2A7  00 00 00 30 78 90 80 00 F8 F8 F8 F8 F8 00 F0 00 
    2312   00:A2B7                             db 0,0,6,3,5,0,0,0,11,11,11,11,11,0,5,0,0,0,128,160,96,192,128,0,248,248,248,248,248,0,240,0
    2312   00:A2B7  00 00 06 03 05 00 00 00 0B 0B 0B 0B 0B 00 05 00 
    2312   00:A2C7  00 00 80 A0 60 C0 80 00 F8 F8 F8 F8 F8 00 F0 00 
    2313   00:A2D7                             db 0,0,2,13,21,0,0,0,15,15,15,15,15,0,7,0,0,0,32,80,120,144,128,0,120,120,120,120,120,0,112,0
    2313   00:A2D7  00 00 02 0D 15 00 00 00 0F 0F 0F 0F 0F 00 07 00 
    2313   00:A2E7  00 00 20 50 78 90 80 00 78 78 78 78 78 00 70 00 
    2314   00:A2F7                             db 120,120,120,123,123,61,30,0,31,0,15,15,15,15,7,3,30,30,30,222,222,188,120,0,232,0,208,208,208,208,160,64
    2314   00:A2F7  78 78 78 7B 7B 3D 1E 00 1F 00 0F 0F 0F 0F 07 03 
    2314   00:A307  1E 1E 1E DE DE BC 78 00 E8 00 D0 D0 D0 D0 A0 40 
    2315   00:A317                             db 30,30,30,30,30,30,14,0,31,0,15,15,15,15,7,3,120,120,56,216,216,184,112,0,232,0,208,208,208,208,160,64
    2315   00:A317  1E 1E 1E 1E 1E 1E 0E 00 1F 00 0F 0F 0F 0F 07 03 
    2315   00:A327  78 78 38 D8 D8 B8 70 00 E8 00 D0 D0 D0 D0 A0 40 
    2316   00:A337                             db 3,3,3,3,3,3,3,0,31,0,15,15,15,15,7,3,192,192,192,192,192,192,192,0,232,0,208,208,208,208,160,64
    2316   00:A337  03 03 03 03 03 03 03 00 1F 00 0F 0F 0F 0F 07 03 
    2316   00:A347  C0 C0 C0 C0 C0 C0 C0 00 E8 00 D0 D0 D0 D0 A0 40 
    2317   00:A357                             db 30,30,28,27,27,29,14,0,31,0,15,15,15,15,7,3,120,120,120,120,120,120,112,0,232,0,208,208,208,208,160,64
    2317   00:A357  1E 1E 1C 1B 1B 1D 0E 00 1F 00 0F 0F 0F 0F 07 03 
    2317   00:A367  78 78 78 78 78 78 70 00 E8 00 D0 D0 D0 D0 A0 40 
    2318   00:A377                             db 16,48,81,83,240,240,157,144,240,113,85,51,18,0,0,0,0,248,116,240,0,96,224,96,224,192,128,0,0,0,0,0
    2318   00:A377  10 30 51 53 F0 F0 9D 90 F0 71 55 33 12 00 00 00 
    2318   00:A387  00 F8 74 F0 00 60 E0 60 E0 C0 80 00 00 00 00 00 
    2319   00:A397                             db 16,48,81,83,240,240,157,144,240,113,85,51,18,0,0,0,0,244,120,240,0,96,224,96,224,192,128,0,0,0,0,0
    2319   00:A397  10 30 51 53 F0 F0 9D 90 F0 71 55 33 12 00 00 00 
    2319   00:A3A7  00 F4 78 F0 00 60 E0 60 E0 C0 80 00 00 00 00 00 
    2320   00:A3B7                             db 16,48,81,83,240,240,157,144,240,113,85,51,18,0,0,0,0,240,112,252,0,96,224,96,224,192,128,0,0,0,0,0
    2320   00:A3B7  10 30 51 53 F0 F0 9D 90 F0 71 55 33 12 00 00 00 
    2320   00:A3C7  00 F0 70 FC 00 60 E0 60 E0 C0 80 00 00 00 00 00 
    2321   00:A3D7                             db 16,48,81,83,240,240,157,144,240,113,85,51,18,0,0,0,0,240,124,240,0,96,224,96,224,192,128,0,0,0,0,0
    2321   00:A3D7  10 30 51 53 F0 F0 9D 90 F0 71 55 33 12 00 00 00 
    2321   00:A3E7  00 F0 7C F0 00 60 E0 60 E0 C0 80 00 00 00 00 00 
    2322   00:A3F7                             db 7,9,11,14,8,70,225,90,55,7,3,12,223,238,80,56,224,176,144,112,16,98,135,90,236,224,192,48,251,119,10,28
    2322   00:A3F7  07 09 0B 0E 08 46 E1 5A 37 07 03 0C DF EE 50 38 
    2322   00:A407  E0 B0 90 70 10 62 87 5A EC E0 C0 30 FB 77 0A 1C 
    2323   00:A417                             db 7,9,11,14,8,6,1,90,247,75,3,4,15,14,112,62,224,144,208,112,16,98,135,90,236,224,195,59,251,119,2,0
    2323   00:A417  07 09 0B 0E 08 06 01 5A F7 4B 03 04 0F 0E 70 3E 
    2323   00:A427  E0 90 D0 70 10 62 87 5A EC E0 C3 3B FB 77 02 00 
    2324   00:A437                             db 7,9,13,15,8,71,225,90,55,7,3,12,223,238,80,56,224,176,144,240,16,226,135,90,236,224,192,48,251,119,10,28
    2324   00:A437  07 09 0D 0F 08 47 E1 5A 37 07 03 0C DF EE 50 38 
    2324   00:A447  E0 B0 90 F0 10 E2 87 5A EC E0 C0 30 FB 77 0A 1C 
    2325   00:A457                             db 7,9,13,15,8,70,225,90,55,7,131,204,223,238,0,0,224,144,176,240,16,96,128,90,239,242,192,32,240,118,14,62
    2325   00:A457  07 09 0D 0F 08 46 E1 5A 37 07 83 CC DF EE 00 00 
    2325   00:A467  E0 90 B0 F0 10 60 80 5A EF F2 C0 20 F0 76 0E 3E 
    2326   00:A477                             db 0,0,0,1,0,1,2,7,0,3,4,11,0,0,0,0,0,0,16,239,16,208,208,216,24,216,24,224,0,216,48,96
    2326   00:A477  00 00 00 01 00 01 02 07 00 03 04 0B 00 00 00 00 
    2326   00:A487  00 00 10 EF 10 D0 D0 D8 18 D8 18 E0 00 D8 30 60 
    2327   00:A497                             db 0,0,0,0,0,1,2,7,0,3,4,11,0,0,0,0,0,0,16,108,16,208,208,216,24,216,24,224,0,216,24,48
    2327   00:A497  00 00 00 00 00 01 02 07 00 03 04 0B 00 00 00 00 
    2327   00:A4A7  00 00 10 6C 10 D0 D0 D8 18 D8 18 E0 00 D8 18 30 
    2328   00:A4B7                             db 0,0,0,0,0,1,2,7,0,3,4,11,0,0,0,0,0,0,16,16,16,208,208,216,24,216,24,224,0,216,28,8
    2328   00:A4B7  00 00 00 00 00 01 02 07 00 03 04 0B 00 00 00 00 
    2328   00:A4C7  00 00 10 10 10 D0 D0 D8 18 D8 18 E0 00 D8 1C 08 
    2329   00:A4D7                             db 0,0,0,0,0,1,2,7,0,3,4,11,0,0,0,0,0,0,16,108,16,208,208,216,24,216,24,224,0,216,24,48
    2329   00:A4D7  00 00 00 00 00 01 02 07 00 03 04 0B 00 00 00 00 
    2329   00:A4E7  00 00 10 6C 10 D0 D0 D8 18 D8 18 E0 00 D8 18 30 
    2330   00:A4F7  (00:A4F7)           frmlst equ $
    2331   00:A4F7  00 01                      db 0,1
    2332   00:A4F9  01 01                      db 1,1
    2333   00:A4FB  02 01                      db 2,1
    2334   00:A4FD  03 01                      db 3,1
    2335   00:A4FF  04 01                      db 4,1
    2336   00:A501  05 04                      db 5,4
    2337   00:A503  09 04                      db 9,4
    2338   00:A505  0D 04                      db 13,4
    2339   00:A507  11 04                      db 17,4
    2340   00:A509  15 04                      db 21,4
    2341   00:A50B  19 04                      db 25,4
    2342   00:A50D  1D 04                      db 29,4
    2343   00:A50F  21 04                      db 33,4
    2344   00:A511  25 04                      db 37,4
    2345   00:A513  29 04                      db 41,4
    2346   00:A515  2D 04                      db 45,4
    2347   00:A517  31 04                      db 49,4
    2348   00:A519  35 04 39 00                db 53,4,57,0
    2349   00:A51D                      nmedat db 0,0,15,16,16,1,5,15,80,16,8,6,15,136,16,255
    2349   00:A51D  00 00 0F 10 10 01 05 0F 50 10 08 06 0F 88 10 FF 
    2350   00:A52D                             db 0,0,15,16,16,2,5,15,40,120,1,5,15,120,24,8,6,15,96,136,255
    2350   00:A52D  00 00 0F 10 10 02 05 0F 28 78 01 05 0F 78 18 08 
    2350   00:A53D  06 0F 60 88 FF 
    2351   00:A542                             db 0,0,15,16,16,2,7,15,48,64,1,5,15,80,192,8,6,15,136,216,255
    2351   00:A542  00 00 0F 10 10 02 07 0F 30 40 01 05 0F 50 C0 08 
    2351   00:A552  06 0F 88 D8 FF 
    2352   00:A557                             db 0,0,15,16,16,8,6,15,136,216,2,7,15,40,40,1,5,15,80,112,3,8,15,120,184,255
    2352   00:A557  00 00 0F 10 10 08 06 0F 88 D8 02 07 0F 28 28 01 
    2352   00:A567  05 0F 50 70 03 08 0F 78 B8 FF 
    2353   00:A571                             db 0,0,15,16,16,8,6,15,16,216,3,8,15,8,192,1,7,15,120,48,4,9,15,80,120,255
    2353   00:A571  00 00 0F 10 10 08 06 0F 10 D8 03 08 0F 08 C0 01 
    2353   00:A581  07 0F 78 30 04 09 0F 50 78 FF 
    2354   00:A58B                             db 0,0,15,16,16,8,6,15,16,96,5,10,15,24,120,1,11,15,128,104,255
    2354   00:A58B  00 00 0F 10 10 08 06 0F 10 60 05 0A 0F 18 78 01 
    2354   00:A59B  0B 0F 80 68 FF 
    2355   00:A5A0                             db 0,0,15,16,16,8,6,15,136,216,3,8,15,8,208,1,11,15,120,80,5,12,15,48,120,255
    2355   00:A5A0  00 00 0F 10 10 08 06 0F 88 D8 03 08 0F 08 D0 01 
    2355   00:A5B0  0B 0F 78 50 05 0C 0F 30 78 FF 
    2356   00:A5BA                             db 0,0,15,16,16,8,6,15,136,216,5,13,15,8,120,5,13,15,56,80,255
    2356   00:A5BA  00 00 0F 10 10 08 06 0F 88 D8 05 0D 0F 08 78 05 
    2356   00:A5CA  0D 0F 38 50 FF 
    2357   00:A5CF                             db 0,0,15,16,16,4,8,15,8,232,3,8,15,128,112,1,5,15,40,96,8,6,15,16,176,255
    2357   00:A5CF  00 00 0F 10 10 04 08 0F 08 E8 03 08 0F 80 70 01 
    2357   00:A5DF  05 0F 28 60 08 06 0F 10 B0 FF 
    2358   00:A5E9                             db 0,0,15,16,16,7,6,15,136,216,5,13,15,48,80,6,7,15,120,16,5,10,15,72,160,255
    2358   00:A5E9  00 00 0F 10 10 07 06 0F 88 D8 05 0D 0F 30 50 06 
    2358   00:A5F9  07 0F 78 10 05 0A 0F 48 A0 FF 
    2359   00:A603                             db 0,0,15,16,16,5,14,15,48,120,5,14,15,64,160,3,17,15,120,120,1,5,15,40,24,7,6,15,136,216,255
    2359   00:A603  00 00 0F 10 10 05 0E 0F 30 78 05 0E 0F 40 A0 03 
    2359   00:A613  11 0F 78 78 01 05 0F 28 18 07 06 0F 88 D8 FF 
    2360   00:A622                             db 0,0,15,16,16,5,10,15,16,160,7,6,15,136,216,4,15,15,88,144,255
    2360   00:A622  00 00 0F 10 10 05 0A 0F 10 A0 07 06 0F 88 D8 04 
    2360   00:A632  0F 0F 58 90 FF 
    2361   00:A637                             db 0,0,15,16,16,5,13,15,16,120,1,5,15,80,104,3,8,15,88,184,7,6,15,136,176,255
    2361   00:A637  00 00 0F 10 10 05 0D 0F 10 78 01 05 0F 50 68 03 
    2361   00:A647  08 0F 58 B8 07 06 0F 88 B0 FF 
    2362   00:A651                             db 0,0,15,16,16,7,6,15,136,16,5,12,15,64,80,1,11,15,40,16,3,11,15,80,184,255
    2362   00:A651  00 00 0F 10 10 07 06 0F 88 10 05 0C 0F 40 50 01 
    2362   00:A661  0B 0F 28 10 03 0B 0F 50 B8 FF 
    2363   00:A66B                             db 0,0,15,16,16,7,6,15,136,224,5,10,15,48,80,3,17,15,128,160,4,8,15,40,120,255
    2363   00:A66B  00 00 0F 10 10 07 06 0F 88 E0 05 0A 0F 30 50 03 
    2363   00:A67B  11 0F 80 A0 04 08 0F 28 78 FF 
    2364   00:A685                             db 0,0,15,16,16,7,6,15,136,16,6,11,15,48,32,2,5,15,40,152,3,8,15,88,152,255
    2364   00:A685  00 00 0F 10 10 07 06 0F 88 10 06 0B 0F 30 20 02 
    2364   00:A695  05 0F 28 98 03 08 0F 58 98 FF 
    2365   00:A69F                             db 0,0,15,16,16,7,6,15,136,216,6,11,15,48,72,5,14,15,16,120,6,7,15,128,152,3,17,15,80,144,255
    2365   00:A69F  00 00 0F 10 10 07 06 0F 88 D8 06 0B 0F 30 48 05 
    2365   00:A6AF  0E 0F 10 78 06 07 0F 80 98 03 11 0F 50 90 FF 
    2366   00:A6BE                             db 0,0,15,16,16,7,6,15,136,144,3,17,15,40,160,1,7,15,88,40,3,17,15,120,64,255
    2366   00:A6BE  00 00 0F 10 10 07 06 0F 88 90 03 11 0F 28 A0 01 
    2366   00:A6CE  07 0F 58 28 03 11 0F 78 40 FF 
    2367   00:A6D8                             db 0,0,15,16,16,7,6,15,136,64,3,8,15,120,144,3,8,15,128,40,1,11,15,88,56,255
    2367   00:A6D8  00 00 0F 10 10 07 06 0F 88 40 03 08 0F 78 90 03 
    2367   00:A6E8  08 0F 80 28 01 0B 0F 58 38 FF 
    2368   00:A6F2                             db 0,0,15,16,16,3,8,15,48,200,2,5,15,40,40,3,9,15,80,120,7,6,15,136,24,3,17,15,128,152,3,11,15,128,72,255
    2368   00:A6F2  00 00 0F 10 10 03 08 0F 30 C8 02 05 0F 28 28 03 
    2368   00:A702  09 0F 50 78 07 06 0F 88 18 03 11 0F 80 98 03 0B 
    2368   00:A712  0F 80 48 FF 
    2369   00:A716                             db 4,6,15,48,32,4,6,15,48,208,4,13,15,136,32,4,13,15,136,208,255,255
    2369   00:A716  04 06 0F 30 20 04 06 0F 30 D0 04 0D 0F 88 20 04 
    2369   00:A726  0D 0F 88 D0 FF FF 
    2370   00:A72C  (00:0028)           NUMOBJ equ 40
    2371   00:A72C  (00:A72C)           objdta:	equ $
    2372   00:A72C                             db 0,16,176,0,0,0,0,0,4,4,2,0,0,0,0,0,4,68,68,2,3,1,1,0,4,3,1,100,108,173,194,246,236,21,187,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2372   00:A72C  00 10 B0 00 00 00 00 00 04 04 02 00 00 00 00 00 
    2372   00:A73C  04 44 44 02 03 01 01 00 04 03 01 64 6C AD C2 F6 
    2372   00:A74C  EC 15 BB F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2372   00:A75C  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2372   00:A76C  F1 F1 F1 
    2373   00:A76F                             db 0,56,96,0,0,0,0,0,4,4,2,0,0,0,0,0,4,68,68,2,3,1,1,0,4,3,1,100,108,173,194,246,236,21,187,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2373   00:A76F  00 38 60 00 00 00 00 00 04 04 02 00 00 00 00 00 
    2373   00:A77F  04 44 44 02 03 01 01 00 04 03 01 64 6C AD C2 F6 
    2373   00:A78F  EC 15 BB F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2373   00:A79F  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2373   00:A7AF  F1 F1 F1 
    2374   00:A7B2                             db 0,96,136,0,0,0,0,0,4,4,2,0,0,0,0,0,4,68,68,2,3,1,1,0,4,3,1,100,108,173,194,246,236,21,187,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2374   00:A7B2  00 60 88 00 00 00 00 00 04 04 02 00 00 00 00 00 
    2374   00:A7C2  04 44 44 02 03 01 01 00 04 03 01 64 6C AD C2 F6 
    2374   00:A7D2  EC 15 BB F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2374   00:A7E2  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2374   00:A7F2  F1 F1 F1 
    2375   00:A7F5                             db 1,56,136,0,0,0,0,0,0,0,0,0,0,0,0,66,231,231,66,0,0,0,0,0,0,0,0,0,189,60,189,60,189,60,189,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2375   00:A7F5  01 38 88 00 00 00 00 00 00 00 00 00 00 00 00 42 
    2375   00:A805  E7 E7 42 00 00 00 00 00 00 00 00 00 BD 3C BD 3C 
    2375   00:A815  BD 3C BD F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2375   00:A825  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2375   00:A835  F1 F1 F1 
    2376   00:A838                             db 1,96,96,0,0,0,0,0,0,0,0,0,0,0,0,66,231,231,66,0,0,0,0,0,0,0,0,0,189,60,189,60,189,60,189,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2376   00:A838  01 60 60 00 00 00 00 00 00 00 00 00 00 00 00 42 
    2376   00:A848  E7 E7 42 00 00 00 00 00 00 00 00 00 BD 3C BD 3C 
    2376   00:A858  BD 3C BD F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2376   00:A868  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2376   00:A878  F1 F1 F1 
    2377   00:A87B                             db 1,136,136,0,0,0,0,0,0,0,0,0,0,0,0,66,231,231,66,0,0,0,0,0,0,0,0,0,189,60,189,60,189,60,189,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2377   00:A87B  01 88 88 00 00 00 00 00 00 00 00 00 00 00 00 42 
    2377   00:A88B  E7 E7 42 00 00 00 00 00 00 00 00 00 BD 3C BD 3C 
    2377   00:A89B  BD 3C BD F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2377   00:A8AB  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2377   00:A8BB  F1 F1 F1 
    2378   00:A8BE                             db 2,16,136,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,16,16,84,84,68,40,41,170,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2378   00:A8BE  02 10 88 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2378   00:A8CE  00 00 00 00 00 00 00 00 00 01 00 10 10 54 54 44 
    2378   00:A8DE  28 29 AA F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2378   00:A8EE  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2378   00:A8FE  F1 F1 F1 
    2379   00:A901                             db 2,56,56,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,16,16,84,84,68,40,41,170,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2379   00:A901  02 38 38 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2379   00:A911  00 00 00 00 00 00 00 00 00 01 00 10 10 54 54 44 
    2379   00:A921  28 29 AA F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2379   00:A931  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2379   00:A941  F1 F1 F1 
    2380   00:A944                             db 2,136,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,16,16,84,84,68,40,41,170,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2380   00:A944  02 88 60 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2380   00:A954  00 00 00 00 00 00 00 00 00 01 00 10 10 54 54 44 
    2380   00:A964  28 29 AA F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2380   00:A974  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2380   00:A984  F1 F1 F1 
    2381   00:A987                             db 3,16,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,130,68,40,146,85,186,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2381   00:A987  03 10 60 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2381   00:A997  00 00 00 00 00 00 00 00 00 01 00 00 00 82 44 28 
    2381   00:A9A7  92 55 BA F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2381   00:A9B7  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2381   00:A9C7  F1 F1 F1 
    2382   00:A9CA                             db 3,96,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,130,68,40,146,85,186,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2382   00:A9CA  03 60 60 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2382   00:A9DA  00 00 00 00 00 00 00 00 00 01 00 00 00 82 44 28 
    2382   00:A9EA  92 55 BA F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2382   00:A9FA  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2382   00:AA0A  F1 F1 F1 
    2383   00:AA0D                             db 3,136,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,130,68,40,146,85,186,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2383   00:AA0D  03 88 60 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2383   00:AA1D  00 00 00 00 00 00 00 00 00 01 00 00 00 82 44 28 
    2383   00:AA2D  92 55 BA F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2383   00:AA3D  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2383   00:AA4D  F1 F1 F1 
    2384   00:AA50                             db 4,16,136,0,0,0,0,0,4,4,2,0,0,0,0,0,4,68,68,2,3,1,1,0,4,3,1,100,108,173,194,246,236,21,187,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2384   00:AA50  04 10 88 00 00 00 00 00 04 04 02 00 00 00 00 00 
    2384   00:AA60  04 44 44 02 03 01 01 00 04 03 01 64 6C AD C2 F6 
    2384   00:AA70  EC 15 BB F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2384   00:AA80  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2384   00:AA90  F1 F1 F1 
    2385   00:AA93                             db 4,56,96,0,0,0,0,0,4,4,2,0,0,0,0,0,4,68,68,2,3,1,1,0,4,3,1,100,108,173,194,246,236,21,187,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2385   00:AA93  04 38 60 00 00 00 00 00 04 04 02 00 00 00 00 00 
    2385   00:AAA3  04 44 44 02 03 01 01 00 04 03 01 64 6C AD C2 F6 
    2385   00:AAB3  EC 15 BB F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2385   00:AAC3  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2385   00:AAD3  F1 F1 F1 
    2386   00:AAD6                             db 4,96,176,0,0,0,0,0,4,4,2,0,0,0,0,0,4,68,68,2,3,1,1,0,4,3,1,100,108,173,194,246,236,21,187,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2386   00:AAD6  04 60 B0 00 00 00 00 00 04 04 02 00 00 00 00 00 
    2386   00:AAE6  04 44 44 02 03 01 01 00 04 03 01 64 6C AD C2 F6 
    2386   00:AAF6  EC 15 BB F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2386   00:AB06  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2386   00:AB16  F1 F1 F1 
    2387   00:AB19                             db 5,16,56,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,130,68,40,146,85,186,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2387   00:AB19  05 10 38 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2387   00:AB29  00 00 00 00 00 00 00 00 00 01 00 00 00 82 44 28 
    2387   00:AB39  92 55 BA F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2387   00:AB49  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2387   00:AB59  F1 F1 F1 
    2388   00:AB5C                             db 5,56,136,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,130,68,40,146,85,186,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2388   00:AB5C  05 38 88 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2388   00:AB6C  00 00 00 00 00 00 00 00 00 01 00 00 00 82 44 28 
    2388   00:AB7C  92 55 BA F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2388   00:AB8C  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2388   00:AB9C  F1 F1 F1 
    2389   00:AB9F                             db 5,96,136,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,130,68,40,146,85,186,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2389   00:AB9F  05 60 88 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2389   00:ABAF  00 00 00 00 00 00 00 00 00 01 00 00 00 82 44 28 
    2389   00:ABBF  92 55 BA F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2389   00:ABCF  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2389   00:ABDF  F1 F1 F1 
    2390   00:ABE2                             db 6,56,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,56,56,56,56,186,215,238,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2390   00:ABE2  06 38 60 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2390   00:ABF2  00 00 00 00 00 00 00 00 00 01 00 00 38 38 38 38 
    2390   00:AC02  BA D7 EE F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2390   00:AC12  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2390   00:AC22  F1 F1 F1 
    2391   00:AC25                             db 6,96,136,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,56,56,56,56,186,215,238,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2391   00:AC25  06 60 88 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2391   00:AC35  00 00 00 00 00 00 00 00 00 01 00 00 38 38 38 38 
    2391   00:AC45  BA D7 EE F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2391   00:AC55  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2391   00:AC65  F1 F1 F1 
    2392   00:AC68                             db 6,136,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,56,56,56,56,186,215,238,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2392   00:AC68  06 88 60 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2392   00:AC78  00 00 00 00 00 00 00 00 00 01 00 00 38 38 38 38 
    2392   00:AC88  BA D7 EE F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2392   00:AC98  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2392   00:ACA8  F1 F1 F1 
    2393   00:ACAB                             db 7,16,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,0,0,0,0,0,0,0,0,73,73,127,54,62,20,42,28,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2393   00:ACAB  07 10 60 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2393   00:ACBB  00 00 3E 00 00 00 00 00 00 00 00 49 49 7F 36 3E 
    2393   00:ACCB  14 2A 1C F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2393   00:ACDB  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2393   00:ACEB  F1 F1 F1 
    2394   00:ACEE                             db 7,96,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,0,0,0,0,0,0,0,0,73,73,127,54,62,20,42,28,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2394   00:ACEE  07 60 60 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2394   00:ACFE  00 00 3E 00 00 00 00 00 00 00 00 49 49 7F 36 3E 
    2394   00:AD0E  14 2A 1C F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2394   00:AD1E  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2394   00:AD2E  F1 F1 F1 
    2395   00:AD31                             db 7,136,136,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,0,0,0,0,0,0,0,0,73,73,127,54,62,20,42,28,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2395   00:AD31  07 88 88 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2395   00:AD41  00 00 3E 00 00 00 00 00 00 00 00 49 49 7F 36 3E 
    2395   00:AD51  14 2A 1C F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2395   00:AD61  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2395   00:AD71  F1 F1 F1 
    2396   00:AD74                             db 8,16,136,0,0,0,0,0,4,4,2,0,0,0,0,0,4,68,68,2,3,1,1,0,4,3,1,100,108,173,194,246,236,21,187,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2396   00:AD74  08 10 88 00 00 00 00 00 04 04 02 00 00 00 00 00 
    2396   00:AD84  04 44 44 02 03 01 01 00 04 03 01 64 6C AD C2 F6 
    2396   00:AD94  EC 15 BB F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2396   00:ADA4  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2396   00:ADB4  F1 F1 F1 
    2397   00:ADB7                             db 8,56,136,0,0,0,0,0,4,4,2,0,0,0,0,0,4,68,68,2,3,1,1,0,4,3,1,100,108,173,194,246,236,21,187,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2397   00:ADB7  08 38 88 00 00 00 00 00 04 04 02 00 00 00 00 00 
    2397   00:ADC7  04 44 44 02 03 01 01 00 04 03 01 64 6C AD C2 F6 
    2397   00:ADD7  EC 15 BB F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2397   00:ADE7  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2397   00:ADF7  F1 F1 F1 
    2398   00:ADFA                             db 8,96,96,0,0,0,0,0,4,4,2,0,0,0,0,0,4,68,68,2,3,1,1,0,4,3,1,100,108,173,194,246,236,21,187,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2398   00:ADFA  08 60 60 00 00 00 00 00 04 04 02 00 00 00 00 00 
    2398   00:AE0A  04 44 44 02 03 01 01 00 04 03 01 64 6C AD C2 F6 
    2398   00:AE1A  EC 15 BB F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2398   00:AE2A  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2398   00:AE3A  F1 F1 F1 
    2399   00:AE3D                             db 9,16,136,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,16,16,84,84,68,40,41,170,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2399   00:AE3D  09 10 88 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2399   00:AE4D  00 00 00 00 00 00 00 00 00 01 00 10 10 54 54 44 
    2399   00:AE5D  28 29 AA F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2399   00:AE6D  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2399   00:AE7D  F1 F1 F1 
    2400   00:AE80                             db 9,96,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,16,16,84,84,68,40,41,170,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2400   00:AE80  09 60 60 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2400   00:AE90  00 00 00 00 00 00 00 00 00 01 00 10 10 54 54 44 
    2400   00:AEA0  28 29 AA F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2400   00:AEB0  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2400   00:AEC0  F1 F1 F1 
    2401   00:AEC3                             db 10,136,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,130,68,40,146,85,186,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2401   00:AEC3  0A 88 60 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2401   00:AED3  00 00 00 00 00 00 00 00 00 01 00 00 00 82 44 28 
    2401   00:AEE3  92 55 BA F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2401   00:AEF3  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2401   00:AF03  F1 F1 F1 
    2402   00:AF06                             db 10,136,96,0,0,0,0,0,4,4,2,0,0,0,0,0,4,68,68,2,3,1,1,0,4,3,1,100,108,173,194,246,236,21,187,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2402   00:AF06  0A 88 60 00 00 00 00 00 04 04 02 00 00 00 00 00 
    2402   00:AF16  04 44 44 02 03 01 01 00 04 03 01 64 6C AD C2 F6 
    2402   00:AF26  EC 15 BB F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2402   00:AF36  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2402   00:AF46  F1 F1 F1 
    2403   00:AF49                             db 12,56,56,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,34,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2403   00:AF49  0C 38 38 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2403   00:AF59  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2403   00:AF69  00 00 22 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2403   00:AF79  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2403   00:AF89  F1 F1 F1 
    2404   00:AF8C                             db 12,136,136,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,34,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2404   00:AF8C  0C 88 88 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2404   00:AF9C  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2404   00:AFAC  00 00 22 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2404   00:AFBC  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2404   00:AFCC  F1 F1 F1 
    2405   00:AFCF                             db 13,136,136,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,34,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2405   00:AFCF  0D 88 88 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2405   00:AFDF  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2405   00:AFEF  00 00 22 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2405   00:AFFF  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2405   00:B00F  F1 F1 F1 
    2406   00:B012                             db 14,96,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,34,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2406   00:B012  0E 60 60 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2406   00:B022  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2406   00:B032  00 00 22 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2406   00:B042  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2406   00:B052  F1 F1 F1 
    2407   00:B055                             db 14,96,136,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,34,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2407   00:B055  0E 60 88 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2407   00:B065  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2407   00:B075  00 00 22 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2407   00:B085  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2407   00:B095  F1 F1 F1 
    2408   00:B098                             db 15,16,136,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,34,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2408   00:B098  0F 10 88 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2408   00:B0A8  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2408   00:B0B8  00 00 22 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2408   00:B0C8  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2408   00:B0D8  F1 F1 F1 
    2409   00:B0DB                             db 15,96,96,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,34,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2409   00:B0DB  0F 60 60 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2409   00:B0EB  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2409   00:B0FB  00 00 22 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2409   00:B10B  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2409   00:B11B  F1 F1 F1 
    2410   00:B11E                             db 15,136,136,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,34,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2410   00:B11E  0F 88 88 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2410   00:B12E  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2410   00:B13E  00 00 22 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2410   00:B14E  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2410   00:B15E  F1 F1 F1 
    2411   00:B161                             db 16,96,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,34,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241
    2411   00:B161  10 60 10 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2411   00:B171  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
    2411   00:B181  00 00 22 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2411   00:B191  F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 F1 
    2411   00:B1A1  F1 F1 F1 
    2412   00:B1A4  (00:B1A4)           palett:	equ $
    2413   00:B1A4                             defw $0,$0,$611,$733,$117,$327,$151,$627,$171,$373,$661,$664,$411,$265,$555,$777
    2413   00:B1A4  00 00 00 00 11 06 33 07 17 01 27 03 51 01 27 06 
    2413   00:B1B4  71 01 73 03 61 06 64 06 11 04 65 02 55 05 77 07 
    2414   00:B1C4  (00:B1C4)           font:	equ $
    2415   00:B1C4                             db 0,0,0,0,0,0,0,0
    2415   00:B1C4  00 00 00 00 00 00 00 00 
    2416   00:B1CC                             db 0,48,48,48,48,0,48,0
    2416   00:B1CC  00 30 30 30 30 00 30 00 
    2417   00:B1D4                             db 0,108,108,0,0,0,0,0
    2417   00:B1D4  00 6C 6C 00 00 00 00 00 
    2418   00:B1DC                             db 0,108,254,108,108,254,108,0
    2418   00:B1DC  00 6C FE 6C 6C FE 6C 00 
    2419   00:B1E4                             db 0,24,126,120,126,30,126,24
    2419   00:B1E4  00 18 7E 78 7E 1E 7E 18 
    2420   00:B1EC                             db 0,230,236,24,48,110,206,0
    2420   00:B1EC  00 E6 EC 18 30 6E CE 00 
    2421   00:B1F4                             db 0,48,120,48,126,204,126,0
    2421   00:B1F4  00 30 78 30 7E CC 7E 00 
    2422   00:B1FC                             db 0,24,48,0,0,0,0,0
    2422   00:B1FC  00 18 30 00 00 00 00 00 
    2423   00:B204                             db 0,12,24,24,24,24,12,0
    2423   00:B204  00 0C 18 18 18 18 0C 00 
    2424   00:B20C                             db 0,96,48,48,48,48,96,0
    2424   00:B20C  00 60 30 30 30 30 60 00 
    2425   00:B214                             db 0,0,60,24,126,24,60,0
    2425   00:B214  00 00 3C 18 7E 18 3C 00 
    2426   00:B21C                             db 0,0,24,24,126,24,24,0
    2426   00:B21C  00 00 18 18 7E 18 18 00 
    2427   00:B224                             db 0,0,0,0,0,24,24,48
    2427   00:B224  00 00 00 00 00 18 18 30 
    2428   00:B22C                             db 0,0,0,24,36,24,0,0
    2428   00:B22C  00 00 00 18 24 18 00 00 
    2429   00:B234                             db 0,0,0,0,0,56,56,0
    2429   00:B234  00 00 00 00 00 38 38 00 
    2430   00:B23C                             db 0,0,6,12,24,48,96,0
    2430   00:B23C  00 00 06 0C 18 30 60 00 
    2431   00:B244                             db 0,124,238,238,238,238,124,0
    2431   00:B244  00 7C EE EE EE EE 7C 00 
    2432   00:B24C                             db 0,56,60,28,28,126,126,0
    2432   00:B24C  00 38 3C 1C 1C 7E 7E 00 
    2433   00:B254                             db 0,124,254,30,248,246,254,0
    2433   00:B254  00 7C FE 1E F8 F6 FE 00 
    2434   00:B25C                             db 0,124,222,60,30,254,124,0
    2434   00:B25C  00 7C DE 3C 1E FE 7C 00 
    2435   00:B264                             db 0,28,60,124,220,254,60,0
    2435   00:B264  00 1C 3C 7C DC FE 3C 00 
    2436   00:B26C                             db 0,254,246,248,62,222,124,0
    2436   00:B26C  00 FE F6 F8 3E DE 7C 00 
    2437   00:B274                             db 0,124,236,242,254,238,124,0
    2437   00:B274  00 7C EC F2 FE EE 7C 00 
    2438   00:B27C                             db 0,254,254,14,60,120,120,0
    2438   00:B27C  00 FE FE 0E 3C 78 78 00 
    2439   00:B284                             db 0,124,238,124,238,238,124,0
    2439   00:B284  00 7C EE 7C EE EE 7C 00 
    2440   00:B28C                             db 0,124,254,246,222,62,124,0
    2440   00:B28C  00 7C FE F6 DE 3E 7C 00 
    2441   00:B294                             db 0,0,48,48,0,48,48,0
    2441   00:B294  00 00 30 30 00 30 30 00 
    2442   00:B29C                             db 0,124,130,186,162,186,130,124
    2442   00:B29C  00 7C 82 BA A2 BA 82 7C 
    2443   00:B2A4                             db 0,0,12,24,48,24,12,0
    2443   00:B2A4  00 00 0C 18 30 18 0C 00 
    2444   00:B2AC                             db 0,0,0,126,0,126,0,0
    2444   00:B2AC  00 00 00 7E 00 7E 00 00 
    2445   00:B2B4                             db 0,0,48,24,12,24,48,0
    2445   00:B2B4  00 00 30 18 0C 18 30 00 
    2446   00:B2BC                             db 0,124,198,12,24,0,24,0
    2446   00:B2BC  00 7C C6 0C 18 00 18 00 
    2447   00:B2C4                             db 0,124,222,254,254,192,124,0
    2447   00:B2C4  00 7C DE FE FE C0 7C 00 
    2448   00:B2CC                             db 0,124,238,254,238,238,108,0
    2448   00:B2CC  00 7C EE FE EE EE 6C 00 
    2449   00:B2D4                             db 0,124,238,252,238,254,124,0
    2449   00:B2D4  00 7C EE FC EE FE 7C 00 
    2450   00:B2DC                             db 0,124,254,224,254,254,124,0
    2450   00:B2DC  00 7C FE E0 FE FE 7C 00 
    2451   00:B2E4                             db 0,252,238,238,254,254,252,0
    2451   00:B2E4  00 FC EE EE FE FE FC 00 
    2452   00:B2EC                             db 0,126,240,252,240,254,126,0
    2452   00:B2EC  00 7E F0 FC F0 FE 7E 00 
    2453   00:B2F4                             db 0,126,240,252,240,240,240,0
    2453   00:B2F4  00 7E F0 FC F0 F0 F0 00 
    2454   00:B2FC                             db 0,124,254,240,238,246,124,0
    2454   00:B2FC  00 7C FE F0 EE F6 7C 00 
    2455   00:B304                             db 0,238,238,254,254,238,238,0
    2455   00:B304  00 EE EE FE FE EE EE 00 
    2456   00:B30C                             db 0,126,126,60,60,126,126,0
    2456   00:B30C  00 7E 7E 3C 3C 7E 7E 00 
    2457   00:B314                             db 0,30,30,30,222,254,124,0
    2457   00:B314  00 1E 1E 1E DE FE 7C 00 
    2458   00:B31C                             db 0,238,252,248,248,252,238,0
    2458   00:B31C  00 EE FC F8 F8 FC EE 00 
    2459   00:B324                             db 0,112,240,240,252,254,126,0
    2459   00:B324  00 70 F0 F0 FC FE 7E 00 
    2460   00:B32C                             db 0,214,254,254,238,238,238,0
    2460   00:B32C  00 D6 FE FE EE EE EE 00 
    2461   00:B334                             db 0,206,238,254,254,238,230,0
    2461   00:B334  00 CE EE FE FE EE E6 00 
    2462   00:B33C                             db 0,124,254,238,238,254,124,0
    2462   00:B33C  00 7C FE EE EE FE 7C 00 
    2463   00:B344                             db 0,252,238,238,252,240,240,0
    2463   00:B344  00 FC EE EE FC F0 F0 00 
    2464   00:B34C                             db 0,124,254,254,238,242,124,0
    2464   00:B34C  00 7C FE FE EE F2 7C 00 
    2465   00:B354                             db 0,252,254,238,252,238,238,0
    2465   00:B354  00 FC FE EE FC EE EE 00 
    2466   00:B35C                             db 0,124,240,252,30,254,124,0
    2466   00:B35C  00 7C F0 FC 1E FE 7C 00 
    2467   00:B364                             db 0,254,254,56,124,124,124,0
    2467   00:B364  00 FE FE 38 7C 7C 7C 00 
    2468   00:B36C                             db 0,238,238,238,238,254,124,0
    2468   00:B36C  00 EE EE EE EE FE 7C 00 
    2469   00:B374                             db 0,238,238,238,238,124,56,0
    2469   00:B374  00 EE EE EE EE 7C 38 00 
    2470   00:B37C                             db 0,238,238,238,254,254,108,0
    2470   00:B37C  00 EE EE EE FE FE 6C 00 
    2471   00:B384                             db 0,238,254,124,254,254,238,0
    2471   00:B384  00 EE FE 7C FE FE EE 00 
    2472   00:B38C                             db 0,238,238,254,62,254,252,0
    2472   00:B38C  00 EE EE FE 3E FE FC 00 
    2473   00:B394                             db 0,254,254,184,118,254,254,0
    2473   00:B394  00 FE FE B8 76 FE FE 00 
    2474   00:B39C                             db 0,30,24,24,24,24,30,0
    2474   00:B39C  00 1E 18 18 18 18 1E 00 
    2475   00:B3A4                             db 0,0,192,96,48,24,12,0
    2475   00:B3A4  00 00 C0 60 30 18 0C 00 
    2476   00:B3AC                             db 0,240,48,48,48,48,240,0
    2476   00:B3AC  00 F0 30 30 30 30 F0 00 
    2477   00:B3B4                             db 0,48,120,252,48,48,48,0
    2477   00:B3B4  00 30 78 FC 30 30 30 00 
    2478   00:B3BC                             db 0,0,0,0,0,0,0,255
    2478   00:B3BC  00 00 00 00 00 00 00 FF 
    2479   00:B3C4                             db 0,60,102,248,96,96,254,0
    2479   00:B3C4  00 3C 66 F8 60 60 FE 00 
    2480   00:B3CC                             db 0,0,120,12,124,204,124,0
    2480   00:B3CC  00 00 78 0C 7C CC 7C 00 
    2481   00:B3D4                             db 0,96,96,124,102,102,124,0
    2481   00:B3D4  00 60 60 7C 66 66 7C 00 
    2482   00:B3DC                             db 0,0,60,96,96,96,60,0
    2482   00:B3DC  00 00 3C 60 60 60 3C 00 
    2483   00:B3E4                             db 0,12,12,124,204,204,124,0
    2483   00:B3E4  00 0C 0C 7C CC CC 7C 00 
    2484   00:B3EC                             db 0,0,120,204,248,192,124,0
    2484   00:B3EC  00 00 78 CC F8 C0 7C 00 
    2485   00:B3F4                             db 0,28,48,56,48,48,48,0
    2485   00:B3F4  00 1C 30 38 30 30 30 00 
    2486   00:B3FC                             db 0,0,124,204,204,124,12,120
    2486   00:B3FC  00 00 7C CC CC 7C 0C 78 
    2487   00:B404                             db 0,192,192,248,204,204,204,0
    2487   00:B404  00 C0 C0 F8 CC CC CC 00 
    2488   00:B40C                             db 0,48,0,112,48,48,120,0
    2488   00:B40C  00 30 00 70 30 30 78 00 
    2489   00:B414                             db 0,12,0,12,12,12,108,56
    2489   00:B414  00 0C 00 0C 0C 0C 6C 38 
    2490   00:B41C                             db 0,96,120,112,112,120,108,0
    2490   00:B41C  00 60 78 70 70 78 6C 00 
    2491   00:B424                             db 0,48,48,48,48,48,28,0
    2491   00:B424  00 30 30 30 30 30 1C 00 
    2492   00:B42C                             db 0,0,248,252,252,252,252,0
    2492   00:B42C  00 00 F8 FC FC FC FC 00 
    2493   00:B434                             db 0,0,248,204,204,204,204,0
    2493   00:B434  00 00 F8 CC CC CC CC 00 
    2494   00:B43C                             db 0,0,120,204,204,204,120,0
    2494   00:B43C  00 00 78 CC CC CC 78 00 
    2495   00:B444                             db 0,0,248,204,204,248,192,192
    2495   00:B444  00 00 F8 CC CC F8 C0 C0 
    2496   00:B44C                             db 0,0,124,204,204,124,12,14
    2496   00:B44C  00 00 7C CC CC 7C 0C 0E 
    2497   00:B454                             db 0,0,60,96,96,96,96,0
    2497   00:B454  00 00 3C 60 60 60 60 00 
    2498   00:B45C                             db 0,0,120,192,120,12,248,0
    2498   00:B45C  00 00 78 C0 78 0C F8 00 
    2499   00:B464                             db 0,48,120,48,48,48,28,0
    2499   00:B464  00 30 78 30 30 30 1C 00 
    2500   00:B46C                             db 0,0,204,204,204,204,120,0
    2500   00:B46C  00 00 CC CC CC CC 78 00 
    2501   00:B474                             db 0,0,204,204,120,120,48,0
    2501   00:B474  00 00 CC CC 78 78 30 00 
    2502   00:B47C                             db 0,0,204,252,252,252,120,0
    2502   00:B47C  00 00 CC FC FC FC 78 00 
    2503   00:B484                             db 0,0,204,120,48,120,204,0
    2503   00:B484  00 00 CC 78 30 78 CC 00 
    2504   00:B48C                             db 0,0,204,204,204,124,12,120
    2504   00:B48C  00 00 CC CC CC 7C 0C 78 
    2505   00:B494                             db 0,0,252,24,48,96,252,0
    2505   00:B494  00 00 FC 18 30 60 FC 00 
    2506   00:B49C                             db 0,30,24,112,24,24,30,0
    2506   00:B49C  00 1E 18 70 18 18 1E 00 
    2507   00:B4A4                             db 0,24,24,24,24,24,24,0
    2507   00:B4A4  00 18 18 18 18 18 18 00 
    2508   00:B4AC                             db 0,240,48,28,48,48,240,0
    2508   00:B4AC  00 F0 30 1C 30 30 F0 00 
    2509   00:B4B4                             db 0,60,120,0,0,0,0,0
    2509   00:B4B4  00 3C 78 00 00 00 00 00 
    2510   00:B4BC                             db 124,198,187,227,227,187,198,124
    2510   00:B4BC  7C C6 BB E3 E3 BB C6 7C 
    2511   00:B4C4                      jtab:	
    2512   00:B4C4  63                         db 99
    2513   00:B4C5                      keytab:	defw $609,$607,$600,$605,$240,$540,$60B,$601,$602,$603,$60A; Game engine code --------------------------------------------------------------
    2513   00:B4C5  09 06 07 06 00 06 05 06 40 02 40 05 0B 06 01 06 
    2513   00:B4D5  02 06 03 06 0A 06 
    2514   00:B4DB                      
    2515   00:B4DB                      ; DEFINE DEBUG
    2516   00:B4DB                      ; DEFINE FASTVRAMDUMP
    2517   00:B4DB                      
    2518   00:B4DB                      ; Arcade Game Designer.
    2519   00:B4DB                      ; (C) 2008 - 2018 Jonathan Cauldwell.
    2520   00:B4DB                      ; MSX version (C) jltursan
    2521   00:B4DB                      ; Based on ZX Spectrum Engine v0.7.4
    2522   00:B4DB                      ;
    2523   00:B4DB                      ; Notes about Music & SFX engine
    2524   00:B4DB                      ; From the EngineMSX itself, 5 routines are being called right now:
    2525   00:B4DB                      ;
    2526   00:B4DB                      ; * music_init => initializes the music engine. If your engine doesn't needs this, use ret to do nothing
    2527   00:B4DB                      ; * music_play => plays a music frame from the ISR. The idea is to set a buffer with all the PSG register ready to dump
    2528   00:B4DB                      ; but also must implement:
    2529   00:B4DB                      ; * music_loopoff
    2530   00:B4DB                      ; * music_loopon
    2531   00:B4DB                      ; * music_set
    2532   00:B4DB                      ; * music_mute
    2533   00:B4DB                      ; * sfx_init => initializes the sfx engine. Idem
    2534   00:B4DB                      ; * sfx_play => plays a sfx frame from the ISR. Idem
    2535   00:B4DB                      ; * psgrout => generic routine to dump all PSG registers
    2536   00:B4DB                      ;
    2537   00:B4DB                      ; Fixed: Now evnt18 (game completed) doesn't disables sprites at all; so you can use the sprites in an ending scene (if you need to hide them, use now SPRITESOFF)
    2538   00:B4DB                      ; Added: Due the change in evnt18, a new command SPRITESOFF has been added to the compiler, it hides all sprites by setting 208 Y-coord to sprite 0
    2539   00:B4DB                      ; Fixed: CLS & CLW routines now erase scrmap buffer and also disable sprites (Thanks to FX).
    2540   00:B4DB                      ; Fixed: ROM stack initialization bug in MSX machines with drives (specially TR)
    2541   00:B4DB                      ;
    2542   00:B4DB                      ; Fixed: Sprite flicker bug (MSX freezes) due a byte boundary overrun. Table colltab must not cross a byte boundary to avoid this.
    2543   00:B4DB                      ; Added: Some cycles saved in plot pixel routine
    2544   00:B4DB                      ; Added: New command CRUMBLE
    2545   00:B4DB                      ; Fixed: Keyboard scanning back to 50fps to fix some positioning problems when controlling characters
    2546   00:B4DB                      ; Fixed: PSG initialization bug filling registers with illegal values
    2547   00:B4DB                      ; Fixed: Some optimization to the ayFX replayer routine
    2548   00:B4DB                      ; Fixed: PSG wrong reset sound when multichannel mode active (FX_MODE=1)  
    2549   00:B4DB                      ; Fixed: Serious bug in the PSG dumping routine (PT3 specially affected)
    2550   00:B4DB                      ; Added: Support for Metablocks (2x2 characters map blocks)
    2551   00:B4DB                      ; Fixed: UNDOSPRITEMOVE support
    2552   00:B4DB                      ; Fixed: Sometimes player sprite was not initialized correctly when changing screen 
    2553   00:B4DB                      ; Added: New command SPRITESOFF
    2554   00:B4DB                      ; Fixed: RAM/ROM slot routines changed to a more compatible ones (Thanks JAM!)
    2555   00:B4DB                      ; Added: Support of forced PAL/NTSC TV modes
    2556   00:B4DB                      ; Added: PAL/NTSC modes swappable with hotkey (SELECT)
    2557   00:B4DB                      ; Added: New command THRUST
    2558   00:B4DB                      ; Added: LZ compression (Pletter) instead RLE for map screens
    2559   00:B4DB                      ; Added: New command SCREENON
    2560   00:B4DB                      ; Added: New command SCREENOFF
    2561   00:B4DB                      
    2562   00:B4DB                      ;
    2563   00:B4DB                      ; Core rotuines
    2564   00:B4DB                      ; ----------------------------------
    2565   00:B4DB                      ; ptxt => core routine that prints a font character (no color)
    2566   00:B4DB                      ; pchr => core routine that prints a BLOCK (pattern+color)
    2567   00:B4DB                      
    2568   00:B4DB                      /*
    2569   00:B4DB                    ~ MEANING OF FLAGS
    2570   00:B4DB                    ~ =========================================
    2571   00:B4DB                    ~ 
    2572   00:B4DB                    ~ AFLAG	: Adventure mode
    2573   00:B4DB                    ~ CFLAG	: Collectables
    2574   00:B4DB                    ~ CRFLAG	: Crumbling blocks
    2575   00:B4DB                    ~ DFLAG	: Digging
    2576   00:B4DB                    ~ EFLAG	: Beeper
    2577   00:B4DB                    ~ HCFLAG	: Hardware collisions disabled
    2578   00:B4DB                    ~ LFLAG	: Ladders
    2579   00:B4DB                    ~ MFLAG	: Menu/Inventory
    2580   00:B4DB                    ~ MBFLAG	: MetaBlocks
    2581   00:B4DB                    ~ RTFLAG	: Thrust for rotational control
    2582   00:B4DB                    ~ OFLAG	: Objects
    2583   00:B4DB                    ~ PFLAG	: Particles
    2584   00:B4DB                    ~ QFLAG	: Marquee
    2585   00:B4DB                    ~ SFLAG	: Scrolling
    2586   00:B4DB                    ~ TVFREQ	: Force 50Hz(50)/60Hz(60). Only for MSX2 or higher models
    2587   00:B4DB                    ~ UFLAG	: User routines 
    2588   00:B4DB                    ~ XFLAG	: PSG SFX
    2589   00:B4DB                    ~ YFLAG	: PSG Music
    2590   00:B4DB                    ~ FX_RELATIVE : Relative SFX volume
    2591   00:B4DB                    ~ FX_MODE 	: SFX replayer mode
    2592   00:B4DB                    ~ FX_CHANNEL	: Fixed SFX channel (if FX_MODE=0, 1 = C, 2 = B, 3 = A)
    2593   00:B4DB                    ~ */
    2594   00:B4DB                      
    2595   00:B4DB                      ; Distribution types
    2596   00:B4DB                      
    2597   00:B4DB  (00:0000)           ROM=0
    2598   00:B4DB  (00:0001)           DISK=1
    2599   00:B4DB  (00:0002)           TAPE=2
    2600   00:B4DB                      
    2601   00:B4DB                      ; TV modes
    2602   00:B4DB                      
    2603   00:B4DB  (00:0001)           PAL=1
    2604   00:B4DB  (00:0002)           NTSC=2
    2605   00:B4DB                      
    2606   00:B4DB                      ; MSX machines characteristics
    2607   00:B4DB  (00:0018)           MSX_MAXROWS	equ 24
    2608   00:B4DB  (00:0020)           MSX_MAXCOLS	equ 32
    2609   00:B4DB  (00:00FF)           MSX_MAXCX	equ 255
    2610   00:B4DB  (00:00BF)           MSX_MAXCY	equ 191
    2611   00:B4DB  (00:0010)           MSX_SPRHS	equ 16
    2612   00:B4DB  (00:0010)           MSX_SPRVS	equ 16
    2613   00:B4DB                      
    2614   00:B4DB                      
    2615   00:B4DB                      ; =============================================================================================
    2616   00:B4DB                       
    2617   00:B4DB                      ; Block characteristics.
    2618   00:B4DB                      
    2619   00:B4DB  (00:0001)           PLATFM	equ 1               ; platform.
    2620   00:B4DB  (00:0002)           WALL	equ PLATFM + 1      ; solid wall.
    2621   00:B4DB  (00:0003)           LADDER	equ WALL + 1        ; ladder.
    2622   00:B4DB  (00:0004)           FODDER	equ LADDER + 1      ; fodder block.
    2623   00:B4DB  (00:0005)           DEADLY	equ FODDER + 1      ; deadly block.
    2624   00:B4DB  (00:0006)           CUSTOM	equ DEADLY + 1      ; custom block.
    2625   00:B4DB  (00:0007)           WATER	equ CUSTOM + 1      ; water block.
    2626   00:B4DB  (00:0008)           COLECT	equ WATER + 1       ; collectable block.
    2627   00:B4DB  (00:0009)           NUMTYP	equ COLECT + 1      ; number of types.
    2628   00:B4DB                      
    2629   00:B4DB  (00:0007)           CRUMBLING_SPEED	equ	7		; crumble every 8 frames. Valid values are 7 (every 8),3 (every 4) or 1 (every 2)
    2630   00:B4DB                      
    2631   00:B4DB                      ; Objects
    2632   00:B4DB                      
    2633   00:B4DB                      	if DISTYPE=ROM
    2634   00:B4DB                      
    2635   00:B4DB  (00:0043)           OBJSIZ 	equ 64+3			; size of each object entry, variable bytes are moved to 
    2636   00:B4DB  (00:0003)           ODTSIZ 	equ 3			   	; object data size
    2637   00:B4DB                      		
    2638   00:B4DB                      	else
    2639   00:B4DB                    ~ 	
    2640   00:B4DB                    ~ OBJSIZ 	equ 64+6			; size of each object entry
    2641   00:B4DB                    ~ ODTSIZ 	equ 6			   	; object data size
    2642   00:B4DB                    ~ 
    2643   00:B4DB                    ~ 	endif
    2644   00:B4DB                      
    2645   00:B4DB                      ; Sprites.
    2646   00:B4DB                      
    2647   00:B4DB  (00:0020)           NUMSPR 	equ 32              ; number of sprites.
    2648   00:B4DB  (00:0011)           TABSIZ 	equ 17              ; size of each entry.
    2649   00:B4DB  (00:0220)           SPRBUF 	equ NUMSPR * TABSIZ ; size of entire table.
    2650   00:B4DB  (00:0005)           NMESIZ 	equ 5               ; bytes stored in nmetab for each sprite (SPRITEPOSITIONs).
    2651   00:B4DB  (00:0003)           X      	equ 3               ; new x coordinate of sprite.
    2652   00:B4DB  (00:0004)           Y      	equ X + 1           ; new y coordinate of sprite.
    2653   00:B4DB  (00:0005)           PAM1ST	equ 5               ; first sprite parameter, old x (ix+5).
    2654   00:B4DB  (00:0258)           MAPSIZE	equ	WINDOWHGT * WINDOWWID	
    2655   00:B4DB                      	
    2656   00:B4DB                      ; Particle engine.
    2657   00:B4DB                      
    2658   00:B4DB                      	if PFLAG
    2659   00:B4DB                      
    2660   00:B4DB  (00:0036)           NUMSHR	equ 54              ; pieces of shrapnel.
    2661   00:B4DB  (00:0009)           SHRSIZ	equ 9               ; bytes per particle.
    2662   00:B4DB  (00:000A)           VAPTIM	equ 10				; vapour particle life time
    2663   00:B4DB                      		
    2664   00:B4DB                      	endif
    2665   00:B4DB                      
    2666   00:B4DB                      ;	include "MSX_Defs.asm"
    2667   00:B4DB                      ;	include "MSX_Macros.asm"
    2668   00:B4DB                      
    2669   00:B4DB                      ; Game starts here.  No reason why screen data couldn't go between start and contrl to put them in
    2670   00:B4DB                      ; contended RAM, leaving the code and rest of the game in uncontended memory at 32768 and beyond.
    2671   00:B4DB                      
    2672   00:B4DB                      start:
    2673   00:B4DB                      ;	if DISTYPE=ROM
    2674   00:B4DB  F3                  		di
    2675   00:B4DC  31 00 30            		ld sp,CV_STACK
    2676   00:B4DF                      ;	else
    2677   00:B4DF                      ; 		ld hl,(MSX_HIMEM)
    2678   00:B4DF                      ;		ld sp,hl
    2679   00:B4DF                      ;	endif
    2680   00:B4DF                      ;		ld a,$C9
    2681   00:B4DF                      ;		ld (MSX_HKEYI),a
    2682   00:B4DF                      ;		ld (MSX_HTIMI),a
    2683   00:B4DF                      ;		xor	a
    2684   00:B4DF                      ;		ld (MSX_SCNCNT),a
    2685   00:B4DF                      ;		ld (MSX_INTCNT),a		
    2686   00:B4DF                      ;
    2687   00:B4DF                      		; initialize vars
    2688   00:B4DF  21 00 40            		ld hl,varbegin
    2689   00:B4E2  11 01 40            		ld de,varbegin+1
    2690   00:B4E5  01 5C 00            		ld bc,(varend-varbegin)-1
    2691   00:B4E8  36 00               		ld (hl),0
    2692   00:B4EA  ED B0               		ldir
    2693   00:B4EC                      
    2694   00:B4EC  3E 01               	ld a,1
    2695   00:B4EE  32 34 40            	ld (contrl),a
    2696   00:B4F1                      
    2697   00:B4F1                      ;		;init mapper
    2698   00:B4F1                      ;		ld	a,1
    2699   00:B4F1                      ;		out	(MSX_MMAP2),a
    2700   00:B4F1                      ;		inc	a
    2701   00:B4F1                      ;		out	(MSX_MMAP1),a
    2702   00:B4F1                      ;		inc	a
    2703   00:B4F1                      ;		out	(MSX_MMAP0),a
    2704   00:B4F1                      ;		
    2705   00:B4F1                      ;	ifdef NOBIOS
    2706   00:B4F1                      ;		ld a,(biosvars+MSX_MSXVER)      	; version del MSX
    2707   00:B4F1                      ;	else
    2708   00:B4F1                      ;		ld a,(MSX_MSXVER)      	; version del MSX
    2709   00:B4F1                      ;	endif
    2710   00:B4F1                      ;		inc a
    2711   00:B4F1                      ;		dec a
    2712   00:B4F1                      ;		jr z,.common
    2713   00:B4F1                      ;		dec a
    2714   00:B4F1                      ;		jr z,.MSX2
    2715   00:B4F1                      ;		dec a
    2716   00:B4F1                      ;		jr z,.MSX2P
    2717   00:B4F1                      ;		; it's a TR		
    2718   00:B4F1                      ;	if EFLAG
    2719   00:B4F1                      ;		ld a,255
    2720   00:B4F1                      ;		ld (snddelay),a
    2721   00:B4F1                      ;	endif
    2722   00:B4F1                      ;		jr .MSX2
    2723   00:B4F1                      ;.MSX2P:
    2724   00:B4F1                      ;		in a,(MSX_DEVID)
    2725   00:B4F1                      ;		cpl
    2726   00:B4F1                      ;		push af
    2727   00:B4F1                      ;		ld a,8
    2728   00:B4F1                      ;		out (MSX_DEVID),a  		;out the manufacturer code 8 (Panasonic) to I/O port 40h
    2729   00:B4F1                      ;		in a,(MSX_DEVID)   		;read the value you have just written
    2730   00:B4F1                      ;		cpl          			;complement all bits of the value
    2731   00:B4F1                      ;		cp 8         			;if it does not match the value you originally wrote,
    2732   00:B4F1                      ;		jr nz,.notWX  			;it is not a WX/WSX/FX.
    2733   00:B4F1                      ;		xor a        			;write 0 to I/O port 41h
    2734   00:B4F1                      ;		out (MSX_SWTIO),a  		;and the mode changes to high-speed clock
    2735   00:B4F1                      ;	if EFLAG
    2736   00:B4F1                      ;		ld a,32
    2737   00:B4F1                      ;		ld (snddelay),a
    2738   00:B4F1                      ;	endif
    2739   00:B4F1                      ;.notWX:
    2740   00:B4F1                      ;		pop af
    2741   00:B4F1                      ;		out (MSX_DEVID),a		
    2742   00:B4F1                      ;.MSX2:		
    2743   00:B4F1                      ;		ld hl,palett
    2744   00:B4F1                      ;		call setpal
    2745   00:B4F1                      ;				
    2746   00:B4F1                      ;		if (TVFREQ>0)
    2747   00:B4F1                      ;			ld hl,MSX_RG9SAV
    2748   00:B4F1                      ;			if (TVFREQ=PAL)
    2749   00:B4F1                      ;				res 1,(hl)
    2750   00:B4F1                      ;			else
    2751   00:B4F1                      ;				set 1,(hl)
    2752   00:B4F1                      ;			endif
    2753   00:B4F1                      ;			call swaphz
    2754   00:B4F1                      ;		else
    2755   00:B4F1                      ;			ld a,(MSX_RG9SAV)
    2756   00:B4F1                      ;		endif
    2757   00:B4F1                      ;		call setticks
    2758   00:B4F1                      ;
    2759   00:B4F1                      ;.common:		
    2760   00:B4F1                      ;		; Set up the display if needed
    2761   00:B4F1                      ;	if QFLAG=0
    2762   00:B4F1                      ;	
    2763   00:B4F1  21 01 01            		ld hl,$0101
    2764   00:B4F4  22 EA 53            		ld (MSX_FORCLR+1),hl    ; sets background & border colour to black
    2765   00:B4F7                      
    2766   00:B4F7                       
    2767   00:B4F7  CD 2D CB            		call CV_INIGRP		; set display to screen 2
    2768   00:B4FA                      
    2769   00:B4FA                      ;Enable both joysticks, buttons, keypads
    2770   00:B4FA                      
    2771   00:B4FA  21 9B 9B            		ld hl,$9b9b
    2772   00:B4FD  22 97 40            		ld (CONTROLLER_BUFFER),hl
    2773   00:B500  AF                  		xor a
    2774   00:B501  CD 05 11            		call CONTROLLER_INIT    
    2775   00:B504                      		
    2776   00:B504                      ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    2777   00:B504                      ;		ld a,(MSX_RG1SAV)
    2778   00:B504                      ;		or 2
    2779   00:B504                      ;		ld b,a
    2780   00:B504                      ;		ld c,1
    2781   00:B504                      ;		call MSX_WRTVDP			; enable 16x16 sprites
    2782   00:B504                      ;
    2783   00:B504                      ;		xor a
    2784   00:B504                      ;		ld (MSX_CLIKSW),a       ; disables keyboard click
    2785   00:B504                      
    2786   00:B504                      ;	endif
    2787   00:B504                      		
    2788   00:B504  3E F1               		ld a,$F1
    2789   00:B506  32 39 40            		ld (clratt),a
    2790   00:B509                      	
    2791   00:B509                      	if YFLAG
    2792   00:B509                    ~ 		call music_init
    2793   00:B509                    ~ 	endif
    2794   00:B509                      	if XFLAG
    2795   00:B509  CD 02 C9            		call sfx_init
    2796   00:B50C                      	endif
    2797   00:B50C                      	
    2798   00:B50C                      ;		; installs ISR
    2799   00:B50C                      ;		di
    2800   00:B50C                      ;		ld hl,isr
    2801   00:B50C                      ;		ld (MSX_HTIMI+1),hl
    2802   00:B50C                      ;		ld a,$C3
    2803   00:B50C                      ;		ld (MSX_HTIMI),a
    2804   00:B50C  FB                  		ei
    2805   00:B50D                      
    2806   00:B50D                      	; When ROM, setup of variables with starting value
    2807   00:B50D                      	if DISTYPE=ROM
    2808   00:B50D                      		
    2809   00:B50D  AF                  		xor a
    2810   00:B50E                      	if EFLAG
    2811   00:B50E  21 16 40            		ld hl,sndtyp
    2812   00:B511  77                  		ld (hl),a
    2813   00:B512                      	endif
    2814   00:B512                      		; ROM mode needs to initialize some vars
    2815   00:B512  21 00 40            		ld hl,score         ; scores.		
    2816   00:B515  11 01 40            		ld de,score+1       ; next byte.
    2817   00:B518  01 11 00            		ld bc,17			; size of score vars.
    2818   00:B51B  36 30               		ld (hl),'0'        	; write '0'
    2819   00:B51D  ED B0               		ldir
    2820   00:B51F  21 15 40            		ld hl,displ0+3
    2821   00:B522  36 8D               		ld (hl),13+128
    2822   00:B524                      	if SFLAG
    2823   00:B524                    ~ 		inc a				; A=1
    2824   00:B524                    ~ 		ld (scrlyoff),a		; by default, no scrolltext
    2825   00:B524                    ~ 	endif
    2826   00:B524                      	if PFLAG
    2827   00:B524  21 E9 B6            		ld hl,prosh1
    2828   00:B527  22 17 40            		ld (shrplot),hl
    2829   00:B52A                      	endif
    2830   00:B52A                      	if MFLAG
    2831   00:B52A                    ~ 		ld a,$C3
    2832   00:B52A                    ~ 		ld (mod0),a
    2833   00:B52A                    ~ 		ld (mod1),a
    2834   00:B52A                    ~ 		ld (mod2),a
    2835   00:B52A                    ~ 	endif
    2836   00:B52A  21 C5 B4            		ld hl,keytab
    2837   00:B52D  11 7D 40            		ld de,keys
    2838   00:B530  01 16 00            		ld bc,22
    2839   00:B533  ED B0               		ldir
    2840   00:B535                      		
    2841   00:B535  EB                  		ex de,hl
    2842   00:B536                      		
    2843   00:B536  36 01               		ld (hl),WINDOWTOP
    2844   00:B538  23                  		inc hl
    2845   00:B539  36 01               		ld (hl),WINDOWLFT
    2846   00:B53B  23                  		inc hl
    2847   00:B53C  36 14               		ld (hl),WINDOWHGT
    2848   00:B53E  23                  		inc hl
    2849   00:B53F  36 1E               		ld (hl),WINDOWWID
    2850   00:B541                      		
    2851   00:B541                      	; DATA command initialization
    2852   00:B541                      	ifdef DATA00
    2853   00:B541                    ~ 		ld hl,rdat00
    2854   00:B541                    ~ 		ld (rptr00),hl
    2855   00:B541                    ~ 	endif
    2856   00:B541                      	ifdef DATA01
    2857   00:B541                    ~ 		ld hl,rdat01
    2858   00:B541                    ~ 		ld (rptr01),hl
    2859   00:B541                    ~ 	endif
    2860   00:B541                      	ifdef DATA02
    2861   00:B541                    ~ 		ld hl,rdat02
    2862   00:B541                    ~ 		ld (rptr02),hl
    2863   00:B541                    ~ 	endif
    2864   00:B541                      	ifdef DATA03
    2865   00:B541                    ~ 		ld hl,rdat03
    2866   00:B541                    ~ 		ld (rptr03),hl
    2867   00:B541                    ~ 	endif
    2868   00:B541                      	ifdef DATA04
    2869   00:B541                    ~ 		ld hl,rdat04
    2870   00:B541                    ~ 		ld (rptr04),hl
    2871   00:B541                    ~ 	endif
    2872   00:B541                      	ifdef DATA05
    2873   00:B541                    ~ 		ld hl,rdat05
    2874   00:B541                    ~ 		ld (rptr05),hl
    2875   00:B541                    ~ 	endif
    2876   00:B541                      	ifdef DATA06
    2877   00:B541                    ~ 		ld hl,rdat06
    2878   00:B541                    ~ 		ld (rptr06),hl
    2879   00:B541                    ~ 	endif
    2880   00:B541                      	ifdef DATA07
    2881   00:B541                    ~ 		ld hl,rdat07
    2882   00:B541                    ~ 		ld (rptr07),hl
    2883   00:B541                    ~ 	endif
    2884   00:B541                      	ifdef DATA08
    2885   00:B541                    ~ 		ld hl,rdat08
    2886   00:B541                    ~ 		ld (rptr08),hl
    2887   00:B541                    ~ 	endif
    2888   00:B541                      	ifdef DATA09
    2889   00:B541                    ~ 		ld hl,rdat09
    2890   00:B541                    ~ 		ld (rptr09),hl
    2891   00:B541                    ~ 	endif
    2892   00:B541                      	ifdef DATA10
    2893   00:B541                    ~ 		ld hl,rdat10
    2894   00:B541                    ~ 		ld (rptr10),hl
    2895   00:B541                    ~ 	endif
    2896   00:B541                      	ifdef DATA11
    2897   00:B541                    ~ 		ld hl,rdat11
    2898   00:B541                    ~ 		ld (rptr11),hl
    2899   00:B541                    ~ 	endif
    2900   00:B541                      	ifdef DATA12
    2901   00:B541                    ~ 		ld hl,rdat12
    2902   00:B541                    ~ 		ld (rptr12),hl
    2903   00:B541                    ~ 	endif
    2904   00:B541                      	ifdef DATA13
    2905   00:B541                    ~ 		ld hl,rdat13
    2906   00:B541                    ~ 		ld (rptr13),hl
    2907   00:B541                    ~ 	endif
    2908   00:B541                      	ifdef DATA14
    2909   00:B541                    ~ 		ld hl,rdat14
    2910   00:B541                    ~ 		ld (rptr14),hl
    2911   00:B541                    ~ 	endif
    2912   00:B541                      	ifdef DATA15
    2913   00:B541                    ~ 		ld hl,rdat15
    2914   00:B541                    ~ 		ld (rptr15),hl
    2915   00:B541                    ~ 	endif
    2916   00:B541                      	ifdef DATA16
    2917   00:B541                    ~ 		ld hl,rdat16
    2918   00:B541                    ~ 		ld (rptr16),hl
    2919   00:B541                    ~ 	endif
    2920   00:B541                      	ifdef DATA17
    2921   00:B541                    ~ 		ld hl,rdat17
    2922   00:B541                    ~ 		ld (rptr17),hl
    2923   00:B541                    ~ 	endif
    2924   00:B541                      	ifdef DATA18
    2925   00:B541                    ~ 		ld hl,rdat18
    2926   00:B541                    ~ 		ld (rptr18),hl
    2927   00:B541                    ~ 	endif
    2928   00:B541                      	ifdef DATA19
    2929   00:B541                    ~ 		ld hl,rdat19
    2930   00:B541                    ~ 		ld (rptr19),hl
    2931   00:B541                    ~ 	endif
    2932   00:B541                      	ifdef DATA20
    2933   00:B541                    ~ 		ld hl,rdat20
    2934   00:B541                    ~ 		ld (rptr20),hl
    2935   00:B541                    ~ 	endif
    2936   00:B541                      		
    2937   00:B541                      	endif
    2938   00:B541  C3 90 B9            		jp game             ; start the game.
    2939   00:B544                      
    2940   00:B544                      
    2941   00:B544  28                  numob  db NUMOBJ         ; number of objects in game.
    2942   00:B545                      
    2943   00:B545                      ; Variables start here.
    2944   00:B545                      ; Pixel versions of wintop, winlft, winhgt, winwid.
    2945   00:B545                      
    2946   00:B545  09                  wntopx db (8 * WINDOWTOP) + 1
    2947   00:B546  08                  wnlftx db (8 * WINDOWLFT)
    2948   00:B547  98                  wnbotx db ((WINDOWTOP * 8) + (WINDOWHGT * 8) - 16)
    2949   00:B548  E8                  wnrgtx db ((WINDOWLFT * 8) + (WINDOWWID * 8) - 16)
    2950   00:B549                      
    2951   00:B549                      
    2952   00:B549                      ; Make sure pointers are arranged in the same order as the data itself.
    2953   00:B549                      
    2954   00:B549  F7 A4               frmptr dw frmlst         ; sprite frames.
    2955   00:B54B  88 97               blkptr dw chgfx          ; block graphics.
    2956   00:B54D  78 9D               proptr dw bprop          ; address of char properties.
    2957   00:B54F  A3 92               scrptr dw scdat          ; address of screens.
    2958   00:B551  1D A5               nmeptr dw nmedat         ; enemy start positions.
    2959   00:B553                      
    2960   00:B553                      
    2961   00:B553                      	if MFLAG
    2962   00:B553                    ~ 	
    2963   00:B553                    ~ ; Modify for inventory.
    2964   00:B553                    ~ 
    2965   00:B553                    ~ minve:
    2966   00:B553                    ~ 	if MBFLAG
    2967   00:B553                    ~ 		ld l,a
    2968   00:B553                    ~ 		ld a,WINDOWHGT	
    2969   00:B553                    ~ 		add a,a			
    2970   00:B553                    ~ 		ld (winhgt),a	
    2971   00:B553                    ~ 		ld a,WINDOWWID	
    2972   00:B553                    ~ 		add a,a			
    2973   00:B553                    ~ 		ld (winwid),a	
    2974   00:B553                    ~ 		ld a,l
    2975   00:B553                    ~ 	endif
    2976   00:B553                    ~ 		
    2977   00:B553                    ~ 		ld hl,invdis        ; routine address.
    2978   00:B553                    ~ 		ld (mod0+1),hl      ; set up menu routine.
    2979   00:B553                    ~ 		ld (mod2+1),hl      ; set up count routine.
    2980   00:B553                    ~ 		ld hl,fopt          ; find option from available objects.
    2981   00:B553                    ~ 		ld (mod1+1),hl      ; set up routine.
    2982   00:B553                    ~ 		jr dbox             ; do menu routine.
    2983   00:B553                    ~ 
    2984   00:B553                    ~ ; Modify for menu.
    2985   00:B553                    ~ 
    2986   00:B553                    ~ mmenu:
    2987   00:B553                    ~ 		ld hl,always        ; routine address.
    2988   00:B553                    ~ 		ld (mod0+1),hl      ; set up routine.
    2989   00:B553                    ~ 		ld (mod2+1),hl      ; set up count routine.
    2990   00:B553                    ~ 		ld hl,fstd          ; standard option selection.
    2991   00:B553                    ~ 		ld (mod1+1),hl      ; set up routine.
    2992   00:B553                    ~ 
    2993   00:B553                    ~ ; Drop through into box routine.
    2994   00:B553                    ~ 
    2995   00:B553                    ~ ; Work out size of box for message or menu.
    2996   00:B553                    ~ 
    2997   00:B553                    ~ dbox:   		
    2998   00:B553                    ~ 		ld hl,msgdat        ; pointer to messages.
    2999   00:B553                    ~ 		call getwrd         ; get message number.
    3000   00:B553                    ~ 		push hl             ; store pointer to message.
    3001   00:B553                    ~ 		ld d,1              ; height.
    3002   00:B553                    ~ 		xor a               ; start at object zero.
    3003   00:B553                    ~ 		ld (combyt),a       ; store number of object in combyt.
    3004   00:B553                    ~ 		ld e,a              ; maximum width.
    3005   00:B553                    ~ dbox5:
    3006   00:B553                    ~ 		ld b,0              ; this line's width.
    3007   00:B553                    ~ ;mod2:						 ; auto-modifying code
    3008   00:B553                    ~ ;		call always
    3009   00:B553                    ~ 		
    3010   00:B553                    ~ 		call mod2		
    3011   00:B553                    ~ 		jr nz,dbox6         ; not in inventory, skip this line. (dbox3?)
    3012   00:B553                    ~ 		inc d               ; add to tally.
    3013   00:B553                    ~ dbox6:
    3014   00:B553                    ~ 		ld a,(hl)           ; get character.
    3015   00:B553                    ~ 		inc hl              ; next character.
    3016   00:B553                    ~ 		cp ','              ; reached end of line?
    3017   00:B553                    ~ 		jr z,dbox3          ; yes.
    3018   00:B553                    ~ 		cp 13               ; reached end of line?
    3019   00:B553                    ~ 		jr z,dbox3          ; yes.
    3020   00:B553                    ~ 		inc b               ; add to this line's width.
    3021   00:B553                    ~ 		and a               ; end of message?
    3022   00:B553                    ~ 		jp m,dbox4          ; yes, end count.
    3023   00:B553                    ~ 		jr dbox6            ; repeat until we find the end.
    3024   00:B553                    ~ dbox3:
    3025   00:B553                    ~ 		ld a,e              ; maximum line width.
    3026   00:B553                    ~ 		cp b                ; have we exceeded longest so far?
    3027   00:B553                    ~ 		jr nc,dbox5         ; no, carry on looking.
    3028   00:B553                    ~ 		ld e,b              ; make this the widest so far.
    3029   00:B553                    ~ 		jr dbox5            ; keep looking.
    3030   00:B553                    ~ dbox4:
    3031   00:B553                    ~ 		ld a,e              ; maximum line width.
    3032   00:B553                    ~ 		cp b                ; have we exceeded longest so far?
    3033   00:B553                    ~ 		jr nc,dbox8         ; no, carry on looking.
    3034   00:B553                    ~ 		ld e,b              ; final line is the longest so far.
    3035   00:B553                    ~ dbox8:
    3036   00:B553                    ~ 		dec d               ; decrement items found.
    3037   00:B553                    ~ 		jp z,dbox15         ; total was zero.
    3038   00:B553                    ~ 		ld a,e              ; longest line.
    3039   00:B553                    ~ 		and a               ; was it zero?
    3040   00:B553                    ~ 		jp z,dbox15         ; total was zero.
    3041   00:B553                    ~ 		ld (bwid),de        ; set up size.
    3042   00:B553                    ~ 
    3043   00:B553                    ~ ; That's set up our box size.
    3044   00:B553                    ~ 
    3045   00:B553                    ~ 		call dissprs
    3046   00:B553                    ~ 
    3047   00:B553                    ~ 		ld a,(winhgt)       ; window height in characters.
    3048   00:B553                    ~ 		sub d               ; subtract height of box.
    3049   00:B553                    ~ 		rra                 ; divide by 2.
    3050   00:B553                    ~ 		ld hl,wintop        ; top edge of window.
    3051   00:B553                    ~ 		add a,(hl)          ; add displacement.
    3052   00:B553                    ~ 		ld (btop),a         ; set up box top.
    3053   00:B553                    ~ 		ld a,(winwid)       ; window width in characters.
    3054   00:B553                    ~ 		sub e               ; subtract box width.
    3055   00:B553                    ~ 		rra                 ; divide by 2.
    3056   00:B553                    ~ 		inc hl              ; left edge of window.
    3057   00:B553                    ~ 		add a,(hl)          ; add displacement.
    3058   00:B553                    ~ 		ld (blft),a         ; box left.
    3059   00:B553                    ~ 
    3060   00:B553                    ~ 		ld hl,font-256       ; font.
    3061   00:B553                    ~ 		ld (grbase),hl      ; set up for text display.
    3062   00:B553                    ~ 		pop hl              ; restore message pointer.
    3063   00:B553                    ~ 		ld a,(btop)         ; box top.
    3064   00:B553                    ~ 		ld (dispx),a        ; set display coordinate.
    3065   00:B553                    ~ 		xor a               ; start at object zero.
    3066   00:B553                    ~ 		ld (combyt),a       ; store number of object in combyt.
    3067   00:B553                    ~ dbox2:
    3068   00:B553                    ~ 		ld a,(combyt)       ; get object number.
    3069   00:B553                    ~ ;mod0:						 ; auto-modifying code
    3070   00:B553                    ~ ;		call always         ; check inventory for display.
    3071   00:B553                    ~ 
    3072   00:B553                    ~ 
    3073   00:B553                    ~ 		call mod0		
    3074   00:B553                    ~ 		jp nz,dbox13        ; not in inventory, skip this line.
    3075   00:B553                    ~ 		ld a,(blft)         ; box left.
    3076   00:B553                    ~ 		ld (dispy),a        ; set left display position.
    3077   00:B553                    ~ 		ld a,(bwid)         ; box width.
    3078   00:B553                    ~ 		ld b,a              ; store width.
    3079   00:B553                    ~ 	   
    3080   00:B553                    ~ dbox0:  
    3081   00:B553                    ~ 		ld a,(hl)           ; get character.
    3082   00:B553                    ~ 		cp ','              ; end of line?
    3083   00:B553                    ~ 		jr z,dbox1          ; yes, next one.
    3084   00:B553                    ~ 		cp 13               ; end of option?
    3085   00:B553                    ~ 		jr z,dbox1          ; yes, on to next.
    3086   00:B553                    ~ 		dec b               ; one less to display.
    3087   00:B553                    ~ 		and 127             ; remove terminator.
    3088   00:B553                    ~ 
    3089   00:B553                    ~ 		push bc             ; store characters remaining.
    3090   00:B553                    ~ 		push hl             ; store address on stack.
    3091   00:B553                    ~ 
    3092   00:B553                    ~ 
    3093   00:B553                    ~ 		call ptxt           ; display character.		
    3094   00:B553                    ~ 		
    3095   00:B553                    ~ 		ld hl,dispy         ; y coordinate.
    3096   00:B553                    ~ 		inc (hl)            ; move along one.
    3097   00:B553                    ~ 		
    3098   00:B553                    ~ 		pop hl              ; retrieve address of next character.
    3099   00:B553                    ~ 		pop bc              ; chars left for this line.
    3100   00:B553                    ~ 
    3101   00:B553                    ~ 		ld a,(hl)           ; get character.
    3102   00:B553                    ~ 		inc hl              ; next character.
    3103   00:B553                    ~ 		cp 128              ; end of message?
    3104   00:B553                    ~ 		jp nc,dbox7         ; yes, job done.
    3105   00:B553                    ~ 		ld a,b              ; chars remaining.
    3106   00:B553                    ~ 		and a               ; are any left?
    3107   00:B553                    ~ 		jr nz,dbox0         ; yes, continue.
    3108   00:B553                    ~ 
    3109   00:B553                    ~ ; Reached limit of characters per line.
    3110   00:B553                    ~ 
    3111   00:B553                    ~ dbox9:
    3112   00:B553                    ~ 		ld a,(hl)           ; get character.
    3113   00:B553                    ~ 		inc hl              ; next one.
    3114   00:B553                    ~ 		cp ','              ; another line?
    3115   00:B553                    ~ 		jr z,dbox10         ; yes, do next line.
    3116   00:B553                    ~ 		cp 13               ; another line?
    3117   00:B553                    ~ 		jr z,dbox10         ; yes, on to next.
    3118   00:B553                    ~ 		cp 128              ; end of message?
    3119   00:B553                    ~ 		jr nc,dbox11        ; yes, finish message.
    3120   00:B553                    ~ 		jr dbox9
    3121   00:B553                    ~ 
    3122   00:B553                    ~ ; Fill box to end of line.
    3123   00:B553                    ~ 
    3124   00:B553                    ~ dboxf:
    3125   00:B553                    ~ 		push hl             ; store address on stack.
    3126   00:B553                    ~ 		push bc             ; store characters remaining.	   
    3127   00:B553                    ~ 		ld a,' '
    3128   00:B553                    ~ 		call ptxt           ; display character.		
    3129   00:B553                    ~ 		
    3130   00:B553                    ~ 		ld hl,dispy         ; y coordinate.
    3131   00:B553                    ~ 		inc (hl)            ; move along one.		
    3132   00:B553                    ~ 		pop bc              ; retrieve character count.
    3133   00:B553                    ~ 		pop hl              ; retrieve address of next character.
    3134   00:B553                    ~ 		djnz dboxf          ; repeat for remaining chars on line.
    3135   00:B553                    ~ 		ret
    3136   00:B553                    ~ 
    3137   00:B553                    ~ dbox1:
    3138   00:B553                    ~ 		inc hl              ; skip character.
    3139   00:B553                    ~ 		call dboxf          ; fill box out to right side.
    3140   00:B553                    ~ dbox10:
    3141   00:B553                    ~ 		ld a,(dispx)        ; x coordinate.
    3142   00:B553                    ~ 		inc a               ; down a line.
    3143   00:B553                    ~ 		ld (dispx),a        ; next position.
    3144   00:B553                    ~ 		jp dbox2            ; next line.
    3145   00:B553                    ~ dbox7:
    3146   00:B553                    ~ 		ld a,b              ; chars remaining.
    3147   00:B553                    ~ 		and a               ; are any left?
    3148   00:B553                    ~ 		jr z,dbox11         ; no, nothing to draw.
    3149   00:B553                    ~ 		call dboxf          ; fill message to line.
    3150   00:B553                    ~ 
    3151   00:B553                    ~ ; Drawn the box menu, now select option.
    3152   00:B553                    ~ 
    3153   00:B553                    ~ dbox11:
    3154   00:B553                    ~ 		ld a,(btop)         ; box top.
    3155   00:B553                    ~ 		ld (dispx),a        ; set bar position.
    3156   00:B553                    ~ dbox14:
    3157   00:B553                    ~ 		call joykey         ; get controls.
    3158   00:B553                    ~ 		and 31              ; anything pressed?
    3159   00:B553                    ~ 		jr nz,dbox14        ; yes, debounce it.
    3160   00:B553                    ~ 		call dbar           ; draw bar.
    3161   00:B553                    ~ dbox12:
    3162   00:B553                    ~ 		call joykey         ; get controls.
    3163   00:B553                    ~ 		and 28              ; anything pressed?
    3164   00:B553                    ~ 		jr z,dbox12         ; no, nothing.
    3165   00:B553                    ~ 		and 16              ; fire button pressed?
    3166   00:B553                    ~ ;mod1:						 ; auto-modifying code
    3167   00:B553                    ~ ;		jp nz,fstd          ; yes, job done.
    3168   00:B553                    ~ 
    3169   00:B553                    ~ 		
    3170   00:B553                    ~ 		jp nz,mod1
    3171   00:B553                    ~ 		call dbar           ; delete bar.
    3172   00:B553                    ~ 		ld a,(joyval)       ; joystick reading.
    3173   00:B553                    ~ 		and 8               ; going up?
    3174   00:B553                    ~ 		jr nz,dboxu         ; yes, go up.
    3175   00:B553                    ~ 		ld a,(dispx)        ; vertical position of bar.
    3176   00:B553                    ~ 		inc a               ; look down.
    3177   00:B553                    ~ 		ld hl,btop          ; top of box.
    3178   00:B553                    ~ 		sub (hl)            ; find distance from top.
    3179   00:B553                    ~ 		dec hl              ; point to height.
    3180   00:B553                    ~ 		cp (hl)             ; are we at end?
    3181   00:B553                    ~ 		jp z,dbox14         ; yes, go no further.
    3182   00:B553                    ~ 		ld hl,dispx         ; coordinate.
    3183   00:B553                    ~ 		inc (hl)            ; move bar.
    3184   00:B553                    ~ 		jr dbox14           ; continue.
    3185   00:B553                    ~ dboxu:
    3186   00:B553                    ~ 		ld a,(dispx)        ; vertical position of bar.
    3187   00:B553                    ~ 		ld hl,btop          ; top of box.
    3188   00:B553                    ~ 		cp (hl)             ; are we at the top?
    3189   00:B553                    ~ 		jp z,dbox14         ; yes, go no further.
    3190   00:B553                    ~ 		ld hl,dispx         ; coordinate.
    3191   00:B553                    ~ 		dec (hl)            ; move bar.
    3192   00:B553                    ~ 		jr dbox14           ; continue.
    3193   00:B553                    ~ fstd:
    3194   00:B553                    ~ 		ld a,(dispx)        ; bar position.
    3195   00:B553                    ~ 		ld hl,btop          ; top of menu.
    3196   00:B553                    ~ 		sub (hl)            ; find selected option.
    3197   00:B553                    ~ 		ld (varopt),a       ; store the option.
    3198   00:B553                    ~ 		jp redraw           ; redraw the screen.
    3199   00:B553                    ~ 
    3200   00:B553                    ~ ; Option not available.  Skip this line.
    3201   00:B553                    ~ 
    3202   00:B553                    ~ dbox13:
    3203   00:B553                    ~ 		ld a,(hl)           ; get character.
    3204   00:B553                    ~ 		inc hl              ; next one.
    3205   00:B553                    ~ 		cp ','              ; another line?
    3206   00:B553                    ~ 		jp z,dbox2          ; yes, do next line.
    3207   00:B553                    ~ 		cp 13               ; another line?
    3208   00:B553                    ~ 		jp z,dbox2          ; yes, on to next line.
    3209   00:B553                    ~ 		and a               ; end of message?
    3210   00:B553                    ~ 		jp m,dbox11         ; yes, finish message.
    3211   00:B553                    ~ 		jr dbox13
    3212   00:B553                    ~ dbox15:
    3213   00:B553                    ~ 
    3214   00:B553                    ~ 	if MBFLAG
    3215   00:B553                    ~ 		ld a,WINDOWWID
    3216   00:B553                    ~ 		ld (winwid),a
    3217   00:B553                    ~ 		ld a,WINDOWHGT
    3218   00:B553                    ~ 		ld (winhgt),a
    3219   00:B553                    ~ 	endif
    3220   00:B553                    ~ 	
    3221   00:B553                    ~ 		pop hl              ; pop message pointer from the stack.
    3222   00:B553                    ~ 		ret
    3223   00:B553                    ~ 
    3224   00:B553                    ~ dbar:
    3225   00:B553                    ~ 		ld a,(blft)         ; box left.
    3226   00:B553                    ~ 		ld (dispy),a        ; set display coordinate.
    3227   00:B553                    ~ 		call gprad          ; get printing address.
    3228   00:B553                    ~ 		ex de,hl            ; flip into hl register pair.
    3229   00:B553                    ~ 	   
    3230   00:B553                    ~ 		set 5,h
    3231   00:B553                    ~ 		ld a,(bwid)         ; box width.
    3232   00:B553                    ~ 		add a,a
    3233   00:B553                    ~ 		add a,a
    3234   00:B553                    ~ 		add a,a
    3235   00:B553                    ~ 		ld c,a
    3236   00:B553                    ~ 		ld b,0
    3237   00:B553                    ~ 		call MSX_RDVRM
    3238   00:B553                    ~ 		rlca
    3239   00:B553                    ~ 		rlca
    3240   00:B553                    ~ 		rlca
    3241   00:B553                    ~ 		rlca
    3242   00:B553                    ~ 		jp MSX_FILVRM
    3243   00:B553                    ~ 
    3244   00:B553                    ~ invdis:
    3245   00:B553                    ~ 		push hl             ; store message text pointer.
    3246   00:B553                    ~ 		push de             ; store de pair for line count.
    3247   00:B553                    ~ 		ld hl,combyt        ; object number.
    3248   00:B553                    ~ 		ld a,(hl)           ; get object number.
    3249   00:B553                    ~ 		inc (hl)            ; ready for next one.
    3250   00:B553                    ~ 		call gotob          ; check if we have object.
    3251   00:B553                    ~ 		pop de              ; retrieve de pair from stack.
    3252   00:B553                    ~ 		pop hl              ; retrieve text pointer.
    3253   00:B553                    ~ 		ret
    3254   00:B553                    ~ 		
    3255   00:B553                    ~ ; Find option selected.
    3256   00:B553                    ~ 
    3257   00:B553                    ~ fopt:
    3258   00:B553                    ~ 		ld a,(dispx)
    3259   00:B553                    ~ 		ld hl,btop          ; top of menu.
    3260   00:B553                    ~ 		sub (hl)            ; find selected option.
    3261   00:B553                    ~ 		inc a               ; object 0 needs one iteration, 1 needs 2 and so on.
    3262   00:B553                    ~ 		ld b,a              ; option selected in b register.
    3263   00:B553                    ~ 		ld hl,combyt        ; object number.
    3264   00:B553                    ~ 		ld (hl),0           ; set to first item.
    3265   00:B553                    ~ fopt0:
    3266   00:B553                    ~ 		push bc             ; store option counter in b register.
    3267   00:B553                    ~ 		call fobj           ; find next object in inventory.
    3268   00:B553                    ~ 		pop bc              ; restore option counter.
    3269   00:B553                    ~ 		djnz fopt0          ; repeat for relevant steps down the list.
    3270   00:B553                    ~ 		ld a,(combyt)       ; get option.
    3271   00:B553                    ~ 		dec a               ; one less, due to where we increment combyt.
    3272   00:B553                    ~ 		ld (varopt),a       ; store the option.
    3273   00:B553                    ~ 		xor a
    3274   00:B553                    ~ 		ld (joyval),a
    3275   00:B553                    ~ 		jp redraw           ; redraw the screen.
    3276   00:B553                    ~ 
    3277   00:B553                    ~ fobj:
    3278   00:B553                    ~ 		ld hl,combyt        ; object number.
    3279   00:B553                    ~ 		ld a,(hl)           ; get object number.
    3280   00:B553                    ~ 		inc (hl)            ; ready for next item.
    3281   00:B553                    ~ 		ret z               ; in case we loop back to zero.
    3282   00:B553                    ~ 		call gotob          ; do we have this item?
    3283   00:B553                    ~ 		ret z               ; yes, it's on the list.
    3284   00:B553                    ~ 		jr fobj             ; repeat until we find next item in pockets.
    3285   00:B553                    ~ 
    3286   00:B553                    ~ 	endif
    3287   00:B553                      
    3288   00:B553                      ;
    3289   00:B553                      ; ISR
    3290   00:B553                      ;
    3291   00:B553                      isr:
    3292   00:B553                      	ifdef NOBIOS
    3293   00:B553                    ~ 		push hl
    3294   00:B553                    ~ 		push de
    3295   00:B553                    ~ 		push bc
    3296   00:B553                    ~ 		push af
    3297   00:B553                    ~ 		exx
    3298   00:B553                    ~ 		ex af,af
    3299   00:B553                    ~ 		push hl
    3300   00:B553                    ~ 		push de
    3301   00:B553                    ~ 		push bc
    3302   00:B553                    ~ 		push af
    3303   00:B553                    ~ 		push iy
    3304   00:B553                    ~ 		push ix
    3305   00:B553                    ~         in a,($99)      ;Clear possible interrupt request
    3306   00:B553                    ~         or a               ;Interrupt requested by VDP?		
    3307   00:B553                    ~ 		jp p,.intret       ;No, skip the rest
    3308   00:B553                    ~ 		ei
    3309   00:B553                    ~ 	endif			
    3310   00:B553  32 E7 53                    ld (MSX_STATFL),a	;Store this new status
    3311   00:B556  2A 9E 5C                    ld hl,(MSX_JIFFY)
    3312   00:B559  23                          inc hl
    3313   00:B55A  22 9E 5C                    ld (MSX_JIFFY),hl		
    3314   00:B55D                      	if (YFLAG or XFLAG)	
    3315   00:B55D  CD F9 C9            		call psgrout
    3316   00:B560                      		if YFLAG
    3317   00:B560                    ~ 			call music_play
    3318   00:B560                    ~ 		endif
    3319   00:B560                      		if XFLAG
    3320   00:B560  CD 55 C9            			call sfx_play
    3321   00:B563                      		endif
    3322   00:B563                      	endif
    3323   00:B563                      	ifdef NOBIOS
    3324   00:B563                    ~ .intret:
    3325   00:B563                    ~ 	else
    3326   00:B563  F1                  		pop af
    3327   00:B564                      	endif
    3328   00:B564  DD E1                       pop ix              ;Restore all registers
    3329   00:B566  FD E1                       pop iy
    3330   00:B568  F1                          pop af
    3331   00:B569  C1                          pop bc
    3332   00:B56A  D1                          pop de
    3333   00:B56B  E1                          pop hl
    3334   00:B56C  08                          ex  af,af
    3335   00:B56D  D9                          exx
    3336   00:B56E  F1                          pop af
    3337   00:B56F  C1                          pop bc
    3338   00:B570  D1                          pop de
    3339   00:B571  E1                          pop hl
    3340   00:B572  FB                          ei
    3341   00:B573  C9                          ret					; returns from interrupt		
    3342   00:B574                      ;
    3343   00:B574                      ; Wait for keypress.
    3344   00:B574                      ;
    3345   00:B574                      chkkey:
    3346   00:B574                      ;		call vsync
    3347   00:B574                      ;		ld b,11
    3348   00:B574                      ;.nokey:
    3349   00:B574                      ;		ld a,b
    3350   00:B574                      ;		dec a
    3351   00:B574                      ;		call MSX_SNSMAT
    3352   00:B574                      ;		cp 255
    3353   00:B574                      ;		ret nz
    3354   00:B574                      ;		djnz .nokey
    3355   00:B574                      ;		jr chkkey
    3356   00:B574                      		
    3357   00:B574                      prskey:
    3358   00:B574  CD F2 B5            	call vsync
    3359   00:B577                      
    3360   00:B577  3A 99 40            	ld a,(CONTROLLER_BUFFER+2)	; Test button left
    3361   00:B57A  A7                  	and a
    3362   00:B57B  20 16               	jr nz,debkey
    3363   00:B57D                      
    3364   00:B57D  3A 9A 40            	ld a,(CONTROLLER_BUFFER+3)	; Test joystick
    3365   00:B580  A7                  	and a
    3366   00:B581  20 10               	jr nz,debkey
    3367   00:B583                      
    3368   00:B583  3A 9D 40            	ld a,(CONTROLLER_BUFFER+6)	; Test keypad
    3369   00:B586  FE 0F               	cp $0f
    3370   00:B588  20 09               	jr nz,debkey
    3371   00:B58A                      
    3372   00:B58A  3A 9C 40            	ld a,(CONTROLLER_BUFFER+5)	; Test button right
    3373   00:B58D  A7                  	and a
    3374   00:B58E  20 03               	jr nz,debkey
    3375   00:B590                      
    3376   00:B590  C3 74 B5            	jp prskey
    3377   00:B593                      
    3378   00:B593                      ; Debounce keypress.
    3379   00:B593                      		
    3380   00:B593                      debkey:
    3381   00:B593  CD F2 B5            	call vsync
    3382   00:B596                      
    3383   00:B596  3A 99 40            	ld a,(CONTROLLER_BUFFER+2)	; Test button left
    3384   00:B599  A7                  	and a
    3385   00:B59A  20 F7               	jr nz,debkey
    3386   00:B59C                      
    3387   00:B59C  3A 9A 40            	ld a,(CONTROLLER_BUFFER+3)	; Test joystick
    3388   00:B59F  A7                  	and a
    3389   00:B5A0  20 F1               	jr nz,debkey
    3390   00:B5A2                      
    3391   00:B5A2  3A 9D 40            	ld a,(CONTROLLER_BUFFER+6)	; Test keypad
    3392   00:B5A5  FE 0F               	cp $0f
    3393   00:B5A7  20 EA               	jr nz,debkey
    3394   00:B5A9                      
    3395   00:B5A9  3A 9C 40            	ld a,(CONTROLLER_BUFFER+5)	; Test button right
    3396   00:B5AC  A7                  	and a
    3397   00:B5AD  20 E4               	jr nz,debkey
    3398   00:B5AF                      
    3399   00:B5AF  C9                  	ret
    3400   00:B5B0                      
    3401   00:B5B0                      ; Delay routine.
    3402   00:B5B0                      
    3403   00:B5B0                      delay:
    3404   00:B5B0  C5                  		push bc             ; store loop counter.
    3405   00:B5B1  CD F2 B5            		call vsync          ; wait for interrupt.
    3406   00:B5B4  C1                  		pop bc              ; restore counter.
    3407   00:B5B5  10 F9               		djnz delay          ; repeat.
    3408   00:B5B7  C9                  		ret
    3409   00:B5B8                      
    3410   00:B5B8                      ; Clear sprite table.
    3411   00:B5B8                      
    3412   00:B5B8                      xspr:
    3413   00:B5B8  21 B4 40            		ld hl,sprtab       ; sprite table.
    3414   00:B5BB  11 B5 40            		ld de,sprtab+1
    3415   00:B5BE  36 FF               		ld (hl),255
    3416   00:B5C0  01 1F 02            		ld bc,SPRBUF-1     ; length of table.
    3417   00:B5C3  ED B0               		ldir
    3418   00:B5C5  AF                  		xor a
    3419   00:B5C6  32 4B 40            		ld (highslot),a		; resets also highest sprite slot number
    3420   00:B5C9                      ;
    3421   00:B5C9                      xspr0:
    3422   00:B5C9  21 00 4D            		ld hl,mapspr       ; sprite images map.
    3423   00:B5CC  11 01 4D            		ld de,mapspr+1
    3424   00:B5CF  36 FF               		ld (hl),255
    3425   00:B5D1  01 7F 00            		ld bc,127          ; length of table.
    3426   00:B5D4  ED B0               		ldir
    3427   00:B5D6  C9                  		ret
    3428   00:B5D7                      		
    3429   00:B5D7                      	if OFLAG
    3430   00:B5D7                      	
    3431   00:B5D7                      ; Initialise all objects.
    3432   00:B5D7                      
    3433   00:B5D7                      	if DISTYPE=ROM
    3434   00:B5D7                      
    3435   00:B5D7                      iniob:
    3436   00:B5D7                      		; ROM model
    3437   00:B5D7  3A 44 B5            		ld a,(numob)        ; number of objects in the game.
    3438   00:B5DA  47                  		ld b,a
    3439   00:B5DB  21 2C A7            		ld hl,objdta        ; objects table.
    3440   00:B5DE  11 A8 4F            		ld de,objatr
    3441   00:B5E1                      .loop:
    3442   00:B5E1  3E 40               		ld a,OBJSIZ-ODTSIZ  ; distance between objects.
    3443   00:B5E3  4F                  		ld c,a
    3444   00:B5E4  ED A0               		ldi
    3445   00:B5E6  ED A0               		ldi
    3446   00:B5E8  ED A0               		ldi
    3447   00:B5EA                      		ADD_HL_A
    3447   00:B5EA  85                >   add a,l
    3447   00:B5EB  6F                >   ld l,a
    3447   00:B5EC  8C                >   adc a,h
    3447   00:B5ED  95                >   sub l
    3447   00:B5EE  67                >   ld h,a
    3448   00:B5EF  10 F0               		djnz .loop         ; repeat.
    3449   00:B5F1  C9                  		ret
    3450   00:B5F2                      
    3451   00:B5F2                      	else
    3452   00:B5F2                    ~ 		; RAM model
    3453   00:B5F2                    ~ iniob:
    3454   00:B5F2                    ~ 		/*
    3455   00:B5F2                    ~ 		ld ix,objdta        ; objects table.
    3456   00:B5F2                    ~ 		ld a,(numob)        ; number of objects in the game.
    3457   00:B5F2                    ~ 		ld b,a              ; loop counter.
    3458   00:B5F2                    ~ 		ld de,OBJSIZ        ; distance between objects.
    3459   00:B5F2                    ~ .loop:
    3460   00:B5F2                    ~ 		ld a,(ix+67)        ; start screen.
    3461   00:B5F2                    ~ 		ld (ix+64),a        ; set start screen.
    3462   00:B5F2                    ~ 		ld a,(ix+68)        ; find start x.
    3463   00:B5F2                    ~ 		ld (ix+65),a        ; set start x.
    3464   00:B5F2                    ~ 		ld a,(ix+69)        ; get initial y.
    3465   00:B5F2                    ~ 		ld (ix+66),a        ; set y coord.
    3466   00:B5F2                    ~ 		add ix,de           ; point to next object.
    3467   00:B5F2                    ~ 		djnz .loop         ; repeat.
    3468   00:B5F2                    ~ 		ret
    3469   00:B5F2                    ~ 		*/
    3470   00:B5F2                    ~ 		ld a,(numob)        ; number of objects in the game.
    3471   00:B5F2                    ~ 		ld b,a				; objects counter
    3472   00:B5F2                    ~ 		ld hl,objdta+OBJSIZ-1	
    3473   00:B5F2                    ~ .loop:
    3474   00:B5F2                    ~ 		ld c,h				; h must be > 3
    3475   00:B5F2                    ~ 		ld d,h
    3476   00:B5F2                    ~ 		ld e,l
    3477   00:B5F2                    ~ 		dec de
    3478   00:B5F2                    ~ 		dec de
    3479   00:B5F2                    ~ 		dec de
    3480   00:B5F2                    ~ 		ldd
    3481   00:B5F2                    ~ 		ldd
    3482   00:B5F2                    ~ 		ldd
    3483   00:B5F2                    ~ 		ld de,OBJSIZ+3
    3484   00:B5F2                    ~ 		add hl,de
    3485   00:B5F2                    ~ 		djnz .loop         ; repeat.
    3486   00:B5F2                    ~ 		ret
    3487   00:B5F2                    ~ 		
    3488   00:B5F2                    ~ 	endif
    3489   00:B5F2                      	
    3490   00:B5F2                      	endif
    3491   00:B5F2                      	
    3492   00:B5F2                      	
    3493   00:B5F2                      ; Screen synchronisation.
    3494   00:B5F2                      
    3495   00:B5F2                      vsync:
    3496   00:B5F2  F5                  	push af
    3497   00:B5F3  E5                  	push hl
    3498   00:B5F4  CD C0 C2            	call buildspr
    3499   00:B5F7                      	if PFLAG
    3500   00:B5F7  CD A1 B6            		call proshr
    3501   00:B5FA                      	endif
    3502   00:B5FA  CD 41 C0            	call joykey
    3503   00:B5FD                      
    3504   00:B5FD                      ; Sync framerate to 25 Hz
    3505   00:B5FD                      
    3506   00:B5FD                      check_if_enough_frames_passed:
    3507   00:B5FD  21 7C 40            	ld hl,time
    3508   00:B600  7E                  	ld a,(hl)
    3509   00:B601  FE 01               	cp 1
    3510   00:B603  00                  	nop
    3511   00:B604  00                  	nop
    3512   00:B605  00                  	nop
    3513   00:B606  00                  	nop
    3514   00:B607  00                  	nop
    3515   00:B608  00                  	nop
    3516   00:B609  38 F2               	jr c,check_if_enough_frames_passed
    3517   00:B60B                      
    3518   00:B60B  AF                  	xor a			; sync framerate 25 Hz
    3519   00:B60C  77                  	ld (hl),a
    3520   00:B60D                      
    3521   00:B60D  E1                  	pop hl
    3522   00:B60E  F1                  	pop af
    3523   00:B60F                      
    3524   00:B60F  C9                  	ret
    3525   00:B610                      ;		ld hl,MSX_JIFFY
    3526   00:B610                      ;		ld a,(hl)
    3527   00:B610                      ;
    3528   00:B610                      ;	if SFLAG
    3529   00:B610                      ;		push af
    3530   00:B610                      ;		push hl
    3531   00:B610                      ;		call scrltxt
    3532   00:B610                      ;		pop hl
    3533   00:B610                      ;		pop af
    3534   00:B610                      ;		cp (hl)
    3535   00:B610                      ;		jr z,.novbl0
    3536   00:B610                      ;		call scrly
    3537   00:B610                      ;	if PFLAG
    3538   00:B610                      ;;		call proshr
    3539   00:B610                      ;	endif
    3540   00:B610                      ;		call buildspr
    3541   00:B610                      ;	ret
    3542   00:B610                      ;	if EFLAG
    3543   00:B610                      ;		call beeper
    3544   00:B610                      ;	endif
    3545   00:B610                      ;		call joykey
    3546   00:B610                      ;		jr .nowait
    3547   00:B610                      ;		
    3548   00:B610                      ;.novbl0:		
    3549   00:B610                      ;	endif
    3550   00:B610                      ;
    3551   00:B610                      ;	if PFLAG
    3552   00:B610                      ;		
    3553   00:B610                      ;		push af
    3554   00:B610                      ;		push hl
    3555   00:B610                      ;		call proshr
    3556   00:B610                      ;		pop hl
    3557   00:B610                      ;		pop af
    3558   00:B610                      ;		cp (hl)
    3559   00:B610                      ;		jr z,.novbl1
    3560   00:B610                      ;	if SFLAG
    3561   00:B610                      ;		call scrly
    3562   00:B610                      ;	endif
    3563   00:B610                      ;		call buildspr
    3564   00:B610                      ;	if EFLAG
    3565   00:B610                      ;		call beeper
    3566   00:B610                      ;	endif
    3567   00:B610                      ;		call joykey
    3568   00:B610                      ;		jr .nowait
    3569   00:B610                      ;		
    3570   00:B610                      ;.novbl1:		
    3571   00:B610                      ;	endif
    3572   00:B610                      ;		
    3573   00:B610                      ;		push af
    3574   00:B610                      ;		push hl
    3575   00:B610                      ;		call buildspr
    3576   00:B610                      ;		pop hl
    3577   00:B610                      ;		pop af
    3578   00:B610                      ;		cp (hl)
    3579   00:B610                      ;		jr z,.novbl2
    3580   00:B610                      ;	if SFLAG
    3581   00:B610                      ;		call scrly
    3582   00:B610                      ;	endif
    3583   00:B610                      ;	if EFLAG
    3584   00:B610                      ;		call beeper
    3585   00:B610                      ;	endif
    3586   00:B610                      ;		call joykey
    3587   00:B610                      ;		jr .nowait
    3588   00:B610                      ;
    3589   00:B610                      ;.novbl2:
    3590   00:B610                      ;	if EFLAG
    3591   00:B610                      ;		call beeper
    3592   00:B610                      ;	endif
    3593   00:B610                      ;		cp (hl)
    3594   00:B610                      ;		jr z,.novbl3
    3595   00:B610                      ;	if SFLAG
    3596   00:B610                      ;		call scrly
    3597   00:B610                      ;	endif
    3598   00:B610                      ;		call joykey
    3599   00:B610                      ;		jr .nowait
    3600   00:B610                      ;		
    3601   00:B610                      ;.novbl3:
    3602   00:B610                      ;		push af
    3603   00:B610                      ;		push hl
    3604   00:B610                      ;		call joykey
    3605   00:B610                      ;		pop hl
    3606   00:B610                      ;		pop af
    3607   00:B610                      ;		cp (hl)
    3608   00:B610                      ;		; jr z,.novbl5
    3609   00:B610                      ;		jr z,.wait
    3610   00:B610                      ;	if SFLAG
    3611   00:B610                      ;		call scrly
    3612   00:B610                      ;	endif
    3613   00:B610                      ;		jr .nowait
    3614   00:B610                      ;		
    3615   00:B610                      ;.wait:		
    3616   00:B610                      ;	ifdef DEBUG
    3617   00:B610                      ;		BORDER 13
    3618   00:B610                      ;	endif
    3619   00:B610                      ;		cp (hl)
    3620   00:B610                      ;		jr z,.wait
    3621   00:B610                      ;	if SFLAG
    3622   00:B610                      ;		call scrly
    3623   00:B610                      ;	endif
    3624   00:B610                      ;	
    3625   00:B610                      ;.nowait:
    3626   00:B610                      ;	ifdef DEBUG
    3627   00:B610                      ;		BORDER 14
    3628   00:B610                      ;	endif
    3629   00:B610                      ;		ret
    3630   00:B610                      ;
    3631   00:B610                      ;	if EFLAG
    3632   00:B610                      ;	
    3633   00:B610                      beeper:
    3634   00:B610                      ;	ifdef DEBUG
    3635   00:B610                      ;		BORDER 15
    3636   00:B610                      ;	endif
    3637   00:B610                      ;		ld e,a				; keeps JIFFY
    3638   00:B610                      ;		ld a,(sndtyp)       ; sound to play.
    3639   00:B610                      ;		and a               ; any sound?
    3640   00:B610                      ;		jr z,beep1			; no.
    3641   00:B610                      ;		ld b,a              ; outer loop.
    3642   00:B610                      ;		and a               ; test it.
    3643   00:B610                      ;		ld c,14				; first value to write (0)
    3644   00:B610                      ;		jp m,noise          ; play white noise.
    3645   00:B610                      ;.beep2:
    3646   00:B610                      ;		ld a,c              ; (5) get speaker value.
    3647   00:B610                      ;		out (MSX_PPICM),a   ; (12) write to speaker.
    3648   00:B610                      ;		xor 1               ; (7) toggle bit 0.
    3649   00:B610                      ;		ld c,a              ; (5) store value for next time.
    3650   00:B610                      ;		ld d,b              ; (5) store loop counter.
    3651   00:B610                      ;		
    3652   00:B610                      ;		ld a,(snddelay)
    3653   00:B610                      ;		or a
    3654   00:B610                      ;		jr z,.nodelay
    3655   00:B610                      ;		ld b,a
    3656   00:B610                      ;		djnz $
    3657   00:B610                      ;		ld b,d
    3658   00:B610                      ;.nodelay:		
    3659   00:B610                      ;		ld a,e				; (5) restore old JiFFY
    3660   00:B610                      ;.beep3:
    3661   00:B610                      ;		cp (hl)				; (8) next frame?
    3662   00:B610                      ;		jr nz,.beep4		; (8/13) yes, no more processing please.
    3663   00:B610                      ;		djnz .beep3         ; (14/9) loop while frame doesn't changes.
    3664   00:B610                      ;		
    3665   00:B610                      ;		ld b,d              ; (5) restore loop counter.
    3666   00:B610                      ;		djnz .beep2         ; (14/9) continue noise.
    3667   00:B610                      ;							; (87)
    3668   00:B610                      ;.beep4:
    3669   00:B610                      ;		ld a,d              ; where we got to.
    3670   00:B610                      ;vsynca:
    3671   00:B610                      ;		ld (sndtyp),a       ; remember for next time.
    3672   00:B610                      ;beep1:		
    3673   00:B610                      ;		ld a,e
    3674   00:B610                      ;
    3675   00:B610                      ;	ifdef DEBUG
    3676   00:B610                      ;		BORDER 14
    3677   00:B610                      ;	endif
    3678   00:B610                      ;
    3679   00:B610                      ;		ret
    3680   00:B610                      
    3681   00:B610                      ; Play white noise
    3682   00:B610                      
    3683   00:B610                      ;noise: 
    3684   00:B610                      ;		sub 127
    3685   00:B610                      ;		ld b,a				; outer loop
    3686   00:B610                      ;vsync7:
    3687   00:B610                      ;		ld a,r              ; get random speaker value.
    3688   00:B610                      ;		and 2               ; only retain the speaker/earphone bits.
    3689   00:B610                      ;		rrca
    3690   00:B610                      ;		or c                ; merge with command PPI bit 7.
    3691   00:B610                      ;		out (MSX_PPICM),a   ; write to speaker.
    3692   00:B610                      ;		ld a,e				; restore old JiFFY
    3693   00:B610                      ;		cp (hl)             ; subtract last reading.
    3694   00:B610                      ;		jp nz,vsync8        ; yes, no more processing please.
    3695   00:B610                      ;		ld a,b
    3696   00:B610                      ;		;and 127
    3697   00:B610                      ;		inc a
    3698   00:B610                      ;vsync9:
    3699   00:B610                      ;		dec a
    3700   00:B610                      ;		jr nz,vsync9        ; loop.
    3701   00:B610                      ;		djnz vsync7         ; continue noise.
    3702   00:B610                      ;vsync8:
    3703   00:B610                      ;		xor a
    3704   00:B610                      ;		jr vsynca
    3705   00:B610                      ;
    3706   00:B610                      ;	endif
    3707   00:B610                      	
    3708   00:B610                      ; Redraw the screen.
    3709   00:B610                      
    3710   00:B610                      redraw:
    3711   00:B610                      	if MBFLAG
    3712   00:B610                    ~ 		ld a,WINDOWWID
    3713   00:B610                    ~ 		ld (winwid),a
    3714   00:B610                    ~ 		ld a,WINDOWHGT
    3715   00:B610                    ~ 		ld (winhgt),a
    3716   00:B610                    ~ 	endif
    3717   00:B610                      
    3718   00:B610  CD D8 C6            		call clrscrmap
    3719   00:B613  DD E5               		push ix             ; place sprite pointer on stack.
    3720   00:B615                      		; ld (nohide),a		; disable screen hiding
    3721   00:B615                      		
    3722   00:B615  CD B5 BE            		call droom          ; show screen layout.
    3723   00:B618                      	if OFLAG
    3724   00:B618  CD FE BA            		call shwob          ; draw objects.
    3725   00:B61B                      	endif
    3726   00:B61B                      
    3727   00:B61B                      		WAITFRAME
    3727   00:B61B                    >   ifdef DEBUG
    3727   00:B61B                    ~   BORDER 13
    3727   00:B61B                    ~   endif
    3727   00:B61B  FB                >   ei
    3727   00:B61C  21 9E 5C          >   ld hl,MSX_JIFFY
    3727   00:B61F  7E                >   ld a,(hl)
    3727   00:B620                    > .wait:
    3727   00:B620  BE                >   cp (hl)
    3727   00:B621  28 FD             >   jr z,.wait
    3727   00:B623                    >   ifdef DEBUG
    3727   00:B623                    ~   BORDER 14
    3727   00:B623                    ~   endif
    3728   00:B623                      		
    3729   00:B623  21 80 45            		ld hl,spratr
    3730   00:B626  11 00 1B            		ld de,MSX_SPRATR
    3731   00:B629  06 80               		ld b,128
    3732   00:B62B  CD 90 C2            		call ram2vram			   
    3733   00:B62E                      	   
    3734   00:B62E                      rpblc1:
    3735   00:B62E                      	if PFLAG
    3736   00:B62E  CD 22 B9            		call dshrp          ; redraw shrapnel.
    3737   00:B631                      	endif
    3738   00:B631                      	if AFLAG
    3739   00:B631                    ~ 		call rbloc          ; draw blocks for this screen
    3740   00:B631                    ~ 	endif
    3741   00:B631  DD E1               		pop ix              ; retrieve sprite pointer.
    3742   00:B633  C9                  		ret
    3743   00:B634                      
    3744   00:B634                      ; swap PAL/NTSC
    3745   00:B634                      
    3746   00:B634                      swaphz:		
    3747   00:B634  3A E8 5F            		ld a,(MSX_RG9SAV)
    3748   00:B637  EE 02               		xor 2
    3749   00:B639  47                  		ld b,a
    3750   00:B63A  0E 09               		ld c,9
    3751   00:B63C  F5                  		push af
    3752   00:B63D  CD 47 00            		call MSX_WRTVDP			
    3753   00:B640  F1                  		pop af
    3754   00:B641  C9                  		ret
    3755   00:B642                      
    3756   00:B642                      ; Clear screen routine.
    3757   00:B642                      
    3758   00:B642                      cls:
    3759   00:B642  3A 39 40            		ld a,(clratt)
    3760   00:B645  5F                  		ld e,a
    3761   00:B646  E6 F0               		and $F0
    3762   00:B648  0F                  		rrca
    3763   00:B649  0F                  		rrca
    3764   00:B64A  0F                  		rrca
    3765   00:B64B  0F                  		rrca
    3766   00:B64C  32 E9 53            		ld (MSX_FORCLR),a
    3767   00:B64F  7B                  		ld a,e
    3768   00:B650  E6 0F               		and $0F
    3769   00:B652  32 EA 53            		ld (MSX_BAKCLR),a
    3770   00:B655  AF                  		xor a
    3771   00:B656  CD 71 CB            		call MSX_CLS
    3772   00:B659  21 00 00            		ld hl,0             ; set hl to origin (0, 0).
    3773   00:B65C  22 35 40            		ld (charx),hl       ; reset coordinates.
    3774   00:B65F  CD D8 C6            		call clrscrmap
    3775   00:B662  C3 88 C2            		jp dissprs
    3776   00:B665                      
    3777   00:B665                      ; Set palette routine and data.
    3778   00:B665                      ; Palette.
    3779   00:B665                      
    3780   00:B665                      setpal:
    3781   00:B665  3A 07 00            		ld a,(MSX_VDPPRT)	; get first VDP write port
    3782   00:B668  4F                  		ld c,a
    3783   00:B669  0C                  		inc c      		; prepare to write register data
    3784   00:B66A  AF                  		xor a      		; from color 0
    3785   00:B66B  ED 79               		out (c),a
    3786   00:B66D  3E 90               		ld a,16+128		; write R#16
    3787   00:B66F  ED 79               		out (c),a
    3788   00:B671  0C                  		inc c      		; prepare to write palette data
    3789   00:B672  06 20               		ld b,32      	; 16 color * 2 bytes for palette data
    3790   00:B674  ED B3               		otir
    3791   00:B676  C9                  		ret
    3792   00:B677                      		
    3793   00:B677                      	if (PFLAG or DFLAG)
    3794   00:B677                      	
    3795   00:B677                      fdchk:
    3796   00:B677  7E                  		ld a,(hl)           ; fetch cell.
    3797   00:B678  FE 04               		cp FODDER           ; is it fodder?
    3798   00:B67A  C0                  		ret nz              ; no.
    3799   00:B67B  36 00               		ld (hl),0           ; rewrite block type.
    3800   00:B67D  E5                  		push hl             ; store pointer to block.
    3801   00:B67E  11 00 46            		ld de,MAP           ; address of map.
    3802   00:B681  A7                  		and a               ; clear carry flag for subtraction.
    3803   00:B682  ED 52               		sbc hl,de           ; find simple displacement for block.
    3804   00:B684  7D                  		ld a,l              ; low byte is y coordinate.
    3805   00:B685  E6 1F               		and 31              ; column position 0 - 31.
    3806   00:B687  32 55 40            		ld (dispy),a        ; set up y position.
    3807   00:B68A  29                  		add hl,hl           ; multiply displacement by 8.
    3808   00:B68B  29                  		add hl,hl
    3809   00:B68C  29                  		add hl,hl
    3810   00:B68D  7C                  		ld a,h              ; x coordinate now in h.
    3811   00:B68E  32 54 40            		ld (dispx),a        ; set the display coordinate.
    3812   00:B691  2A 4B B5            		ld hl,(blkptr)      ; blocks.
    3813   00:B694  22 3E 40            		ld (grbase),hl      ; set graphics base.		
    3814   00:B697  AF                  		xor a               ; block to write.
    3815   00:B698  CD 2F BE            		call pattr          ; write block.
    3816   00:B69B  E1                  		pop hl              ; restore block pointer.
    3817   00:B69C  C9                  		ret
    3818   00:B69D                      		
    3819   00:B69D                      	endif
    3820   00:B69D                      	
    3821   00:B69D                      ; Colour a sprite.
    3822   00:B69D                      
    3823   00:B69D                      cspr:
    3824   00:B69D  DD 71 05            		ld (ix+5),c
    3825   00:B6A0  C9                  		ret
    3826   00:B6A1                      				
    3827   00:B6A1                      	if PFLAG
    3828   00:B6A1                      
    3829   00:B6A1                      ; Specialist routines.
    3830   00:B6A1                      ; Process shrapnel.
    3831   00:B6A1                      		
    3832   00:B6A1                      proshr:
    3833   00:B6A1  CD D5 B6            		call setshr
    3834   00:B6A4                      		
    3835   00:B6A4                      proshrnoset:
    3836   00:B6A4                      		
    3837   00:B6A4                      	ifdef DEBUG
    3838   00:B6A4                    ~ 		BORDER 5
    3839   00:B6A4                    ~ 	endif
    3840   00:B6A4                      
    3841   00:B6A4  CD BC B6            		call proshr0
    3842   00:B6A7  CD BC B6            		call proshr0
    3843   00:B6AA  CD BC B6            		call proshr0
    3844   00:B6AD  CD BC B6            		call proshr0
    3845   00:B6B0  CD BC B6            		call proshr0
    3846   00:B6B3  CD BC B6            		call proshr0
    3847   00:B6B6  CD BC B6            		call proshr0
    3848   00:B6B9  CD BC B6            		call proshr0
    3849   00:B6BC                      		
    3850   00:B6BC                      	ifdef DEBUG
    3851   00:B6BC                    ~ 
    3852   00:B6BC                    ~ 		call proshr0 	
    3853   00:B6BC                    ~ 		BORDER 14
    3854   00:B6BC                    ~ 		ret
    3855   00:B6BC                    ~ 
    3856   00:B6BC                    ~ 	else
    3857   00:B6BC                      
    3858   00:B6BC                      proshr0:
    3859   00:B6BC  DD 2A C0 4D         		ld ix,(shraddr)
    3860   00:B6C0  06 03               		ld b,NUMSHR/(9*2)
    3861   00:B6C2                      proshloop:
    3862   00:B6C2  DD 7E 00            		ld a,(ix+0)         ; on/off marker.
    3863   00:B6C5  17                  		rla                 ; check its status.
    3864   00:B6C6  D4 E5 B6            		call nc,proshx      ; on, so process it.
    3865   00:B6C9  11 12 00            		ld de,SHRSIZ*2      ; distance to next.
    3866   00:B6CC  DD 19               		add ix,de           ; point there.
    3867   00:B6CE  10 F2               		djnz proshloop      ; round again.
    3868   00:B6D0  DD 22 C0 4D         		ld (shraddr),ix
    3869   00:B6D4  C9                  		ret
    3870   00:B6D5                      	
    3871   00:B6D5                      	endif
    3872   00:B6D5                      	
    3873   00:B6D5                      setshr:
    3874   00:B6D5  3A 9E 5C            		ld a,(MSX_JIFFY)
    3875   00:B6D8                      setshr0:
    3876   00:B6D8  21 CB 4D            		ld hl,SHRAPN+SHRSIZ        ; table.
    3877   00:B6DB  0F                  		rrca
    3878   00:B6DC  38 03               		jr c,.shrodd
    3879   00:B6DE  21 C2 4D            		ld hl,SHRAPN			 ; table.
    3880   00:B6E1                      .shrodd:
    3881   00:B6E1  22 C0 4D            		ld (shraddr),hl
    3882   00:B6E4  C9                  		ret
    3883   00:B6E5                      
    3884   00:B6E5                      	ifdef DEBUG
    3885   00:B6E5                    ~ 		
    3886   00:B6E5                    ~ proshr0:
    3887   00:B6E5                    ~ 		ld ix,(shraddr)
    3888   00:B6E5                    ~ 		ld b,NUMSHR/(9*2)
    3889   00:B6E5                    ~ proshloop:
    3890   00:B6E5                    ~ 		ld a,(ix+0)         ; on/off marker.
    3891   00:B6E5                    ~ 		rla                 ; check its status.
    3892   00:B6E5                    ~ 		call nc,proshx      ; on, so process it.
    3893   00:B6E5                    ~ 		ld de,SHRSIZ*2      ; distance to next.
    3894   00:B6E5                    ~ 		add ix,de           ; point there.
    3895   00:B6E5                    ~ 		djnz proshloop      ; round again.
    3896   00:B6E5                    ~ 		ld (shraddr),ix
    3897   00:B6E5                    ~ 		ret
    3898   00:B6E5                    ~ 
    3899   00:B6E5                    ~ 	endif
    3900   00:B6E5                      
    3901   00:B6E5                      proshx:
    3902   00:B6E5  2A 17 40            		ld hl,(shrplot)
    3903   00:B6E8  E9                  		jp (hl)
    3904   00:B6E9                      
    3905   00:B6E9                      prosh1:
    3906   00:B6E9  C5                  		push bc             ; store counter.
    3907   00:B6EA  CD 58 B7            		call plot           ; delete the pixel.
    3908   00:B6ED  DD 7E 00            		ld a,(ix+0)         ; restore shrapnel type.
    3909   00:B6F0  CD F8 B6            		call prosh2         ; run the routine.
    3910   00:B6F3  CD 31 B7            		call chkxy          ; check x and y are good before we redisplay.
    3911   00:B6F6  C1                  		pop bc              ; restore counter.
    3912   00:B6F7  C9                  		ret
    3913   00:B6F8                      prosh2:
    3914   00:B6F8  87                  		add a,a		
    3915   00:B6F9  C6 08               		add a,shrptr&$FF
    3916   00:B6FB  6F                  		ld l,a
    3917   00:B6FC  26 C8               		ld h,shrptr>>8
    3918   00:B6FE                      		;ld (addr+1),a			; auto-modifying code
    3919   00:B6FE                      ;addr:
    3920   00:B6FE                      		;ld hl,(shrptr)
    3921   00:B6FE                      
    3922   00:B6FE  C3 43 C2            		jp jumphl
    3923   00:B701                       
    3924   00:B701                      
    3925   00:B701                      ; Explosion shrapnel.
    3926   00:B701                      ; 220
    3927   00:B701                      /*
    3928   00:B701                    ~ shrap: 
    3929   00:B701                    ~ 		ld h,(shrsin >> 8) & $FF    ; Get MSB of table
    3930   00:B701                    ~ 		ld l,(ix+1)
    3931   00:B701                    ~ 		
    3932   00:B701                    ~ 		ld e,(hl)           ; fetch value from table.
    3933   00:B701                    ~ 		inc hl              ; next byte of table.
    3934   00:B701                    ~ 		ld d,(hl)           ; fetch value from table.
    3935   00:B701                    ~ 		
    3936   00:B701                    ~ 		inc hl              ; next byte of table.
    3937   00:B701                    ~ 		ld c,(hl)           ; fetch value from table.
    3938   00:B701                    ~ 		inc hl              ; next byte of table.
    3939   00:B701                    ~ 		ld b,(hl)           ; fetch value from table.
    3940   00:B701                    ~ 		
    3941   00:B701                    ~ 		ld l,(ix+2)         ; x coordinate in hl.
    3942   00:B701                    ~ 		ld h,(ix+3)
    3943   00:B701                    ~ 		add hl,de           ; add sine.
    3944   00:B701                    ~ 		ld (ix+2),l         ; store new coordinate.
    3945   00:B701                    ~ 		ld (ix+3),h
    3946   00:B701                    ~ 		
    3947   00:B701                    ~ 		ld l,(ix+4)         ; y coordinate in hl.
    3948   00:B701                    ~ 		ld h,(ix+5)
    3949   00:B701                    ~ 		add hl,bc           ; add cosine.
    3950   00:B701                    ~ 		ld (ix+4),l         ; store new coordinate.
    3951   00:B701                    ~ 		ld (ix+5),h
    3952   00:B701                    ~ 		ret
    3953   00:B701                    ~  */
    3954   00:B701                       ; 182 -> 156
    3955   00:B701                      shrap: 
    3956   00:B701  26 C8               		ld h,shrsin>>8    ; Get MSB of table
    3957   00:B703  DD 7E 01            		ld a,(ix+1)
    3958   00:B706  C6 18               		add a,shrsin&$FF	; table offset (saving some bytes)
    3959   00:B708  6F                  		ld l,a
    3960   00:B709  ED 73 7A 40         		ld (stack),sp
    3961   00:B70D  F3                  		di
    3962   00:B70E  F9                  		ld sp,hl
    3963   00:B70F  D1                  		pop de						; fetch sine
    3964   00:B710  C1                  		pop bc						; fetch cosine
    3965   00:B711  DD F9               		ld sp,ix
    3966   00:B713  E1                  		pop hl
    3967   00:B714  E1                  		pop hl
    3968   00:B715  19                  		add hl,de
    3969   00:B716  E5                  		push hl		
    3970   00:B717  E1                  		pop hl
    3971   00:B718  E1                  		pop hl
    3972   00:B719  09                  		add hl,bc
    3973   00:B71A  E5                  		push hl				
    3974   00:B71B  FB                  		ei
    3975   00:B71C  ED 7B 7A 40         		ld sp,(stack)            ;parameter will overwritten
    3976   00:B720  C9                  		ret
    3977   00:B721                      
    3978   00:B721  DD 35 05            dotl:   dec (ix+5)          ; move left.
    3979   00:B724  C9                          ret
    3980   00:B725  DD 34 05            dotr:   inc (ix+5)          ; move left.
    3981   00:B728  C9                          ret
    3982   00:B729  DD 35 03            dotu:   dec (ix+3)          ; move up.
    3983   00:B72C  C9                          ret
    3984   00:B72D  DD 34 03            dotd:   inc (ix+3)          ; move down.
    3985   00:B730  C9                          ret
    3986   00:B731                      
    3987   00:B731                      ; Check coordinates are good before redrawing at new position.
    3988   00:B731                      
    3989   00:B731                      chkxy:
    3990   00:B731                      ;		ld (ix+7),255
    3991   00:B731                      
    3992   00:B731  21 45 B5            		ld hl,wntopx        ; window top.
    3993   00:B734  DD 7E 03            		ld a,(ix+3)         ; fetch shrapnel Y coordinate.
    3994   00:B737  BE                  		cp (hl)             ; compare with top window limit.
    3995   00:B738  38 19               		jr c,kilshr         ; out of window, kill shrapnel.
    3996   00:B73A  23                  		inc hl              ; left edge.
    3997   00:B73B  DD 7E 05            		ld a,(ix+5)         ; fetch shrapnel X coordinate.
    3998   00:B73E  BE                  		cp (hl)             ; compare with left window limit.
    3999   00:B73F  38 12               		jr c,kilshr         ; out of window, kill shrapnel.
    4000   00:B741                      
    4001   00:B741  23                  		inc hl              ; point to bottom.
    4002   00:B742  7E                  		ld a,(hl)           ; fetch window limit.
    4003   00:B743  C6 0F               		add a,MSX_SPRVS-1   ; add height of sprite.
    4004   00:B745  DD BE 03            		cp (ix+3)           ; compare with shrapnel Y coordinate.
    4005   00:B748  38 09               		jr c,kilshr         ; off screen, kill shrapnel.
    4006   00:B74A  23                  		inc hl              ; point to right edge.
    4007   00:B74B  7E                  		ld a,(hl)           ; fetch shrapnel X coordinate.
    4008   00:B74C  C6 0F               		add a,MSX_SPRVS-1   ; add width of sprite.
    4009   00:B74E  DD BE 05            		cp (ix+5)           ; compare with window limit.
    4010   00:B751  30 05               		jr nc,plot          ; off screen, kill shrapnel.
    4011   00:B753                      
    4012   00:B753                      kilshr:
    4013   00:B753  DD 36 00 80         		ld (ix+0),128       ; switch off shrapnel.
    4014   00:B757                      		; ld (ix+7),255       ; switch off shrapnel.
    4015   00:B757                      		
    4016   00:B757  C9                  		ret
    4017   00:B758                      
    4018   00:B758                      
    4019   00:B758                      ; Drop through.
    4020   00:B758                      ; Display shrapnel.
    4021   00:B758                      
    4022   00:B758                      plot:   ; ret
    4023   00:B758                      
    4024   00:B758  DD 6E 03            		ld l,(ix+3)         ; y integer.
    4025   00:B75B  DD 66 05            		ld h,(ix+5)         ; x integer.
    4026   00:B75E  22 54 40            		ld (dispx),hl       ; workspace coordinates.
    4027   00:B761  DD 7E 00            		ld a,(ix+0)         ; type.
    4028   00:B764  A7                  		and a               ; is it a laser?
    4029   00:B765  28 1F               		jr z,plot1          ; yes, draw laser instead.
    4030   00:B767                      
    4031   00:B767                      ; INPUT:
    4032   00:B767                      ; 	H = X
    4033   00:B767                      ;	L = Y
    4034   00:B767                      plot0:
    4035   00:B767                      /*
    4036   00:B767                    ~ 		ld a,h              ; 5 which pixel within byte do we
    4037   00:B767                    ~ 		and 7               ; 7 want to set first?		
    4038   00:B767                    ~ 		ld e,a				; 5
    4039   00:B767                    ~ 		call scadd          	; screen address.		
    4040   00:B767                    ~ 		ld a,l				; 5 (22)
    4041   00:B767                    ~ 		di					; 5
    4042   00:B767                    ~ 		out (MSX_VDPCW),a	; 12
    4043   00:B767                    ~ 		ld a,h				; 5
    4044   00:B767                    ~ 		out (MSX_VDPCW),a	; 12
    4045   00:B767                    ~ 		ld d,dots>>8		; 7 Get MSB of table
    4046   00:B767                    ~ 		ld a,(de)			; 8 get value
    4047   00:B767                    ~ 		ld e,a				; 5
    4048   00:B767                    ~ 		in a,(MSX_VDPDRW)   ; 12 (66)
    4049   00:B767                    ~ 		xor e				; 5
    4050   00:B767                    ~ 		ld e,a				; 5
    4051   00:B767                    ~ 		ld a,l				; 5
    4052   00:B767                    ~ 		out (MSX_VDPCW),a	; 12
    4053   00:B767                    ~ 		ld a,h				; 5
    4054   00:B767                    ~ 		or 64				; 7
    4055   00:B767                    ~ 		out (MSX_VDPCW),a	; 12
    4056   00:B767                    ~ 		ei					; 5
    4057   00:B767                    ~ 		ld a,e				; 5
    4058   00:B767                    ~ 		out (MSX_VDPDRW),a	; 12 (73) 161		 = 139
    4059   00:B767                    ~ 		ret	   
    4060   00:B767                    ~ */
    4061   00:B767                      
    4062   00:B767                      
    4063   00:B767  7C                  		ld a,h              ; 5 which pixel within byte do we
    4064   00:B768  E6 07               		and 7               ; 7 want to set first?		
    4065   00:B76A  5F                  		ld e,a				; 5	(24)
    4066   00:B76B  CD A8 C3            		call scadd          	; screen address.					
    4067   00:B76E  0E BF               		ld c,MSX_VDPCW		; 7
    4068   00:B770  F3                  		di					; 5
    4069   00:B771  ED 69               		out (c),l			; 14	
    4070   00:B773  ED 61               		out (c),h			; 14
    4071   00:B775  16 C8               		ld d,dots>>8		; 7 Get MSB of table
    4072   00:B777  1A                  		ld a,(de)			; 8 get value
    4073   00:B778  5F                  		ld e,a				; 5
    4074   00:B779                      pltwrt:
    4075   00:B779  DB BE               		in a,(MSX_VDPDRW)   ; 12
    4076   00:B77B  AB                  		xor e				; 5 (70)
    4077   00:B77C  ED 69               		out (c),l			; 14
    4078   00:B77E  CB F4               		set 6,h				; 10
    4079   00:B780  ED 61               		out (c),h			; 14
    4080   00:B782  FB                  		ei					; 5
    4081   00:B783  D3 BE               		out (MSX_VDPDRW),a	; 12 (65)		 = 159
    4082   00:B785  C9                  		ret	   
    4083   00:B786                      		
    4084   00:B786                      plot1:
    4085   00:B786  CD A8 C3            		call scadd          ; screen address.
    4086   00:B789  0E BF               		ld c,MSX_VDPCW		; 7
    4087   00:B78B  F3                  		di					; 5
    4088   00:B78C  ED 69               		out (c),l			; 14	
    4089   00:B78E  ED 61               		out (c),h			; 14
    4090   00:B790  1E FF               		ld e,255
    4091   00:B792  C3 79 B7            		jp pltwrt
    4092   00:B795                      		
    4093   00:B795                      		/*
    4094   00:B795                    ~ 		and $FF					; dummy, wait 7 cycles
    4095   00:B795                    ~ 		and $FF					; dummy, wait 7 cycles
    4096   00:B795                    ~ 		in a,(MSX_VDPDRW)   ; 12
    4097   00:B795                    ~ 		cpl					; 5 (70)
    4098   00:B795                    ~ 		out (c),l			; 14
    4099   00:B795                    ~ 		set 6,h				; 10
    4100   00:B795                    ~ 		out (c),h			; 14
    4101   00:B795                    ~ 		ei					; 5
    4102   00:B795                    ~ 		out (MSX_VDPDRW),a	; 12 (65)		 = 159
    4103   00:B795                    ~ 		ret	   
    4104   00:B795                    ~ 		*/
    4105   00:B795                      /*
    4106   00:B795                    ~ 		call scadd          ; screen address.
    4107   00:B795                    ~ 		ld a,l
    4108   00:B795                    ~ 		di
    4109   00:B795                    ~ 		out (MSX_VDPCW),a
    4110   00:B795                    ~ 		ld a,h
    4111   00:B795                    ~ 		out (MSX_VDPCW),a
    4112   00:B795                    ~ 		and $FF					; dummy, wait 7 cycles
    4113   00:B795                    ~ 		and $FF					; dummy, wait 7 cycles
    4114   00:B795                    ~ 		in a,(MSX_VDPDRW)
    4115   00:B795                    ~ 		cpl
    4116   00:B795                    ~ 		ld e,a
    4117   00:B795                    ~ 		ld a,l
    4118   00:B795                    ~ 		out (MSX_VDPCW),a
    4119   00:B795                    ~ 		ld a,h
    4120   00:B795                    ~ 		or 64
    4121   00:B795                    ~ 		out (MSX_VDPCW),a
    4122   00:B795                    ~ 		ei	
    4123   00:B795                    ~ 		ld a,e
    4124   00:B795                    ~ 		out (MSX_VDPDRW),a		
    4125   00:B795                    ~ 		ret
    4126   00:B795                    ~ */
    4127   00:B795                      
    4128   00:B795                      
    4129   00:B795                      
    4130   00:B795                      trail:
    4131   00:B795  DD 35 01            		dec (ix+1)          ; time remaining.
    4132   00:B798  CA B7 B7            		jp z,trailk        ; time to switch it off.
    4133   00:B79B  CD 15 B9            		call qrand          ; get a random number.
    4134   00:B79E  1F                  		rra                 ; x or y axis?
    4135   00:B79F  38 0B               		jr c,.trailv        ; use x.
    4136   00:B7A1  1F                  		rra                 ; which direction?
    4137   00:B7A2  38 04               		jr c,.traill        ; go left.
    4138   00:B7A4  DD 34 05            		inc (ix+5)          ; go right.
    4139   00:B7A7  C9                  		ret
    4140   00:B7A8                      .traill:
    4141   00:B7A8  DD 35 05            		dec (ix+5)          ; go left.
    4142   00:B7AB  C9                  		ret
    4143   00:B7AC                      .trailv:
    4144   00:B7AC  1F                  		rra                 ; which direction?
    4145   00:B7AD  38 04               		jr c,.trailu        ; go up.
    4146   00:B7AF  DD 34 03            		inc (ix+3)          ; go down.
    4147   00:B7B2  C9                  		ret
    4148   00:B7B3                      .trailu:
    4149   00:B7B3  DD 35 03            		dec (ix+3)          ; go up.
    4150   00:B7B6  C9                  		ret
    4151   00:B7B7                      trailk:
    4152   00:B7B7  DD 36 03 C8         		ld (ix+3),200       ; set off-screen to kill vapour trail.
    4153   00:B7BB  C9                  		ret
    4154   00:B7BC                      
    4155   00:B7BC                      laser:
    4156   00:B7BC  DD 7E 01            		ld a,(ix+1)         ; direction.
    4157   00:B7BF  1F                  		rra                 ; left or right?
    4158   00:B7C0  30 04               		jr nc,laserl        ; move left.
    4159   00:B7C2  06 08               		ld b,8              ; distance to travel.
    4160   00:B7C4  18 02               		jr laserm           ; move laser.
    4161   00:B7C6                      laserl:
    4162   00:B7C6  06 F8               		ld b,248            ; distance to travel.
    4163   00:B7C8                      laserm:
    4164   00:B7C8  DD 7E 05            		ld a,(ix+5)         ; y position.
    4165   00:B7CB  80                  		add a,b             ; add distance.
    4166   00:B7CC  DD 77 05            		ld (ix+5),a         ; set new y coordinate.
    4167   00:B7CF                      
    4168   00:B7CF                      ; Test new block.
    4169   00:B7CF                      
    4170   00:B7CF  32 55 40            		ld (dispy),a        ; set y for block collision detection purposes.
    4171   00:B7D2  DD 7E 03            		ld a,(ix+3)         ; get x.
    4172   00:B7D5  32 54 40            		ld (dispx),a        ; set coordinate for collision test.
    4173   00:B7D8  CD CD BF            		call tstbl          ; get block type there.
    4174   00:B7DB  FE 02               		cp WALL             ; is it solid?
    4175   00:B7DD  28 D8               		jr z,trailk         ; yes, it cannot pass.
    4176   00:B7DF                      
    4177   00:B7DF                      	if (PFLAG or DFLAG)
    4178   00:B7DF  FE 04               		cp FODDER           ; is it fodder?
    4179   00:B7E1  20 05               		jr nz,.exit         ; no, ignore it.
    4180   00:B7E3  CD 77 B6            		call fdchk          ; remove fodder block.
    4181   00:B7E6  18 CF               		jr trailk           ; destroy laser.
    4182   00:B7E8                      .exit
    4183   00:B7E8                      	endif
    4184   00:B7E8  C9                  		ret
    4185   00:B7E9                      
    4186   00:B7E9                      ; Plot, preserving de.
    4187   00:B7E9                      
    4188   00:B7E9                      plotde:
    4189   00:B7E9  D5                  		push de             ; put de on stack.
    4190   00:B7EA  CD 58 B7            		call plot           ; plot pixel.
    4191   00:B7ED  D1                  		pop de              ; restore de from stack.
    4192   00:B7EE  C9                  		ret
    4193   00:B7EF                      
    4194   00:B7EF                      ; Shoot a laser.
    4195   00:B7EF                      
    4196   00:B7EF                      shoot:
    4197   00:B7EF  4F                  		ld c,a              ; store direction in c register.
    4198   00:B7F0  DD 7E 03            		ld a,(ix+3)         ; sprite x coordinate.
    4199   00:B7F3                      shoot1:
    4200   00:B7F3  C6 07               		add a,7             ; down 7 pixels.
    4201   00:B7F5  6F                  		ld l,a              ; puty x coordinate in l.
    4202   00:B7F6  DD 66 04            		ld h,(ix+4)         ; sprite y coordinate in h.
    4203   00:B7F9  DD E5               		push ix             ; store pointer to sprite.
    4204   00:B7FB  CD BD B8            		call fpslot         ; find particle slot.
    4205   00:B7FE  30 2C               		jr nc,vapou2        ; failed, restore ix.
    4206   00:B800  DD 36 00 00         		ld (ix+0),0         ; set up a laser.
    4207   00:B804  DD 71 01            		ld (ix+1),c         ; set the direction.
    4208   00:B807  DD 75 03            		ld (ix+3),l         ; set x coordinate.
    4209   00:B80A  CB 19               		rr c                ; check direction we want.
    4210   00:B80C  38 08               		jr c,shootr         ; shoot right.
    4211   00:B80E  7C                  		ld a,h              ; y position.
    4212   00:B80F                      
    4213   00:B80F                      shoot0:
    4214   00:B80F  E6 F8               		and 248             ; align on character boundary.
    4215   00:B811  DD 77 05            		ld (ix+5),a         ; set y coordinate.
    4216   00:B814  18 2D               		jr vapou0           ; draw first image.
    4217   00:B816                      shootr:
    4218   00:B816  7C                  		ld a,h              ; y position.
    4219   00:B817  C6 0F               		add a,15            ; look right.
    4220   00:B819  18 F4               		jr shoot0           ; align and continue.
    4221   00:B81B                      
    4222   00:B81B                      ; Create a bit of vapour trail.
    4223   00:B81B                      
    4224   00:B81B                      vapour:
    4225   00:B81B  DD E5               		push ix             ; store pointer to sprite.
    4226   00:B81D  DD 6E 03            		ld l,(ix+3)         ; x coordinate.
    4227   00:B820  DD 66 04            		ld h,(ix+4)         ; y coordinate.
    4228   00:B823                      vapou3:
    4229   00:B823  11 07 07            		ld de,7*256+7       ; mid-point of sprite.
    4230   00:B826  19                  		add hl,de           ; point to centre of sprite.
    4231   00:B827  CD BD B8            		call fpslot         ; find particle slot.
    4232   00:B82A  38 03               		jr c,vapou1         ; no, we can use it.
    4233   00:B82C                      vapou2:
    4234   00:B82C  DD E1               		pop ix              ; restore sprite pointer.
    4235   00:B82E  C9                  		ret                 ; out of slots, can't generate anything.
    4236   00:B82F                      vapou1:
    4237   00:B82F  DD 75 03            		ld (ix+3),l         ; set up x.
    4238   00:B832  DD 74 05            		ld (ix+5),h         ; set up y coordinate.
    4239   00:B835  CD 15 B9            		call qrand          ; get quick random number.
    4240   00:B838  E6 0F               		and 15              ; random time.
    4241   00:B83A  C6 0A               		add a,VAPTIM      ; minimum time on screen.
    4242   00:B83C  DD 77 01            		ld (ix+1),a         ; set time on screen.
    4243   00:B83F  DD 36 00 01         		ld (ix+0),1         ; define particle as vapour trail.
    4244   00:B843                      vapou0:
    4245   00:B843  CD 31 B7            		call chkxy          ; plot first position.
    4246   00:B846  18 E4               		jr vapou2
    4247   00:B848                      
    4248   00:B848                      ; Create a user particle.
    4249   00:B848                      
    4250   00:B848                      ptusr:
    4251   00:B848  08                  		ex af,af            ; store timer.
    4252   00:B849  DD 6E 03            		ld l,(ix+3)         ; x coordinate.
    4253   00:B84C  DD 66 04            		ld h,(ix+4)         ; y coordinate.
    4254   00:B84F  11 07 07            		ld de,7*256+7       ; mid-point of sprite.
    4255   00:B852  19                  		add hl,de           ; point to centre of sprite.
    4256   00:B853  CD BD B8            		call fpslot         ; find particle slot.
    4257   00:B856  38 01               		jr c,.ptusr1        ; no, we can use it.
    4258   00:B858  C9                  		ret                 ; out of slots, can't generate anything.
    4259   00:B859                      .ptusr1:
    4260   00:B859  DD 75 03            		ld (ix+3),l         ; set up x.
    4261   00:B85C  DD 74 05            		ld (ix+5),h         ; set up y coordinate.
    4262   00:B85F  08                  		ex af,af            ; restore timer.
    4263   00:B860  DD 77 01            		ld (ix+1),a         ; set time on screen.
    4264   00:B863  DD 36 00 07         		ld (ix+0),7         ; define particle as user particle.
    4265   00:B867  C3 31 B7            		jp chkxy            ; plot first position.
    4266   00:B86A                      
    4267   00:B86A                      
    4268   00:B86A                      ; Create a vertical or horizontal star.
    4269   00:B86A                      
    4270   00:B86A  DD E5               star   push ix             ; store pointer to sprite.
    4271   00:B86C  CD BD B8                   call fpslot         ; find particle slot.
    4272   00:B86F  DA 75 B8                   jp c,star7          ; found one we can use.
    4273   00:B872  DD E1               star0  pop ix              ; restore sprite pointer.
    4274   00:B874  C9                         ret                 ; out of slots, can't generate anything.
    4275   00:B875                      
    4276   00:B875  79                  star7  ld a,c              ; direction.
    4277   00:B876  E6 03                      and 3               ; is it left?
    4278   00:B878  28 21                      jr z,star1          ; yes, it's horizontal.
    4279   00:B87A  3D                         dec a               ; is it right?
    4280   00:B87B  28 2C                      jr z,star2          ; yes, it's horizontal.
    4281   00:B87D  3D                         dec a               ; is it up?
    4282   00:B87E  28 35                      jr z,star3          ; yes, it's vertical.
    4283   00:B880                      
    4284   00:B880  3A 45 B5                   ld a,(wntopx)       ; get edge of screen.
    4285   00:B883  3C                         inc a               ; down one pixel.
    4286   00:B884  DD 77 03            star8  ld (ix+3),a         ; set x coord.
    4287   00:B887  CD 15 B9                   call qrand          ; get quick random number.
    4288   00:B88A  DD 77 05            star9  ld (ix+5),a         ; set y position.
    4289   00:B88D  79                         ld a,c              ; direction.
    4290   00:B88E  E6 03                      and 3               ; zero to three.
    4291   00:B890  C6 03                      add a,3             ; 3 to 6 for starfield.
    4292   00:B892  DD 77 00                   ld (ix+0),a         ; define particle as star.
    4293   00:B895  CD 31 B7                   call chkxy          ; plot first position.
    4294   00:B898  C3 72 B8                   jp star0
    4295   00:B89B  CD 15 B9            star1  call qrand          ; get quick random number.
    4296   00:B89E  DD 77 03                   ld (ix+3),a         ; set x coord.
    4297   00:B8A1  3A 48 B5                   ld a,(wnrgtx)       ; get edge of screen.
    4298   00:B8A4  C6 0F                      add a,15            ; add width of sprite minus 1.
    4299   00:B8A6  C3 8A B8                   jp star9
    4300   00:B8A9  CD 15 B9            star2  call qrand          ; get quick random number.
    4301   00:B8AC  DD 77 03                   ld (ix+3),a         ; set x coord.
    4302   00:B8AF  3A 46 B5                   ld a,(wnlftx)       ; get edge of screen.
    4303   00:B8B2  C3 8A B8                   jp star9
    4304   00:B8B5  3A 47 B5            star3  ld a,(wnbotx)       ; get edge of screen.
    4305   00:B8B8  C6 0F                      add a,15            ; height of sprite minus one pixel.
    4306   00:B8BA  C3 84 B8                   jp star8
    4307   00:B8BD                      
    4308   00:B8BD                      
    4309   00:B8BD                      ; Find particle slot for lasers or vapour trail.
    4310   00:B8BD                      ; Can't use alternate accumulator.
    4311   00:B8BD                      
    4312   00:B8BD                      fpslot:
    4313   00:B8BD  DD 21 C2 4D         		ld ix,SHRAPN        ; shrapnel table.
    4314   00:B8C1  11 09 00            		ld de,SHRSIZ        ; size of each particle.
    4315   00:B8C4  06 36               		ld b,NUMSHR         ; number of pieces in table.
    4316   00:B8C6                      fpslt0:
    4317   00:B8C6  DD 7E 00            		ld a,(ix+0)         ; get type.
    4318   00:B8C9  17                  		rla                 ; is this slot in use?
    4319   00:B8CA  D8                  		ret c               ; no, we can use it.
    4320   00:B8CB  DD 19               		add ix,de           ; point to more shrapnel.
    4321   00:B8CD  10 F7               		djnz fpslt0         ; repeat for all shrapnel.
    4322   00:B8CF  C9                  		ret                 ; out of slots, can't generate anything.
    4323   00:B8D0                      
    4324   00:B8D0                      ; Create an explosion at sprite position.
    4325   00:B8D0                      
    4326   00:B8D0                      explod:
    4327   00:B8D0  4F                  		ld c,a              ; particles to create.
    4328   00:B8D1  DD E5               		push ix             ; store pointer to sprite.
    4329   00:B8D3  DD 6E 03            		ld l,(ix+3)         ; y coordinate.
    4330   00:B8D6  DD 66 04            		ld h,(ix+4)         ; x coordinate.
    4331   00:B8D9  DD 21 C2 4D         		ld ix,SHRAPN        ; shrapnel table.
    4332   00:B8DD  11 09 00            		ld de,SHRSIZ        ; size of each particle.
    4333   00:B8E0  06 36               		ld b,NUMSHR         ; number of pieces in table.
    4334   00:B8E2                      expld0:
    4335   00:B8E2  DD 7E 00            		ld a,(ix+0)         ; get type.
    4336   00:B8E5  17                  		rla                 ; is this slot in use?
    4337   00:B8E6  38 07               		jr c,expld1         ; no, we can use it.
    4338   00:B8E8                      expld2:
    4339   00:B8E8  DD 19               		add ix,de           ; point to more shrapnel.
    4340   00:B8EA  10 F6               		djnz expld0         ; repeat for all shrapnel.
    4341   00:B8EC                      expld3:
    4342   00:B8EC  DD E1               		pop ix              ; restore sprite pointer.
    4343   00:B8EE  C9                  		ret                 ; out of slots, can't generate any more.
    4344   00:B8EF                      
    4345   00:B8EF                      expld1:
    4346   00:B8EF  79                  		ld a,c              ; shrapnel counter.
    4347   00:B8F0  E6 0F               		and 15              ; 0 to 15.
    4348   00:B8F2  85                  		add a,l             ; add to x.
    4349   00:B8F3  DD 77 03            		ld (ix+3),a         ; x coord.
    4350   00:B8F6  3A 4F 40            		ld a,(seed3)        ; crap random number.
    4351   00:B8F9  E6 0F               		and 15              ; 0 to 15.
    4352   00:B8FB  84                  		add a,h             ; add to y.
    4353   00:B8FC  DD 77 05            		ld (ix+5),a         ; y coord.
    4354   00:B8FF  DD 36 00 02         		ld (ix+0),2         ; switch it on.
    4355   00:B903  D9                  		exx                 ; store coordinates.
    4356   00:B904  CD 31 B7            		call chkxy          ; plot first position.
    4357   00:B907  CD 15 B9            		call qrand          ; quick random angle.
    4358   00:B90A  E6 3C               		and 60              ; keep within range.
    4359   00:B90C  DD 77 01            		ld (ix+1),a         ; angle.
    4360   00:B90F  D9                  		exx                 ; restore coordinates.
    4361   00:B910  0D                  		dec c               ; one less piece of shrapnel to generate.
    4362   00:B911  20 D5               		jr nz,expld2        ; back to main explosion loop.
    4363   00:B913  18 D7               		jr expld3           ; restore sprite pointer and exit.
    4364   00:B915                      qrand:
    4365   00:B915  3A 4F 40            		ld a,(seed3)        ; random seed.
    4366   00:B918  6F                  		ld l,a              ; low byte.
    4367   00:B919  26 00               		ld h,0              ; no high byte.
    4368   00:B91B  ED 5F               		ld a,r              ; r register.
    4369   00:B91D  AE                  		xor (hl)            ; combine with seed.
    4370   00:B91E  32 4F 40            		ld (seed3),a        ; new seed.
    4371   00:B921  C9                  		ret
    4372   00:B922                      
    4373   00:B922                      ; Display all shrapnel.
    4374   00:B922                      
    4375   00:B922                      dshrp:
    4376   00:B922  21 E9 B7            		ld hl,plotde        ; display routine.
    4377   00:B925  22 17 40            		ld (shrplot),hl
    4378   00:B928                      		; ld (proshx+1),hl    ; modify routine.		
    4379   00:B928                      		
    4380   00:B928  AF                  		xor a
    4381   00:B929  CD D8 B6            		call setshr0
    4382   00:B92C  CD A4 B6            		call proshrnoset    ; process even shrapnel.
    4383   00:B92F  3E 01               		ld a,1
    4384   00:B931  CD D8 B6            		call setshr0
    4385   00:B934  CD A4 B6            		call proshrnoset    ; process odd shrapnel.
    4386   00:B937                      		
    4387   00:B937  21 E9 B6            		ld hl,prosh1        ; processing routine.
    4388   00:B93A  22 17 40            		ld (shrplot),hl
    4389   00:B93D                      		; ld (proshx+1),hl    ; modify the call.
    4390   00:B93D                      		
    4391   00:B93D  C9                  		ret
    4392   00:B93E                      
    4393   00:B93E                      ; Deletes all shrapnel
    4394   00:B93E                      
    4395   00:B93E                      delshr: 
    4396   00:B93E  DD 21 C2 4D         		ld ix,SHRAPN        ; table.
    4397   00:B942  06 36               		ld b,NUMSHR         ; shrapnel pieces to process.
    4398   00:B944                      		; ld d,0				; plot needs this initially		
    4399   00:B944                      .loop:
    4400   00:B944  DD 7E 00            		ld a,(ix+0)         ; on/off marker.
    4401   00:B947  17                  		rla
    4402   00:B948  38 05               		jr c,.noshr
    4403   00:B94A  C5                  		push bc             ; store counter.
    4404   00:B94B  CD 58 B7            		call plot           ; delete the pixel.
    4405   00:B94E  C1                  		pop bc              ; restore counter.
    4406   00:B94F                      .noshr:		
    4407   00:B94F  11 09 00            		ld de,SHRSIZ        ; distance to next.
    4408   00:B952  DD 19               		add ix,de           ; point there.
    4409   00:B954  10 EE               		djnz .loop         ; round again.
    4410   00:B956  C9                  		ret
    4411   00:B957                      
    4412   00:B957                      inishr:	
    4413   00:B957  21 C2 4D            		ld hl,SHRAPN        ; table.
    4414   00:B95A  11 C3 4D            		ld de,SHRAPN+1        ; distance to next.
    4415   00:B95D  36 FF               		ld (hl),255
    4416   00:B95F  01 E5 01            		ld bc,(NUMSHR*SHRSIZ)-1         ; shrapnel pieces to process.
    4417   00:B962  ED B0               		ldir 
    4418   00:B964  C9                  		ret
    4419   00:B965                      	   
    4420   00:B965                      ; Check for collision between laser and sprite.
    4421   00:B965                      
    4422   00:B965                      lcol:
    4423   00:B965  21 C2 4D            		ld hl,SHRAPN        ; shrapnel table.
    4424   00:B968  11 09 00            		ld de,SHRSIZ        ; size of each particle.
    4425   00:B96B  06 36               		ld b,NUMSHR         ; number of pieces in table.
    4426   00:B96D                      .loop:
    4427   00:B96D  7E                  		ld a,(hl)           ; get type.
    4428   00:B96E  A7                  		and a               ; is this slot a laser?
    4429   00:B96F  28 04               		jr z,.chkcol          ; yes, check collision.
    4430   00:B971                      .nxtshr:
    4431   00:B971  19                  		add hl,de           ; point to more shrapnel.
    4432   00:B972  10 F9               		djnz .loop          ; repeat for all shrapnel.
    4433   00:B974  C9                  		ret                 ; no collision, carry not set.
    4434   00:B975                      .chkcol:
    4435   00:B975  E5                  		push hl             ; store pointer to laser.
    4436   00:B976  23                  		inc hl              ; direction.
    4437   00:B977  23                  		inc hl              ; not used.
    4438   00:B978  23                  		inc hl              ; x position.
    4439   00:B979  7E                  		ld a,(hl)           ; get x.
    4440   00:B97A  DD 96 03            		sub (ix+X)          ; subtract sprite x.
    4441   00:B97D                      ;lcolh:
    4442   00:B97D  FE 10               		cp 16               ; within range?
    4443   00:B97F  30 0A               		jr nc,.missed         ; no, missed.
    4444   00:B981  23                  		inc hl              ; not used.
    4445   00:B982  23                  		inc hl              ; y position.
    4446   00:B983  7E                  		ld a,(hl)           ; get y.
    4447   00:B984  DD 96 04            		sub (ix+Y)          ; subtract sprite y.
    4448   00:B987  FE 10               		cp 16               ; within range?
    4449   00:B989  38 03               		jr c,.exit          ; yes, collision occurred.
    4450   00:B98B                      .missed:
    4451   00:B98B  E1                  		pop hl              ; restore laser pointer from stack.
    4452   00:B98C  18 E3               		jr .nxtshr
    4453   00:B98E                      .exit:
    4454   00:B98E  E1                  		pop hl              ; restore laser pointer.
    4455   00:B98F  C9                  		ret                 ; return with carry set for collision.
    4456   00:B990                      
    4457   00:B990                      	endif
    4458   00:B990                      	
    4459   00:B990                      ; Main game engine code starts here.
    4460   00:B990                      
    4461   00:B990                      game:
    4462   00:B990                      
    4463   00:B990                      	if PFLAG
    4464   00:B990  CD 57 B9            		call inishr         ; initialise particle engine.
    4465   00:B993                      	endif
    4466   00:B993                      evintr:
    4467   00:B993  F3                  	di
    4468   00:B994  CD AD 8E            		call evnt12         ; call intro/menu event.
    4469   00:B997                      
    4470   00:B997  21 00 46            		ld hl,MAP           ; block properties.
    4471   00:B99A  0E 03               		ld c,3     			; 3 * 256 bytes
    4472   00:B99C  3E 02               		ld a,WALL			; fill value
    4473   00:B99E  CD DF C6            		call fastfill
    4474   00:B9A1                      
    4475   00:B9A1                      	if OFLAG
    4476   00:B9A1  CD CE C6            		call clrobjlst
    4477   00:B9A4                      	endif
    4478   00:B9A4  CD D8 C6            		call clrscrmap
    4479   00:B9A7                      
    4480   00:B9A7                      	if OFLAG
    4481   00:B9A7  CD D7 B5            		call iniob          ; initialise objects.
    4482   00:B9AA                      	endif
    4483   00:B9AA  AF                  		xor a               ; put zero in accumulator.
    4484   00:B9AB  32 53 40            		ld (gamwon),a       ; reset game won flag.
    4485   00:B9AE                      
    4486   00:B9AE  21 00 40            		ld hl,score         ; score.
    4487   00:B9B1  CD D3 BA            		call inisc          ; init the score.
    4488   00:B9B4                      mapst:
    4489   00:B9B4  3A A1 80            		ld a,(stmap)        ; start position on map.
    4490   00:B9B7  32 4C 40            		ld (roomtb),a       ; set up position in table, if there is one.
    4491   00:B9BA                      inipbl:
    4492   00:B9BA                      	if AFLAG
    4493   00:B9BA                    ~ 		ld hl,eop          ; reset blockpointer
    4494   00:B9BA                    ~ 		; ld (pbptr+1),hl
    4495   00:B9BA                    ~ 		ld (pblkptr),hl
    4496   00:B9BA                    ~ 	endif
    4497   00:B9BA                       
    4498   00:B9BA  CD 5E C4            		call initsc         ; set up first screen.
    4499   00:B9BD  DD 21 A3 40         		ld ix,ssprit        ; default to spare sprite in table.
    4500   00:B9C1                      evini:  
    4501   00:B9C1                      
    4502   00:B9C1  CD 0D 90            		call evnt13         ; initialisation. (GAMEINIT)
    4503   00:B9C4                      
    4504   00:B9C4                      ; Two restarts.
    4505   00:B9C4                      ; First restart - clear all sprites and initialise everything.
    4506   00:B9C4                      
    4507   00:B9C4                      rstrt:
    4508   00:B9C4  CD 8E BA            		call rsevt          ; restart events (evnt14 - RESTARTSCREEN).
    4509   00:B9C7  CD B8 B5            		call xspr           ; clear sprite table.
    4510   00:B9CA  CD B6 C5            		call sprlst         ; fetch pointer to screen sprites.
    4511   00:B9CD  CD E5 C5            		call ispr           ; initialise sprite table.
    4512   00:B9D0  18 0F               		jr rstrt0
    4513   00:B9D2                      
    4514   00:B9D2                      ; Second restart - clear all but player, and don't initialise him.
    4515   00:B9D2                      
    4516   00:B9D2                      rstrtn:
    4517   00:B9D2  CD 8E BA            		call rsevt          ; restart events (evnt14 - RESTARTSCREEN).
    4518   00:B9D5  CD CD C5            		call nspr           ; clear all non-player sprites.
    4519   00:B9D8  CD C9 B5            		call xspr0
    4520   00:B9DB  CD B6 C5            		call sprlst         ; fetch pointer to screen sprites.
    4521   00:B9DE  CD 0A C6            		call kspr           ; initialise sprite table, no more players.
    4522   00:B9E1                      
    4523   00:B9E1                      ; Set up the player and/or enemy sprites.
    4524   00:B9E1                      
    4525   00:B9E1                      rstrt0: 
    4526   00:B9E1  AF                  		xor a               ; zero in accumulator.
    4527   00:B9E2  32 50 40            		ld (nexlev),a       ; reset next level flag.
    4528   00:B9E5  32 51 40            		ld (restfl),a       ; reset restart flag.
    4529   00:B9E8  32 52 40            		ld (deadf),a        ; reset dead flag.
    4530   00:B9EB                      		; ld (nohide),a		; enable screen hiding		
    4531   00:B9EB                      		
    4532   00:B9EB                      	if PFLAG
    4533   00:B9EB  CD 3E B9            		call delshr			; erases all particles from screen
    4534   00:B9EE                      	endif
    4535   00:B9EE                      	if OFLAG
    4536   00:B9EE  CD F8 BB            		call robjs			; removes all present objects from screen
    4537   00:B9F1                      	endif
    4538   00:B9F1  CD B5 BE            		call droom          ; show screen layout.
    4539   00:B9F4                      rpblc0: 
    4540   00:B9F4                      	if AFLAG
    4541   00:B9F4                    ~ 		call rbloc          ; draw blocks for this screen
    4542   00:B9F4                    ~ 	endif
    4543   00:B9F4                      	if PFLAG
    4544   00:B9F4  CD 57 B9            		call inishr         ; initialise particle engine.
    4545   00:B9F7                      	endif
    4546   00:B9F7                      	if OFLAG
    4547   00:B9F7  CD FE BA            		call shwob          ; draw objects.
    4548   00:B9FA                      	endif
    4549   00:B9FA                      mloop:
    4550   00:B9FA  CD F2 B5            		call vsync          ; synchronise with display.
    4551   00:B9FD  CD 92 C3            		call dumpspr
    4552   00:BA00                      		
    4553   00:BA00                      	ifdef DEBUG
    4554   00:BA00                    ~ 		BORDER 9
    4555   00:BA00                    ~ 	endif
    4556   00:BA00                      	   
    4557   00:BA00  DD 21 A3 40         		ld ix,ssprit        ; point to spare sprite for spawning purposes.
    4558   00:BA04                      evlp1:  
    4559   00:BA04  CD D1 8D            		call evnt10         ; MAINLOOP1: called once per main loop.
    4560   00:BA07  CD 04 C2            		call pspr           ; process sprites.
    4561   00:BA0A                      		
    4562   00:BA0A                      ; Main loop events.
    4563   00:BA0A  DD 21 A3 40         		ld ix,ssprit        ; point to spare sprite for spawning purposes.
    4564   00:BA0E                      evlp2:  
    4565   00:BA0E                      	ifdef DEBUG
    4566   00:BA0E                    ~ 		BORDER 8
    4567   00:BA0E                    ~ 	endif
    4568   00:BA0E  CD 0B 8E            		call evnt11         ; MAINLOOP2: called once per main loop.
    4569   00:BA11                      	ifdef DEBUG
    4570   00:BA11                    ~ 		BORDER 14
    4571   00:BA11                    ~ 	endif
    4572   00:BA11                      		
    4573   00:BA11  DD 21 B4 40         		ld ix,sprtab
    4574   00:BA15  CD 5A C2            		call chkimg
    4575   00:BA18                      		
    4576   00:BA18  3A 50 40            		ld a,(nexlev)       ; finished level flag.
    4577   00:BA1B  A7                  		and a               ; has it been set?
    4578   00:BA1C  20 1E               		jr nz,newlev        ; yes, go to next level.
    4579   00:BA1E  3A 53 40            		ld a,(gamwon)       ; finished game flag.
    4580   00:BA21  A7                  		and a               ; has it been set?
    4581   00:BA22  20 28               		jr nz,evwon         ; yes, finish the game.
    4582   00:BA24  3A 51 40            		ld a,(restfl)       ; finished level flag.
    4583   00:BA27  3D                  		dec a               ; has it been set?
    4584   00:BA28  CA C4 B9            		jp z,rstrt          ; yes, go to next level.
    4585   00:BA2B  3D                  		dec a               ; has it been set?
    4586   00:BA2C  CA D2 B9            		jp z,rstrtn         ; yes, go to next level.
    4587   00:BA2F  3A 52 40            		ld a,(deadf)        ; dead flag.
    4588   00:BA32  A7                  		and a               ; is it non-zero?
    4589   00:BA33  20 1D               		jr nz,pdead         ; yes, player dead.
    4590   00:BA35                      		
    4591   00:BA35  21 4D 40            		ld hl,frmno         ; game frame.
    4592   00:BA38  34                  		inc (hl)            ; advance the frame.
    4593   00:BA39                      ; Back to start of main loop.
    4594   00:BA39                      qoff:	
    4595   00:BA39  C3 FA B9            		jp mloop            ; switched to a jp nz,mloop during test mode.
    4596   00:BA3C                      		
    4597   00:BA3C                      ;----------------------------------------------------------
    4598   00:BA3C                      ; Read blocks from list and update screen accordingly.
    4599   00:BA3C                      ;----------------------------------------------------------
    4600   00:BA3C                      
    4601   00:BA3C                      	if AFLAG
    4602   00:BA3C                    ~ 	
    4603   00:BA3C                    ~ rbloc:
    4604   00:BA3C                    ~ ;pbbuf:
    4605   00:BA3C                    ~ 		ld de,eop             ; check for last block
    4606   00:BA3C                    ~ rbloc2:
    4607   00:BA3C                    ~ 		; ld hl,(pbptr+1)
    4608   00:BA3C                    ~ 		ld hl,(pblkptr)
    4609   00:BA3C                    ~ 		or a
    4610   00:BA3C                    ~ 		sbc hl,de
    4611   00:BA3C                    ~ 		ret z
    4612   00:BA3C                    ~ rbloc1:
    4613   00:BA3C                    ~ 		ex de,hl
    4614   00:BA3C                    ~ 		ld a,(scno)
    4615   00:BA3C                    ~ 		cp (hl)                ;pbbuf
    4616   00:BA3C                    ~ 		jr nz,rbloc0
    4617   00:BA3C                    ~ 		push hl
    4618   00:BA3C                    ~ 		inc hl
    4619   00:BA3C                    ~ 		ld de,dispx
    4620   00:BA3C                    ~ 		ldi                    ;dispx
    4621   00:BA3C                    ~ 		ldi                    ;dispy
    4622   00:BA3C                    ~ 		ld a,(hl)
    4623   00:BA3C                    ~ 		call pattr2            ; draw block
    4624   00:BA3C                    ~ 		pop hl
    4625   00:BA3C                    ~ rbloc0:
    4626   00:BA3C                    ~ 		ld de,4
    4627   00:BA3C                    ~ 		add hl,de              ; point to next block
    4628   00:BA3C                    ~ 		ex de,hl
    4629   00:BA3C                    ~ 		jr rbloc2
    4630   00:BA3C                    ~     
    4631   00:BA3C                    ~ 	endif
    4632   00:BA3C                      
    4633   00:BA3C                      	
    4634   00:BA3C                      newlev:
    4635   00:BA3C  3A 41 40            		ld a,(scno)         ; current screen.
    4636   00:BA3F  21 87 97            		ld hl,numsc         ; total number of screens.
    4637   00:BA42  3C                  		inc a               ; next screen.
    4638   00:BA43  BE                  		cp (hl)             ; reached the limit?
    4639   00:BA44  30 06               		jr nc,evwon         ; yes, game finished.
    4640   00:BA46  32 41 40            		ld (scno),a         ; set new level number.
    4641   00:BA49  C3 C4 B9            		jp rstrt            ; restart, clearing all aliens.
    4642   00:BA4C                      evwon:
    4643   00:BA4C  CD BD 91            		call evnt18         ; game completed.
    4644   00:BA4F  C3 66 BA            		jp tidyup           ; tidy up and return to BASIC/calling routine.
    4645   00:BA52                      
    4646   00:BA52                      ; Player dead.
    4647   00:BA52                      
    4648   00:BA52                      pdead:
    4649   00:BA52  AF                  		xor a               ; zeroise accumulator.
    4650   00:BA53  32 52 40            		ld (deadf),a        ; reset dead flag.
    4651   00:BA56                      evdie:
    4652   00:BA56  CD 45 91            		call evnt16         ; death subroutine.
    4653   00:BA59  3A 45 40            		ld a,(numlif)       ; number of lives.
    4654   00:BA5C  A7                  		and a               ; reached zero yet?
    4655   00:BA5D  C2 C4 B9            		jp nz,rstrt         ; restart game.
    4656   00:BA60  CD 88 C2            		call dissprs
    4657   00:BA63  CD 58 91            		call evnt17         ; failure event.
    4658   00:BA66                      tidyup: 
    4659   00:BA66  21 06 40            		ld hl,hiscor        ; high score.
    4660   00:BA69  11 00 40            		ld de,score         ; player's score.
    4661   00:BA6C  06 06               		ld b,6              ; digits to check.
    4662   00:BA6E                      .tidyu2 
    4663   00:BA6E  1A                  		ld a,(de)           ; get score digit.
    4664   00:BA6F  BE                  		cp (hl)             ; are we larger than high score digit?
    4665   00:BA70  38 06               		jr c,tidyu0         ; high score is bigger.
    4666   00:BA72  20 07               		jr nz,tidyu1        ; score is greater, record new high score.
    4667   00:BA74  23                  		inc hl              ; next digit of high score.
    4668   00:BA75  13                  		inc de              ; next digit of score.
    4669   00:BA76  10 F6               		djnz .tidyu2         ; repeat for all digits.
    4670   00:BA78                      tidyu0:
    4671   00:BA78  C3 90 B9            		jp game
    4672   00:BA7B                      tidyu1:
    4673   00:BA7B  21 00 40            		ld hl,score         ; score.
    4674   00:BA7E  11 06 40            		ld de,hiscor        ; high score.
    4675   00:BA81  01 06 00            		ld bc,6             ; digits to copy.
    4676   00:BA84  ED B0               		ldir                ; copy score to high score.
    4677   00:BA86  CD 88 C2            		call dissprs
    4678   00:BA89  CD C7 91            		call evnt19         ; new high score event.
    4679   00:BA8C  18 EA               		jr tidyu0           ; tidy up.
    4680   00:BA8E                      
    4681   00:BA8E                      ; Restart event.
    4682   00:BA8E                      
    4683   00:BA8E                      rsevt:
    4684   00:BA8E  DD 21 A3 40         		ld ix,ssprit        ; default to spare element in table.
    4685   00:BA92                      evrs:
    4686   00:BA92  C3 72 90            		jp evnt14           ; call restart event.
    4687   00:BA95                      
    4688   00:BA95                      ; Copy number passed in a to string position bc, right-justified.
    4689   00:BA95                      
    4690   00:BA95  6F                  num2ch ld l,a              ; put accumulator in l.
    4691   00:BA96  26 00                      ld h,0              ; blank high byte of hl.
    4692   00:BA98  3E 20                      ld a,32             ; leading spaces.
    4693   00:BA9A  11 64 00            numdg3 ld de,100           ; hundreds column.
    4694   00:BA9D  CD AB BA                   call numdg          ; show digit.
    4695   00:BAA0  11 0A 00            numdg2 ld de,10            ; tens column.
    4696   00:BAA3  CD AB BA                   call numdg          ; show digit.
    4697   00:BAA6  F6 10                      or 16               ; last digit is always shown.
    4698   00:BAA8  11 01 00                   ld de,1             ; units column.
    4699   00:BAAB  E6 30               numdg  and 48              ; clear carry, clear digit.
    4700   00:BAAD  ED 52               numdg1 sbc hl,de           ; subtract from column.
    4701   00:BAAF  38 05                      jr c,numdg0         ; nothing to show.
    4702   00:BAB1  F6 10                      or 16               ; something to show, make it a digit.
    4703   00:BAB3  3C                         inc a               ; increment digit.
    4704   00:BAB4  18 F7                      jr numdg1           ; repeat until column is zero.
    4705   00:BAB6  19                  numdg0 add hl,de           ; restore total.
    4706   00:BAB7  FE 20                      cp 32               ; leading space?
    4707   00:BAB9  C8                         ret z               ; yes, don't write that.
    4708   00:BABA  02                         ld (bc),a           ; write digit to buffer.
    4709   00:BABB  03                         inc bc              ; next buffer position.
    4710   00:BABC  C9                         ret
    4711   00:BABD  6F                  num2dd ld l,a              ; put accumulator in l.
    4712   00:BABE  26 00                      ld h,0              ; blank high byte of hl.
    4713   00:BAC0  3E 20                      ld a,32             ; leading spaces.
    4714   00:BAC2  11 64 00                   ld de,100           ; hundreds column.
    4715   00:BAC5  CD AB BA                   call numdg          ; show digit.
    4716   00:BAC8  F6 10                      or 16               ; second digit is always shown.
    4717   00:BACA  18 D4                      jr numdg2
    4718   00:BACC  6F                  num2td ld l,a              ; put accumulator in l.
    4719   00:BACD  26 00                      ld h,0              ; blank high byte of hl.
    4720   00:BACF  3E 30                      ld a,48             ; leading spaces.
    4721   00:BAD1  18 C7                      jr numdg3
    4722   00:BAD3                      
    4723   00:BAD3  06 06               inisc  ld b,6              ; digits to initialise.
    4724   00:BAD5  36 30               inisc0 ld (hl),'0'         ; write zero digit.
    4725   00:BAD7  23                         inc hl              ; next column.
    4726   00:BAD8  10 FB                      djnz inisc0         ; repeat for all digits.
    4727   00:BADA  C9                         ret
    4728   00:BADB                      
    4729   00:BADB                      
    4730   00:BADB                      ; Multiply h by d and return in hl.
    4731   00:BADB                      
    4732   00:BADB                      imul:   
    4733   00:BADB  5A                  		ld e,d              ; HL = H * D
    4734   00:BADC  4C                  		ld c,h              ; make c first multiplier.
    4735   00:BADD                      imul0:
    4736   00:BADD  21 00 00            		ld hl,0             ; zeroise total.
    4737   00:BAE0  54                  		ld d,h              ; zeroise high byte.
    4738   00:BAE1  06 08               		ld b,8              ; repeat 8 times.
    4739   00:BAE3                      .loop:
    4740   00:BAE3  CB 19               		rr c                ; rotate rightmost bit into carry.
    4741   00:BAE5  30 02               		jr nc,.imul2         ; wasn't set.
    4742   00:BAE7  19                  		add hl,de           ; bit was set, so add de.
    4743   00:BAE8  A7                  		and a               ; reset carry.
    4744   00:BAE9                      .imul2:
    4745   00:BAE9  CB 13               		rl e                ; shift de 1 bit left.
    4746   00:BAEB  CB 12               		rl d
    4747   00:BAED  10 F4               		djnz .loop          ; repeat 8 times.
    4748   00:BAEF  C9                  		ret
    4749   00:BAF0                      
    4750   00:BAF0                      ; Divide d by e and return in d, remainder in a.
    4751   00:BAF0                      
    4752   00:BAF0                      idiv:
    4753   00:BAF0  AF                  		xor a
    4754   00:BAF1  06 08               		ld b,8              ; bits to shift.
    4755   00:BAF3                      .loop:
    4756   00:BAF3  CB 22               		sla d               ; multiply d by 2.
    4757   00:BAF5  17                  		rla                 ; shift carry into remainder.
    4758   00:BAF6  BB                  		cp e                ; test if e is smaller.
    4759   00:BAF7  38 02               		jr c,.nodiv          ; e is greater, no division this time.
    4760   00:BAF9  93                  		sub e               ; subtract it.
    4761   00:BAFA  14                  		inc d               ; rotate into d.
    4762   00:BAFB                      .nodiv:
    4763   00:BAFB  10 F6               		djnz .loop
    4764   00:BAFD  C9                  		ret
    4765   00:BAFE                      
    4766   00:BAFE                      	
    4767   00:BAFE                      	if OFLAG
    4768   00:BAFE                      
    4769   00:BAFE                      ; Objects handling.
    4770   00:BAFE                      ; 64 bytes for image
    4771   00:BAFE                      ; 3 for room, x and y
    4772   00:BAFE                      ; 3 for starting room, x and y.
    4773   00:BAFE                      ; 254 = disabled.
    4774   00:BAFE                      ; 255 = object in player's pockets.
    4775   00:BAFE                      
    4776   00:BAFE                      ; Show items present.
    4777   00:BAFE                      
    4778   00:BAFE                      	if DISTYPE=ROM
    4779   00:BAFE                      	
    4780   00:BAFE                      shwob:
    4781   00:BAFE  21 A8 4F            		ld hl,objatr        ; objects attribute table.		
    4782   00:BB01  3A 44 B5            		ld a,(numob)        ; number of objects in the game.
    4783   00:BB04  47                  		ld b,a              ; loop counter.
    4784   00:BB05                      .loop0:
    4785   00:BB05  C5                  		push bc             ; store count.
    4786   00:BB06  E5                  		push hl             ; store item pointer.
    4787   00:BB07  3A 44 B5            		ld a,(numob)
    4788   00:BB0A  90                  		sub b				; need to invert object counter
    4789   00:BB0B  32 46 40            		ld (curobj),a
    4790   00:BB0E  3A 41 40            		ld a,(scno)         ; current location.
    4791   00:BB11  BE                  		cp (hl)             ; same as an item?
    4792   00:BB12  CC 1E BB            		call z,dobj         ; yes, display object in colour.
    4793   00:BB15  E1                  		pop hl              ; restore pointer.
    4794   00:BB16  C1                  		pop bc              ; restore counter.
    4795   00:BB17  11 03 00            		ld de,ODTSIZ		; distance to next item.
    4796   00:BB1A  19                  		add hl,de           ; point to it.
    4797   00:BB1B  10 E8               		djnz .loop0         ; repeat for others.
    4798   00:BB1D  C9                  		ret
    4799   00:BB1E                      
    4800   00:BB1E                      	else
    4801   00:BB1E                    ~ 	
    4802   00:BB1E                    ~ shwob:
    4803   00:BB1E                    ~ 		ld hl,objdta        ; objects table.
    4804   00:BB1E                    ~ 		ld de,OBJSIZ-ODTSIZ ; distance to room number.
    4805   00:BB1E                    ~ 		add hl,de           ; point to room data.
    4806   00:BB1E                    ~ 		ld a,(numob)        ; number of objects in the game.
    4807   00:BB1E                    ~ 		ld b,a              ; loop counter.
    4808   00:BB1E                    ~ .loop0:
    4809   00:BB1E                    ~ 		push bc             ; store count.
    4810   00:BB1E                    ~ 		push hl             ; store item pointer.
    4811   00:BB1E                    ~ 		ld a,(numob)
    4812   00:BB1E                    ~ 		sub b				; need to invert object counter
    4813   00:BB1E                    ~ 		ld (curobj),a
    4814   00:BB1E                    ~ 		ld a,(scno)         ; current location.
    4815   00:BB1E                    ~ 		cp (hl)             ; same as an item?
    4816   00:BB1E                    ~ 		call z,dobj         ; yes, display object in colour.
    4817   00:BB1E                    ~ 		pop hl              ; restore pointer.
    4818   00:BB1E                    ~ 		pop bc              ; restore counter.
    4819   00:BB1E                    ~ 		ld de,OBJSIZ        ; distance to next item.
    4820   00:BB1E                    ~ 		add hl,de           ; point to it.
    4821   00:BB1E                    ~ 		djnz .loop0         ; repeat for others.
    4822   00:BB1E                    ~ 		ret
    4823   00:BB1E                    ~ 
    4824   00:BB1E                    ~ 	endif
    4825   00:BB1E                      
    4826   00:BB1E                      ; Display object.
    4827   00:BB1E                      ; hl must point to object's room number.
    4828   00:BB1E                      
    4829   00:BB1E                      	if DISTYPE=ROM
    4830   00:BB1E                      	
    4831   00:BB1E                      dobj:   
    4832   00:BB1E  23                  		inc hl						; point to y.
    4833   00:BB1F  11 54 40            		ld de,dispx         		; coordinates.
    4834   00:BB22  7E                  		ld a,(hl)
    4835   00:BB23  FE C0               		cp MSX_MAXCY+1
    4836   00:BB25  D0                  		ret nc						; don't draw if it's out of boundaries
    4837   00:BB26  ED A0               		ldi                 		; transfer y coord.
    4838   00:BB28  ED A0               		ldi                 		; transfer x too.
    4839   00:BB2A  CD 60 BB            		call objimg			; gets object image address in HL
    4840   00:BB2D                      putobj:
    4841   00:BB2D  E5                  		push hl             ; store object graphic address.
    4842   00:BB2E  CD B6 BB            		call wobj			; preserves visible object coords in list
    4843   00:BB31  CD A8 C3            		call scadd          ; get screen address in hl.
    4844   00:BB34  CB F4               		set 6,h				; set write permanently
    4845   00:BB36  7D                  		ld a,l
    4846   00:BB37  F3                  		di					;
    4847   00:BB38  D3 BF               		out (MSX_VDPCW),a
    4848   00:BB3A  7C                  		ld a,h
    4849   00:BB3B  FB                  		ei	
    4850   00:BB3C  D3 BF               		out (MSX_VDPCW),a   ;
    4851   00:BB3E  0E BE               		ld c,MSX_VDPDRW		
    4852   00:BB40  EB                  		ex de,hl            ; switch regs. DE=VRAM
    4853   00:BB41  E1                  		pop hl              ; restore graphic address. HL=graphics, DE=VRAM
    4854   00:BB42  CD 58 BB            		call putrow0		; 1st pattern row
    4855   00:BB45  14                  		inc d				; row increased
    4856   00:BB46  CD 50 BB            		call putrow			; 2nd pattern row
    4857   00:BB49  15                  		dec d				; back again to 1st row
    4858   00:BB4A  CB EA               		set 5,d				; point to color area
    4859   00:BB4C  CD 50 BB            		call putrow			; 1st color row
    4860   00:BB4F  14                  		inc d				; row increased and process color row
    4861   00:BB50                      putrow:
    4862   00:BB50  7B                  		ld a,e
    4863   00:BB51  F3                  		di					;
    4864   00:BB52  D3 BF               		out (MSX_VDPCW),a
    4865   00:BB54  7A                  		ld a,d
    4866   00:BB55  FB                  		ei	
    4867   00:BB56  D3 BF               		out (MSX_VDPCW),a   ;
    4868   00:BB58                      putrow0:
    4869   00:BB58  06 10               		ld b,16
    4870   00:BB5A                      .loop:
    4871   00:BB5A  ED A3               		outi
    4872   00:BB5C  C2 5A BB            		jp nz,.loop
    4873   00:BB5F  C9                  		ret
    4874   00:BB60                      ;
    4875   00:BB60                      ; calculates object image address from object number
    4876   00:BB60                      ;
    4877   00:BB60                      ; Input:
    4878   00:BB60                      ;	A = object number
    4879   00:BB60                      ; Output:
    4880   00:BB60                      ;	HL = object image address
    4881   00:BB60                      ;
    4882   00:BB60                      objimg:
    4883   00:BB60  16 00               		ld d,0
    4884   00:BB62  3A 46 40            		ld a,(curobj)
    4885   00:BB65  5F                  		ld e,a
    4886   00:BB66  0F                  		rrca
    4887   00:BB67  0F                  		rrca
    4888   00:BB68  6F                  		ld l,a			
    4889   00:BB69  E6 3F               		and $3F			
    4890   00:BB6B  67                  		ld h,a			
    4891   00:BB6C  7D                  		ld a,l			
    4892   00:BB6D  E6 C0               		and $C0			
    4893   00:BB6F  6F                  		ld l,a			; n * 64
    4894   00:BB70  19                  		add hl,de
    4895   00:BB71  EB                  		ex de,hl		; DE=n*65
    4896   00:BB72  29                  		add hl,hl		; HL=n*2
    4897   00:BB73  19                  		add hl,de		; HL=n*65 + n*2
    4898   00:BB74  11 2F A7            		ld de,objdta+3
    4899   00:BB77  19                  		add hl,de		; point to image.		
    4900   00:BB78  C9                  		ret
    4901   00:BB79                      
    4902   00:BB79                      	else
    4903   00:BB79                    ~ 	
    4904   00:BB79                    ~ dobj:   
    4905   00:BB79                    ~ 		inc hl						; point to x.
    4906   00:BB79                    ~ 		ld de,dispx         		; coordinates.
    4907   00:BB79                    ~ 		ld a,(hl)
    4908   00:BB79                    ~ 		cp MSX_MAXCY+1
    4909   00:BB79                    ~ 		ret nc						; don't draw if it's out of boundaries
    4910   00:BB79                    ~ 		ldi                 		; transfer y coord.
    4911   00:BB79                    ~ 		ldi                 		; transfer x too.
    4912   00:BB79                    ~ 		ld de,-(OBJSIZ-(ODTSIZ/2))	; distance needed to restore image pointer.
    4913   00:BB79                    ~ 		add hl,de           		; point to image.
    4914   00:BB79                    ~ putobj:
    4915   00:BB79                    ~ 		push hl             ; store sprite graphic address.
    4916   00:BB79                    ~ 		call wobj			; preserves visible object coords in list
    4917   00:BB79                    ~ 		call scadd          ; get screen address in hl.
    4918   00:BB79                    ~ 		set 6,h
    4919   00:BB79                    ~ 		ld a,l
    4920   00:BB79                    ~ 		di					;
    4921   00:BB79                    ~ 		out (MSX_VDPCW),a
    4922   00:BB79                    ~ 		ld a,h
    4923   00:BB79                    ~ 		ei	
    4924   00:BB79                    ~ 		out (MSX_VDPCW),a   ;
    4925   00:BB79                    ~ 		ld c,MSX_VDPDRW		
    4926   00:BB79                    ~ 		ex de,hl            ; switch regs. DE=VRAM
    4927   00:BB79                    ~ 		pop hl              ; restore graphic address. HL=graphics, DE=VRAM
    4928   00:BB79                    ~ 		call putrow0		; 1st pattern row
    4929   00:BB79                    ~ 		inc d				; row increased
    4930   00:BB79                    ~ 		call putrow			; 2nd pattern row
    4931   00:BB79                    ~ 		dec d				; back again to 1st row
    4932   00:BB79                    ~ 		set 5,d				; point to color area
    4933   00:BB79                    ~ 		call putrow			; 1st color row
    4934   00:BB79                    ~ 		inc d				; row increased and process las color row
    4935   00:BB79                    ~ putrow:
    4936   00:BB79                    ~ 		ld a,e
    4937   00:BB79                    ~ 		di					;
    4938   00:BB79                    ~ 		out (MSX_VDPCW),a
    4939   00:BB79                    ~ 		ld a,d
    4940   00:BB79                    ~ 		ei	
    4941   00:BB79                    ~ 		out (MSX_VDPCW),a   ;
    4942   00:BB79                    ~ putrow0:
    4943   00:BB79                    ~ 		ld b,16
    4944   00:BB79                    ~ .loop:
    4945   00:BB79                    ~ 		outi
    4946   00:BB79                    ~ 		jp nz,.loop
    4947   00:BB79                    ~ 		ret
    4948   00:BB79                    ~ 
    4949   00:BB79                    ~ 	endif
    4950   00:BB79                      	
    4951   00:BB79                      	
    4952   00:BB79                      ; Remove an object (REMOVEOBJECT).
    4953   00:BB79                      
    4954   00:BB79                      remob:
    4955   00:BB79  21 44 B5            		ld hl,numob         ; number of objects in game.
    4956   00:BB7C  BE                  		cp (hl)             ; are we checking past the end?
    4957   00:BB7D  D0                  		ret nc              ; yes, can't get non-existent item.
    4958   00:BB7E  F5                  		push af             ; remember object.
    4959   00:BB7F  CD 89 BB            		call getob          ; pick it up if we haven't already got it.
    4960   00:BB82  F1                  		pop af              ; retrieve object number.
    4961   00:BB83  CD 70 BC            		call gotob          ; get its address.
    4962   00:BB86  36 FE               		ld (hl),254         ; remove it.
    4963   00:BB88  C9                  		ret
    4964   00:BB89                      
    4965   00:BB89                      ; Pick up object number held in the accumulator (GET).
    4966   00:BB89                      
    4967   00:BB89                      getob:  
    4968   00:BB89  32 46 40            		ld (curobj),a		; preserves object number
    4969   00:BB8C  21 44 B5            		ld hl,numob         ; number of objects in game.
    4970   00:BB8F  BE                  		cp (hl)             ; are we checking past the end?
    4971   00:BB90  D0                  		ret nc              ; yes, can't get non-existent item.
    4972   00:BB91  CD 70 BC            		call gotob          ; check if we already have it.
    4973   00:BB94  C8                  		ret z               ; we already do.
    4974   00:BB95  EB                  		ex de,hl            ; object address in de.
    4975   00:BB96  21 41 40            		ld hl,scno          ; current screen.
    4976   00:BB99  BE                  		cp (hl)             ; is it on this screen?
    4977   00:BB9A  EB                  		ex de,hl            ; object address back in hl.
    4978   00:BB9B  20 0B               		jr nz,.notinscr        ; not on screen, so nothing to delete.
    4979   00:BB9D  36 FF               		ld (hl),255         ; pick it up.
    4980   00:BB9F  2A 4B B5            		ld hl,(blkptr)      ; blocks.
    4981   00:BBA2  22 3E 40            		ld (grbase),hl      ; set graphics base.		
    4982   00:BBA5  C3 BE BB            		jp robj
    4983   00:BBA8                      .notinscr:
    4984   00:BBA8  36 FF               		ld (hl),255         ; pick it up.
    4985   00:BBAA  C9                  		ret
    4986   00:BBAB                      
    4987   00:BBAB                      ;
    4988   00:BBAB                      ; Returns pointers over dispx & object coords list
    4989   00:BBAB                      ; Input:
    4990   00:BBAB                      ;	curobj = object number
    4991   00:BBAB                      ; Output:
    4992   00:BBAB                      ;	HL = dispx
    4993   00:BBAB                      ;	DE = Object's pointer
    4994   00:BBAB                      ;
    4995   00:BBAB                      objptr:
    4996   00:BBAB  3A 46 40            		ld a,(curobj)
    4997   00:BBAE  87                  		add a,a
    4998   00:BBAF  5F                  		ld e,a
    4999   00:BBB0  16 49               		ld d,(objlist >> 8) & $FF
    5000   00:BBB2  21 54 40            		ld hl,dispx
    5001   00:BBB5  C9                  		ret
    5002   00:BBB6                      
    5003   00:BBB6                      ;
    5004   00:BBB6                      ; Stores current coords in object coords list
    5005   00:BBB6                      ; Input:
    5006   00:BBB6                      ;	curobj = object number
    5007   00:BBB6                      ; Output:
    5008   00:BBB6                      ;	None. Object's coords filled with dispx/y
    5009   00:BBB6                      ;
    5010   00:BBB6                      wobj:
    5011   00:BBB6  CD AB BB            		call objptr
    5012   00:BBB9  ED A0               		ldi
    5013   00:BBBB  ED A0               		ldi					; stores dispxy to objects coords list
    5014   00:BBBD  C9                  		ret
    5015   00:BBBE                      
    5016   00:BBBE                      ;
    5017   00:BBBE                      ; Removes object from objects list restoring background		
    5018   00:BBBE                      ;		
    5019   00:BBBE                      ; Input:
    5020   00:BBBE                      ; 	curobj = object number to delete
    5021   00:BBBE                      ; Output:
    5022   00:BBBE                      ;	None. Object's coords erased with $FF
    5023   00:BBBE                      ; Modifies: All
    5024   00:BBBE                      ;		
    5025   00:BBBE                      robj:
    5026   00:BBBE  CD AB BB            		call objptr
    5027   00:BBC1  1A                  		ld a,(de)			
    5028   00:BBC2  FE FF               		cp 255
    5029   00:BBC4  C8                  		ret z				; if dispx=255, there's no object displayed
    5030   00:BBC5  EB                  		ex de,hl	
    5031   00:BBC6  ED A0               		ldi				
    5032   00:BBC8  ED A0               		ldi					; restores to dispxy stored objects coords
    5033   00:BBCA  2B                  		dec hl
    5034   00:BBCB  2B                  		dec hl
    5035   00:BBCC  36 FF               		ld (hl),255			; clear stored dispx, object deleted
    5036   00:BBCE  CD A1 BD            		call gp2tp
    5037   00:BBD1  11 00 4A            		ld de,scrmap
    5038   00:BBD4  CD C3 BD            		call pradd
    5039   00:BBD7  19                  		add hl,de
    5040   00:BBD8  7E                  		ld a,(hl)			; gets old block from screen map buffer
    5041   00:BBD9  E5                  		push hl
    5042   00:BBDA  CD 57 BE            		call pchr
    5043   00:BBDD  E1                  		pop hl
    5044   00:BBDE  23                  		inc hl
    5045   00:BBDF  7E                  		ld a,(hl)
    5046   00:BBE0  E5                  		push hl
    5047   00:BBE1  CD 57 BE            		call pchr
    5048   00:BBE4  35                  		dec (hl)
    5049   00:BBE5  35                  		dec (hl)
    5050   00:BBE6  2B                  		dec hl
    5051   00:BBE7  34                  		inc (hl)
    5052   00:BBE8  E1                  		pop hl
    5053   00:BBE9  11 1F 00            		ld de,31
    5054   00:BBEC  19                  		add hl,de
    5055   00:BBED  7E                  		ld a,(hl)
    5056   00:BBEE  E5                  		push hl
    5057   00:BBEF  CD 57 BE            		call pchr
    5058   00:BBF2  E1                  		pop hl
    5059   00:BBF3  23                  		inc hl
    5060   00:BBF4  7E                  		ld a,(hl)
    5061   00:BBF5  C3 57 BE            		jp pchr
    5062   00:BBF8                      
    5063   00:BBF8                      ;
    5064   00:BBF8                      ; Removes all objects from objects list restoring background		
    5065   00:BBF8                      ;		
    5066   00:BBF8                      ; Input:
    5067   00:BBF8                      ; 	None
    5068   00:BBF8                      ; Output:
    5069   00:BBF8                      ;	None. All object's dispx in objects list erased with $FF		
    5070   00:BBF8                      		
    5071   00:BBF8                      robjs:
    5072   00:BBF8  2A 4B B5            		ld hl,(blkptr)      ; blocks.
    5073   00:BBFB  22 3E 40            		ld (grbase),hl      ; set graphics base.
    5074   00:BBFE  3A 44 B5            		ld a,(numob)
    5075   00:BC01  47                  		ld b,a
    5076   00:BC02                      .loop:
    5077   00:BC02  C5                  		push bc
    5078   00:BC03  78                  		ld a,b
    5079   00:BC04  3D                  		dec a
    5080   00:BC05  32 46 40            		ld (curobj),a
    5081   00:BC08  CD BE BB            		call robj			; erase object restoring bg
    5082   00:BC0B  C1                  		pop bc
    5083   00:BC0C  10 F4               		djnz .loop
    5084   00:BC0E  C9                  		ret
    5085   00:BC0F                      
    5086   00:BC0F                      ; Drop object number at (dispx, dispy).
    5087   00:BC0F                      
    5088   00:BC0F                      	if DISTYPE=ROM
    5089   00:BC0F                      
    5090   00:BC0F                      drpob:
    5091   00:BC0F  32 46 40            		ld (curobj),a		; preserves object number
    5092   00:BC12  21 44 B5            		ld hl,numob         ; number of objects in game.
    5093   00:BC15  BE                  		cp (hl)             ; are we checking past the end?
    5094   00:BC16  D0                  		ret nc              ; yes, can't drop non-existent item.
    5095   00:BC17  CD 70 BC            		call gotob          ; make sure object is in inventory.
    5096   00:BC1A  3A 41 40            		ld a,(scno)         ; screen number.
    5097   00:BC1D  BE                  		cp (hl)             ; already on this screen?
    5098   00:BC1E  C8                  		ret z               ; yes, nothing to do.
    5099   00:BC1F  77                  		ld (hl),a           ; bring onto screen.
    5100   00:BC20  23                  		inc hl              ; point to x coord.
    5101   00:BC21                      		
    5102   00:BC21  3A 54 40            		ld a,(dispx)        ; object y coordinate.
    5103   00:BC24  77                  		ld (hl),a           ; set y coord.
    5104   00:BC25  4F                  		ld c,a
    5105   00:BC26  23                  		inc hl              ; point to object x.
    5106   00:BC27  3A 55 40            		ld a,(dispy)        ; object x coordinate.
    5107   00:BC2A  77                  		ld (hl),a           ; set the x position.
    5108   00:BC2B  79                  		ld a,c
    5109   00:BC2C  FE C0               		cp MSX_MAXCY+1
    5110   00:BC2E  D0                  		ret nc				; don't draw object if it's out of boundaries
    5111   00:BC2F                      
    5112   00:BC2F  3A 46 40            		ld a,(curobj)
    5113   00:BC32  CD 60 BB            		call objimg
    5114   00:BC35  C3 2D BB            		jp putobj           ; draw object.
    5115   00:BC38                      
    5116   00:BC38                      	else
    5117   00:BC38                    ~ 	
    5118   00:BC38                    ~ drpob:
    5119   00:BC38                    ~ 		ld (curobj),a		; preserves object number
    5120   00:BC38                    ~ 		ld hl,numob         ; number of objects in game.
    5121   00:BC38                    ~ 		cp (hl)             ; are we checking past the end?
    5122   00:BC38                    ~ 		ret nc              ; yes, can't drop non-existent item.
    5123   00:BC38                    ~ 		call gotob          ; make sure object is in inventory.
    5124   00:BC38                    ~ 		ld a,(scno)         ; screen number.
    5125   00:BC38                    ~ 		cp (hl)             ; already on this screen?
    5126   00:BC38                    ~ 		ret z               ; yes, nothing to do.
    5127   00:BC38                    ~ 		ld (hl),a           ; bring onto screen.
    5128   00:BC38                    ~ 		inc hl              ; point to x coord.
    5129   00:BC38                    ~ 		
    5130   00:BC38                    ~ 		ld a,(dispx)        ; object y coordinate.
    5131   00:BC38                    ~ 		ld (hl),a           ; set y coord.
    5132   00:BC38                    ~ 		ld c,a
    5133   00:BC38                    ~ 		inc hl              ; point to object x.
    5134   00:BC38                    ~ 		ld a,(dispy)        ; object x coordinate.
    5135   00:BC38                    ~ 		ld (hl),a           ; set the x position.
    5136   00:BC38                    ~ 		ld a,c
    5137   00:BC38                    ~ 		cp MSX_MAXCY+1
    5138   00:BC38                    ~ 		ret nc				; don't draw object if it's out of boundaries
    5139   00:BC38                    ~ 		
    5140   00:BC38                    ~ 		ld de,-66           ; minus graphic size.
    5141   00:BC38                    ~ 		add hl,de           ; point to graphics.
    5142   00:BC38                    ~ 		jp putobj           ; draw object.
    5143   00:BC38                    ~ 
    5144   00:BC38                    ~ 	endif
    5145   00:BC38                      	
    5146   00:BC38                      
    5147   00:BC38                      ; Seek objects at sprite position.
    5148   00:BC38                      
    5149   00:BC38                      	if DISTYPE=ROM
    5150   00:BC38                      	
    5151   00:BC38                      skobj:
    5152   00:BC38  11 03 00            		ld de,ODTSIZ        ; size of each object.
    5153   00:BC3B  21 A8 4F            		ld hl,objatr
    5154   00:BC3E  3A 44 B5            		ld a,(numob)        ; number of objects in game.
    5155   00:BC41  47                  		ld b,a              ; set up the loop counter.
    5156   00:BC42                      .sk0: 
    5157   00:BC42  3A 41 40            		ld a,(scno)         ; current room number.
    5158   00:BC45  BE                  		cp (hl)             ; is object in here?
    5159   00:BC46  CC 4F BC            		call z,.sk1       	; yes, check coordinates.
    5160   00:BC49  19                  		add hl,de           ; point to next object in table.
    5161   00:BC4A  10 F6               		djnz .sk0         	; repeat for all objects.
    5162   00:BC4C  3E FF               		ld a,255            ; end of list and nothing found, return 255.
    5163   00:BC4E  C9                  		ret
    5164   00:BC4F                      .sk1: 
    5165   00:BC4F  23                  		inc hl              ; point to y coordinate.
    5166   00:BC50  7E                  		ld a,(hl)           ; get coordinate.
    5167   00:BC51  DD 96 03            		sub (ix+3)          ; subtract sprite y.
    5168   00:BC54  C6 0F               		add a,MSX_SPRVS-1	; add sprite height minus one.
    5169   00:BC56  FE 1F               		cp MSX_SPRVS+16-1   ; within range?
    5170   00:BC58  D2 6E BC            		jp nc,.sk2        	; no, ignore object.
    5171   00:BC5B  23                  		inc hl              ; point to x coordinate now.
    5172   00:BC5C  7E                  		ld a,(hl)           ; get coordinate.
    5173   00:BC5D  DD 96 04            		sub (ix+4)          ; subtract the sprite x.
    5174   00:BC60  C6 0F               		add a,MSX_SPRHS-1   ; add sprite width minus one.
    5175   00:BC62  FE 1F               		cp MSX_SPRHS+16-1   ; within range?
    5176   00:BC64  D2 6D BC            		jp nc,.sk3        	; no, ignore object.
    5177   00:BC67  D1                  		pop de              ; remove return address from stack.
    5178   00:BC68  3A 44 B5            		ld a,(numob)        ; objects in game.
    5179   00:BC6B  90                  		sub b               ; subtract loop counter.
    5180   00:BC6C  C9                  		ret                 ; accumulator now points to object.
    5181   00:BC6D                      .sk3:
    5182   00:BC6D  2B                  		dec hl              ; back to y position.
    5183   00:BC6E                      .sk2:
    5184   00:BC6E  2B                  		dec hl              ; back to room.
    5185   00:BC6F  C9                  		ret
    5186   00:BC70                      
    5187   00:BC70                      	else
    5188   00:BC70                    ~ 	
    5189   00:BC70                    ~ skobj:
    5190   00:BC70                    ~ 		ld hl,objdta        ; pointer to objects.
    5191   00:BC70                    ~ 		ld de,OBJSIZ-ODTSIZ ; distance to room number.
    5192   00:BC70                    ~ 		add hl,de           ; point to room data.
    5193   00:BC70                    ~ 		ld de,OBJSIZ        ; size of each object.
    5194   00:BC70                    ~ 		ld a,(numob)        ; number of objects in game.
    5195   00:BC70                    ~ 		ld b,a              ; set up the loop counter.
    5196   00:BC70                    ~ .sk0: 
    5197   00:BC70                    ~ 		ld a,(scno)         ; current room number.
    5198   00:BC70                    ~ 		cp (hl)             ; is object in here?
    5199   00:BC70                    ~ 		call z,.sk1       	; yes, check coordinates.
    5200   00:BC70                    ~ 		add hl,de           ; point to next object in table.
    5201   00:BC70                    ~ 		djnz .sk0         	; repeat for all objects.
    5202   00:BC70                    ~ 		ld a,255            ; end of list and nothing found, return 255.
    5203   00:BC70                    ~ 		ret
    5204   00:BC70                    ~ .sk1: 
    5205   00:BC70                    ~ 		inc hl              ; point to x coordinate.
    5206   00:BC70                    ~ 		ld a,(hl)           ; get coordinate.
    5207   00:BC70                    ~ 		sub (ix+3)          ; subtract sprite x.
    5208   00:BC70                    ~ 		add a,15            ; add sprite height minus one.
    5209   00:BC70                    ~ 		cp 31               ; within range?
    5210   00:BC70                    ~ 		jp nc,.sk2        	; no, ignore object.
    5211   00:BC70                    ~ 		inc hl              ; point to y coordinate now.
    5212   00:BC70                    ~ 		ld a,(hl)           ; get coordinate.
    5213   00:BC70                    ~ 		sub (ix+4)          ; subtract the sprite y.
    5214   00:BC70                    ~ 		add a,15            ; add sprite width minus one.
    5215   00:BC70                    ~ 		cp 31               ; within range?
    5216   00:BC70                    ~ 		jp nc,.sk3        	; no, ignore object.
    5217   00:BC70                    ~ 		pop de              ; remove return address from stack.
    5218   00:BC70                    ~ 		ld a,(numob)        ; objects in game.
    5219   00:BC70                    ~ 		sub b               ; subtract loop counter.
    5220   00:BC70                    ~ 		ret                 ; accumulator now points to object.
    5221   00:BC70                    ~ .sk3:
    5222   00:BC70                    ~ 		dec hl              ; back to y position.
    5223   00:BC70                    ~ .sk2:
    5224   00:BC70                    ~ 		dec hl              ; back to room.
    5225   00:BC70                    ~ 		ret
    5226   00:BC70                    ~ 
    5227   00:BC70                    ~ 	endif
    5228   00:BC70                      	
    5229   00:BC70                      	endif
    5230   00:BC70                      	
    5231   00:BC70                      	if (OFLAG or MFLAG)
    5232   00:BC70                      		
    5233   00:BC70                      ;-----------------------------------------------------------------
    5234   00:BC70                      ; Got object check.
    5235   00:BC70                      ; Call with object in accumulator, returns zero set if in pockets.
    5236   00:BC70                      ;
    5237   00:BC70                      ; Input:
    5238   00:BC70                      ;  A = object number
    5239   00:BC70                      ;-----------------------------------------------------------------
    5240   00:BC70                      
    5241   00:BC70                      gotob:
    5242   00:BC70  21 44 B5            		ld hl,numob         ; number of objects in game.
    5243   00:BC73  BE                  		cp (hl)             ; are we checking past the end?
    5244   00:BC74  30 06               		jr nc,.gotob0       ; yes, we can't have a non-existent object.
    5245   00:BC76  CD 80 BC            		call findob         ; find the object.
    5246   00:BC79                      .gotob1:
    5247   00:BC79  FE FF               		cp 255              ; in pockets?
    5248   00:BC7B  C9                  		ret
    5249   00:BC7C                      .gotob0:
    5250   00:BC7C  3E FE               		ld a,254            ; missing.
    5251   00:BC7E  18 F9               		jr .gotob1
    5252   00:BC80                      
    5253   00:BC80                      ; Find object address
    5254   00:BC80                      
    5255   00:BC80                      	if DISTYPE=ROM
    5256   00:BC80                      	
    5257   00:BC80                      findob:
    5258   00:BC80  26 00               		ld h,0
    5259   00:BC82  6F                  		ld l,a
    5260   00:BC83  29                  		add hl,hl
    5261   00:BC84                      		ADD_HL_A
    5261   00:BC84  85                >   add a,l
    5261   00:BC85  6F                >   ld l,a
    5261   00:BC86  8C                >   adc a,h
    5261   00:BC87  95                >   sub l
    5261   00:BC88  67                >   ld h,a
    5262   00:BC89  11 A8 4F            		ld de,objatr
    5263   00:BC8C  19                  		add hl,de
    5264   00:BC8D  7E                  		ld a,(hl)
    5265   00:BC8E  C9                  		ret
    5266   00:BC8F                      
    5267   00:BC8F                      	else
    5268   00:BC8F                    ~ 	
    5269   00:BC8F                    ~ findob:
    5270   00:BC8F                    ~ 		ld hl,objdta        ; objects.
    5271   00:BC8F                    ~ 		ld de,OBJSIZ        ; size of each object (64+6)
    5272   00:BC8F                    ~ 		and a               ; is it zero?
    5273   00:BC8F                    ~ 		jr z,.fndob1        ; yes, skip loop.
    5274   00:BC8F                    ~ 		ld b,a              ; loop counter in b.
    5275   00:BC8F                    ~ .fndob2:
    5276   00:BC8F                    ~ 		add hl,de           ; point to next one.
    5277   00:BC8F                    ~ 		djnz .fndob2        ; repeat until we find address.
    5278   00:BC8F                    ~ .fndob1:
    5279   00:BC8F                    ~ 		ld e,OBJSIZ-ODTSIZ  ; distance to room it's in (0-63 obj.data, 64 room)
    5280   00:BC8F                    ~ 		add hl,de           ; point to room.
    5281   00:BC8F                    ~ 		ld a,(hl)           ; fetch status.
    5282   00:BC8F                    ~ 		ret
    5283   00:BC8F                    ~ 
    5284   00:BC8F                    ~ 	endif
    5285   00:BC8F                      	
    5286   00:BC8F                      	endif
    5287   00:BC8F                      
    5288   00:BC8F                      
    5289   00:BC8F                      ;
    5290   00:BC8F                      ; Fills a box of values 255 in screenmap
    5291   00:BC8F                      ;
    5292   00:BC8F                      ; Input:
    5293   00:BC8F                      ;	dispx: y coord (0-191)
    5294   00:BC8F                      ;	dispy: x coord (0-255)
    5295   00:BC8F                      ;	dirthig: height of the box
    5296   00:BC8F                      ;	dirthig+1: width of the box		
    5297   00:BC8F                      ; Output:
    5298   00:BC8F                      ; 	None. box is filled in scrmap
    5299   00:BC8F                      ; Modifies:
    5300   00:BC8F                      ;	None
    5301   00:BC8F                      ;
    5302   00:BC8F                      
    5303   00:BC8F                      /* dirtybox:
    5304   00:BC8F                    ~ 		push hl
    5305   00:BC8F                    ~ 		push de
    5306   00:BC8F                    ~ 		push bc
    5307   00:BC8F                    ~ 		ld de,scrmap
    5308   00:BC8F                    ~ 		call chradd
    5309   00:BC8F                    ~ 		add hl,de
    5310   00:BC8F                    ~ 		ld de,32
    5311   00:BC8F                    ~ 		ld bc,(dirthig)
    5312   00:BC8F                    ~ 		ld a,b
    5313   00:BC8F                    ~ .looprows:	
    5314   00:BC8F                    ~ 		push hl
    5315   00:BC8F                    ~ .loopcols:		
    5316   00:BC8F                    ~ 		ld (hl),255
    5317   00:BC8F                    ~ 		inc hl
    5318   00:BC8F                    ~ 		djnz .loopcols
    5319   00:BC8F                    ~ 		pop hl		
    5320   00:BC8F                    ~ 		add hl,de
    5321   00:BC8F                    ~ 		ld b,a		
    5322   00:BC8F                    ~ 		dec c
    5323   00:BC8F                    ~ 		jr nz,.looprows		
    5324   00:BC8F                    ~ 		pop bc
    5325   00:BC8F                    ~ 		pop de
    5326   00:BC8F                    ~ 		pop hl
    5327   00:BC8F                    ~ 		ret
    5328   00:BC8F                    ~  */	   
    5329   00:BC8F                      
    5330   00:BC8F                      ; Spawn a new sprite.
    5331   00:BC8F                      
    5332   00:BC8F                      spawn:
    5333   00:BC8F  21 B4 40            		ld hl,sprtab        ; sprite table.
    5334   00:BC92                      numsp1:
    5335   00:BC92  3E 20               		ld a,NUMSPR         ; number of sprites.
    5336   00:BC94  11 11 00            		ld de,TABSIZ        ; size of each entry.
    5337   00:BC97                      .nxtslot:
    5338   00:BC97  08                  		ex af,af            ; store loop counter.
    5339   00:BC98  7E                  		ld a,(hl)           ; get sprite type.
    5340   00:BC99  3C                  		inc a               ; is it an unused slot?
    5341   00:BC9A  28 05               		jr z,.spaw1         ; yes, we can use this one.
    5342   00:BC9C  19                  		add hl,de           ; point to next sprite in table.
    5343   00:BC9D  08                  		ex af,af            ; restore loop counter.
    5344   00:BC9E  3D                  		dec a               ; one less iteration.
    5345   00:BC9F  20 F6               		jr nz,.nxtslot      ; keep going until we find a slot.
    5346   00:BCA1                      ; Didn't find one but drop through and set up a dummy sprite instead.
    5347   00:BCA1                      .spaw1:
    5348   00:BCA1  DD E5               		push ix             ; existing sprite address on stack.
    5349   00:BCA3  22 3B 40            		ld (spptr),hl       ; store spawned sprite address.
    5350   00:BCA6  71                  		ld (hl),c           ; set the type.
    5351   00:BCA7  23                  		inc hl              ; point to image.
    5352   00:BCA8  70                  		ld (hl),b           ; set the image.
    5353   00:BCA9  23                  		inc hl              ; next byte.
    5354   00:BCAA                      
    5355   00:BCAA  78                  		ld a,b
    5356   00:BCAB  CD 82 C6            		call mapsprite
    5357   00:BCAE                      
    5358   00:BCAE  36 00               		ld (hl),0           ; frame zero.
    5359   00:BCB0  23                  		inc hl              ; next byte.
    5360   00:BCB1  DD 7E 03            		ld a,(ix+X)         ; x coordinate.
    5361   00:BCB4  77                  		ld (hl),a           ; set sprite coordinate.
    5362   00:BCB5  23                  		inc hl              ; next byte.
    5363   00:BCB6  DD 7E 04            		ld a,(ix+Y)         ; y coordinate.
    5364   00:BCB9  77                  		ld (hl),a           ; set sprite coordinate.
    5365   00:BCBA  23                  		inc hl              ; next byte.
    5366   00:BCBB                      
    5367   00:BCBB  DD 7E 05            		ld a,(ix+5)         ; color
    5368   00:BCBE  77                  		ld (hl),a           ; set sprite color.
    5369   00:BCBF  23                  		inc hl              ; next byte.
    5370   00:BCC0  23                  		inc hl
    5371   00:BCC1  23                  		inc hl
    5372   00:BCC2  DD 7E 03            		ld a,(ix+X)         ; x coordinate.
    5373   00:BCC5  77                  		ld (hl),a           ; set sprite coordinate.
    5374   00:BCC6  23                  		inc hl              ; next byte.
    5375   00:BCC7  DD 7E 04            		ld a,(ix+Y)         ; y coordinate.
    5376   00:BCCA  77                  		ld (hl),a           ; set sprite coordinate.
    5377   00:BCCB  23                  		inc hl              ; next byte.
    5378   00:BCCC                      
    5379   00:BCCC  DD 7E 0A            		ld a,(ix+10)        ; direction of original.
    5380   00:BCCF  77                  		ld (hl),a           ; set the direction.
    5381   00:BCD0  23                  		inc hl              ; next byte.
    5382   00:BCD1  06 00               		ld b,0
    5383   00:BCD3  70                  		ld (hl),b           ; reset parameter.
    5384   00:BCD4  23                  		inc hl              ; next byte.
    5385   00:BCD5  70                  		ld (hl),b           ; reset parameter.
    5386   00:BCD6  23                  		inc hl              ; next byte.
    5387   00:BCD7  70                  		ld (hl),b           ; reset parameter.
    5388   00:BCD8  23                  		inc hl              ; next byte.
    5389   00:BCD9  70                  		ld (hl),b           ; reset parameter.
    5390   00:BCDA                      rtssp:
    5391   00:BCDA  DD 2A 3B 40         		ld ix,(spptr)       ; address of new sprite.
    5392   00:BCDE                      evis1:
    5393   00:BCDE  CD 80 8D            		call evnt09         ; call sprite initialisation event.
    5394   00:BCE1  DD E1               		pop ix              ; address of original sprite.
    5395   00:BCE3                      
    5396   00:BCE3                      ;
    5397   00:BCE3                      ; Finds the highest used sprite slot
    5398   00:BCE3                      ;
    5399   00:BCE3                      
    5400   00:BCE3                      hslot:		
    5401   00:BCE3  3E FF               		ld a,255
    5402   00:BCE5  06 20               		ld b,NUMSPR
    5403   00:BCE7  11 EF FF            		ld de,-TABSIZ
    5404   00:BCEA  21 C3 42            		ld hl,sprtab+((NUMSPR-1)*TABSIZ)
    5405   00:BCED                      .nxtslot:
    5406   00:BCED  BE                  		cp (hl)
    5407   00:BCEE  20 03               		jr nz,.found
    5408   00:BCF0  19                  		add hl,de
    5409   00:BCF1  10 FA               		djnz .nxtslot
    5410   00:BCF3                      .found		
    5411   00:BCF3  78                  		ld a,b
    5412   00:BCF4  32 4B 40            		ld (highslot),a
    5413   00:BCF7  C9                  		ret
    5414   00:BCF8                      
    5415   00:BCF8                      checkx:
    5416   00:BCF8  7B                  		ld a,e              ; x position.
    5417   00:BCF9  FE 18               		cp MSX_MAXROWS      ; off screen?
    5418   00:BCFB  D8                  		ret c               ; no, it's okay.
    5419   00:BCFC  E1                  		pop hl              ; remove return address from stack.
    5420   00:BCFD  C9                  		ret
    5421   00:BCFE                      
    5422   00:BCFE                      ; Displays the current score. (MSX:OK)
    5423   00:BCFE                      
    5424   00:BCFE                      dscor:
    5425   00:BCFE  CD E8 C1            		call preprt         ; set up font and print position.
    5426   00:BD01  CD F8 BC            		call checkx         ; make sure we're in a printable range.
    5427   00:BD04  3A 38 40            		ld a,(prtmod)       ; get print mode.
    5428   00:BD07  A7                  		and a               ; standard size text?
    5429   00:BD08  C2 27 BD            		jp nz,bscor0        ; no, show double-height.
    5430   00:BD0B                      dscor0:
    5431   00:BD0B  C5                  		push bc             ; place counter onto the stack.
    5432   00:BD0C  E5                  		push hl
    5433   00:BD0D  7E                  		ld a,(hl)           ; fetch character.
    5434   00:BD0E  CD F7 BD            		call ptxt           ; display character.
    5435   00:BD11                      		
    5436   00:BD11  21 55 40            		ld hl,dispy         ; y coordinate.
    5437   00:BD14  34                  		inc (hl)            ; move along one.
    5438   00:BD15  E1                  		pop hl
    5439   00:BD16  23                  		inc hl              ; next score column.
    5440   00:BD17  C1                  		pop bc              ; retrieve character counter.
    5441   00:BD18  10 F1               		djnz dscor0         ; repeat for all digits.
    5442   00:BD1A  2A 4B B5            		ld hl,(blkptr)      ; blocks.
    5443   00:BD1D  22 3E 40            		ld (grbase),hl      ; set graphics base.
    5444   00:BD20                      dscor2:
    5445   00:BD20  2A 54 40            		ld hl,(dispx)       ; general coordinates.
    5446   00:BD23  22 35 40            		ld (charx),hl       ; set up display coordinates.
    5447   00:BD26  C9                  		ret
    5448   00:BD27                      
    5449   00:BD27                      ; Displays the current score in double-height characters.
    5450   00:BD27                      
    5451   00:BD27  C5                  bscor0 push bc             ; place counter onto the stack.
    5452   00:BD28  E5                         push hl
    5453   00:BD29  7E                         ld a,(hl)           ; fetch character.
    5454   00:BD2A  CD 67 C1                   call bchar          ; display big char.
    5455   00:BD2D  E1                         pop hl
    5456   00:BD2E  23                         inc hl              ; next score column.
    5457   00:BD2F  C1                         pop bc              ; retrieve character counter.
    5458   00:BD30  10 F5                      djnz bscor0         ; repeat for all digits.
    5459   00:BD32  C3 20 BD                   jp dscor2           ; tidy up line and column variables.
    5460   00:BD35                      
    5461   00:BD35                      ; Adds number in the hl pair to the score.
    5462   00:BD35                      
    5463   00:BD35  11 01 40            addsc  ld de,score+1       ; ten thousands column.
    5464   00:BD38  01 10 27                   ld bc,10000         ; amount to add each time.
    5465   00:BD3B  CD 57 BD                   call incsc          ; add to score.
    5466   00:BD3E  13                         inc de              ; thousands column.
    5467   00:BD3F  01 E8 03                   ld bc,1000          ; amount to add each time.
    5468   00:BD42  CD 57 BD                   call incsc          ; add to score.
    5469   00:BD45  13                         inc de              ; hundreds column.
    5470   00:BD46  01 64 00                   ld bc,100           ; amount to add each time.
    5471   00:BD49  CD 57 BD                   call incsc          ; add to score.
    5472   00:BD4C  13                         inc de              ; tens column.
    5473   00:BD4D  01 0A 00                   ld bc,10            ; amount to add each time.
    5474   00:BD50  CD 57 BD                   call incsc          ; add to score.
    5475   00:BD53  13                         inc de              ; units column.
    5476   00:BD54  01 01 00                   ld bc,1             ; units.
    5477   00:BD57  E5                  incsc  push hl             ; store amount to add.
    5478   00:BD58  A7                         and a               ; clear the carry flag.
    5479   00:BD59  ED 42                      sbc hl,bc           ; subtract from amount to add.
    5480   00:BD5B  38 09                      jr c,incsc0         ; too much, restore value.
    5481   00:BD5D  F1                         pop af              ; delete the previous amount from the stack.
    5482   00:BD5E  D5                         push de             ; store column position.
    5483   00:BD5F  CD 68 BD                   call incsc2         ; do the increment.
    5484   00:BD62  D1                         pop de              ; restore column.
    5485   00:BD63  C3 57 BD                   jp incsc            ; repeat until all added.
    5486   00:BD66  E1                  incsc0 pop hl              ; restore previous value.
    5487   00:BD67  C9                         ret
    5488   00:BD68  1A                  incsc2 ld a,(de)           ; get amount.
    5489   00:BD69  3C                         inc a               ; add one to column.
    5490   00:BD6A  12                         ld (de),a           ; write new column total.
    5491   00:BD6B  FE 3A                      cp '9'+1            ; gone beyond range of digits?
    5492   00:BD6D  D8                         ret c               ; no, carry on.
    5493   00:BD6E  3E 30                      ld a,'0'            ; mae it zero.
    5494   00:BD70  12                         ld (de),a           ; write new column total.
    5495   00:BD71  1B                         dec de              ; back one column.
    5496   00:BD72  18 F4                      jr incsc2
    5497   00:BD74                      
    5498   00:BD74                      ; Add bonus to score.
    5499   00:BD74                      
    5500   00:BD74  11 05 40            addbo  ld de,score+5       ; last score digit.
    5501   00:BD77  21 11 40                   ld hl,bonus+5       ; last bonus digit.
    5502   00:BD7A  A7                         and a               ; clear carry.
    5503   00:BD7B  01 30 06                   ld bc,6*256+48      ; 6 digits to add, ASCII '0' in c.
    5504   00:BD7E  1A                  addbo0 ld a,(de)           ; get score.
    5505   00:BD7F  8E                         adc a,(hl)          ; add bonus.
    5506   00:BD80  91                         sub c               ; 0 to 18.
    5507   00:BD81  71                         ld (hl),c           ; zeroise bonus.
    5508   00:BD82  2B                         dec hl              ; next bonus.
    5509   00:BD83  FE 3A                      cp 58               ; carried?
    5510   00:BD85  38 02                      jr c,addbo1         ; no, do next one.
    5511   00:BD87  D6 0A                      sub 10              ; subtract 10.
    5512   00:BD89  12                  addbo1 ld (de),a           ; write new score.
    5513   00:BD8A  1B                         dec de              ; next score digit.
    5514   00:BD8B  3F                         ccf                 ; set carry for next digit.
    5515   00:BD8C  10 F0                      djnz addbo0         ; repeat for all 6 digits.
    5516   00:BD8E  C9                         ret
    5517   00:BD8F                      
    5518   00:BD8F                      ; Swap score and bonus.
    5519   00:BD8F                      
    5520   00:BD8F  11 00 40            swpsb  ld de,score         ; first score digit.
    5521   00:BD92  21 0C 40                   ld hl,bonus         ; first bonus digit.
    5522   00:BD95  06 06                      ld b,6              ; digits to add.
    5523   00:BD97  1A                  swpsb0 ld a,(de)           ; get score and bonus digits.
    5524   00:BD98  4E                         ld c,(hl)
    5525   00:BD99  EB                         ex de,hl            ; swap pointers.
    5526   00:BD9A  71                         ld (hl),c           ; write bonus and score digits.
    5527   00:BD9B  12                         ld (de),a
    5528   00:BD9C  23                         inc hl              ; next score and bonus.
    5529   00:BD9D  13                         inc de
    5530   00:BD9E  10 F7                      djnz swpsb0         ; repeat for all 6 digits.
    5531   00:BDA0  C9                         ret
    5532   00:BDA1                      
    5533   00:BDA1                      ; Turns graphic coordinates to text ones
    5534   00:BDA1                      ; Input:
    5535   00:BDA1                      ;	None
    5536   00:BDA1                      ; Output:
    5537   00:BDA1                      ; 	dispx & dispy updated
    5538   00:BDA1                      gp2tp:
    5539   00:BDA1  3A 54 40            		ld a,(dispx)
    5540   00:BDA4  0F                  		rrca
    5541   00:BDA5  0F                  		rrca
    5542   00:BDA6  0F                  		rrca
    5543   00:BDA7  E6 1F               		and $1F			
    5544   00:BDA9  32 54 40            		ld (dispx),a	; stores y/8
    5545   00:BDAC  3A 55 40            		ld a,(dispy)
    5546   00:BDAF  0F                  		rrca
    5547   00:BDB0  0F                  		rrca
    5548   00:BDB1  0F                  		rrca
    5549   00:BDB2  E6 1F               		and $1F			
    5550   00:BDB4  32 55 40            		ld (dispy),a	; stores x/8
    5551   00:BDB7  C9                  		ret
    5552   00:BDB8                      		
    5553   00:BDB8                      ; Get print address.Returns VRAM address in DE (0000-17FF).
    5554   00:BDB8                      ; Requires: y(0-23), x(0-31)
    5555   00:BDB8                      ; Must NOT modify HL
    5556   00:BDB8                      
    5557   00:BDB8                      gprad:
    5558   00:BDB8  ED 5B 54 40         		ld de,(dispx)		; get y coord
    5559   00:BDBC  7A                  		ld a,d				; y*256
    5560   00:BDBD  87                  		add a,a				; get x coord
    5561   00:BDBE  87                  		add a,a				; 
    5562   00:BDBF  87                  		add a,a				; 
    5563   00:BDC0  53                  		ld d,e				; x*8
    5564   00:BDC1  5F                  		ld e,a				; (y*256)+(x*8)
    5565   00:BDC2  C9                  		ret		
    5566   00:BDC3                       
    5567   00:BDC3                      ; Get property buffer address of char at (dispx, dispy) in HL (0-767).
    5568   00:BDC3                      ; Requires: y(0-23), x(0-31)
    5569   00:BDC3                      
    5570   00:BDC3                      pradd:
    5571   00:BDC3  3A 54 40            		ld a,(dispx)        ; y coordinate.
    5572   00:BDC6  0F                  		rrca
    5573   00:BDC7  0F                  		rrca
    5574   00:BDC8  0F                  		rrca
    5575   00:BDC9  6F                  		ld l,a			
    5576   00:BDCA  E6 1F               		and $1F			
    5577   00:BDCC  67                  		ld h,a			
    5578   00:BDCD  7D                  		ld a,l			
    5579   00:BDCE  E6 E0               		and $E0			
    5580   00:BDD0  6F                  		ld l,a				; y * 32
    5581   00:BDD1  3A 55 40            		ld a,(dispy)    	; fetch x coordinate.
    5582   00:BDD4  E6 1F               		and $1F         	; should be in range 0 - 31.
    5583   00:BDD6                      		ADD_HL_A
    5583   00:BDD6  85                >   add a,l
    5583   00:BDD7  6F                >   ld l,a
    5583   00:BDD8  8C                >   adc a,h
    5583   00:BDD9  95                >   sub l
    5583   00:BDDA  67                >   ld h,a
    5584   00:BDDB  C9                  		ret		
    5585   00:BDDC                      
    5586   00:BDDC                      ; Get screen buffer address of char at (dispx, dispy) in hl (0-767).
    5587   00:BDDC                      ; Requires: y(0-191), x(0-255)
    5588   00:BDDC                      
    5589   00:BDDC                      chradd:
    5590   00:BDDC  3A 54 40            		ld a,(dispx)
    5591   00:BDDF  07                  		rlca                ; multiply char by 4.
    5592   00:BDE0  07                  		rlca
    5593   00:BDE1  6F                  		ld l,a              ; store shift in e.
    5594   00:BDE2  E6 03               		and 3               ; only want high byte bits.
    5595   00:BDE4  67                  		ld h,a              ; store in d.
    5596   00:BDE5  7D                  		ld a,l              ; restore shifted value.
    5597   00:BDE6  E6 FC               		and $FC             ; only want low byte bits.
    5598   00:BDE8  6F                  		ld l,a
    5599   00:BDE9  3A 55 40            		ld a,(dispy)
    5600   00:BDEC  E6 F8               		and $F8
    5601   00:BDEE  0F                  		rrca
    5602   00:BDEF  0F                  		rrca
    5603   00:BDF0  0F                  		rrca
    5604   00:BDF1                      		ADD_HL_A
    5604   00:BDF1  85                >   add a,l
    5604   00:BDF2  6F                >   ld l,a
    5604   00:BDF3  8C                >   adc a,h
    5604   00:BDF4  95                >   sub l
    5604   00:BDF5  67                >   ld h,a
    5605   00:BDF6  C9                  		ret
    5606   00:BDF7                      
    5607   00:BDF7                      ; print char pattern (without color) (MSX:OK)
    5608   00:BDF7                      ; A= char
    5609   00:BDF7                      ; dispy,dispx = x,y
    5610   00:BDF7                      ; fgclr,bgclr		
    5611   00:BDF7                      ptxt:
    5612   00:BDF7  07                  		rlca                ; find address for the font char
    5613   00:BDF8  07                  		rlca
    5614   00:BDF9  07                  		rlca				; multiply char code by 8.
    5615   00:BDFA  5F                  		ld e,a              ; store shift in e.
    5616   00:BDFB  E6 07               		and 7               ; only want high byte bits.
    5617   00:BDFD  57                  		ld d,a              ; store in d.
    5618   00:BDFE  7B                  		ld a,e              ; restore shifted value.
    5619   00:BDFF  E6 F8               		and 248             ; only want low byte bits.
    5620   00:BE01  5F                  		ld e,a              ; that's the low byte. DE=CHAR*8
    5621   00:BE02  2A 3E 40            		ld hl,(grbase)      ; address of graphics.
    5622   00:BE05  19                  		add hl,de           ; add displacement.
    5623   00:BE06  CD B8 BD            		call gprad          ; get screen address (in DE)
    5624   00:BE09                      		SETWRT de		
    5624   00:BE09                    >  ifdifi reg,de
    5624   00:BE09                    ~   ld a,l
    5624   00:BE09                    ~   di
    5624   00:BE09                    ~   out (MSX_VDPCW),a
    5624   00:BE09                    ~   ld a,h
    5624   00:BE09                    ~  else
    5624   00:BE09  7B                >   ld a,e
    5624   00:BE0A  F3                >   di
    5624   00:BE0B  D3 BF             >   out (MSX_VDPCW),a
    5624   00:BE0D  7A                >   ld a,d
    5624   00:BE0E                    >  endif
    5624   00:BE0E  F6 40             >   or $40
    5624   00:BE10  D3 BF             >   out (MSX_VDPCW),a
    5624   00:BE12  FB                >   ei
    5625   00:BE13  01 BE 08            		ld bc,8*256+MSX_VDPDRW
    5626   00:BE16                      ldirvm0:
    5627   00:BE16  ED A3               		outi				; writes pattern bytes
    5628   00:BE18  C2 16 BE            		jp nz,ldirvm0				
    5629   00:BE1B  7B                  		ld a,e
    5630   00:BE1C  F3                  		di					; 5
    5631   00:BE1D  D3 BF               		out (MSX_VDPCW),a
    5632   00:BE1F  7A                  		ld a,d
    5633   00:BE20  F6 60               		or $60				; color patterns + write
    5634   00:BE22  FB                  		ei	
    5635   00:BE23  D3 BF               		out (MSX_VDPCW),a   ; (51)
    5636   00:BE25  06 08               		ld b,8
    5637   00:BE27  3A 39 40            		ld a,(clratt)
    5638   00:BE2A                      .nxtrow:
    5639   00:BE2A  D3 BE               		out (MSX_VDPDRW),a	; writes color bytes
    5640   00:BE2C  10 FC               		djnz .nxtrow
    5641   00:BE2E  C9                  		ret
    5642   00:BE2F                      		
    5643   00:BE2F                      ; Print block with attributes, properties and pixels (saves block if adventure mode).
    5644   00:BE2F                      
    5645   00:BE2F                      pattr:
    5646   00:BE2F                      		if AFLAG
    5647   00:BE2F                    ~ 		call wbloc          ; save blockinfo	   
    5648   00:BE2F                    ~ 		endif
    5649   00:BE2F                      
    5650   00:BE2F                      ; Print block with attributes, properties and pixels (no saving).
    5651   00:BE2F                      		
    5652   00:BE2F                      pattr2:
    5653   00:BE2F  47                  		ld b,a              ; store cell in b register for now.
    5654   00:BE30  2A 4D B5            		ld hl,(proptr)      ; pointer to properties.
    5655   00:BE33                      		ADD_HL_A
    5655   00:BE33  85                >   add a,l
    5655   00:BE34  6F                >   ld l,a
    5655   00:BE35  8C                >   adc a,h
    5655   00:BE36  95                >   sub l
    5655   00:BE37  67                >   ld h,a
    5656   00:BE38  4E                  		ld c,(hl)           ; fetch byte.
    5657   00:BE39  79                  		ld a,c              ; put into accumulator.
    5658   00:BE3A  FE 08               		cp COLECT           ; is it a collectable?
    5659   00:BE3C  C2 43 BE            		jp nz,pattr1        ; no, carry on as normal.
    5660   00:BE3F  78                  		ld a,b              ; restore cell.
    5661   00:BE40  32 37 40            		ld (colpat),a       ; store collectable block.
    5662   00:BE43                      pattr1:
    5663   00:BE43  11 00 46            		ld de,MAP
    5664   00:BE46  CD C3 BD            		call pradd          ; get property buffer address.
    5665   00:BE49  E5                  		push hl
    5666   00:BE4A  19                  		add hl,de
    5667   00:BE4B  71                  		ld (hl),c           ; write property.		
    5668   00:BE4C  11 00 4A            		ld de,scrmap		; screen buffer
    5669   00:BE4F  E1                  		pop hl
    5670   00:BE50  19                  		add hl,de
    5671   00:BE51  7E                  		ld a,(hl)
    5672   00:BE52  B8                  		cp b
    5673   00:BE53  28 38               		jr z, pattrnxt		; skip printing char
    5674   00:BE55  70                   		ld (hl),b		
    5675   00:BE56  78                  		ld a,b              ; restore block number.
    5676   00:BE57                      
    5677   00:BE57                      ; Print block.
    5678   00:BE57                      pchr:
    5679   00:BE57  07                  		rlca                ; find address for the block 
    5680   00:BE58  07                  		rlca
    5681   00:BE59  07                  		rlca
    5682   00:BE5A  07                  		rlca				; multiply block code by 16
    5683   00:BE5B  5F                  		ld e,a              ; store shift in e.
    5684   00:BE5C  E6 0F               		and $0F             ; only want high byte bits.
    5685   00:BE5E  57                  		ld d,a              ; store in d.
    5686   00:BE5F  7B                  		ld a,e              ; restore shifted value.
    5687   00:BE60  E6 F0               		and $F0             ; only want low byte bits.
    5688   00:BE62  5F                  		ld e,a              ; that's the low byte. DE=CHAR*8
    5689   00:BE63  2A 3E 40            		ld hl,(grbase)      ; address of graphics.
    5690   00:BE66  19                  		add hl,de           ; add displacement.
    5691   00:BE67  CD B8 BD            		call gprad          ; get screen address (in DE)
    5692   00:BE6A                      		SETWRT de
    5692   00:BE6A                    >  ifdifi reg,de
    5692   00:BE6A                    ~   ld a,l
    5692   00:BE6A                    ~   di
    5692   00:BE6A                    ~   out (MSX_VDPCW),a
    5692   00:BE6A                    ~   ld a,h
    5692   00:BE6A                    ~  else
    5692   00:BE6A  7B                >   ld a,e
    5692   00:BE6B  F3                >   di
    5692   00:BE6C  D3 BF             >   out (MSX_VDPCW),a
    5692   00:BE6E  7A                >   ld a,d
    5692   00:BE6F                    >  endif
    5692   00:BE6F  F6 40             >   or $40
    5692   00:BE71  D3 BF             >   out (MSX_VDPCW),a
    5692   00:BE73  FB                >   ei
    5693   00:BE74  01 BE 08            		ld bc,8*256+MSX_VDPDRW
    5694   00:BE77                      .ldirvm0:
    5695   00:BE77  ED A3               		outi
    5696   00:BE79  C2 77 BE            		jp nz,.ldirvm0		
    5697   00:BE7C  7B                  		ld a,e
    5698   00:BE7D  F3                  		di					; 5
    5699   00:BE7E  D3 BF               		out (MSX_VDPCW),a
    5700   00:BE80  7A                  		ld a,d
    5701   00:BE81  F6 60               		or $60				; color patterns + write
    5702   00:BE83  FB                  		ei	
    5703   00:BE84  D3 BF               		out (MSX_VDPCW),a   ; (51)
    5704   00:BE86  06 08               		ld b,8
    5705   00:BE88                      .loop:
    5706   00:BE88  ED A3               		outi
    5707   00:BE8A  C2 88 BE            		jp nz,.loop
    5708   00:BE8D                      pattrnxt:		
    5709   00:BE8D  21 55 40            		ld hl,dispy         ; x coordinate.
    5710   00:BE90  34                  		inc (hl)            ; move along one.
    5711   00:BE91  C9                  		ret
    5712   00:BE92                      
    5713   00:BE92                      ;----------------------------------------------
    5714   00:BE92                      ; Write block
    5715   00:BE92                      ;----------------------------------------------
    5716   00:BE92                      
    5717   00:BE92                      		if AFLAG
    5718   00:BE92                    ~ wbloc:
    5719   00:BE92                    ~ 		ld de,(pblkptr)
    5720   00:BE92                    ~         ld hl,scno
    5721   00:BE92                    ~         ldi                ; write screen.
    5722   00:BE92                    ~         ld hl,dispx
    5723   00:BE92                    ~         ldi                ; write x position of block.
    5724   00:BE92                    ~         ldi                ; write y position of block.
    5725   00:BE92                    ~         ld (de),a          ; store block number
    5726   00:BE92                    ~         inc de
    5727   00:BE92                    ~ 		
    5728   00:BE92                    ~ 		ld (pblkptr),de
    5729   00:BE92                    ~         ret
    5730   00:BE92                    ~ 		endif
    5731   00:BE92                      	   
    5732   00:BE92                      ; Get room address.
    5733   00:BE92                      
    5734   00:BE92                      groom:
    5735   00:BE92  3A 41 40            		ld a,(scno)         ; screen number.
    5736   00:BE95                      groomx:
    5737   00:BE95  11 00 00            		ld de,0             ; start at zero.
    5738   00:BE98  2A 4F B5            		ld hl,(scrptr)      ; pointer to screens.
    5739   00:BE9B                      groom1:
    5740   00:BE9B  4E                  		ld c,(hl)           ; low byte of screen size.
    5741   00:BE9C  23                  		inc hl              ; point to high byte.
    5742   00:BE9D  46                  		ld b,(hl)           ; high byte of screen size.
    5743   00:BE9E  23                  		inc hl              ; next address.
    5744   00:BE9F  A7                  		and a               ; is it the first one?
    5745   00:BEA0  28 06               		jr z,groom0         ; no more screens to skip.
    5746   00:BEA2  EB                  		ex de,hl            ; put total in hl, pointer in de.
    5747   00:BEA3  09                  		add hl,bc           ; skip a screen.
    5748   00:BEA4  EB                  		ex de,hl            ; put total in de, pointer in hl.
    5749   00:BEA5  3D                  		dec a               ; one less iteration.
    5750   00:BEA6  18 F3               		jr groom1           ; loop until we reach the end.
    5751   00:BEA8                      groom0:
    5752   00:BEA8  2A 4F B5            		ld hl,(scrptr)      ; pointer to screens.
    5753   00:BEAB  19                  		add hl,de           ; add displacement.
    5754   00:BEAC  3A 87 97            		ld a,(numsc)        ; number of screens.
    5755   00:BEAF  16 00               		ld d,0              ; zeroise high byte.
    5756   00:BEB1  5F                  		ld e,a              ; displacement in de.
    5757   00:BEB2  19                  		add hl,de           ; add double displacement to address.
    5758   00:BEB3  19                  		add hl,de
    5759   00:BEB4  C9                  		ret
    5760   00:BEB5                      
    5761   00:BEB5                      ; Draw present room.
    5762   00:BEB5                      
    5763   00:BEB5                      droom:
    5764   00:BEB5  3A 93 40            		ld a,(wintop)       ; window top.
    5765   00:BEB8  32 54 40            		ld (dispx),a        ; set x coordinate.
    5766   00:BEBB                      droom2:
    5767   00:BEBB  2A 4B B5            		ld hl,(blkptr)      ; blocks.
    5768   00:BEBE  22 3E 40            		ld (grbase),hl      ; set graphics base.
    5769   00:BEC1  CD 92 BE            		call groom          ; get address of current room.
    5770   00:BEC4                      
    5771   00:BEC4  11 D4 42            		ld de,mapbuf
    5772   00:BEC7  CD 58 C8            		call unpack
    5773   00:BECA                      		; call scunpack	
    5774   00:BECA                      		
    5775   00:BECA                      		
    5776   00:BECA  21 D4 42            		ld hl,mapbuf
    5777   00:BECD  3A 95 40            		ld a,(winhgt)       ; height of window.
    5778   00:BED0  4F                  		ld c,a
    5779   00:BED1                      droom0:
    5780   00:BED1  3A 94 40            		ld a,(winlft)       ; window left edge.
    5781   00:BED4  32 55 40            		ld (dispy),a        ; set cursor position.
    5782   00:BED7  3A 96 40            		ld a,(winwid)       ; width of window.
    5783   00:BEDA  47                  		ld b,a
    5784   00:BEDB                      droom1:
    5785   00:BEDB  C5                  		push bc             ; store column counter.
    5786   00:BEDC  7E                  		ld a,(hl)
    5787   00:BEDD  23                  		inc hl
    5788   00:BEDE  E5                  		push hl             ; store address of cell.
    5789   00:BEDF                      	if MBFLAG
    5790   00:BEDF                    ~ 		call drwmeta		; draw metablock
    5791   00:BEDF                    ~ 	else
    5792   00:BEDF  CD 2F BE            		call pattr2
    5793   00:BEE2                      	endif
    5794   00:BEE2  E1                  		pop hl              ; restore cell address.
    5795   00:BEE3  C1                  		pop bc              ; restore loop counter.
    5796   00:BEE4  10 F5               		djnz droom1
    5797   00:BEE6  3A 54 40            		ld a,(dispx)        ; y coord.
    5798   00:BEE9  3C                  		inc a               ; move down one line.
    5799   00:BEEA                      	if MBFLAG
    5800   00:BEEA                    ~ 		inc a				; move down one line.
    5801   00:BEEA                    ~ 	endif		
    5802   00:BEEA  32 54 40            		ld (dispx),a        ; set new position.
    5803   00:BEED  0D                  		dec c
    5804   00:BEEE  20 E1               		jr nz,droom0
    5805   00:BEF0                      ;		jp enascreen
    5806   00:BEF0  C9                  		ret
    5807   00:BEF1                      
    5808   00:BEF1                      /*
    5809   00:BEF1                    ~ ; HL = pointer to packed screen data
    5810   00:BEF1                    ~ ; BC = lenght of packed screen data
    5811   00:BEF1                    ~ scunpack:
    5812   00:BEF1                    ~ 		xor a               ; zero in accumulator.
    5813   00:BEF1                    ~ 		ld (comcnt),a       ; reset compression counter.	
    5814   00:BEF1                    ~ 		ex de,hl	
    5815   00:BEF1                    ~ 		ld bc,MAPSIZE		
    5816   00:BEF1                    ~ .nxtbyte:		
    5817   00:BEF1                    ~ 		ld a,(comcnt)       ; compression counter.
    5818   00:BEF1                    ~ 		and a               ; any more to decompress?
    5819   00:BEF1                    ~ 		jp nz,.flbyt1        ; yes.
    5820   00:BEF1                    ~ 		ld a,(de)           ; fetch next byte.
    5821   00:BEF1                    ~ 		inc de              ; point to next cell.
    5822   00:BEF1                    ~ 		cp 255              ; is this byte a control code?
    5823   00:BEF1                    ~ 		jp nz,.nocom         ; no, this byte is uncompressed.
    5824   00:BEF1                    ~ 		ld a,(de)           ; fetch byte type.
    5825   00:BEF1                    ~ 		ld (combyt),a       ; set up the type.
    5826   00:BEF1                    ~ 		inc de              ; point to quantity.
    5827   00:BEF1                    ~ 		ld a,(de)           ; get quantity.
    5828   00:BEF1                    ~ 		inc de              ; point to next byte.
    5829   00:BEF1                    ~ .flbyt1:
    5830   00:BEF1                    ~ 		dec a               ; one less.
    5831   00:BEF1                    ~ 		ld (comcnt),a       ; store new quantity.
    5832   00:BEF1                    ~ 		ld a,(combyt)       ; byte to expand.
    5833   00:BEF1                    ~ .nocom:
    5834   00:BEF1                    ~ 		ld (hl),a
    5835   00:BEF1                    ~ 		cpi
    5836   00:BEF1                    ~ 		jp pe,.nxtbyte
    5837   00:BEF1                    ~ 		ret
    5838   00:BEF1                    ~ */
    5839   00:BEF1                      	
    5840   00:BEF1                      ; ------------------------------------------------------------------------------------------------------------------------------------------
    5841   00:BEF1                      ; Drawing a MetaBlock (4 tiles 8x8 => 16x16)
    5842   00:BEF1                      ; param in regA tells the block number to use, if 0 use 0,0,0,0  else use 
    5843   00:BEF1                      ; N,N+2 
    5844   00:BEF1                      ; N+1,N+3
    5845   00:BEF1                      ; ------------------------------------------------------------------------------------------------------------------------------------------
    5846   00:BEF1                      	if MBFLAG
    5847   00:BEF1                    ~ drwmeta:
    5848   00:BEF1                    ~ 		ld b,2
    5849   00:BEF1                    ~ drwm01:
    5850   00:BEF1                    ~ 		push bc
    5851   00:BEF1                    ~ 		push af
    5852   00:BEF1                    ~ 		call pattr2		; put block N
    5853   00:BEF1                    ~ 		dec (hl)		; decrement X, back to start column
    5854   00:BEF1                    ~ 		dec hl
    5855   00:BEF1                    ~ 		inc (hl)		; increment y, next line
    5856   00:BEF1                    ~ 		pop af
    5857   00:BEF1                    ~ 		or a
    5858   00:BEF1                    ~ 		jr z, drwm02
    5859   00:BEF1                    ~ 		inc a			; put block N+1
    5860   00:BEF1                    ~ drwm02:
    5861   00:BEF1                    ~ 		push af
    5862   00:BEF1                    ~ 		call pattr2
    5863   00:BEF1                    ~ 		dec hl			
    5864   00:BEF1                    ~ 		dec (hl)		; decrement Y, back to start line
    5865   00:BEF1                    ~ 		pop af
    5866   00:BEF1                    ~ 		or a
    5867   00:BEF1                    ~ 		jr z,drwm03
    5868   00:BEF1                    ~ 		inc a			; put block N+2
    5869   00:BEF1                    ~ drwm03:
    5870   00:BEF1                    ~ 		pop bc
    5871   00:BEF1                    ~ 		djnz drwm01
    5872   00:BEF1                    ~ 		ret
    5873   00:BEF1                    ~ /*
    5874   00:BEF1                    ~ 
    5875   00:BEF1                    ~ drwmeta:
    5876   00:BEF1                    ~ 		ldb	#$02							; columns to be drawn
    5877   00:BEF1                    ~ 		pshs	b,a							; [,S]=block number - [1,S]=column counter
    5878   00:BEF1                    ~ DrwM01:	
    5879   00:BEF1                    ~ 		jsr	PAttr2						; print block number A at dispX,dispY
    5880   00:BEF1                    ~ 		inc	<dispY						; point to next line
    5881   00:BEF1                    ~ 		dec	<dispX						; back one column
    5882   00:BEF1                    ~ 		lda	,s								; get block number
    5883   00:BEF1                    ~ 		beq	DrwM02						; is zero?
    5884   00:BEF1                    ~ 		inca									; no, get next block number (for row two)
    5885   00:BEF1                    ~ 		sta	,s								; update stack variable
    5886   00:BEF1                    ~ DrwM02:	
    5887   00:BEF1                    ~ 		jsr	PAttr2						; print block number A at dispX,dispY
    5888   00:BEF1                    ~ 		dec	<dispY						; point to previous line, column is OK
    5889   00:BEF1                    ~ 		lda	,s								; get block number
    5890   00:BEF1                    ~ 		beq	DrwM03						; is zero?
    5891   00:BEF1                    ~ 		inca									; no, point to next block number: N+2
    5892   00:BEF1                    ~ 		sta	,s								; update stack variable
    5893   00:BEF1                    ~ DrwM03:	
    5894   00:BEF1                    ~ 		dec	1,s							; decrement column counter in stack
    5895   00:BEF1                    ~ 		bne	DrwM01						; if not zero, loop for next Column
    5896   00:BEF1                    ~ 		puls	a,b,pc						; clean stack and return
    5897   00:BEF1                    ~ */
    5898   00:BEF1                    ~ 
    5899   00:BEF1                    ~ 	endif
    5900   00:BEF1                      	
    5901   00:BEF1                      	if LFLAG
    5902   00:BEF1                    ~ 	
    5903   00:BEF1                    ~ ; Ladder down check.
    5904   00:BEF1                    ~ 
    5905   00:BEF1                    ~ laddd:
    5906   00:BEF1                    ~ 		ld l,16
    5907   00:BEF1                    ~ 		jr ladd
    5908   00:BEF1                    ~ 
    5909   00:BEF1                    ~ ; Ladder up check.
    5910   00:BEF1                    ~ 
    5911   00:BEF1                    ~ laddu:
    5912   00:BEF1                    ~ 		ld l,15
    5913   00:BEF1                    ~ ladd:
    5914   00:BEF1                    ~ 		ld a,(ix+3)         ; y coordinate.
    5915   00:BEF1                    ~ 		ld h,(ix+4)         ; x coordinate.
    5916   00:BEF1                    ~ 		add a,l            ; look 2 pixels above feet.
    5917   00:BEF1                    ~ 		ld l,a              ; coords in hl.
    5918   00:BEF1                    ~ 
    5919   00:BEF1                    ~ laddv:
    5920   00:BEF1                    ~ 		ld (dispx),hl       ; set up test coordinates.
    5921   00:BEF1                    ~ 		call tstbl          ; get map address.
    5922   00:BEF1                    ~ 		call ldchk          ; standard ladder check.
    5923   00:BEF1                    ~ 		ret nz              ; no way through.
    5924   00:BEF1                    ~ 		inc hl              ; look right one cell.
    5925   00:BEF1                    ~ 		call ldchk          ; do the check.
    5926   00:BEF1                    ~ 		ret nz              ; impassable.
    5927   00:BEF1                    ~ 		ld a,(dispy)        ; y coordinate.
    5928   00:BEF1                    ~ 		and 7               ; position straddling block cells.
    5929   00:BEF1                    ~ 		ret z               ; no more checks needed.
    5930   00:BEF1                    ~ 		inc hl              ; look to third cell.
    5931   00:BEF1                    ~ 	
    5932   00:BEF1                    ~ ; Check ladder is available.
    5933   00:BEF1                    ~ 
    5934   00:BEF1                    ~ ldchk:
    5935   00:BEF1                    ~ 		ld a,(hl)           ; fetch cell.
    5936   00:BEF1                    ~ 		cp LADDER           ; is it a ladder?
    5937   00:BEF1                    ~ 		ret                 ; return with zero flag set accordingly.
    5938   00:BEF1                    ~ 
    5939   00:BEF1                    ~ 	endif
    5940   00:BEF1                      	
    5941   00:BEF1                      ; Can go up check.
    5942   00:BEF1                      
    5943   00:BEF1                      cangu:
    5944   00:BEF1  DD 7E 03            		ld a,(ix+3)         ; y coordinate.
    5945   00:BEF4  DD 66 04            		ld h,(ix+4)         ; x coordinate.
    5946   00:BEF7  D6 01               		sub 1               ; look up 1 pixels.
    5947   00:BEF9  6F                  		ld l,a              ; coords in hl.
    5948   00:BEFA  22 54 40            		ld (dispx),hl       ; set up test coordinates.
    5949   00:BEFD  CD CD BF            		call tstbl          ; get map address.
    5950   00:BF00  CD 77 BF            		call lrchk          ; standard left/right check.
    5951   00:BF03  C0                  		ret nz              ; no way through.
    5952   00:BF04  23                  		inc hl              ; look right one cell.
    5953   00:BF05  CD 77 BF            		call lrchk          ; do the check.
    5954   00:BF08  C0                  		ret nz              ; impassable.
    5955   00:BF09  3A 55 40            		ld a,(dispy)        ; y coordinate.
    5956   00:BF0C  E6 07               		and 7               ; position straddling block cells.
    5957   00:BF0E  C8                  		ret z               ; no more checks needed.
    5958   00:BF0F  23                  		inc hl              ; look to third cell.
    5959   00:BF10  C3 77 BF            		jp lrchk          ; do the check.
    5960   00:BF13                      
    5961   00:BF13                      ; Can go down check.
    5962   00:BF13                      
    5963   00:BF13                      cangd:
    5964   00:BF13  DD 7E 03            		ld a,(ix+3)         ; y coordinate.
    5965   00:BF16  DD 66 04            		ld h,(ix+4)         ; x coordinate.
    5966   00:BF19                      numsp3:
    5967   00:BF19  C6 10               		add a,16            ; look down 16 pixels.
    5968   00:BF1B  6F                  		ld l,a              ; coords in hl.
    5969   00:BF1C  22 54 40            		ld (dispx),hl       ; set up test coordinates.
    5970   00:BF1F  CD CD BF            		call tstbl          ; get map address.
    5971   00:BF22  CD 32 BF            		call plchk          ; block, platform check.
    5972   00:BF25  C0                  		ret nz              ; no way through.
    5973   00:BF26  23                  		inc hl              ; look right one cell.
    5974   00:BF27  CD 32 BF            		call plchk          ; block, platform check.
    5975   00:BF2A  C0                  		ret nz              ; impassable.
    5976   00:BF2B  3A 55 40            		ld a,(dispy)        ; y coordinate.
    5977   00:BF2E  E6 07               		and 7               ; position straddling block cells.
    5978   00:BF30  C8                  		ret z               ; no more checks needed.
    5979   00:BF31  23                  		inc hl              ; look to third cell.
    5980   00:BF32                      
    5981   00:BF32                      ; Check platform or solid item is not in way.
    5982   00:BF32                      
    5983   00:BF32                      plchk:
    5984   00:BF32  7E                  		ld a,(hl)           ; fetch map cell.
    5985   00:BF33  FE 02               		cp WALL             ; is it passable?
    5986   00:BF35  28 4B               		jr z,lrchkx         ; no.
    5987   00:BF37                      	if (PFLAG or DFLAG)
    5988   00:BF37  FE 04               		cp FODDER           ; fodder has to be dug.
    5989   00:BF39  28 47               		jr z,lrchkx         ; not passable.
    5990   00:BF3B                      	endif
    5991   00:BF3B  FE 01               		cp PLATFM           ; platform is solid.
    5992   00:BF3D  28 02               		jr z,plchkx         ; not passable.
    5993   00:BF3F                      	if LFLAG
    5994   00:BF3F                    ~ 		cp LADDER           ; is it a ladder?
    5995   00:BF3F                    ~ 		jr z,lrchkx         ; on ladder, deny movement.
    5996   00:BF3F                    ~ 	endif
    5997   00:BF3F                      plchk0:
    5998   00:BF3F  AF                  		xor a               ; report it as okay.
    5999   00:BF40  C9                  		ret
    6000   00:BF41                      plchkx:
    6001   00:BF41  3A 54 40            		ld a,(dispx)        ; x coordinate.
    6002   00:BF44  E6 07               		and 7               ; position straddling blocks.
    6003   00:BF46  28 3A               		jr z,lrchkx         ; on platform, deny movement.
    6004   00:BF48  18 F5               		jr plchk0
    6005   00:BF4A                      
    6006   00:BF4A                      
    6007   00:BF4A                      ; Can go left check.
    6008   00:BF4A                      
    6009   00:BF4A                      cangl:
    6010   00:BF4A  DD 6E 03            		ld l,(ix+3)         ; y coordinate.
    6011   00:BF4D  DD 7E 04            		ld a,(ix+4)         ; x coordinate.
    6012   00:BF50  D6 01               		sub 1               ; look left 1 pixels.
    6013   00:BF52  67                  		ld h,a              ; coords in hl.
    6014   00:BF53  18 09               		jr cangh            ; test if we can go there.
    6015   00:BF55                      
    6016   00:BF55                      ; Can go right check.
    6017   00:BF55                      
    6018   00:BF55                      cangr:
    6019   00:BF55  DD 6E 03            		ld l,(ix+3)         ; y coordinate.
    6020   00:BF58  DD 7E 04            		ld a,(ix+4)         ; x coordinate.
    6021   00:BF5B  C6 10               		add a,16            ; look right 16 pixels.
    6022   00:BF5D  67                  		ld h,a              ; coords in hl.
    6023   00:BF5E                      
    6024   00:BF5E                      cangh:
    6025   00:BF5E  22 54 40            		ld (dispx),hl       ; set up test coordinates.
    6026   00:BF61                      cangh2:
    6027   00:BF61  06 03               		ld b,3              ; default rows to write.
    6028   00:BF63  7D                  		ld a,l              ; x position.
    6029   00:BF64  E6 07               		and 7               ; does x straddle cells?
    6030   00:BF66  20 01               		jr nz,cangh0        ; yes, loop counter is good.
    6031   00:BF68  05                  		dec b               ; one less row to write.
    6032   00:BF69                      cangh0:
    6033   00:BF69  CD CD BF            		call tstbl          ; get map address.
    6034   00:BF6C  11 20 00            		ld de,MSX_MAXCOLS      ; distance to next cell.
    6035   00:BF6F                      cangh1:
    6036   00:BF6F  CD 77 BF            		call lrchk          ; standard left/right check.
    6037   00:BF72  C0                  		ret nz              ; no way through.
    6038   00:BF73  19                  		add hl,de           ; look down.
    6039   00:BF74  10 F9               		djnz cangh1
    6040   00:BF76  C9                  		ret
    6041   00:BF77                      
    6042   00:BF77                      ; Check left/right movement is okay.
    6043   00:BF77                      
    6044   00:BF77                      lrchk:
    6045   00:BF77  7E                  		ld a,(hl)           ; fetch map cell.
    6046   00:BF78  FE 02               		cp WALL             ; is it passable?
    6047   00:BF7A  28 06               		jr z,lrchkx         ; no.
    6048   00:BF7C  FE 04               		cp FODDER           ; fodder has to be dug.
    6049   00:BF7E  28 02               		jr z,lrchkx         ; not passable.
    6050   00:BF80                      always:
    6051   00:BF80  AF                  		xor a               ; report it as okay.
    6052   00:BF81  C9                  		ret
    6053   00:BF82                      lrchkx:
    6054   00:BF82  AF                  		xor a               ; reset all bits.
    6055   00:BF83  3C                  		inc a
    6056   00:BF84  C9                  		ret
    6057   00:BF85                      
    6058   00:BF85                      	
    6059   00:BF85                      	if CFLAG
    6060   00:BF85                    ~ 	
    6061   00:BF85                    ~ ; Get collectables.
    6062   00:BF85                    ~ 
    6063   00:BF85                    ~ getcol:
    6064   00:BF85                    ~ 		ld b,COLECT         ; collectable blocks.
    6065   00:BF85                    ~ 		call tded           ; test for collectable blocks.
    6066   00:BF85                    ~ 		cp b                ; did we find one?
    6067   00:BF85                    ~ 		ret nz              ; none were found, job done.
    6068   00:BF85                    ~ 		call gtblk          ; get block.
    6069   00:BF85                    ~ 		call evnt20         ; collected block event.
    6070   00:BF85                    ~ 		jr getcol           ; repeat until none left.
    6071   00:BF85                    ~ 
    6072   00:BF85                    ~ ; Get collectable block.
    6073   00:BF85                    ~ 
    6074   00:BF85                    ~ gtblk:
    6075   00:BF85                    ~ 		ld (hl),0           ; make it empty now.
    6076   00:BF85                    ~ 		ld de,MAP           ; map address.
    6077   00:BF85                    ~ 		and a               ; clear carry.
    6078   00:BF85                    ~ 		sbc hl,de           ; find cell number.
    6079   00:BF85                    ~ 		ld a,l              ; get low byte of cell number.
    6080   00:BF85                    ~ 		and MSX_MAXCOLS-1   ; 0 - 31 is column.
    6081   00:BF85                    ~ 		ld d,a              ; store y in d register.
    6082   00:BF85                    ~ 		add hl,hl           ; multiply by 8.
    6083   00:BF85                    ~ 		add hl,hl
    6084   00:BF85                    ~ 		add hl,hl           ; x is now in h.
    6085   00:BF85                    ~ 		ld e,h              ; put x in e.
    6086   00:BF85                    ~ 		ld (dispx),de       ; set display coordinates.
    6087   00:BF85                    ~ 		ld hl,(blkptr)      ; blocks.
    6088   00:BF85                    ~ 		ld (grbase),hl      ; set graphics base.
    6089   00:BF85                    ~ 		xor a
    6090   00:BF85                    ~ 		jp pchr
    6091   00:BF85                    ~ 
    6092   00:BF85                    ~ 	endif
    6093   00:BF85                      	
    6094   00:BF85                      ; Touched deadly block check.
    6095   00:BF85                      ; Returns with DEADLY (must be non-zero) in accumulator if true.
    6096   00:BF85                      
    6097   00:BF85                      tded:
    6098   00:BF85  DD 6E 03            		ld l,(ix+3)         ; x coordinate.
    6099   00:BF88  DD 66 04            		ld h,(ix+4)         ; y coordinate.
    6100   00:BF8B  22 54 40            		ld (dispx),hl       ; set up test coordinates.
    6101   00:BF8E  CD CD BF            		call tstbl          ; get map address.
    6102   00:BF91  11 1F 00            		ld de,MSX_MAXCOLS-1 ; default distance to next line down.
    6103   00:BF94  B8                  		cp b                ; is this the required block?
    6104   00:BF95  C8                  		ret z               ; yes.
    6105   00:BF96  23                  		inc hl              ; next cell.
    6106   00:BF97  7E                  		ld a,(hl)           ; fetch type.
    6107   00:BF98  B8                  		cp b                ; is this deadly/custom?
    6108   00:BF99  C8                  		ret z               ; yes.
    6109   00:BF9A  3A 55 40            		ld a,(dispy)        ; horizontal position.
    6110   00:BF9D  4F                  		ld c,a              ; store column in c register.
    6111   00:BF9E  E6 07               		and 7               ; is it straddling cells?
    6112   00:BFA0  28 05               		jr z,.tded0          ; no.
    6113   00:BFA2  23                  		inc hl              ; last cell.
    6114   00:BFA3  7E                  		ld a,(hl)           ; fetch type.
    6115   00:BFA4  B8                  		cp b                ; is this the block?
    6116   00:BFA5  C8                  		ret z               ; yes.
    6117   00:BFA6  1B                  		dec de              ; one less cell to next row down.
    6118   00:BFA7                      .tded0:  
    6119   00:BFA7  19                  		add hl,de           ; point to next row.
    6120   00:BFA8  7E                  		ld a,(hl)           ; fetch left cell block.
    6121   00:BFA9  B8                  		cp b                ; is this fatal?
    6122   00:BFAA  C8                  		ret z               ; yes.
    6123   00:BFAB  23                  		inc hl              ; next cell.
    6124   00:BFAC  7E                  		ld a,(hl)           ; fetch type.
    6125   00:BFAD  B8                  		cp b                ; is this fatal?
    6126   00:BFAE  C8                  		ret z               ; yes.
    6127   00:BFAF  79                  		ld a,c              ; horizontal position.
    6128   00:BFB0  E6 07               		and 7               ; is it straddling cells?
    6129   00:BFB2  28 04               		jr z,.tded1          ; no.
    6130   00:BFB4  23                  		inc hl              ; last cell.
    6131   00:BFB5  7E                  		ld a,(hl)           ; fetch type.
    6132   00:BFB6  B8                  		cp b                ; is this fatal?
    6133   00:BFB7  C8                  		ret z               ; yes.
    6134   00:BFB8                      .tded1:
    6135   00:BFB8  3A 54 40            		ld a,(dispx)        ; vertical position.
    6136   00:BFBB  E6 07               		and 7               ; is it straddling cells?
    6137   00:BFBD  C8                  		ret z               ; no, job done.
    6138   00:BFBE  19                  		add hl,de           ; point to next row.
    6139   00:BFBF  7E                  		ld a,(hl)           ; fetch left cell block.
    6140   00:BFC0  B8                  		cp b                ; is this fatal?
    6141   00:BFC1  C8                  		ret z               ; yes.
    6142   00:BFC2  23                  		inc hl              ; next cell.
    6143   00:BFC3  7E                  		ld a,(hl)           ; fetch type.
    6144   00:BFC4  B8                  		cp b                ; is this fatal?
    6145   00:BFC5  C8                  		ret z               ; yes.
    6146   00:BFC6  79                  		ld a,c              ; horizontal position.
    6147   00:BFC7  E6 07               		and 7               ; is it straddling cells?
    6148   00:BFC9  C8                  		ret z               ; no.
    6149   00:BFCA  23                  		inc hl              ; last cell.
    6150   00:BFCB  7E                  		ld a,(hl)           ; fetch final type.
    6151   00:BFCC  C9                  		ret                 ; return with final type in accumulator.
    6152   00:BFCD                      
    6153   00:BFCD                      
    6154   00:BFCD                      ; Fetch block type at (dispx, dispy).
    6155   00:BFCD                      ; Input:
    6156   00:BFCD                      ; 	dispx = Y coord (0-191)
    6157   00:BFCD                      ; 	dispy = X coord (0-255)
    6158   00:BFCD                      ; Output:
    6159   00:BFCD                      ;	A = block code at (dispx, dispy)
    6160   00:BFCD                      ; Modifies:
    6161   00:BFCD                      ;	A,HL
    6162   00:BFCD                      tstbl:
    6163   00:BFCD  3A 54 40            		ld a,(dispx)        ; fetch y coord.
    6164   00:BFD0  07                  		rlca                ; divide by 8,
    6165   00:BFD1  07                  		rlca                ; and multiply by 32.
    6166   00:BFD2  67                  		ld h,a              ; store in d.
    6167   00:BFD3  E6 E0               		and $E0             ; mask off high bits.
    6168   00:BFD5  6F                  		ld l,a              ; low byte.
    6169   00:BFD6  7C                  		ld a,h              ; restore shift result.
    6170   00:BFD7  E6 03               		and 3               ; high bits.
    6171   00:BFD9  C6 46               		add a,MAP>>8
    6172   00:BFDB  67                  		ld h,a              ; got displacement in de.
    6173   00:BFDC  3A 55 40            		ld a,(dispy)        ; x coord.
    6174   00:BFDF  1F                  		rra                 ; divide by 8.
    6175   00:BFE0  1F                  		rra
    6176   00:BFE1  1F                  		rra
    6177   00:BFE2  E6 1F               		and 31              ; only want 0 - 31.
    6178   00:BFE4  85                  		add a,l             ; add to displacement.
    6179   00:BFE5  6F                  		ld l,a              ; displacement in hl.
    6180   00:BFE6  7E                  		ld a,(hl)           ; fetch byte there.
    6181   00:BFE7  C9                  		ret
    6182   00:BFE8                      
    6183   00:BFE8                      
    6184   00:BFE8                      ; Jump - if we can.
    6185   00:BFE8                      ; Requires initial speed to be set up in accumulator prior to call.
    6186   00:BFE8                      
    6187   00:BFE8                      jump:
    6188   00:BFE8  ED 44               		neg                 ; switch sign so we jump up.
    6189   00:BFEA  4F                  		ld c,a              ; store in c register.
    6190   00:BFEB                      jump0:
    6191   00:BFEB  DD 7E 0D            		ld a,(ix+13)        ; jumping flag.
    6192   00:BFEE  A7                  		and a               ; is it set?
    6193   00:BFEF  C0                  		ret nz              ; already in the air.
    6194   00:BFF0  DD 34 0D            		inc (ix+13)         ; set it.
    6195   00:BFF3  DD 71 0E            		ld (ix+14),c        ; set jump height.
    6196   00:BFF6  C9                  		ret
    6197   00:BFF7                      
    6198   00:BFF7                      hop:   
    6199   00:BFF7  DD 7E 0D            		ld a,(ix+13)        ; jumping flag.
    6200   00:BFFA  A7                  		and a               ; is it set?
    6201   00:BFFB  C0                  		ret nz              ; already in the air.
    6202   00:BFFC  DD 36 0D FF         		ld (ix+13),255      ; set it.
    6203   00:C000  DD 36 0E 00         		ld (ix+14),0        ; set jump table displacement.
    6204   00:C004  C9                  		ret
    6205   00:C005                      
    6206   00:C005                      ; Random numbers code.
    6207   00:C005                      ; Pseudo-random number generator, 8-bit.
    6208   00:C005                      
    6209   00:C005                      random:
    6210   00:C005  21 3D 40            		ld hl,seed          ; set up seed pointer.
    6211   00:C008  7E                  		ld a,(hl)           ; get last random number.
    6212   00:C009  47                  		ld b,a              ; copy to b register.
    6213   00:C00A  0F                  		rrca                ; multiply by 32.
    6214   00:C00B  0F                  		rrca
    6215   00:C00C  0F                  		rrca
    6216   00:C00D  EE 1F               		xor 31
    6217   00:C00F  80                  		add a,b
    6218   00:C010  DE FF               		sbc a,255
    6219   00:C012  77                  		ld (hl),a           ; store new seed.
    6220   00:C013  32 56 40            		ld (varrnd),a       ; return number in variable.
    6221   00:C016  C9                  		ret
    6222   00:C017                      
    6223   00:C017                      ; Keyboard test routine. (returns NC if pressed)
    6224   00:C017                      ;
    6225   00:C017                      ; Checks if a key is pressed
    6226   00:C017                      ;
    6227   00:C017                      ; Input:	A=offset
    6228   00:C017                      ;		D=mask
    6229   00:C017                      ; Output:	Carry=1 if key not pressed
    6230   00:C017                      ;		Carry=0 if key is pressed
    6231   00:C017                      ; Modifies:	A,C
    6232   00:C017                      ;
    6233   00:C017                      ktest:
    6234   00:C017  C5                  	push bc
    6235   00:C018  E5                  	push hl
    6236   00:C019  01 00 00            	ld bc,0
    6237   00:C01C  4A                  	ld c,d
    6238   00:C01D  21 97 40            	ld hl,CONTROLLER_BUFFER
    6239   00:C020  09                  	add hl,bc
    6240   00:C021  BE                  	cp (hl)
    6241   00:C022  28 04               	jr z,keypressed
    6242   00:C024  E1                  	pop hl
    6243   00:C025  C1                  	pop bc
    6244   00:C026  37                  	scf
    6245   00:C027  C9                  	ret
    6246   00:C028                      keypressed:
    6247   00:C028  E1                  	pop hl
    6248   00:C029  C1                  	pop bc
    6249   00:C02A  A7                  	and a
    6250   00:C02B  C9                  	ret	
    6251   00:C02C                      
    6252   00:C02C                      jtest:
    6253   00:C02C  C5                  	push bc
    6254   00:C02D  E5                  	push hl
    6255   00:C02E  01 00 00            	ld bc,0
    6256   00:C031  4A                  	ld c,d
    6257   00:C032  21 97 40            	ld hl,CONTROLLER_BUFFER
    6258   00:C035  09                  	add hl,bc
    6259   00:C036  A6                  	and (hl)
    6260   00:C037  20 04               	jr nz,jkeypressed
    6261   00:C039  E1                  	pop hl
    6262   00:C03A  C1                  	pop bc
    6263   00:C03B  37                  	scf
    6264   00:C03C  C9                  	ret
    6265   00:C03D                      jkeypressed:
    6266   00:C03D  E1                  	pop hl
    6267   00:C03E  C1                  	pop bc
    6268   00:C03F  A7                  	and a
    6269   00:C040  C9                  	ret	
    6270   00:C041                      
    6271   00:C041                      ;		call MSX_SNSMAT
    6272   00:C041                      ;		and d
    6273   00:C041                      ;		ret z
    6274   00:C041                      ;		scf					; sets C, key NOT pressed
    6275   00:C041                      ;		ret
    6276   00:C041                      ;
    6277   00:C041                      ;chkselect:
    6278   00:C041                      ;		ld a,(select)
    6279   00:C041                      ;		or a
    6280   00:C041                      ;		jr z,.chghz
    6281   00:C041                      ;		dec a
    6282   00:C041                      ;		ld (select),a
    6283   00:C041                      ;		ret nz
    6284   00:C041                      ;.chghz:
    6285   00:C041                      ;		bit 6,e
    6286   00:C041                      ;		ret nz
    6287   00:C041                      ;		; SELECT key pressed
    6288   00:C041                      ;		call swaphz
    6289   00:C041                      ;		; falls through setticks
    6290   00:C041                      		
    6291   00:C041                      ; Sets the number of frames/sec. based on PAL/NTSC setting
    6292   00:C041                      ; Input:
    6293   00:C041                      ;	A = (RG9SAV)
    6294   00:C041                      ; Output:
    6295   00:C041                      ;	(TICKS) = 50/60
    6296   00:C041                      ;   (SELECT) = 50/60
    6297   00:C041                      ;setticks:
    6298   00:C041                      ;		and 2
    6299   00:C041                      ;		ld a,50
    6300   00:C041                      ;		jr nz,.itspal
    6301   00:C041                      ;		ld a,60
    6302   00:C041                      ;.itspal:
    6303   00:C041                      ;		ld (ticks),a
    6304   00:C041                      ;		ld (select),a
    6305   00:C041                      ;		ret
    6306   00:C041                      ;		
    6307   00:C041                      ;
    6308   00:C041                      ; Check if STOP key is pressed
    6309   00:C041                      ;		
    6310   00:C041                      ;stopselect:
    6311   00:C041                      ;		ld a,7
    6312   00:C041                      ;		call MSX_SNSMAT
    6313   00:C041                      ;		ld e,a
    6314   00:C041                      ;	ifdef NOBIOS
    6315   00:C041                      ;		ld a,(biosvars+MSX_MSXVER)      	; version del MSX
    6316   00:C041                      ;	else
    6317   00:C041                      ;		ld a,(MSX_MSXVER)      	; version del MSX
    6318   00:C041                      ;	endif		
    6319   00:C041                      ;		or a
    6320   00:C041                      ;		; push de
    6321   00:C041                      ;		call nz,chkselect
    6322   00:C041                      ;		; pop de
    6323   00:C041                      ;		bit 4,e
    6324   00:C041                      ;		ret nz
    6325   00:C041                      ;.loop1
    6326   00:C041                      ;		ld a,7
    6327   00:C041                      ;		call MSX_SNSMAT
    6328   00:C041                      ;		and $10
    6329   00:C041                      ;		jr z,.loop1
    6330   00:C041                      ;
    6331   00:C041                      ;.loop2
    6332   00:C041                      ;		ld a,7
    6333   00:C041                      ;		call MSX_SNSMAT
    6334   00:C041                      ;		and $10
    6335   00:C041                      ;		jr nz,.loop2
    6336   00:C041                      ;.loop3
    6337   00:C041                      ;		ld a,7
    6338   00:C041                      ;		call MSX_SNSMAT
    6339   00:C041                      ;		and $10
    6340   00:C041                      ;		jr z,.loop3
    6341   00:C041                      ;		ret
    6342   00:C041                      	
    6343   00:C041                      ; Joystick and keyboard reading routines.
    6344   00:C041                      ; A/E/joyval = result bits: 0,fire3,fire2,fire,up,down,left,right
    6345   00:C041                      
    6346   00:C041                      joykey:
    6347   00:C041                      ;		call stopselect
    6348   00:C041                      
    6349   00:C041                      		ifdef DEBUG
    6350   00:C041                    ~ 		BORDER 7
    6351   00:C041                    ~ 		endif
    6352   00:C041                      
    6353   00:C041  3A 34 40            		ld a,(contrl)       ; control flag.
    6354   00:C044  3D                  		dec a               ; is it the keyboard?
    6355   00:C045  28 08               		jr z,joyjoy1        ; no, it's joystick 1
    6356   00:C047  3D                  		dec a               ; joystick 2?
    6357   00:C048  28 0A               		jr z,joyjoy2        ; read joystick 2
    6358   00:C04A                      
    6359   00:C04A                      ; Control was keyboard (CONTROL=0)
    6360   00:C04A                      
    6361   00:C04A  21 8A 40            		ld hl,keys+13       ; address of last key.
    6362   00:C04D  18 08               		jr readkeys
    6363   00:C04F                      
    6364   00:C04F                      ; Control was joystick 1 (CONTROL=1)
    6365   00:C04F                      
    6366   00:C04F                      joyjoy1:
    6367   00:C04F  21 79 C0            		ld hl,joykey1+13    ; address of last key.
    6368   00:C052  18 03               		jr readkeys
    6369   00:C054                      
    6370   00:C054                      ; Control was joystick 2 (CONTROL=2)
    6371   00:C054                      
    6372   00:C054                      joyjoy2:
    6373   00:C054  21 87 C0            		ld hl,joykey2+13    ; address of last key.
    6374   00:C057                      
    6375   00:C057                      readkeys:
    6376   00:C057  1E 00               		ld e,0              ; zero reading.
    6377   00:C059  06 07               		ld b,7              ; keys to read.
    6378   00:C05B                      .loop:
    6379   00:C05B  56                  		ld d,(hl)           ; get key from table.
    6380   00:C05C  2B                  		dec hl
    6381   00:C05D  7E                  		ld a,(hl)	    ; get row
    6382   00:C05E  2B                  		dec hl
    6383   00:C05F  CD 2C C0            		call jtest
    6384   00:C062  3F                  		ccf                 ; complement the result (0=not pressed,1=pressed).
    6385   00:C063  CB 13               		rl e                ; rotate into reading.
    6386   00:C065  10 F4               		djnz .loop          ; repeat for all keys.
    6387   00:C067                      
    6388   00:C067  7B                  		ld a,e              ; copy e register to accumulator.
    6389   00:C068  32 40 40            		ld (joyval),a       ; remember value.
    6390   00:C06B                      
    6391   00:C06B                      		ifdef DEBUG
    6392   00:C06B                    ~ 		BORDER 14
    6393   00:C06B                    ~ 		endif
    6394   00:C06B                      
    6395   00:C06B  C9                  		ret
    6396   00:C06C                      
    6397   00:C06C                      joykey1:
    6398   00:C06C                      	dw $0302,$0308,$0304,$0301	; Direction buttons
    6398   00:C06C  02 03 08 03 04 03 01 03 
    6399   00:C074  40 02 40 05 0B 06   	dw $0240,$0540,$060b		; Fire buttons
    6400   00:C07A                      
    6401   00:C07A                      joykey2:
    6402   00:C07A                      	dw $0802,$0808,$0804,$0801	; Direction buttons
    6402   00:C07A  02 08 08 08 04 08 01 08 
    6403   00:C082  40 07 40 0A 0B 0B   	dw $0740,$0a40,$0b0b		; Fire buttons
    6404   00:C088                      
    6405   00:C088                      
    6406   00:C088                      ; Display message.
    6407   00:C088                      
    6408   00:C088                      dmsg:	
    6409   00:C088  21 CA 91            		ld hl,msgdat        ; pointer to messages.
    6410   00:C08B  CD F8 C1            		call getwrd         ; get message number.
    6411   00:C08E                      dmsg3:
    6412   00:C08E  CD E8 C1            		call preprt         ; pre-printing stuff.
    6413   00:C091  CD F8 BC            		call checkx         ; make sure we're in a printable range.
    6414   00:C094                      		
    6415   00:C094  EB                  		ex de,hl
    6416   00:C095  CD C3 BD            		call pradd			; find scrmap pointer from dispx,dispy
    6417   00:C098  E5                  		push hl				; preserves buffer pointer
    6418   00:C099  EB                  		ex de,hl
    6419   00:C09A  E5                  		push hl				; preserves start of string
    6420   00:C09B                      		
    6421   00:C09B  3A 38 40            		ld a,(prtmod)       ; print mode.
    6422   00:C09E  A7                  		and a               ; standard size?
    6423   00:C09F  C2 13 C1            		jp nz,bmsg1         ; no, double-height text.
    6424   00:C0A2                      dmsg0:	
    6425   00:C0A2  E5                  		push hl             ; store string pointer.
    6426   00:C0A3  7E                  		ld a,(hl)           ; fetch byte to display.
    6427   00:C0A4  E6 7F               		and 127             ; remove any end marker.
    6428   00:C0A6  FE 0D               		cp 13               ; newline character?
    6429   00:C0A8  28 59               		jr z,dmsg1
    6430   00:C0AA  CD F7 BD            		call ptxt           ; display character.		
    6431   00:C0AD                      		
    6432   00:C0AD  CD D6 C1            		call nexpos         ; display position.
    6433   00:C0B0  20 03               		jr nz,dmsg2         ; not on a new line.
    6434   00:C0B2                      		
    6435   00:C0B2  CD E0 C1            		call nexlin         ; next line down.
    6436   00:C0B5                      dmsg2:	
    6437   00:C0B5  E1                  		pop hl				
    6438   00:C0B6  7E                  		ld a,(hl)           ; fetch last character.
    6439   00:C0B7  17                  		rla                 ; was it the end?
    6440   00:C0B8  D2 FF C0            		jp nc,.nxtchr
    6441   00:C0BB                      
    6442   00:C0BB  D1                  		pop de				; restores start of string
    6443   00:C0BC  B7                  		or a
    6444   00:C0BD  ED 52               		sbc hl,de			
    6445   00:C0BF  20 0A               		jr nz,.btzero
    6446   00:C0C1  21 00 4A            		ld hl,scrmap
    6447   00:C0C4  D1                  		pop de				; restores scrmap buffer pointer
    6448   00:C0C5  19                  		add hl,de			; start of string in scrmap
    6449   00:C0C6  36 FF               		ld (hl),255                     ; mark as dirty in scrmap
    6450   00:C0C8  C3 20 BD            		jp dscor2
    6451   00:C0CB                      .btzero:
    6452   00:C0CB                      
    6453   00:C0CB  44                  		ld b,h
    6454   00:C0CC  4D                  		ld c,l				; get string lenght in BC
    6455   00:C0CD  D1                  		pop de				; restores scrmap buffer pointer
    6456   00:C0CE  19                  		add hl,de
    6457   00:C0CF  7C                  		ld a,h
    6458   00:C0D0  FE 03               		cp 3				; check if end of string is higher than length of map
    6459   00:C0D2  30 0E               		jr nc,.wrapped
    6460   00:C0D4                      .strseg:
    6461   00:C0D4  21 00 4A            		ld hl,scrmap
    6462   00:C0D7  19                  		add hl,de			; start of string in scrmap
    6463   00:C0D8  54                  		ld d,h
    6464   00:C0D9  5D                  		ld e,l
    6465   00:C0DA  1C                  		inc e
    6466   00:C0DB  36 FF               		ld (hl),255                     ; mark as dirty in scrmap
    6467   00:C0DD  ED B0               		ldir		
    6468   00:C0DF  C3 20 BD            		jp dscor2         	; job done.
    6469   00:C0E2                      .wrapped:	; half of the message is in the bottom and the rest wraps to coord 0,0
    6470   00:C0E2                      		; upper segment
    6471   00:C0E2  7D                  		ld a,l
    6472   00:C0E3  B7                  		or a
    6473   00:C0E4  28 11               		jr z,.bottom
    6474   00:C0E6  E5                  		push hl
    6475   00:C0E7  D5                  		push de
    6476   00:C0E8  C5                  		push bc
    6477   00:C0E9  4D                  		ld c,l
    6478   00:C0EA  21 00 4A            		ld hl,scrmap
    6479   00:C0ED  11 01 4A            		ld de,scrmap+1
    6480   00:C0F0  36 FF               		ld (hl),255                     ; mark as dirty in scrmap
    6481   00:C0F2  ED B0               		ldir	
    6482   00:C0F4  C1                  		pop bc
    6483   00:C0F5  D1                  		pop de
    6484   00:C0F6  E1                  		pop hl
    6485   00:C0F7                      .bottom:
    6486   00:C0F7                      		; bottom segment
    6487   00:C0F7  79                  		ld a,c
    6488   00:C0F8  95                  		sub l
    6489   00:C0F9  4F                  		ld c,a
    6490   00:C0FA  1C                  		inc e
    6491   00:C0FB  0D                  		dec c
    6492   00:C0FC  0D                  		dec c
    6493   00:C0FD  18 D5               		jr .strseg
    6494   00:C0FF                      		
    6495   00:C0FF                      .nxtchr:
    6496   00:C0FF  23                  		inc hl              ; next character to display.
    6497   00:C100  C3 A2 C0            		jp dmsg0
    6498   00:C103                      dmsg1:
    6499   00:C103  21 54 40            		ld hl,dispx         ; y coordinate.
    6500   00:C106  34                  		inc (hl)            ; newline.
    6501   00:C107  7E                  		ld a,(hl)           ; fetch position.
    6502   00:C108  FE 18               		cp MSX_MAXROWS		; past screen edge?
    6503   00:C10A  38 02               		jr c,dmsg4          ; no, it's okay.
    6504   00:C10C  36 00               		ld (hl),0           ; restart at top.
    6505   00:C10E  23                  dmsg4:	inc hl              ; x coordinate.
    6506   00:C10F  36 00               		ld (hl),0           ; carriage return.
    6507   00:C111  18 A2               		jr dmsg2
    6508   00:C113                      	   
    6509   00:C113                      
    6510   00:C113                      
    6511   00:C113                      ; Display message in big text.
    6512   00:C113                      
    6513   00:C113                      bmsg1:
    6514   00:C113  7E                  		ld a,(hl)           ; get character to display.
    6515   00:C114  E5                  		push hl             ; store pointer to message.
    6516   00:C115  E6 7F               		and 127             ; only want 7 bits.
    6517   00:C117  FE 0D               		cp 13               ; newline character?
    6518   00:C119  28 3B               		jr z,.bmsg2
    6519   00:C11B  CD 67 C1            		call bchar          ; display big char.
    6520   00:C11E                      .bmsg3:
    6521   00:C11E  E1                  		pop hl              ; retrieve message pointer.
    6522   00:C11F  7E                  		ld a,(hl)           ; look at last character.
    6523   00:C120  23                  		inc hl              ; next character in list.
    6524   00:C121  17                  		rla                 ; was terminator flag set?
    6525   00:C122  30 EF               		jr nc,bmsg1         ; no, keep going.
    6526   00:C124                      
    6527   00:C124  D1                  		pop de				; restores start of string
    6528   00:C125  B7                  		or a
    6529   00:C126  ED 52               		sbc hl,de			
    6530   00:C128  20 0E               		jr nz,.btzero
    6531   00:C12A  21 00 4A            		ld hl,scrmap
    6532   00:C12D  D1                  		pop de				; restores scrmap buffer pointer
    6533   00:C12E  19                  		add hl,de			; start of string in scrmap
    6534   00:C12F  36 FF               		ld (hl),255			; 1st half
    6535   00:C131  11 20 00            		ld de,32
    6536   00:C134  19                  		add hl,de
    6537   00:C135  36 FF               		ld (hl),255			; 2nd half
    6538   00:C137  C9                  		ret
    6539   00:C138                      .btzero:
    6540   00:C138                      		; upper half
    6541   00:C138  44                  		ld b,h
    6542   00:C139  4D                  		ld c,l				; get string lenght in BC
    6543   00:C13A  21 00 4A            		ld hl,scrmap
    6544   00:C13D  D1                  		pop de				; restores scrmap buffer pointer
    6545   00:C13E  19                  		add hl,de			; start of string in scrmap
    6546   00:C13F  54                  		ld d,h
    6547   00:C140  5D                  		ld e,l
    6548   00:C141  13                  		inc de
    6549   00:C142  36 FF               		ld (hl),255
    6550   00:C144  E5                  		push hl
    6551   00:C145  C5                  		push bc
    6552   00:C146  ED B0               		ldir
    6553   00:C148                      		; bottom half
    6554   00:C148  C1                  		pop bc
    6555   00:C149  E1                  		pop hl
    6556   00:C14A  11 20 00            		ld de,32
    6557   00:C14D  19                  		add hl,de
    6558   00:C14E  54                  		ld d,h
    6559   00:C14F  5D                  		ld e,l
    6560   00:C150  13                  		inc de
    6561   00:C151  36 FF               		ld (hl),255
    6562   00:C153  ED B0               		ldir
    6563   00:C155  C9                  		ret
    6564   00:C156                      .bmsg2:
    6565   00:C156  21 35 40            		ld hl,charx         ; y coordinate.
    6566   00:C159  34                  		inc (hl)            ; newline.
    6567   00:C15A  34                  		inc (hl)            ; newline.
    6568   00:C15B  7E                  		ld a,(hl)           ; fetch position.
    6569   00:C15C  FE 17               		cp MSX_MAXROWS-1		; past screen edge?
    6570   00:C15E  38 BE               		jr c,.bmsg3          ; no, it's okay.
    6571   00:C160  36 00               		ld (hl),0           ; restart at top.
    6572   00:C162  23                  		inc hl              ; y coordinate.
    6573   00:C163  36 00               		ld (hl),0           ; carriage return.
    6574   00:C165  18 B7               		jr .bmsg3
    6575   00:C167                      
    6576   00:C167                      
    6577   00:C167                      ; Big character display.
    6578   00:C167                      
    6579   00:C167                      bchar:
    6580   00:C167  07                  		rlca                ; multiply char by 8.
    6581   00:C168  07                  		rlca
    6582   00:C169  07                  		rlca
    6583   00:C16A  5F                  		ld e,a              ; store shift in e.
    6584   00:C16B  E6 07               		and 7               ; only want high byte bits.
    6585   00:C16D  57                  		ld d,a              ; store in d.
    6586   00:C16E  7B                  		ld a,e              ; restore shifted value.
    6587   00:C16F  E6 F8               		and $F8             ; only want low byte bits.
    6588   00:C171  5F                  		ld e,a              ; that's the low byte. DE=CHAR*8
    6589   00:C172  2A 3E 40            		ld hl,(grbase)      ; address of graphics.
    6590   00:C175  19                  		add hl,de           ; add displacement.
    6591   00:C176  CD B8 BD            		call gprad          ; get screen address (in DE)
    6592   00:C179                      
    6593   00:C179                      /*		
    6594   00:C179                    ~ 		dec d	
    6595   00:C179                    ~ 		ld b,2
    6596   00:C179                    ~ .nxtchar:		
    6597   00:C179                    ~ 		inc d
    6598   00:C179                    ~ 		SETWRT de
    6599   00:C179                    ~ 		ld c,4
    6600   00:C179                    ~ .nxtrow:
    6601   00:C179                    ~ 		ld a,(hl)
    6602   00:C179                    ~ 		out (MSX_VDPDRW),a
    6603   00:C179                    ~ 		inc hl
    6604   00:C179                    ~ 		dec c
    6605   00:C179                    ~ 		nop					; VDP slowdown		
    6606   00:C179                    ~ 		out (MSX_VDPDRW),a
    6607   00:C179                    ~ 		jr nz,.nxtrow
    6608   00:C179                    ~ 		djnz .nxtchar
    6609   00:C179                    ~ */
    6610   00:C179                      
    6611   00:C179  06 02               		ld b,2
    6612   00:C17B                      .nxtchar:		
    6613   00:C17B                      
    6614   00:C17B  7B                  		ld a,e
    6615   00:C17C  F3                  		di
    6616   00:C17D  D3 BF               		out (MSX_VDPCW),a
    6617   00:C17F  7A                  		ld a,d
    6618   00:C180  F6 40               		or $40
    6619   00:C182  D3 BF               		out (MSX_VDPCW),a
    6620   00:C184  FB                  		ei	
    6621   00:C185                      
    6622   00:C185  0E 04               		ld c,4
    6623   00:C187                      .nxtrow:
    6624   00:C187  7E                  		ld a,(hl)
    6625   00:C188  D3 BE               		out (MSX_VDPDRW),a
    6626   00:C18A  23                  		inc hl
    6627   00:C18B  0D                  		dec c
    6628   00:C18C  00                  		nop					; VDP slowdown		
    6629   00:C18D  D3 BE               		out (MSX_VDPDRW),a
    6630   00:C18F  20 F6               		jr nz,.nxtrow
    6631   00:C191  14                  		inc d
    6632   00:C192  10 E7               		djnz .nxtchar
    6633   00:C194                      		
    6634   00:C194  15                  		dec d
    6635   00:C195  15                  		dec d
    6636   00:C196  7A                  		ld a,d
    6637   00:C197  F6 60               		or $60
    6638   00:C199  57                  		ld d,a
    6639   00:C19A                      
    6640   00:C19A  3A 39 40            		ld a,(clratt)
    6641   00:C19D  0E BF               		ld c,MSX_VDPCW
    6642   00:C19F  2E 02               		ld l,2
    6643   00:C1A1                      nxtchar2:		
    6644   00:C1A1  F3                          di
    6645   00:C1A2  ED 59                       out (c),e
    6646   00:C1A4  FB                          ei		
    6647   00:C1A5  ED 51                       out (c),d
    6648   00:C1A7  06 08               		ld b,8
    6649   00:C1A9                      nxtfile2:
    6650   00:C1A9  D3 BE               		out (MSX_VDPDRW),a
    6651   00:C1AB  10 FC               		djnz nxtfile2
    6652   00:C1AD  14                  		inc d
    6653   00:C1AE  2D                  		dec l
    6654   00:C1AF  20 F0               		jr nz,nxtchar2
    6655   00:C1B1                      
    6656   00:C1B1                      /*
    6657   00:C1B1                    ~ 		ld b,2
    6658   00:C1B1                    ~ nxtchar2:		
    6659   00:C1B1                    ~ 
    6660   00:C1B1                    ~ 		ld a,e
    6661   00:C1B1                    ~         di
    6662   00:C1B1                    ~         out (MSX_VDPCW),a
    6663   00:C1B1                    ~         ld a,d
    6664   00:C1B1                    ~ 		ld c,8
    6665   00:C1B1                    ~         or 64       		;for write, set bit 6 high
    6666   00:C1B1                    ~         out (MSX_VDPCW),a
    6667   00:C1B1                    ~         ei		
    6668   00:C1B1                    ~ 
    6669   00:C1B1                    ~ 		ld a,(clratt)
    6670   00:C1B1                    ~ nxtfile2:
    6671   00:C1B1                    ~ 		out (MSX_VDPDRW),a
    6672   00:C1B1                    ~ 		dec c
    6673   00:C1B1                    ~ 		jr nz,nxtfile2
    6674   00:C1B1                    ~ 		inc d
    6675   00:C1B1                    ~ 		djnz nxtchar2	
    6676   00:C1B1                    ~ */
    6677   00:C1B1                      
    6678   00:C1B1                      		
    6679   00:C1B1  CD D6 C1            bchar1 call nexpos         ; display position.
    6680   00:C1B4  C2 BB C1                   jp nz,bchar2        ; not on a new line.
    6681   00:C1B7  34                  bchar3 inc (hl)            ; newline.
    6682   00:C1B8  CD E0 C1                   call nexlin         ; next line check.
    6683   00:C1BB  C3 20 BD            bchar2 jp dscor2           ; tidy up line and column variables.
    6684   00:C1BE                      
    6685   00:C1BE                      ; Display a character. (MSX:OK)
    6686   00:C1BE                      
    6687   00:C1BE                      achar:
    6688   00:C1BE  47                  		ld b,a              ; copy to b.
    6689   00:C1BF  CD E8 C1            		call preprt         ; get ready to print.
    6690   00:C1C2  3A 38 40            		ld a,(prtmod)       ; print mode.
    6691   00:C1C5  A7                  		and a               ; standard size?
    6692   00:C1C6  78                  		ld a,b              ; character in accumulator.
    6693   00:C1C7  C2 67 C1            		jp nz,bchar         ; no, double-height text.
    6694   00:C1CA  CD F7 BD            		call ptxt           ; display character.
    6695   00:C1CD                      	   
    6696   00:C1CD  CD D6 C1            		call nexpos         ; display position.
    6697   00:C1D0  CA B7 C1            		jp z,bchar3         ; next line down.
    6698   00:C1D3  C3 BB C1            		jp bchar2           ; tidy up.
    6699   00:C1D6                      
    6700   00:C1D6                      ; Get next print column position.(MSX:OK)
    6701   00:C1D6                      
    6702   00:C1D6                      nexpos:
    6703   00:C1D6  21 55 40            		ld hl,dispy         ; X display position.
    6704   00:C1D9  7E                  		ld a,(hl)           ; get coordinate.
    6705   00:C1DA  3C                  		inc a               ; move along one position.
    6706   00:C1DB  E6 1F               		and MSX_MAXCOLS-1   ; reached edge of screen?
    6707   00:C1DD                      		
    6708   00:C1DD  77                  		ld (hl),a           ; set new position.
    6709   00:C1DE  2B                  		dec hl              ; point to y now.
    6710   00:C1DF  C9                  		ret                 ; return with status in zero flag.
    6711   00:C1E0                      
    6712   00:C1E0                      ; Get next print line position. (MSX:OK)
    6713   00:C1E0                      
    6714   00:C1E0  34                  nexlin inc (hl)            ; newline.
    6715   00:C1E1  7E                         ld a,(hl)           ; vertical position.
    6716   00:C1E2  FE 18                      cp MSX_MAXROWS      ; past screen edge?
    6717   00:C1E4  D8                         ret c               ; no, still okay.
    6718   00:C1E5  36 00                      ld (hl),0           ; restart at top.
    6719   00:C1E7  C9                         ret
    6720   00:C1E8                      
    6721   00:C1E8                      ; Pre-print preliminaries.
    6722   00:C1E8                      
    6723   00:C1E8                      preprt: 
    6724   00:C1E8  11 C4 B0            		ld de,font-256		; font pointer, skipping first 32 ASCII codes
    6725   00:C1EB  ED 53 3E 40         		ld (grbase),de      ; set up graphics base.
    6726   00:C1EF                      prescr:
    6727   00:C1EF  ED 5B 35 40         		ld de,(charx)       ; display coordinates.
    6728   00:C1F3  ED 53 54 40         		ld (dispx),de       ; set up general coordinates.
    6729   00:C1F7  C9                  		ret
    6730   00:C1F8                      
    6731   00:C1F8                      ; On entry: hl points to word list
    6732   00:C1F8                      ;           a contains word number.
    6733   00:C1F8                      ; Modifies: b,a,hl
    6734   00:C1F8                      
    6735   00:C1F8                      getwrd:	; (MSX:OK)
    6736   00:C1F8  A7                  		and a               ; first word in list?
    6737   00:C1F9  C8                  		ret z               ; yep, don't search.
    6738   00:C1FA  47                  		ld b,a
    6739   00:C1FB                      getwd0:
    6740   00:C1FB  7E                  		ld a,(hl)
    6741   00:C1FC  23                  		inc hl
    6742   00:C1FD  FE 80               		cp 128              ; found end?
    6743   00:C1FF  38 FA               		jr c,getwd0         ; no, carry on.
    6744   00:C201  10 F8               		djnz getwd0         ; until we have right number.
    6745   00:C203  C9                  		ret
    6746   00:C204                      
    6747   00:C204                      ; Process sprites.
    6748   00:C204                      		
    6749   00:C204                      pspr:
    6750   00:C204  3A 4B 40            		ld a,(highslot)
    6751   00:C207  A7                  		and a
    6752   00:C208  C8                  		ret z				; no sprites, nothing to do
    6753   00:C209                      		ifdef DEBUG
    6754   00:C209                    ~ 		BORDER 6
    6755   00:C209                    ~ 		endif
    6756   00:C209  47                  		ld b,a
    6757   00:C20A  DD 21 B4 40         		ld ix,sprtab        ; sprite table.
    6758   00:C20E                      .loop:
    6759   00:C20E  C5                  		push bc
    6760   00:C20F  DD 7E 00            		ld a,(ix+0)         ; fetch sprite type.
    6761   00:C212  FE 09               		cp 9                ; within range of sprite types?
    6762   00:C214  DC 20 C2            		call c,pspr2        ; yes, process this one.
    6763   00:C217  11 11 00            		ld de,TABSIZ        ; distance to next odd/even entry.
    6764   00:C21A  DD 19               		add ix,de           ; next sprite.
    6765   00:C21C  C1                  		pop bc
    6766   00:C21D  10 EF               		djnz .loop
    6767   00:C21F                      		ifdef DEBUG
    6768   00:C21F                    ~ 		BORDER 9
    6769   00:C21F                    ~ 		endif
    6770   00:C21F  C9                  		ret
    6771   00:C220                      pspr2:
    6772   00:C220  DD 22 42 40         		ld (ogptr),ix       ; store original sprite pointer.
    6773   00:C224  67                  		ld h,a
    6774   00:C225  DD 7E 03            		ld a,(ix+3)			; saves sprite coordinates as backup
    6775   00:C228  DD 77 08            		ld (ix+8),a
    6776   00:C22B  DD 7E 04            		ld a,(ix+4)
    6777   00:C22E  DD 77 09            		ld (ix+9),a
    6778   00:C231  7C                  		ld a,h
    6779   00:C232  CD 3A C2            		call pspr3          ; do the routine.
    6780   00:C235                      ; rtorg:
    6781   00:C235  DD 2A 42 40         		ld ix,(ogptr)       ; restore original pointer to sprite.
    6782   00:C239                      ; rtorg0:
    6783   00:C239  C9                  		ret
    6784   00:C23A                      pspr3:
    6785   00:C23A  21 48 C2            		ld hl,evtyp0        ; sprite type events list.
    6786   00:C23D                      pspr4:
    6787   00:C23D  87                  		add a,a             ; double accumulator.
    6788   00:C23E                      		ADD_HL_A
    6788   00:C23E  85                >   add a,l
    6788   00:C23F  6F                >   ld l,a
    6788   00:C240  8C                >   adc a,h
    6788   00:C241  95                >   sub l
    6788   00:C242  67                >   ld h,a
    6789   00:C243                      ;
    6790   00:C243                      ; Makes an indirect jump based on the contents of HL
    6791   00:C243                      ;
    6792   00:C243                      jumphl:	
    6793   00:C243  7E                  		ld a,(hl)
    6794   00:C244  23                  		inc hl
    6795   00:C245  66                  		ld h,(hl)
    6796   00:C246  6F                  		ld l,a
    6797   00:C247  E9                  		jp (hl)
    6798   00:C248                      
    6799   00:C248                      ; Address of each sprite type's routine.
    6800   00:C248                      
    6801   00:C248  A2 80               evtyp0:	dw evnt00
    6802   00:C24A  5D 83               evtyp1:	dw evnt01
    6803   00:C24C  14 84               evtyp2:	dw evnt02
    6804   00:C24E  46 84               evtyp3:	dw evnt03
    6805   00:C250  86 84               evtyp4:	dw evnt04
    6806   00:C252  D1 84               evtyp5:	dw evnt05
    6807   00:C254  1D 85               evtyp6:	dw evnt06
    6808   00:C256  57 85               evtyp7:	dw evnt07
    6809   00:C258  1D 8A               evtyp8:	dw evnt08
    6810   00:C25A                      
    6811   00:C25A                      ; Look for sprites not mapped yet and map them
    6812   00:C25A                      ; Input:
    6813   00:C25A                      ;	None
    6814   00:C25A                      ; Output:
    6815   00:C25A                      ;	None. Sprites mapped
    6816   00:C25A                      ;
    6817   00:C25A                      chkimg:
    6818   00:C25A  3A 4B 40            		ld a,(highslot)
    6819   00:C25D  A7                  		and a
    6820   00:C25E  C8                  		ret z				; no sprites, nothing to do
    6821   00:C25F                      		ifdef DEBUG
    6822   00:C25F                    ~ 		BORDER 3
    6823   00:C25F                    ~ 		endif
    6824   00:C25F  47                  		ld b,a
    6825   00:C260  11 11 00            		ld de,TABSIZ				
    6826   00:C263                      .loop:		
    6827   00:C263  DD 7E 00            		ld a,(ix+0)			; get sprite type
    6828   00:C266  3C                  		inc a
    6829   00:C267  28 14               		jr z,.nxtspr		; is the sprite active?		
    6830   00:C269  DD 7E 01            		ld a,(ix+1)		
    6831   00:C26C  4F                   		ld c,a
    6832   00:C26D  CD AC C5            		call gfrm
    6833   00:C270  6E                  		ld l,(hl)
    6834   00:C271  26 4D               		ld h,mapspr>>8		
    6835   00:C273  7E                  		ld a,(hl)
    6836   00:C274  3C                  		inc a				; has already been mapped?
    6837   00:C275  20 06               		jr nz,.nxtspr
    6838   00:C277  79                  		ld a,c
    6839   00:C278  EB                  		ex de,hl
    6840   00:C279  CD 82 C6             		call mapsprite		; the sprite has not been mapped ($FF), do it now
    6841   00:C27C  EB                  		ex de,hl
    6842   00:C27D                      .nxtspr:		
    6843   00:C27D  DD 19               		add ix,de           ; next sprite.
    6844   00:C27F  10 E2               		djnz .loop          ; repeat for remaining sprites.
    6845   00:C281                      		ifdef DEBUG
    6846   00:C281                    ~ 		BORDER 14
    6847   00:C281                    ~ 		endif
    6848   00:C281  C9                  		ret
    6849   00:C282                       
    6850   00:C282                      disscreen:
    6851   00:C282  C3 41 00            		jp MSX_DISSCR
    6852   00:C285                      
    6853   00:C285                      enascreen:
    6854   00:C285  C3 44 00            		jp MSX_ENASCR
    6855   00:C288                      		
    6856   00:C288                      dissprs:
    6857   00:C288  3E D0               		ld a,MSX_HIDE_SPRITES	; disable all sprites
    6858   00:C28A  21 00 1B            		ld hl,MSX_SPRATR
    6859   00:C28D  C3 A3 CB            		jp MSX_WRTVRM
    6860   00:C290                      
    6861   00:C290                      ;
    6862   00:C290                      ; Copy data from RAM to VRAM
    6863   00:C290                      ; Input:
    6864   00:C290                      ; 	HL: Source in RAM
    6865   00:C290                      ; 	DE: VRAM address to copy to
    6866   00:C290                      ;	B: bytes to copy (0-255, 0 is 256 bytes)
    6867   00:C290                      ; Output:
    6868   00:C290                      ;	None. 
    6869   00:C290                      
    6870   00:C290                      
    6871   00:C290                      ;		 
    6872   00:C290                      ram2vram:
    6873   00:C290  0E BF               		ld c,MSX_VDPCW
    6874   00:C292  F3                          di
    6875   00:C293  ED 59                       out (c),e
    6876   00:C295  CB F2                       set 6,d			; high byte set for write
    6877   00:C297  FB                          ei	
    6878   00:C298  ED 51                       out (c),d
    6879   00:C29A  0D                  		dec c 
    6880   00:C29B                      .loop:		
    6881   00:C29B                      		[8] outi
    6881   00:C29B  ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 
    6882   00:C2AB  C2 9B C2            		jp nz,.loop
    6883   00:C2AE  C9                  		ret
    6884   00:C2AF                      
    6885   00:C2AF                      ;
    6886   00:C2AF                      ; Copy data from RAM to VRAM
    6887   00:C2AF                      ; Input:
    6888   00:C2AF                      ; 	HL: Source in RAM
    6889   00:C2AF                      ; 	DE: VRAM address to copy to
    6890   00:C2AF                      ;	B: bytes to copy (0-255, 0 is 256 bytes)
    6891   00:C2AF                      ; Output:
    6892   00:C2AF                      ;	None. 
    6893   00:C2AF                      ;		 
    6894   00:C2AF                      ram2vram_slow:
    6895   00:C2AF  0E BF               		ld c,MSX_VDPCW
    6896   00:C2B1  F3                          di
    6897   00:C2B2  ED 59                       out (c),e
    6898   00:C2B4  CB F2                       set 6,d			; high byte set for write
    6899   00:C2B6  FB                          ei	
    6900   00:C2B7  ED 51                       out (c),d
    6901   00:C2B9  0D                  		dec c 
    6902   00:C2BA                      .loop:		
    6903   00:C2BA  ED A3               		outi
    6904   00:C2BC  C2 BA C2            		jp nz,.loop
    6905   00:C2BF  C9                  		ret
    6906   00:C2C0                      
    6907   00:C2C0                       
    6908   00:C2C0                      buildspr:
    6909   00:C2C0  3A 4B 40            		ld a,(highslot)		; max number of sprites being instantiated
    6910   00:C2C3  A7                  		and a
    6911   00:C2C4  C8                  		ret z				; no sprites, nothing to do
    6912   00:C2C5                      		ifdef DEBUG
    6913   00:C2C5                    ~ 		BORDER 12
    6914   00:C2C5                    ~ 		endif
    6915   00:C2C5  DD 21 B4 40         		ld ix,sprtab
    6916   00:C2C9  47                  		ld b,a
    6917   00:C2CA  21 80 45            		ld hl,spratr
    6918   00:C2CD  22 76 40            		ld (sprptr),hl
    6919   00:C2D0                      .loop:		
    6920   00:C2D0  DD 7E 00            		ld a,(ix+0)			; get sprite type
    6921   00:C2D3  3C                  		inc a
    6922   00:C2D4  20 08               		jr nz,.ison			; is the sprite active?
    6923   00:C2D6  3E D1               		ld a,MSX_HIDE_SPRITE	; not active
    6924   00:C2D8  77                  		ld (hl),a			; Y
    6925   00:C2D9  2C                  		inc l
    6926   00:C2DA  2C                  		inc l
    6927   00:C2DB  2C                  		inc l
    6928   00:C2DC  18 22               		jr .nxtspr		
    6929   00:C2DE                      .ison:		
    6930   00:C2DE  DD 7E 03            		ld a,(ix+3)			
    6931   00:C2E1  3D                  		dec a				; corrects y MSX sprite coordinate		
    6932   00:C2E2  77                  		ld (hl),a			; Y
    6933   00:C2E3  2C                  		inc l		
    6934   00:C2E4                      		
    6935   00:C2E4  DD 7E 04            		ld a,(ix+4)				
    6936   00:C2E7  77                  		ld (hl),a			; X	
    6937   00:C2E8  2C                  		inc l
    6938   00:C2E9                      
    6939   00:C2E9  EB                  		ex de,hl
    6940   00:C2EA  DD 7E 01            		ld a,(ix+1)
    6941   00:C2ED  CD AC C5            		call gfrm
    6942   00:C2F0  6E                  		ld l,(hl)
    6943   00:C2F1  26 4D               		ld h,mapspr>>8				
    6944   00:C2F3  7E                  		ld a,(hl)			; gets real frame from mapspr table
    6945   00:C2F4  DD 86 02            		add a,(ix+2)
    6946   00:C2F7  87                  		add a,a
    6947   00:C2F8  87                  		add a,a
    6948   00:C2F9  EB                  		ex de,hl
    6949   00:C2FA  77                  		ld (hl),a			; image number * 4
    6950   00:C2FB  2C                  		inc l
    6951   00:C2FC                      		
    6952   00:C2FC  DD 7E 05            		ld a,(ix+5)
    6953   00:C2FF  77                  		ld (hl),a
    6954   00:C300                      .nxtspr:
    6955   00:C300  2C                  		inc l		
    6956   00:C301  11 11 00            		ld de,TABSIZ		
    6957   00:C304  DD 19               		add ix,de           ; next sprite.
    6958   00:C306  10 C8               		djnz .loop          ; repeat for remaining sprites.
    6959   00:C308  3E D0               		ld a,MSX_HIDE_SPRITES	; no more sprite from here
    6960   00:C30A  77                  		ld (hl),a
    6961   00:C30B                      
    6962   00:C30B                      ; ----------------------------------
    6963   00:C30B                      
    6964   00:C30B                      sprflick:	
    6965   00:C30B  21 80 45            		ld hl,spratr
    6966   00:C30E  3A E7 53            		ld a,(MSX_STATFL)
    6967   00:C311  CB 77               		bit 6,a
    6968   00:C313  20 07               		jr nz,.flick
    6969   00:C315  3E 80               		ld a,colltab&$FF
    6970   00:C317  32 5A 40            		ld (offset),a
    6971   00:C31A  18 72               		jr .no5th
    6972   00:C31C                      .flick:
    6973   00:C31C                      		; sort sprites into two separate lists (aligned with 5th & not aligned)
    6974   00:C31C  E6 1F               		and 31				; get 5th sprite plane number
    6975   00:C31E  5F                  		ld e,a
    6976   00:C31F  3A 4B 40            		ld a,(highslot)
    6977   00:C322  BB                  		cp e
    6978   00:C323  38 69               		jr c,.no5th			; 5th has been removed?, no flicker then...
    6979   00:C325                      		;
    6980   00:C325  08                  		ex af,af			; save number of sprites in screen
    6981   00:C326  7B                  		ld a,e
    6982   00:C327  11 00 45            		ld de,spratr2		; new sprite attribute table
    6983   00:C32A  D5                  		push de
    6984   00:C32B  54                  		ld d,h
    6985   00:C32C  5D                  		ld e,l
    6986   00:C32D  87                  		add a,a
    6987   00:C32E  87                  		add a,a				; 5th sprite plane * 4
    6988   00:C32F  83                  		add a,e				; DE now points to 5th sprite plane attributes
    6989   00:C330  5F                  		ld e,a
    6990   00:C331                      		;
    6991   00:C331  08                  		ex af,af			; restores number of sprites in screen
    6992   00:C332  47                  		ld b,a				; number of sprites to check
    6993   00:C333  1A                  		ld a,(de)			; 
    6994   00:C334  4F                  		ld c,a				; get C=Y-coord of 5th sprite
    6995   00:C335  11 80 4D            		ld de,colltab		; aligned with 5th list
    6996   00:C338                      .lp:
    6997   00:C338  7E                  		ld a,(hl)			; get Y coord of sprite from master sprite attribute table
    6998   00:C339  91                  		sub c				 
    6999   00:C33A  30 02               		jr nc,.bottom		; compare both Y coords
    7000   00:C33C  ED 44               		neg					; if 5th Y coord is greater, negate the difference
    7001   00:C33E                      .bottom:		
    7002   00:C33E  FE 10               		cp MSX_SPRVS		; compare the difference with sprite vertical size
    7003   00:C340  30 0C               		jr nc,.noovlp		; if diff > sprite vertical size, there's no vertical overlapping
    7004   00:C342  C5                  		push bc					
    7005   00:C343  ED A0               		ldi
    7006   00:C345  ED A0               		ldi
    7007   00:C347  ED A0               		ldi
    7008   00:C349  ED A0               		ldi					; store sprite attributes in colltab
    7009   00:C34B  C1                  		pop bc
    7010   00:C34C  18 10               		jr .nxt
    7011   00:C34E                      .noovlp:
    7012   00:C34E                      		EX_SP_DE			; swaps lists colltab<>spratr2
    7012   00:C34E  EB                >   ex de,hl
    7012   00:C34F  E3                >   ex (sp),hl
    7012   00:C350  EB                >   ex de,hl
    7013   00:C351  C5                  		push bc
    7014   00:C352  ED A0               		ldi
    7015   00:C354  ED A0               		ldi
    7016   00:C356  ED A0               		ldi
    7017   00:C358  ED A0               		ldi					; now store sprite attributes in spratr2
    7018   00:C35A  C1                  		pop bc
    7019   00:C35B                      		EX_SP_DE			; restores lists pointers
    7019   00:C35B  EB                >   ex de,hl
    7019   00:C35C  E3                >   ex (sp),hl
    7019   00:C35D  EB                >   ex de,hl
    7020   00:C35E                      .nxt:
    7021   00:C35E  10 D8               		djnz .lp
    7022   00:C360                      		; rotate SAT segments (only 5th related sprites)
    7023   00:C360  4B                  		ld c,e
    7024   00:C361  3A 5A 40            		ld a,(offset)
    7025   00:C364  C6 10               		add a,16
    7026   00:C366  B9                  		cp c
    7027   00:C367  38 09               		jr c,.noreset 
    7028   00:C369  3E 80               		ld a,colltab&$FF
    7029   00:C36B  32 5A 40            		ld (offset),a		; store offset to split SAT
    7030   00:C36E  7B                  		ld a,e
    7031   00:C36F  D1                  		pop de
    7032   00:C370  18 0E               		jr .fullsat			; SAT is not splitted, only one copy needed		
    7033   00:C372                      .noreset:		
    7034   00:C372  32 5A 40            		ld (offset),a		; store offset to split SAT
    7035   00:C375  62                  		ld h,d
    7036   00:C376  6F                  		ld l,a
    7037   00:C377  79                  		ld a,c
    7038   00:C378  95                  		sub l
    7039   00:C379  4F                  		ld c,a
    7040   00:C37A  D1                  		pop de
    7041   00:C37B  ED B0               		ldir				; copy first half 
    7042   00:C37D  3A 5A 40            		ld a,(offset)
    7043   00:C380                      .fullsat:
    7044   00:C380  D6 80               		sub colltab&$FF
    7045   00:C382  4F                  		ld c,a
    7046   00:C383  21 80 4D            		ld hl,colltab
    7047   00:C386  ED B0               		ldir				; copy 2nd half
    7048   00:C388  3E D0               		ld a,MSX_HIDE_SPRITES	; no more sprite from here
    7049   00:C38A  12                  		ld (de),a
    7050   00:C38B  21 00 45            		ld hl,spratr2
    7051   00:C38E                      .no5th:
    7052   00:C38E  22 76 40            		ld (sprptr),hl
    7053   00:C391                      
    7054   00:C391                      		ifdef DEBUG
    7055   00:C391                    ~ 		BORDER 14
    7056   00:C391                    ~ 		endif
    7057   00:C391                      
    7058   00:C391  C9                  		ret
    7059   00:C392                      
    7060   00:C392                      
    7061   00:C392                      /*
    7062   00:C392                    ~  ; Could be reworked
    7063   00:C392                    ~ 		ld hl,spratr
    7064   00:C392                    ~ 		ld a,(MSX_STATFL)
    7065   00:C392                    ~ 		bit 6,a
    7066   00:C392                    ~ 		jp z,.NO5TH
    7067   00:C392                    ~ 		
    7068   00:C392                    ~ 		ld e,a
    7069   00:C392                    ~ 		ld a,(offset)
    7070   00:C392                    ~ 		or a
    7071   00:C392                    ~ 		jr z,.NOLDIR
    7072   00:C392                    ~ 		cp 255
    7073   00:C392                    ~ 		jr nz,.NOINIT
    7074   00:C392                    ~ 		ld a,e
    7075   00:C392                    ~ 		and $3C
    7076   00:C392                    ~ 		add a,a
    7077   00:C392                    ~ 		add a,a		
    7078   00:C392                    ~ .NOINIT:	
    7079   00:C392                    ~ 		ld b,0
    7080   00:C392                    ~ 		ld c,a
    7081   00:C392                    ~ 		ld de,spratr2
    7082   00:C392                    ~ 		ldir
    7083   00:C392                    ~ .NOLDIR:	
    7084   00:C392                    ~ 		add a,16
    7085   00:C392                    ~ 		and $3F
    7086   00:C392                    ~ 		jp .NORESET
    7087   00:C392                    ~ 		
    7088   00:C392                    ~ .NO5TH:	
    7089   00:C392                    ~ 		ld a,255
    7090   00:C392                    ~ .NORESET:	
    7091   00:C392                    ~ 		ld (offset),a
    7092   00:C392                    ~ 		ld (sprptr),hl
    7093   00:C392                    ~ */
    7094   00:C392                      
    7095   00:C392                      dumpspr:
    7096   00:C392  3A 4B 40            		ld a,(highslot)
    7097   00:C395  A7                  		and a
    7098   00:C396  C8                  		ret z				; no sprites, nothing to do
    7099   00:C397                      		ifdef DEBUG
    7100   00:C397                    ~ 		BORDER 10
    7101   00:C397                    ~ 		endif		
    7102   00:C397  87                  		add a,a
    7103   00:C398  87                  		add a,a		
    7104   00:C399  C6 08               		add a,8
    7105   00:C39B  E6 F8               		and $F8				; only send to VRAM multiples of 8 
    7106   00:C39D  47                  		ld b,a
    7107   00:C39E  2A 76 40            		ld hl,(sprptr)
    7108   00:C3A1  11 00 1B            		ld de,MSX_SPRATR
    7109   00:C3A4                      		ifdef FASTVRAMDUMP
    7110   00:C3A4                    ~ 		call ram2vram
    7111   00:C3A4                    ~ 		else
    7112   00:C3A4  CD AF C2            		call ram2vram_slow
    7113   00:C3A7                      		endif
    7114   00:C3A7                      		ifdef DEBUG
    7115   00:C3A7                    ~ 		BORDER 14
    7116   00:C3A7                    ~ 		endif
    7117   00:C3A7  C9                  		ret
    7118   00:C3A8                      		
    7119   00:C3A8                      ; Drop into screen address routine. (MSX:OK)
    7120   00:C3A8                      ; This routine returns in HL a screen address for (dispx, dispy). Must not modify DE
    7121   00:C3A8                      
    7122   00:C3A8                      scadd:
    7123   00:C3A8  3A 54 40            		ld a,(dispx)	; 14
    7124   00:C3AB  6F                  		ld l,a			; 5
    7125   00:C3AC  E6 F8               		and $F8			; 7
    7126   00:C3AE  0F                  		rrca			; 5
    7127   00:C3AF  0F                  		rrca			; 5
    7128   00:C3B0  0F                  		rrca			; 5
    7129   00:C3B1  67                  		ld h,a			; 5
    7130   00:C3B2  7D                  		ld a,l			; 5
    7131   00:C3B3  E6 07               		and $07			; 7
    7132   00:C3B5  6F                  		ld l,a			; 5 HL= ((y/8)*256+y%8)
    7133   00:C3B6  3A 55 40            		ld a,(dispy)	; 14
    7134   00:C3B9  E6 F8               		and $F8			; 7 A = (x/8)*8
    7135   00:C3BB                      		ADD_HL_A		; 25
    7135   00:C3BB  85                >   add a,l
    7135   00:C3BC  6F                >   ld l,a
    7135   00:C3BD  8C                >   adc a,h
    7135   00:C3BE  95                >   sub l
    7135   00:C3BF  67                >   ld h,a
    7136   00:C3C0  C9                  		ret	
    7137   00:C3C1                      		
    7138   00:C3C1                      		
    7139   00:C3C1                      ; Animates a sprite.
    7140   00:C3C1                      
    7141   00:C3C1                      animsp:
    7142   00:C3C1  21 4D 40            		ld hl,frmno         ; game frame.
    7143   00:C3C4  A6                  		and (hl)            ; is it time to change the frame?
    7144   00:C3C5  C0                  		ret nz              ; not this frame.
    7145   00:C3C6  DD 7E 01            		ld a,(ix+1)         ; sprite image.
    7146   00:C3C9  CD AC C5            		call gfrm           ; get frame data.
    7147   00:C3CC  23                  		inc hl              ; point to frames.
    7148   00:C3CD  DD 7E 02            		ld a,(ix+2)         ; sprite frame.
    7149   00:C3D0  3C                  		inc a               ; next one along.
    7150   00:C3D1  BE                  		cp (hl)             ; reached the last frame?
    7151   00:C3D2  38 01               		jr c,anims0         ; no, not yet.
    7152   00:C3D4  AF                  		xor a               ; start at first frame.
    7153   00:C3D5                      anims0:
    7154   00:C3D5  DD 77 02            		ld (ix+2),a         ; new frame.
    7155   00:C3D8  C9                  		ret
    7156   00:C3D9                      animbk:
    7157   00:C3D9  21 4D 40            		ld hl,frmno         ; game frame.
    7158   00:C3DC  A6                  		and (hl)            ; is it time to change the frame?
    7159   00:C3DD  C0                  		ret nz              ; not this frame.
    7160   00:C3DE  DD 7E 01            		ld a,(ix+1)         ; sprite image.
    7161   00:C3E1  CD AC C5            		call gfrm           ; get frame data.
    7162   00:C3E4  23                  		inc hl              ; point to frames.
    7163   00:C3E5  DD 7E 02            		ld a,(ix+2)         ; sprite frame.
    7164   00:C3E8  A7                  		and a               ; first one?
    7165   00:C3E9  20 01               		jr nz,.rtanb0        ; yes, start at end.
    7166   00:C3EB  7E                  		ld a,(hl)           ; last sprite.
    7167   00:C3EC                      .rtanb0:
    7168   00:C3EC  3D                  		dec a               ; next one along.
    7169   00:C3ED  18 E6               		jr anims0           ; set new frame.
    7170   00:C3EF                      
    7171   00:C3EF                      ; Check for collision with other sprite, strict enforcement.
    7172   00:C3EF                      ; Input:
    7173   00:C3EF                      ;	C = NUmber of sprite to check for collision
    7174   00:C3EF                      sktyp:  
    7175   00:C3EF  41                  		ld b,c
    7176   00:C3F0  3A 4B 40            		ld a,(highslot)
    7177   00:C3F3  A7                  		and a
    7178   00:C3F4  C8                  		ret z				; no sprites, nothing to do
    7179   00:C3F5                      		ifdef DEBUG
    7180   00:C3F5                    ~ 		BORDER 4
    7181   00:C3F5                    ~ 		endif
    7182   00:C3F5                      	
    7183   00:C3F5                      	if HCFLAG=1
    7184   00:C3F5                    ~ 		ld a,(MSX_STATFL)
    7185   00:C3F5                    ~ 		and 00100000b		; check hardware sprites collision
    7186   00:C3F5                    ~ 		jr z,.nocoll		; no collisions, skip routine
    7187   00:C3F5                    ~ 	endif
    7188   00:C3F5                      	
    7189   00:C3F5                      		; There's a collision, find it
    7190   00:C3F5                      		
    7191   00:C3F5  21 B4 40            		ld hl,sprtab        ; sprite table.
    7192   00:C3F8                      .loop: 
    7193   00:C3F8  08                  		ex af,af            ; store loop counter.
    7194   00:C3F9  22 49 40            		ld (skptr),hl       ; store pointer to sprite.
    7195   00:C3FC  7E                  		ld a,(hl)           ; get sprite type.
    7196   00:C3FD  B8                  		cp b                ; is it the type we seek?
    7197   00:C3FE  28 14               		jr z,coltyp         ; yes, we can use this one.
    7198   00:C400                      .sktyp1: 
    7199   00:C400  2A 49 40            		ld hl,(skptr)       ; retrieve sprite pointer.
    7200   00:C403                      		
    7201   00:C403  11 11 00            		ld de,TABSIZ        ; size of each entry.
    7202   00:C406  19                  		add hl,de           ; point to next sprite in table.
    7203   00:C407                      		
    7204   00:C407  08                  		ex af,af           ; restore loop counter.
    7205   00:C408  3D                  		dec a               ; one less iteration.
    7206   00:C409  C2 F8 C3            		jp nz,.loop        ; keep going until we find a slot.
    7207   00:C40C                      		
    7208   00:C40C  21 00 00            		ld hl,0             ; default to ROM address - no sprite.
    7209   00:C40F  22 49 40            		ld (skptr),hl       ; store pointer to sprite.
    7210   00:C412  B4                  		or h                ; don't return with zero flag set.
    7211   00:C413                      .nocoll:
    7212   00:C413                      		ifdef DEBUG
    7213   00:C413                    ~ 		BORDER 6
    7214   00:C413                    ~ 		endif
    7215   00:C413  C9                  		ret                 ; didn't find one.
    7216   00:C414                      
    7217   00:C414                      coltyp:
    7218   00:C414  DD 7E 00            		ld a,(ix+0)         ; current sprite type.
    7219   00:C417  B8                  		cp b                ; seeking sprite of same type?
    7220   00:C418  28 27               		jr z,.colty1        ; yes, need to check we're not detecting ourselves.
    7221   00:C41A                      .colty0:
    7222   00:C41A  11 03 00            		ld de,X             ; distance to x position in table.
    7223   00:C41D  19                  		add hl,de           ; point to coords.
    7224   00:C41E                      		
    7225   00:C41E  5E                  		ld e,(hl)           ; fetch x coordinate.
    7226   00:C41F  23                  		inc hl              ; now point to y.
    7227   00:C420  56                  		ld d,(hl)           ; that's y coordinate.
    7228   00:C421                      
    7229   00:C421                      ; Drop into collision detection.
    7230   00:C421                      ;colc16:
    7231   00:C421  DD 7E 03            		ld a,(ix+X)         ; x coord.
    7232   00:C424  93                  		sub e               ; subtract x.
    7233   00:C425  30 02               		jr nc,.colc1a        ; result is positive.
    7234   00:C427  ED 44               		neg                 ; make negative positive.
    7235   00:C429                      .colc1a:
    7236   00:C429  FE 10               		cp 16               ; within x range?
    7237   00:C42B  30 D3               		jr nc,sktyp.sktyp1        ; no - they've missed.
    7238   00:C42D  4F                  		ld c,a              ; store difference.
    7239   00:C42E  DD 7E 04            		ld a,(ix+Y)         ; y coord.
    7240   00:C431  92                  		sub d               ; subtract y.
    7241   00:C432  30 02               		jr nc,.colc1b        ; result is positive.
    7242   00:C434  ED 44               		neg                 ; make negative positive.
    7243   00:C436                      .colc1b:
    7244   00:C436  FE 10               		cp 16               ; within y range?
    7245   00:C438  30 C6               		jr nc,sktyp.sktyp1        ; no - they've missed.
    7246   00:C43A  81                  		add a,c             ; add x difference.
    7247   00:C43B  FE 1A               		cp 26               ; only 5 corner pixels touching?
    7248   00:C43D  D8                  		ret c               ; carry set if there's a collision.
    7249   00:C43E  C3 00 C4            		jp sktyp.sktyp1           ; try next sprite in table.
    7250   00:C441                      .colty1:
    7251   00:C441  DD E5               		push ix             ; base sprite address onto stack.
    7252   00:C443  D1                  		pop de              ; pop it into de.
    7253   00:C444  EB                  		ex de,hl            ; flip hl into de.
    7254   00:C445  ED 52               		sbc hl,de           ; compare the two.
    7255   00:C447  EB                  		ex de,hl            ; restore hl.
    7256   00:C448  28 B6               		jr z,sktyp.sktyp1   ; addresses are identical.
    7257   00:C44A  C3 1A C4            		jp .colty0
    7258   00:C44D                      
    7259   00:C44D                      ; Display number.
    7260   00:C44D                      ;
    7261   00:C44D                      disply:
    7262   00:C44D  01 12 40            		ld bc,displ0        ; display workspace.
    7263   00:C450  CD 95 BA            		call num2ch         ; convert accumulator to string.
    7264   00:C453                      displ1:
    7265   00:C453  0B                  		dec bc              ; back one character.
    7266   00:C454  0A                  		ld a,(bc)           ; fetch digit.
    7267   00:C455  F6 80               		or 128              ; insert end marker.
    7268   00:C457  02                  		ld (bc),a           ; new value.
    7269   00:C458  21 12 40            		ld hl,displ0        ; display space.
    7270   00:C45B  C3 8E C0            		jp dmsg3            ; display the string.
    7271   00:C45E                      
    7272   00:C45E                      ; Initialise screen.
    7273   00:C45E                      ;
    7274   00:C45E                      initsc:
    7275   00:C45E  3A 4C 40            		ld a,(roomtb)       ; whereabouts in the map are we?
    7276   00:C461  CD 6B C4            		call tstsc          ; find displacement.
    7277   00:C464  FE FF               		cp 255              ; is it valid?
    7278   00:C466  C8                  		ret z               ; no, it's rubbish.
    7279   00:C467  32 41 40            		ld (scno),a         ; store new room number.
    7280   00:C46A  C9                  		ret
    7281   00:C46B                      
    7282   00:C46B                      ; Test screen.
    7283   00:C46B                      ;
    7284   00:C46B                      tstsc:
    7285   00:C46B  21 6D 80                   ld hl,mapdat-MAPWID ; start of map data, subtract width for negative.
    7286   00:C46E  47                         ld b,a              ; store room in b for now.
    7287   00:C46F  C6 0D                      add a,MAPWID        ; add width in case we're negative.
    7288   00:C471  5F                         ld e,a              ; screen into e.
    7289   00:C472  16 00                      ld d,0              ; zeroise d.
    7290   00:C474  19                         add hl,de           ; add displacement to map data.
    7291   00:C475  7E                         ld a,(hl)           ; find room number there.
    7292   00:C476  C9                         ret
    7293   00:C477                      
    7294   00:C477                      ; Screen left.
    7295   00:C477                      ;
    7296   00:C477                      scrl:
    7297   00:C477  3A 4C 40            		ld a,(roomtb)       ; present room table pointer.
    7298   00:C47A  3D                  		dec a               ; room left.
    7299   00:C47B                      scrl0:
    7300   00:C47B  CD 6B C4            		call tstsc          ; test screen.
    7301   00:C47E  3C                  		inc a               ; is there a screen this way?
    7302   00:C47F  C8                  		ret z               ; no, return to loop.
    7303   00:C480  78                  		ld a,b              ; restore room displacement.
    7304   00:C481  32 4C 40            		ld (roomtb),a       ; new room table position.
    7305   00:C484                      scrl1:
    7306   00:C484  CD 5E C4            		call initsc         ; set new screen.
    7307   00:C487  21 51 40            		ld hl,restfl        ; restart screen flag.
    7308   00:C48A  36 02               		ld (hl),2           ; set it.
    7309   00:C48C  C9                  		ret
    7310   00:C48D                      scrr:
    7311   00:C48D  3A 4C 40            		ld a,(roomtb)       ; room table pointer.
    7312   00:C490  3C                  		inc a               ; room right.
    7313   00:C491  18 E8               		jr scrl0
    7314   00:C493                      scru:
    7315   00:C493  3A 4C 40            		ld a,(roomtb)       ; room table pointer.
    7316   00:C496  D6 0D               		sub MAPWID          ; room up.
    7317   00:C498  18 E1               		jr scrl0
    7318   00:C49A                      scrd:
    7319   00:C49A  3A 4C 40            		ld a,(roomtb)       ; room table pointer.
    7320   00:C49D  C6 0D               		add a,MAPWID        ; room down.
    7321   00:C49F  18 DA               		jr scrl0
    7322   00:C4A1                      		
    7323   00:C4A1                      ; Jump to new screen.
    7324   00:C4A1                      ;
    7325   00:C4A1                      nwscr:
    7326   00:C4A1  21 7A 80            		ld hl,mapdat        ; start of map data.
    7327   00:C4A4  01 00 50            		ld bc,256*80        ; zero room count, 80 to search.
    7328   00:C4A7                      nwscr0:
    7329   00:C4A7  BE                  		cp (hl)             ; have we found a match for screen?
    7330   00:C4A8  28 05               		jr z,nwscr1         ; yes, set new point in map.
    7331   00:C4AA  23                  		inc hl              ; next room.
    7332   00:C4AB  0C                  		inc c               ; count rooms.
    7333   00:C4AC  10 F9               		djnz nwscr0         ; keep looking.
    7334   00:C4AE  C9                  		ret
    7335   00:C4AF                      nwscr1:
    7336   00:C4AF  79                  		ld a,c              ; room displacement.
    7337   00:C4B0  32 4C 40            		ld (roomtb),a       ; set the map position.
    7338   00:C4B3  18 CF               		jr scrl1            ; draw new room.
    7339   00:C4B5                      
    7340   00:C4B5                      
    7341   00:C4B5                      ; Gravity processing.
    7342   00:C4B5                      ;
    7343   00:C4B5                      grav:
    7344   00:C4B5  3A 4D 40             		ld a,(frmno)
    7345   00:C4B8  0F                  		rrca
    7346   00:C4B9  D8                  		ret c				; only 1/2 of frames		
    7347   00:C4BA  DD 7E 0D            		ld a,(ix+13)        ; in-air flag.
    7348   00:C4BD  A7                  		and a               ; are we in the air?
    7349   00:C4BE  C8                  		ret z               ; no we are not.
    7350   00:C4BF  3C                  		inc a               ; increment it.
    7351   00:C4C0  CA 0A C5            		jp z,ogrv           ; set to 255, use old gravity.
    7352   00:C4C3  DD 77 0D            		ld (ix+13),a        ; write new setting.
    7353   00:C4C6  1F                  		rra                 ; every other frame.
    7354   00:C4C7  30 0A               		jr nc,grav0         ; don't apply gravity this time.
    7355   00:C4C9  DD 7E 0E            		ld a,(ix+14)        ; pixels to move.
    7356   00:C4CC  FE 10               		cp 16               ; reached maximum?
    7357   00:C4CE  28 03               		jr z,grav0          ; yes, continue.
    7358   00:C4D0  DD 34 0E            		inc (ix+14)         ; slow down ascent/speed up fall.
    7359   00:C4D3                      grav0:
    7360   00:C4D3  DD 7E 0E            		ld a,(ix+14)        ; get distance to move.
    7361   00:C4D6  CB 2F               		sra a               ; divide by 2.
    7362   00:C4D8  A7                  		and a               ; any movement required?
    7363   00:C4D9  C8                  		ret z               ; no, not this time.
    7364   00:C4DA  FE 80               		cp 128              ; is it up or down?
    7365   00:C4DC  30 0C               		jr nc,gravu         ; it's up.
    7366   00:C4DE                      gravd:
    7367   00:C4DE  47                  		ld b,a              ; set pixels to move.
    7368   00:C4DF                      gravd0:
    7369   00:C4DF  CD 13 BF            		call cangd          ; can we go down?
    7370   00:C4E2  20 15               		jr nz,gravst        ; can't move down, so stop.
    7371   00:C4E4  DD 34 03            		inc (ix+3)          ; adjust new y coord.
    7372   00:C4E7  10 F6               		djnz gravd0
    7373   00:C4E9  C9                  		ret
    7374   00:C4EA                      gravu:
    7375   00:C4EA  ED 44               		neg                 ; flip the sign so it's positive.
    7376   00:C4EC  47                  		ld b,a              ; set pixels to move.
    7377   00:C4ED                      gravu0:
    7378   00:C4ED  CD F1 BE            		call cangu          ; can we go up?
    7379   00:C4F0  C2 91 C5            		jp nz,ifalls        ; can't move up, go down next.
    7380   00:C4F3  DD 35 03            		dec (ix+3)          ; adjust new y coord.
    7381   00:C4F6  10 F5               		djnz gravu0
    7382   00:C4F8  C9                  		ret
    7383   00:C4F9                      gravst:
    7384   00:C4F9  DD 7E 0E            		ld a,(ix+14)        ; jump pointer high.
    7385   00:C4FC  DD 36 0D 00         		ld (ix+13),0        ; reset falling flag.
    7386   00:C500  DD 36 0E 00         		ld (ix+14),0        ; store new speed.
    7387   00:C504  FE 08               		cp 8                ; was speed the maximum?
    7388   00:C506                      evftf:
    7389   00:C506  CA 39 91            		jp z,evnt15         ; yes, fallen too far.
    7390   00:C509  C9                  		ret
    7391   00:C50A                      
    7392   00:C50A                      ; Old gravity processing for compatibility with 4.6 and 4.7.
    7393   00:C50A                      ;
    7394   00:C50A                      ogrv:   
    7395   00:C50A  DD 5E 0E            		ld e,(ix+14)        ; get index to table.
    7396   00:C50D  16 00               		ld d,0              ; no high byte.
    7397   00:C50F  21 C4 B4            		ld hl,jtab          ; jump table.
    7398   00:C512  19                  		add hl,de           ; hl points to jump value.
    7399   00:C513  7E                  		ld a,(hl)           ; pixels to move.
    7400   00:C514  FE 63               		cp 99               ; reached the end?
    7401   00:C516  20 04               		jr nz,ogrv0         ; no, continue.
    7402   00:C518  2B                  		dec hl              ; go back to previous value.
    7403   00:C519  7E                  		ld a,(hl)           ; fetch that from table.
    7404   00:C51A  18 03               		jr ogrv1
    7405   00:C51C  DD 34 0E            ogrv0  inc (ix+14)         ; point to next table entry.
    7406   00:C51F  A7                  ogrv1  and a               ; any movement required?
    7407   00:C520  C8                         ret z               ; no, not this time.
    7408   00:C521  FE 80                      cp 128              ; is it up or down?
    7409   00:C523  30 0C                      jr nc,ogrvu         ; bigger than 128, it's up.	   
    7410   00:C525  47                  ogrvd  ld b,a              ; less than 128, go down. Set pixels to move.
    7411   00:C526  CD 13 BF            ogrvd0 call cangd          ; can we go down?
    7412   00:C529  20 14                      jr nz,ogrvst        ; can't move down, so stop.
    7413   00:C52B  DD 34 03                   inc (ix+3)          ; adjust new y coord.
    7414   00:C52E  10 F6                      djnz ogrvd0
    7415   00:C530  C9                         ret	   
    7416   00:C531  ED 44               ogrvu  neg                 ; flip the sign so it's positive.
    7417   00:C533  47                         ld b,a              ; set pixels to move.
    7418   00:C534  CD F1 BE            ogrvu0 call cangu          ; can we go up?
    7419   00:C537  20 1D                      jr nz,ogrv2         ; can't move up, go down next.
    7420   00:C539  DD 35 03                   dec (ix+3)          ; adjust new y coord.
    7421   00:C53C  10 F6                      djnz ogrvu0
    7422   00:C53E  C9                         ret	   
    7423   00:C53F  DD 5E 0E            ogrvst ld e,(ix+14)        ; get index to table.
    7424   00:C542  16 00                      ld d,0              ; no high byte.
    7425   00:C544  21 C4 B4                   ld hl,jtab          ; jump table.
    7426   00:C547  19                         add hl,de           ; hl points to jump value.
    7427   00:C548  7E                         ld a,(hl)           ; fetch byte from table.
    7428   00:C549  FE 63                      cp 99               ; is it the end marker?
    7429   00:C54B  DD 36 0D 00                ld (ix+13),0        ; reset jump flag.
    7430   00:C54F  DD 36 0E 00                ld (ix+14),0        ; reset pointer.
    7431   00:C553  C3 06 C5                   jp evftf	   
    7432   00:C556  21 C4 B4            ogrv2  ld hl,jtab          ; jump table.
    7433   00:C559  06 00                      ld b,0              ; offset into table.
    7434   00:C55B  7E                  ogrv4  ld a,(hl)           ; fetch table byte.
    7435   00:C55C  FE 64                      cp 100              ; hit end or downward move?
    7436   00:C55E  38 04                      jr c,ogrv3          ; yes.
    7437   00:C560  23                         inc hl              ; next byte of table.
    7438   00:C561  04                         inc b               ; next offset.
    7439   00:C562  18 F7                      jr ogrv4            ; keep going until we find crest/end of table.
    7440   00:C564  DD 70 0E            ogrv3  ld (ix+14),b        ; set next table offset.
    7441   00:C567  C9                         ret
    7442   00:C568                      
    7443   00:C568                      ; Initiate fall check.
    7444   00:C568                      ;
    7445   00:C568                      ifall:
    7446   00:C568  DD 7E 0D            		ld a,(ix+13)        ; jump pointer flag.
    7447   00:C56B  A7                  		and a               ; are we in the air?
    7448   00:C56C  C0                  		ret nz              ; if set, we're already in the air.
    7449   00:C56D  DD 66 04            		ld h,(ix+4)         ; y coordinate.
    7450   00:C570  3E 10               		ld a,16             ; look down 16 pixels.
    7451   00:C572  DD 86 03            		add a,(ix+3)        ; add x coordinate.
    7452   00:C575  6F                  		ld l,a              ; coords in hl.
    7453   00:C576  22 54 40            		ld (dispx),hl       ; set up test coordinates.
    7454   00:C579  CD CD BF            		call tstbl          ; get map address.
    7455   00:C57C  CD 32 BF            		call plchk          ; block, platform check.
    7456   00:C57F  C0                  		ret nz              ; it's solid, don't fall.
    7457   00:C580  23                  		inc hl              ; look right one cell.
    7458   00:C581  CD 32 BF            		call plchk          ; block, platform check.
    7459   00:C584  C0                  		ret nz              ; it's solid, don't fall.
    7460   00:C585  3A 55 40            		ld a,(dispy)        ; x coordinate.
    7461   00:C588  E6 07               		and 7               ; position straddling block cells.
    7462   00:C58A  28 05               		jr z,ifalls         ; no more checks needed.
    7463   00:C58C  23                  		inc hl              ; look to third cell.
    7464   00:C58D  CD 32 BF            		call plchk          ; block, platform check.
    7465   00:C590  C0                  		ret nz              ; it's solid, don't fall.
    7466   00:C591                      ifalls:
    7467   00:C591  DD 34 0D            		inc (ix+13)         ; set in air flag.
    7468   00:C594  DD 36 0E 00         		ld (ix+14),0        ; initial speed = 0.
    7469   00:C598  C9                  		ret
    7470   00:C599                      
    7471   00:C599                      tfall:
    7472   00:C599  DD 7E 0D            		ld a,(ix+13)        ; jump pointer flag.
    7473   00:C59C  A7                  		and a               ; are we in the air?
    7474   00:C59D  C0                  		ret nz              ; if set, we're already in the air.
    7475   00:C59E  CD 68 C5            		call ifall          ; do fall test.
    7476   00:C5A1  DD 7E 0D            		ld a,(ix+13)        ; get falling flag.
    7477   00:C5A4  A7                  		and a               ; is it set?
    7478   00:C5A5  C8                  		ret z               ; no.
    7479   00:C5A6  DD 36 0D FF         		ld (ix+13),255      ; we're using the table.
    7480   00:C5AA  18 AA               		jr ogrv2            ; find position in table.
    7481   00:C5AC                      
    7482   00:C5AC                      
    7483   00:C5AC                      ; Get frame data for a particular sprite.
    7484   00:C5AC                      ;
    7485   00:C5AC                      gfrm:
    7486   00:C5AC  07                  		rlca                ; multiple of 2.
    7487   00:C5AD  2A 49 B5            		ld hl,(frmptr)      ; table of sprite frames used by game.
    7488   00:C5B0                      		ADD_HL_A
    7488   00:C5B0  85                >   add a,l
    7488   00:C5B1  6F                >   ld l,a
    7488   00:C5B2  8C                >   adc a,h
    7488   00:C5B3  95                >   sub l
    7488   00:C5B4  67                >   ld h,a
    7489   00:C5B5  C9                  		ret
    7490   00:C5B6                      
    7491   00:C5B6                      ; Find sprite list for current room.
    7492   00:C5B6                      ;
    7493   00:C5B6                      sprlst:
    7494   00:C5B6  3A 41 40            		ld a,(scno)         ; screen number.
    7495   00:C5B9  2A 51 B5            		ld hl,(nmeptr)      ; pointer to enemies.
    7496   00:C5BC  47                  		ld b,a              ; loop counter in b register.
    7497   00:C5BD  A7                  		and a               ; is it the first screen?
    7498   00:C5BE  C8                  		ret z               ; yes, don't need to search data.
    7499   00:C5BF  11 05 00            		ld de,NMESIZ        ; bytes to skip.
    7500   00:C5C2                      .loop:
    7501   00:C5C2  7E                  		ld a,(hl)           ; fetch type of sprite.
    7502   00:C5C3  3C                  		inc a               ; is it an end marker?
    7503   00:C5C4  28 03               		jr z,.nxtscr        ; yes, end of this room.
    7504   00:C5C6  19                  		add hl,de           ; point to next sprite in list.
    7505   00:C5C7  18 F9               		jr .loop            ; continue until end of room.
    7506   00:C5C9                      .nxtscr:
    7507   00:C5C9  23                  		inc hl              ; point to start of next screen.
    7508   00:C5CA  10 F6               		djnz .loop          ; continue until room found.
    7509   00:C5CC  C9                  		ret
    7510   00:C5CD                      
    7511   00:C5CD                      ; Clear all but a single player sprite.
    7512   00:C5CD                      ;
    7513   00:C5CD                      nspr:
    7514   00:C5CD  06 20               		ld b,NUMSPR         ; sprite slots in table.
    7515   00:C5CF  DD 21 B4 40         		ld ix,sprtab        ; sprite table.
    7516   00:C5D3  11 11 00            		ld de,TABSIZ        ; distance to next odd/even entry.
    7517   00:C5D6                      .loop:
    7518   00:C5D6  DD 7E 00            		ld a,(ix+0)         ; fetch sprite type.
    7519   00:C5D9  A7                  		and a               ; is it a player?
    7520   00:C5DA  28 04               		jr z,.loop1         ; yes, keep this one.
    7521   00:C5DC  DD 36 00 FF         		ld (ix+0),255       ; remove next type.
    7522   00:C5E0                      .loop1:
    7523   00:C5E0  DD 19               		add ix,de           ; next sprite.
    7524   00:C5E2  10 F2               		djnz .loop          ; one less space in the table.
    7525   00:C5E4  C9                  		ret
    7526   00:C5E5                      		
    7527   00:C5E5                      ; Two initialisation routines.
    7528   00:C5E5                      
    7529   00:C5E5                      ; HL is already pointing to start of sprites for this screen (nmedat / SPRITEPOSITIONS)
    7530   00:C5E5                      ; Initialise sprites - copy everything from list to table.
    7531   00:C5E5                      ;
    7532   00:C5E5                      ispr:	
    7533   00:C5E5  AF                  		xor a
    7534   00:C5E6  32 44 40            		ld (nsprite),a		; reset first sprite frame number in VRAM
    7535   00:C5E9  06 20               		ld b,NUMSPR         ; sprite slots in table.
    7536   00:C5EB  DD 21 B4 40         		ld ix,sprtab        ; sprite table.
    7537   00:C5EF                      .loop2:
    7538   00:C5EF  7E                  		ld a,(hl)
    7539   00:C5F0  3C                  		inc a
    7540   00:C5F1  28 14               		jr z,.exit
    7541   00:C5F3                      .loop1:  
    7542   00:C5F3  DD 7E 00            		ld a,(ix+0)         ; next type.
    7543   00:C5F6  3C                  		inc a
    7544   00:C5F7  28 09               		jr z,.copyspr       ; no, process this one.
    7545   00:C5F9  11 11 00            		ld de,TABSIZ        ; distance to next entry.
    7546   00:C5FC  DD 19               		add ix,de           ; next sprite.
    7547   00:C5FE  10 F3               		djnz .loop1         ; repeat for remaining sprites.
    7548   00:C600  18 05               		jr .exit
    7549   00:C602                      .copyspr:
    7550   00:C602  CD 44 C6            		call cpsp           ; initialise a sprite.
    7551   00:C605  10 E8               		djnz .loop2         ; one less space in the table.
    7552   00:C607                      .exit:
    7553   00:C607  C3 E3 BC            		jp hslot
    7554   00:C60A                      
    7555   00:C60A                      ; HL is already pointing to start of sprites for this screen (nmedat)		
    7556   00:C60A                      ; Initialise sprites - but not player, we're keeping the old one.
    7557   00:C60A                      ;
    7558   00:C60A                      kspr:	
    7559   00:C60A  AF                  		xor a
    7560   00:C60B  32 44 40            		ld (nsprite),a		; reset first sprite frame number in VRAM		
    7561   00:C60E  EB                  		ex de,hl
    7562   00:C60F  CD 88 C2            		call dissprs		; hide all sprites
    7563   00:C612  EB                  		ex de,hl		
    7564   00:C613  06 20               		ld b,NUMSPR         ; sprite slots in table.
    7565   00:C615  DD 21 B4 40         		ld ix,sprtab        ; sprite table.
    7566   00:C619                      .loop2:  
    7567   00:C619  7E                  		ld a,(hl)           ; fetch byte.
    7568   00:C61A  FE FF               		cp 255              ; is it an end marker?
    7569   00:C61C  28 23               		jr z,.exit          ; yes, no more to do.
    7570   00:C61E  A7                  		and a               ; is it a player sprite?
    7571   00:C61F  20 0C               		jr nz,.loop1        ; no, add to table as normal.		
    7572   00:C621  23                  		inc hl
    7573   00:C622  7E                  		ld a,(hl)			; sprite image number from SPRITEPOSITIONS
    7574   00:C623  CD 82 C6            		call mapsprite		; no player set but sprite pattern mapped to VRAM
    7575   00:C626  2B                  		dec hl		
    7576   00:C627  11 05 00            		ld de,NMESIZ        ; distance to next item in list.
    7577   00:C62A  19                  		add hl,de           ; point to next one.
    7578   00:C62B  18 EC               		jr .loop2
    7579   00:C62D                      .loop1:
    7580   00:C62D  DD 7E 00            		ld a,(ix+0)         ; next type.
    7581   00:C630  3C                  		inc a               ; is it enabled yet?
    7582   00:C631  28 09               		jr z,.copyspr       ; no, process this one.
    7583   00:C633  11 11 00            		ld de,TABSIZ        ; distance to next odd/even entry.
    7584   00:C636  DD 19               		add ix,de           ; next sprite.
    7585   00:C638  10 F3               		djnz .loop1         ; repeat for remaining sprites.
    7586   00:C63A  18 05               		jr .exit            ; no more room in table.
    7587   00:C63C                      .copyspr:
    7588   00:C63C  CD 44 C6            		call cpsp           ; copy sprite to table.
    7589   00:C63F  10 D8               		djnz .loop2         ; one less space in the table.
    7590   00:C641                      .exit:
    7591   00:C641  C3 E3 BC            		jp hslot
    7592   00:C644                      
    7593   00:C644                      ; Copy sprite from list to table.
    7594   00:C644                      
    7595   00:C644                      cpsp:
    7596   00:C644  7E                  		ld a,(hl)           ; fetch byte from table.
    7597   00:C645  DD 77 00            		ld (ix+0),a         ; set up type.
    7598   00:C648  23                  		inc hl              ; move to next byte.
    7599   00:C649  7E                  		ld a,(hl)           ; fetch byte from table.
    7600   00:C64A  DD 77 01            		ld (ix+1),a         ; set up sprite number.		
    7601   00:C64D  23                  		inc hl              ; move to next byte.
    7602   00:C64E  CD 82 C6            		call mapsprite		; remaps RAM sprite number in A to a new VRAM sprite
    7603   00:C651  7E                  		ld a,(hl)           ; fetch byte from table (color).
    7604   00:C652  DD 77 05            		ld (ix+5),a         ; set up color.
    7605   00:C655  23                  		inc hl              ; move to next byte.
    7606   00:C656  7E                  		ld a,(hl)           ; fetch byte from table.
    7607   00:C657  DD 77 03            		ld (ix+3),a         ; set up coordinate.
    7608   00:C65A  23                  		inc hl              ; move to next byte.
    7609   00:C65B  7E                  		ld a,(hl)           ; fetch byte from table.
    7610   00:C65C  DD 77 04            		ld (ix+4),a         ; set up coordinate.
    7611   00:C65F  23                  		inc hl		
    7612   00:C660  AF                  		xor a               ; zeroes in accumulator.
    7613   00:C661  DD 77 02            		ld (ix+2),a         ; reset frame number.
    7614   00:C664  DD 77 0A            		ld (ix+10),a        ; reset direction.
    7615   00:C667  DD 77 0D            		ld (ix+13),a        ; reset jump pointer low.
    7616   00:C66A  DD 77 0E            		ld (ix+14),a        ; reset jump pointer high.
    7617   00:C66D  DD 36 10 FF         		ld (ix+16),255      ; reset data pointer to auto-restore.
    7618   00:C671  DD E5               		push ix             ; store ix pair.
    7619   00:C673  E5                  		push hl             ; store hl pair.
    7620   00:C674  C5                  		push bc
    7621   00:C675  CD 80 8D            		call evnt09         ; perform event.
    7622   00:C678  C1                  		pop bc
    7623   00:C679  E1                  		pop hl              ; restore hl.
    7624   00:C67A  DD E1               		pop ix              ; restore ix.
    7625   00:C67C  11 11 00            		ld de,TABSIZ        ; distance to next entry.
    7626   00:C67F  DD 19               		add ix,de           ; next sprite.
    7627   00:C681  C9                  		ret
    7628   00:C682                      
    7629   00:C682                      		; A=image number from SPRITEPOSITION
    7630   00:C682                      mapsprite:					; initialize mapspr table
    7631   00:C682  E5                  		push hl
    7632   00:C683  C5                  		push bc
    7633   00:C684  CD AC C5            		call gfrm			; HL = real sprite frames pointer in RAM for sprite number A
    7634   00:C687  7E                  		ld a,(hl)			; get real frame in RAM
    7635   00:C688  E6 7F               		and 127				; maximum 128 frames in RAM (correct?)
    7636   00:C68A  5F                  		ld e,a
    7637   00:C68B  16 4D               		ld d,mapspr>>8		
    7638   00:C68D  1A                  		ld a,(de)
    7639   00:C68E  3C                  		inc a
    7640   00:C68F  20 19               		jr nz,nomap
    7641   00:C691  3A 44 40            		ld a,(nsprite)		; gets available sprite frame pointer
    7642   00:C694  12                  		ld (de),a			; maps this to the old image from SPRITEPOSITION
    7643   00:C695  23                  		inc hl
    7644   00:C696  86                  		add a,(hl)			; next sprite frame available after adding frames size
    7645   00:C697  32 44 40            		ld (nsprite),a		; stores it as new available sprite frame
    7646   00:C69A  2B                  		dec hl				; restore HL pointer to start of frmlst
    7647   00:C69B  CD AD C6            		call spradr			; HL = sprite frame list position, DE = pointer to actual sprite frame in VRAM, BC = lenght of data		
    7648   00:C69E  CD 96 CB            		call MSX_SETWRT
    7649   00:C6A1  EB                  		ex de,hl			; HL = sprite RAM data address, DE = spriVte RAM data address, BC = lenght of data
    7650   00:C6A2                      nxtsprbyt:		
    7651   00:C6A2  7E                  		ld a,(hl)
    7652   00:C6A3  D3 BE               		out (MSX_VDPDRW),a
    7653   00:C6A5  ED A1               		cpi					; 18
    7654   00:C6A7  EA A2 C6            		jp pe,nxtsprbyt		; 11 = 29
    7655   00:C6AA                      nomap:		
    7656   00:C6AA  C1                  		pop bc
    7657   00:C6AB  E1                  		pop hl
    7658   00:C6AC  C9                  		ret
    7659   00:C6AD                      		
    7660   00:C6AD                      ; Inputs
    7661   00:C6AD                      ; HL = sprite frame list position
    7662   00:C6AD                      ; DE = pointer to actual sprite frame in VRAM
    7663   00:C6AD                      spradr:
    7664   00:C6AD  7E                  		ld a,(hl)			; get initial image frame in RAM
    7665   00:C6AE  CD C2 C6            		call mult32			; BC= A * 32
    7666   00:C6B1  23                  		inc hl				; next frmlst position (num framesS)
    7667   00:C6B2  7E                  		ld a,(hl)			; get num frames		
    7668   00:C6B3  08                  		ex af,af			; saves num frames
    7669   00:C6B4  21 D7 9D            		ld hl,sprgfx
    7670   00:C6B7  09                  		add hl,bc			; HL = sprite RAM data address
    7671   00:C6B8  1A                  		ld a,(de)			; gets destination VRAM sprite frame
    7672   00:C6B9  EB                  		ex de,hl			; DE = now sprite RAM source data address
    7673   00:C6BA  CD C2 C6            		call mult32		
    7674   00:C6BD  21 00 38            		ld hl,MSX_SPRTBL
    7675   00:C6C0  09                  		add hl,bc			; HL = sprite VRAM destination data address
    7676   00:C6C1  08                  		ex af,af			; restore num frames		
    7677   00:C6C2                      mult32:		
    7678   00:C6C2  0F                  		rrca                
    7679   00:C6C3  0F                  		rrca
    7680   00:C6C4  0F                  		rrca
    7681   00:C6C5  4F                  		ld c,a              
    7682   00:C6C6  E6 1F               		and $1F              
    7683   00:C6C8  47                  		ld b,a              
    7684   00:C6C9  79                  		ld a,c              
    7685   00:C6CA  E6 E0               		and $E0             
    7686   00:C6CC  4F                  		ld c,a				; BC = A * 32		
    7687   00:C6CD  C9                  		ret
    7688   00:C6CE                      
    7689   00:C6CE                      	if OFLAG
    7690   00:C6CE                      	
    7691   00:C6CE                      clrobjlst:
    7692   00:C6CE  21 00 49            		ld hl,objlist
    7693   00:C6D1  0E 01               		ld c,1     			; 1 * 256 bytes
    7694   00:C6D3  3E FF               		ld a,255			; fill value
    7695   00:C6D5  C3 DF C6            		jp fastfill
    7696   00:C6D8                      	
    7697   00:C6D8                      	endif
    7698   00:C6D8                      		
    7699   00:C6D8                      clrscrmap:
    7700   00:C6D8  21 00 4A            		ld hl,scrmap
    7701   00:C6DB  0E 03               		ld c,3     			; 3 * 256 bytes
    7702   00:C6DD  3E FF               		ld a,255			; fill value
    7703   00:C6DF                      ;
    7704   00:C6DF                      ; fast fills RAM areas starting in addresses multiple of 4 
    7705   00:C6DF                      ; Input:	C=number of 256 bytes blocks to fill
    7706   00:C6DF                      ;			HL=starting address
    7707   00:C6DF                      ;			A=byte for fill			
    7708   00:C6DF                      ;
    7709   00:C6DF                      fastfill:
    7710   00:C6DF  06 40               		ld b,64              ;set B to 64 (64 * 4 sets = 256 bytes initiaized)
    7711   00:C6E1                      .loop1:
    7712   00:C6E1  77                  		ld (hl), a           ;set byte to 255
    7713   00:C6E2  2C                  		inc l                ;move to the next byte
    7714   00:C6E3  77                  		ld (hl), a
    7715   00:C6E4  2C                  		inc l
    7716   00:C6E5  77                  		ld (hl), a
    7717   00:C6E6  2C                  		inc l
    7718   00:C6E7  77                  		ld (hl), a
    7719   00:C6E8  23                  		inc hl               ;this time we are not sure that inc l will not cause overflow
    7720   00:C6E9  10 F6               		djnz .loop1          ;repeat for next 4 bytes
    7721   00:C6EB  0D                  		dec c
    7722   00:C6EC  20 F1               		jr nz,fastfill       ;outer loop. repeat for next c*256 bytes.
    7723   00:C6EE  C9                  		ret		
    7724   00:C6EF                      	 
    7725   00:C6EF                      ; Clear the play area window.
    7726   00:C6EF                      
    7727   00:C6EF                      clw:
    7728   00:C6EF                      	if PFLAG
    7729   00:C6EF                      	
    7730   00:C6EF  CD 57 B9            		call inishr
    7731   00:C6F2                      		
    7732   00:C6F2                      	endif
    7733   00:C6F2                      	
    7734   00:C6F2  2A 93 40            		ld hl,(wintop)
    7735   00:C6F5  22 54 40            		ld (dispx),hl
    7736   00:C6F8  CD B8 BD            		call gprad          ; get print address in DE.
    7737   00:C6FB  EB                  		ex de,hl
    7738   00:C6FC  3A 95 40            		ld a,(winhgt)       ; height of window.
    7739   00:C6FF  47                  		ld b,a
    7740   00:C700  3A 96 40            		ld a,(winwid)
    7741   00:C703  87                  		add a,a
    7742   00:C704  87                  		add a,a
    7743   00:C705  87                  		add a,a
    7744   00:C706  4F                  		ld c,a
    7745   00:C707                      .loop3   
    7746   00:C707  CD 96 CB            		call MSX_SETWRT
    7747   00:C70A  C5                  		push bc
    7748   00:C70B  AF                  		xor a
    7749   00:C70C                      .loop1:
    7750   00:C70C  D3 BE               		out (MSX_VDPDRW),a
    7751   00:C70E  0D                  		dec c
    7752   00:C70F  20 FB               		jr nz,.loop1
    7753   00:C711  CB EC               		set 5,h
    7754   00:C713  CD 96 CB            		call MSX_SETWRT
    7755   00:C716  C1                  		pop bc
    7756   00:C717  C5                  		push bc
    7757   00:C718  3A 39 40            		ld a,(clratt)
    7758   00:C71B                      .loop2:
    7759   00:C71B  D3 BE               		out (MSX_VDPDRW),a
    7760   00:C71D  0D                  		dec c
    7761   00:C71E  20 FB               		jr nz,.loop2
    7762   00:C720  C1                  		pop bc
    7763   00:C721  CB AC               		res 5,h
    7764   00:C723  24                  		inc h
    7765   00:C724  10 E1               		djnz .loop3
    7766   00:C726  2A 93 40            		ld hl,(wintop)      ; get coordinates of window.
    7767   00:C729  22 35 40            		ld (charx),hl       ; put into display position.
    7768   00:C72C  CD D8 C6            		call clrscrmap
    7769   00:C72F  C3 88 C2            		jp dissprs
    7770   00:C732                      
    7771   00:C732                      
    7772   00:C732                      	if SFLAG
    7773   00:C732                    ~ 	
    7774   00:C732                    ~ ; Effects code.
    7775   00:C732                    ~ ; Ticker routine is called 25 times per second (MSX:50fps).
    7776   00:C732                    ~ 
    7777   00:C732                    ~ scrly:
    7778   00:C732                    ~  	ifdef DEBUG
    7779   00:C732                    ~ 		BORDER 7
    7780   00:C732                    ~ 	endif
    7781   00:C732                    ~ 		ld a,(scrlyoff)
    7782   00:C732                    ~ 		or a
    7783   00:C732                    ~ 		ret nz
    7784   00:C732                    ~ 		ld hl,scrbuf
    7785   00:C732                    ~ 		ld de,(txtbeg)         ; get screen address.
    7786   00:C732                    ~ 		ld a,(txtwid)       
    7787   00:C732                    ~ 		add a,a
    7788   00:C732                    ~ 		add a,a
    7789   00:C732                    ~ 		add a,a					; characters*8 wide.
    7790   00:C732                    ~ 		ld b,a
    7791   00:C732                    ~ 		ifdef FASTVRAMDUMP
    7792   00:C732                    ~ 		call ram2vram
    7793   00:C732                    ~ 		else
    7794   00:C732                    ~ 		call ram2vram_slow
    7795   00:C732                    ~ 		endif
    7796   00:C732                    ~  	ifdef DEBUG
    7797   00:C732                    ~ 		BORDER 14
    7798   00:C732                    ~ 	endif
    7799   00:C732                    ~ 		ret
    7800   00:C732                    ~ 		
    7801   00:C732                    ~ scrltxt:
    7802   00:C732                    ~  	ifdef DEBUG
    7803   00:C732                    ~ 		BORDER 2
    7804   00:C732                    ~ 	endif
    7805   00:C732                    ~ 		ld a,(scrlyoff)
    7806   00:C732                    ~ 		or a
    7807   00:C732                    ~ 		ret nz
    7808   00:C732                    ~ 		
    7809   00:C732                    ~ 		ld a,(txtbit)
    7810   00:C732                    ~ 		rlca
    7811   00:C732                    ~ 		jr nc,.nonewchr
    7812   00:C732                    ~ 		
    7813   00:C732                    ~ 		ld hl,(txtpos)      ; get text pointer.
    7814   00:C732                    ~ 		ld a,(hl)           ; find character we're displaying.
    7815   00:C732                    ~ 		push hl
    7816   00:C732                    ~ 		and 127             ; remove end marker bit if applicable.
    7817   00:C732                    ~ 		cp 13               ; is it newline?
    7818   00:C732                    ~ 		jr nz,.scrly5       ; no, it's okay.
    7819   00:C732                    ~ 		ld a,32             ; convert to a space instead.
    7820   00:C732                    ~ .scrly5:
    7821   00:C732                    ~ 		rlca
    7822   00:C732                    ~ 		rlca
    7823   00:C732                    ~ 		rlca                ; multiply by 8 to find char.
    7824   00:C732                    ~ 		ld b,a              ; store shift in b.
    7825   00:C732                    ~ 		and 3               ; keep within 768-byte range of font.
    7826   00:C732                    ~ 		ld d,a              ; that's our high byte.
    7827   00:C732                    ~ 		ld a,b              ; restore the shift.
    7828   00:C732                    ~ 		and 248
    7829   00:C732                    ~ 		ld e,a
    7830   00:C732                    ~ 		ld hl,font-256      ; font.
    7831   00:C732                    ~ 		add hl,de           ; point to image of character.
    7832   00:C732                    ~ 		ld de,(txtend)
    7833   00:C732                    ~ 		ld bc,8
    7834   00:C732                    ~ 		ldir
    7835   00:C732                    ~ 		pop hl
    7836   00:C732                    ~ 		ld a,(hl)
    7837   00:C732                    ~ 		inc hl
    7838   00:C732                    ~ 		rla
    7839   00:C732                    ~ 		jr nc,.scrly6        ; not yet - continue.
    7840   00:C732                    ~ .scrly4:
    7841   00:C732                    ~ 		ld hl,(txtini)      ; start of scrolling message.		
    7842   00:C732                    ~ .scrly6:
    7843   00:C732                    ~ 		ld (txtpos),hl      ; new text pointer position.
    7844   00:C732                    ~ 		ld a,1
    7845   00:C732                    ~ .nonewchr:
    7846   00:C732                    ~ 		ld (txtbit),a
    7847   00:C732                    ~ 
    7848   00:C732                    ~ 		; Scroll a char row
    7849   00:C732                    ~ 		ld hl,(txtend)
    7850   00:C732                    ~ 		ld d,254
    7851   00:C732                    ~ 		ld c,8
    7852   00:C732                    ~ 		ld a,(txtwid)       ; characters wide.
    7853   00:C732                    ~ 		inc a
    7854   00:C732                    ~ 		ld b,a              ; put into the loop counter.
    7855   00:C732                    ~ .rowloop:
    7856   00:C732                    ~ 		push bc
    7857   00:C732                    ~ 		push hl
    7858   00:C732                    ~ 		ld c,0
    7859   00:C732                    ~ .colloop:	   
    7860   00:C732                    ~ 		ld a,(hl)
    7861   00:C732                    ~ 		rlca
    7862   00:C732                    ~ 		ld e,a
    7863   00:C732                    ~ 		and d
    7864   00:C732                    ~ 		or c
    7865   00:C732                    ~ 		ld (hl),a
    7866   00:C732                    ~ 		ld a,e
    7867   00:C732                    ~ 		and 1
    7868   00:C732                    ~ 		ld c,a
    7869   00:C732                    ~ 		
    7870   00:C732                    ~ 		ld a,l
    7871   00:C732                    ~ 		sub 8
    7872   00:C732                    ~ 		jr nc,$+3
    7873   00:C732                    ~ 		dec	h
    7874   00:C732                    ~ 		ld l,a
    7875   00:C732                    ~ 
    7876   00:C732                    ~ 		djnz .colloop
    7877   00:C732                    ~ 		pop hl
    7878   00:C732                    ~ 		inc l
    7879   00:C732                    ~ 		pop bc
    7880   00:C732                    ~ 		dec c
    7881   00:C732                    ~ 		jr nz,.rowloop
    7882   00:C732                    ~ 		
    7883   00:C732                    ~  		ifdef DEBUG
    7884   00:C732                    ~ 		BORDER 14
    7885   00:C732                    ~ 		endif
    7886   00:C732                    ~ 		ret
    7887   00:C732                    ~ 				
    7888   00:C732                    ~ 	   ; bc= width*256+msg.number
    7889   00:C732                    ~ iscrly: 
    7890   00:C732                    ~ 		call prescr         ; set up display position.
    7891   00:C732                    ~ 		ld a,b              ; width.
    7892   00:C732                    ~ 		dec a               ; subtract one.
    7893   00:C732                    ~ 		cp MSX_MAXCOLS      ; is it between 1 and 32?
    7894   00:C732                    ~ 		ret nc              ; TODO:no, disable messages.
    7895   00:C732                    ~ 		ld d,b
    7896   00:C732                    ~ 		ld a,c              ; message number.
    7897   00:C732                    ~ 		ld hl,msgdat        ; text messages.
    7898   00:C732                    ~ 		call getwrd         ; find message start.
    7899   00:C732                    ~ 		ld (txtini),hl      ; set initial text position.
    7900   00:C732                    ~ 		ld (txtpos),hl      ; set initial text position.
    7901   00:C732                    ~ 		ld a,d
    7902   00:C732                    ~ 		ld (txtwid),a
    7903   00:C732                    ~ 		add a,a
    7904   00:C732                    ~ 		add a,a
    7905   00:C732                    ~ 		add a,a				; *8
    7906   00:C732                    ~ 		ld c,a
    7907   00:C732                    ~ 		ld b,0
    7908   00:C732                    ~ 		jr nc,.nocarry
    7909   00:C732                    ~ 		inc b
    7910   00:C732                    ~ .nocarry:		
    7911   00:C732                    ~ 		call gprad          ; get hires print address in DE.
    7912   00:C732                    ~ 		ld (txtbeg),de
    7913   00:C732                    ~ 		ld hl,scrbuf
    7914   00:C732                    ~ 		ex de,hl
    7915   00:C732                    ~ 		call MSX_LDIRMV
    7916   00:C732                    ~ 		ld (txtend),de      ; set text screen address.
    7917   00:C732                    ~         ld a,128
    7918   00:C732                    ~         ld (txtbit),a
    7919   00:C732                    ~ 		xor a	
    7920   00:C732                    ~ 		ld (scrlyoff),a 
    7921   00:C732                    ~         ret
    7922   00:C732                    ~ 
    7923   00:C732                    ~ 	endif
    7924   00:C732                      
    7925   00:C732                      
    7926   00:C732                      	if DFLAG
    7927   00:C732                    ~ 
    7928   00:C732                    ~ dig:
    7929   00:C732                    ~        and 3
    7930   00:C732                    ~        jr z,digl
    7931   00:C732                    ~        dec a
    7932   00:C732                    ~        jr z,digr
    7933   00:C732                    ~        dec a
    7934   00:C732                    ~        jr z,digu
    7935   00:C732                    ~        ld h,(ix+4)
    7936   00:C732                    ~        ld a,16
    7937   00:C732                    ~        add a,(ix+3)
    7938   00:C732                    ~        ld l,a
    7939   00:C732                    ~        jr digv
    7940   00:C732                    ~ digu   ld a,(ix+3)
    7941   00:C732                    ~        ld h,(ix+4)
    7942   00:C732                    ~        sub 2
    7943   00:C732                    ~        ld l,a
    7944   00:C732                    ~ digv   ld (dispx),hl
    7945   00:C732                    ~        call tstbl
    7946   00:C732                    ~        call fdchk
    7947   00:C732                    ~        inc hl
    7948   00:C732                    ~        call fdchk
    7949   00:C732                    ~        ld a,(dispy)
    7950   00:C732                    ~        and 7
    7951   00:C732                    ~        ret z
    7952   00:C732                    ~        inc hl
    7953   00:C732                    ~        jp fdchk
    7954   00:C732                    ~ digl   ld l,(ix+3)
    7955   00:C732                    ~        ld a,(ix+4)
    7956   00:C732                    ~        sub 2
    7957   00:C732                    ~        ld h,a
    7958   00:C732                    ~ digh   ld (dispx),hl
    7959   00:C732                    ~        ld a,l
    7960   00:C732                    ~        and 7
    7961   00:C732                    ~        ld a,3
    7962   00:C732                    ~        jr nz,digh1
    7963   00:C732                    ~        dec a
    7964   00:C732                    ~ digh1  ld b,a
    7965   00:C732                    ~        call tstbl
    7966   00:C732                    ~ digh0  push bc
    7967   00:C732                    ~        call fdchk
    7968   00:C732                    ~        ld de,MSX_MAXCOLS
    7969   00:C732                    ~        add hl,de
    7970   00:C732                    ~        pop bc
    7971   00:C732                    ~        djnz digh0
    7972   00:C732                    ~        ret
    7973   00:C732                    ~ digr   ld l,(ix+3)
    7974   00:C732                    ~        ld a,(ix+4)
    7975   00:C732                    ~        add a,16
    7976   00:C732                    ~        ld h,a
    7977   00:C732                    ~        jr digh 
    7978   00:C732                    ~ 
    7979   00:C732                    ~ 	endif
    7980   00:C732                      
    7981   00:C732                      	if CRFLAG
    7982   00:C732                    ~ 
    7983   00:C732                    ~ ;
    7984   00:C732                    ~ ; Crumbling blocks routine
    7985   00:C732                    ~ ; Input:	None
    7986   00:C732                    ~ ; Output:	None
    7987   00:C732                    ~ ; Modifies: AF,BC,HL,DE
    7988   00:C732                    ~ ;
    7989   00:C732                    ~ 
    7990   00:C732                    ~ crumble:	
    7991   00:C732                    ~  		ld a,(frmno)
    7992   00:C732                    ~ 		and CRUMBLING_SPEED
    7993   00:C732                    ~ 		ret nz				; executed only every 1/8 of frames		
    7994   00:C732                    ~ 		ld h,(ix+4)			; x coordinate
    7995   00:C732                    ~ 		ld a,(ix+3)			; y coordinate
    7996   00:C732                    ~ 		add a,16
    7997   00:C732                    ~ 		ld l,a
    7998   00:C732                    ~ 		ld (dispx),hl		
    7999   00:C732                    ~ 		and 6
    8000   00:C732                    ~ 		ret nz
    8001   00:C732                    ~ 		call gp2tp			; dispx/y now has text coords
    8002   00:C732                    ~ 		call pradd
    8003   00:C732                    ~ 		ld de,scrmap
    8004   00:C732                    ~ 		add hl,de	
    8005   00:C732                    ~ 		ex de,hl
    8006   00:C732                    ~ 		ld hl,dispy
    8007   00:C732                    ~ 		ld a,(de)
    8008   00:C732                    ~ 		cp 9
    8009   00:C732                    ~ 		call nc,.crumb
    8010   00:C732                    ~ 		inc (hl)
    8011   00:C732                    ~ 		inc de
    8012   00:C732                    ~ 		ld a,(de)
    8013   00:C732                    ~ 		cp 9
    8014   00:C732                    ~ 		call nc,.crumb
    8015   00:C732                    ~ 		inc (hl)
    8016   00:C732                    ~ 		inc de
    8017   00:C732                    ~ 		ld a,(ix+4)			; get x coord
    8018   00:C732                    ~ 		and 7				; multiple of 8?
    8019   00:C732                    ~ 		ret z				; return (only two blocks crumb) 
    8020   00:C732                    ~ 		ld a,(de)
    8021   00:C732                    ~ 		cp 9
    8022   00:C732                    ~ 		ret c
    8023   00:C732                    ~ .crumb:	
    8024   00:C732                    ~ 		push de
    8025   00:C732                    ~ 		inc a
    8026   00:C732                    ~ 		cp 17
    8027   00:C732                    ~ 		jr c,.noblank		; if block < 17, update it 
    8028   00:C732                    ~ 		xor a				; else, empty block
    8029   00:C732                    ~ .noblank:
    8030   00:C732                    ~ 		call pattr
    8031   00:C732                    ~ 		dec (hl)			; undo x+1 position
    8032   00:C732                    ~ 		pop de
    8033   00:C732                    ~ 		ret
    8034   00:C732                    ~ 
    8035   00:C732                    ~ 	endif
    8036   00:C732                      
    8037   00:C732                      	if RTFLAG
    8038   00:C732                    ~ 	
    8039   00:C732                    ~ ; User routine for rotational controls.
    8040   00:C732                    ~ ; To use, set up the angle (0-255) of travel in DIRECTION, then call THRUST with a single parameter for speed (eg THRUST 4).
    8041   00:C732                    ~ ; This routine uses AIRBORNE and JUMPHEIGHT to store fractional coordinates but leaves SETTINGA and SETTINGB free. 
    8042   00:C732                    ~ ; Jonathan Cauldwell, 22nd October 2020.
    8043   00:C732                    ~ 
    8044   00:C732                    ~ thrust:
    8045   00:C732                    ~ 		ld b,a                      ; speed in b for now.
    8046   00:C732                    ~ 		ld (usrspd),a               ; store speed.
    8047   00:C732                    ~ 		ld l,(ix+13)                ; y fraction.
    8048   00:C732                    ~ 		ld h,(ix+14)                ; x fraction.
    8049   00:C732                    ~ 		push hl                     ; store old fractions.
    8050   00:C732                    ~ 
    8051   00:C732                    ~ 		/*
    8052   00:C732                    ~ 		ld h,(sintab>>8)&$FF
    8053   00:C732                    ~ 		ld l,(ix+10)
    8054   00:C732                    ~ 		ld a,(hl)
    8055   00:C732                    ~ 		*/
    8056   00:C732                    ~ 		
    8057   00:C732                    ~ 		ld hl,sintab                ; sine table.
    8058   00:C732                    ~ 		ld e,(ix+10)                ; direction.
    8059   00:C732                    ~ 		ld d,0                      ; no high byte.
    8060   00:C732                    ~ 		add hl,de                   ; point to entry.
    8061   00:C732                    ~ 		ld a,(hl)                   ; get the sine.
    8062   00:C732                    ~ 
    8063   00:C732                    ~ 		ld (usrsgn),a               ; store sign.
    8064   00:C732                    ~ 		and 127                     ; remove sign.
    8065   00:C732                    ~ 		ld h,a                      ; copy to first multiplier.
    8066   00:C732                    ~ 		ld d,b                      ; get speed.
    8067   00:C732                    ~ 		call imul                   ; multiply together.
    8068   00:C732                    ~ 		ld e,(ix+13)                ; y fraction.
    8069   00:C732                    ~ 		ld d,(ix+3)                 ; y integer.
    8070   00:C732                    ~ 		ld a,(usrsgn)               ; get sign.
    8071   00:C732                    ~ 		rla                         ; is it negative?
    8072   00:C732                    ~ 		jr nc,thrust0               ; yes.
    8073   00:C732                    ~ 		add hl,de                   ; just add.
    8074   00:C732                    ~ 		jr thrust1                  ; skip subtraction.
    8075   00:C732                    ~ thrust0:
    8076   00:C732                    ~ 		ex de,hl                    ; inertia in hl, force in de.
    8077   00:C732                    ~ 		sbc hl,de                   ; subtract force.
    8078   00:C732                    ~ thrust1:
    8079   00:C732                    ~ 		ld (ix+3),h                 ; set integer.
    8080   00:C732                    ~ 		ld (ix+13),l                ; set fraction.
    8081   00:C732                    ~ 		ld a,(ix+10)                ; direction.
    8082   00:C732                    ~ 		add a,64                    ; shift 90 degrees to get cosine.
    8083   00:C732                    ~ 		
    8084   00:C732                    ~ 		
    8085   00:C732                    ~ 		/*
    8086   00:C732                    ~ 		ld h,(sintab>>8)&$FF
    8087   00:C732                    ~ 		ld l,a
    8088   00:C732                    ~ 		ld a,(hl)
    8089   00:C732                    ~ 		*/
    8090   00:C732                    ~ 		
    8091   00:C732                    ~ 		ld e,a                      ; displacement to value.
    8092   00:C732                    ~ 		ld d,0                      ; no high byte.
    8093   00:C732                    ~ 		ld hl,sintab                ; sine table.
    8094   00:C732                    ~ 		add hl,de                   ; point to entry.
    8095   00:C732                    ~ 		ld a,(hl)                   ; get the cosine.
    8096   00:C732                    ~ 		
    8097   00:C732                    ~ 		ld (usrsgn),a               ; store sign.
    8098   00:C732                    ~ 		and 127                     ; remove sign.
    8099   00:C732                    ~ 		ld h,a                      ; copy to first multiplier.
    8100   00:C732                    ~ 		ld a,(usrspd)               ; get speed.
    8101   00:C732                    ~ 		ld d,a                      ; second multiplier.
    8102   00:C732                    ~ 		call imul                   ; multiply together.
    8103   00:C732                    ~ 		ld e,(ix+14)                ; x fraction.
    8104   00:C732                    ~ 		ld d,(ix+4)                 ; x integer.
    8105   00:C732                    ~ 		ld a,(usrsgn)               ; get sign.
    8106   00:C732                    ~ 		rla                         ; is it negative?
    8107   00:C732                    ~ 		jr nc,thrust2               ; yes.
    8108   00:C732                    ~ 		add hl,de                   ; just add.
    8109   00:C732                    ~ 		jr thrust3                  ; skip subtraction.
    8110   00:C732                    ~ thrust2:
    8111   00:C732                    ~ 		ex de,hl                    ; inertia in hl, force in de.
    8112   00:C732                    ~ 		sbc hl,de                   ; subtract force.
    8113   00:C732                    ~ thrust3:
    8114   00:C732                    ~ 		ld (ix+4),h                 ; x set integer.
    8115   00:C732                    ~ 		ld (ix+14),l                ; x set fraction.
    8116   00:C732                    ~ 		ld a,4                      ; displacement.
    8117   00:C732                    ~ 		add a,h                     ; add to integer.
    8118   00:C732                    ~ 		ld h,a                      ; set horizontal.
    8119   00:C732                    ~ 		ld a,(ix+3)                 ; get y.
    8120   00:C732                    ~ 		add a,4                     ; add displacement.
    8121   00:C732                    ~ 		ld l,a                      ; copy to second coordinate register.
    8122   00:C732                    ~ 		ld (dispx),hl               ; set coordinates to find.
    8123   00:C732                    ~ 		call tstbl                  ; check block.
    8124   00:C732                    ~ 		ld b,2                      ; cells to test vertically.
    8125   00:C732                    ~ 		ld de,MSX_MAXCOLS-1         ; distance between cell lines minus one.
    8126   00:C732                    ~ thrust5:
    8127   00:C732                    ~ 		ld a,(hl)                   ; get block there.
    8128   00:C732                    ~ 		cp WALL                     ; is it a wall?
    8129   00:C732                    ~ 		jr z,thrust4                ; yes, can't move there.
    8130   00:C732                    ~ 		inc l                       ; next cell.
    8131   00:C732                    ~ 		ld a,(hl)                   ; get block there.
    8132   00:C732                    ~ 		cp WALL                     ; is it a wall?
    8133   00:C732                    ~ 		jr z,thrust4                ; yes, can't move there.
    8134   00:C732                    ~ 		add hl,de                   ; next row down.
    8135   00:C732                    ~ 		djnz thrust5                ; repeat for all rows.
    8136   00:C732                    ~ 		pop hl                      ; restore old fractions.
    8137   00:C732                    ~ 		ret
    8138   00:C732                    ~ thrust4:
    8139   00:C732                    ~ 		pop hl                      ; restore old fractions.
    8140   00:C732                    ~ 		ld (ix+13),l                ; reset y.
    8141   00:C732                    ~ 		ld (ix+14),h                ; reset x.
    8142   00:C732                    ~ 		ld a,(ix+8)                 ; previous y.
    8143   00:C732                    ~ 		ld (ix+3),a                 ; restore it.
    8144   00:C732                    ~ 		ld a,(ix+9)                 ; previous x.
    8145   00:C732                    ~ 		ld (ix+4),a                 ; restore that too.
    8146   00:C732                    ~ 		ret
    8147   00:C732                    ~ 	   
    8148   00:C732                    ~ sintab:
    8149   00:C732                    ~ 		db 0,3,6,9,12,15,18,21,24,27,30,33,36,39,42,45
    8150   00:C732                    ~ 		db 48,51,54,57,59,62,65,67,70,73,75,78,80,82,85,87
    8151   00:C732                    ~ 		db 89,91,94,96,98,100,102,103,105,107,108,110,112,113,114,116
    8152   00:C732                    ~ 		db 117,118,119,120,121,122,123,123,124,125,125,126,126,126,126,126
    8153   00:C732                    ~ 		db 127,126,126,126,126,126,125,125,124,123,123,122,121,120,119,118
    8154   00:C732                    ~ 		db 117,116,114,113,112,110,108,107,105,103,102,100,98,96,94,91
    8155   00:C732                    ~ 		db 89,87,85,82,80,78,75,73,70,67,65,62,59,57,54,51
    8156   00:C732                    ~ 		db 48,45,42,39,36,33,30,27,24,21,18,15,12,9,6,3
    8157   00:C732                    ~ 		db 128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173
    8158   00:C732                    ~ 		db 176,179,182,185,187,190,193,195,198,201,203,206,208,210,213,215
    8159   00:C732                    ~ 		db 217,219,222,224,226,228,230,231,233,235,236,238,240,241,242,244
    8160   00:C732                    ~ 		db 245,246,247,248,249,250,251,251,252,253,253,254,254,254,254,254
    8161   00:C732                    ~ 		db 255,254,254,254,254,254,253,253,252,251,251,250,249,248,247,246
    8162   00:C732                    ~ 		db 245,244,242,241,240,238,236,235,233,231,230,228,226,224,222,219
    8163   00:C732                    ~ 		db 217,215,213,210,208,206,203,201,198,195,193,190,187,185,182,179
    8164   00:C732                    ~ 		db 176,173,170,167,164,161,158,155,152,149,146,143,140,137,134,131
    8165   00:C732                    ~ 	
    8166   00:C732                    ~ 	endif
    8167   00:C732                      	
    8168   00:C732                      	if PFLAG
    8169   00:C732                      
    8170   00:C732                      ; some aligned data (256+88 bytes)
    8171   00:C732                      
    8172   00:C732  (00CE)              	   ALIGN 256
    8173   00:C800                      	
    8174   00:C800                      dots:		db 128,64,32,16,8,4,2,1   
    8174   00:C800  80 40 20 10 08 04 02 01 
    8175   00:C808  BC B7               shrptr:		dw laser          ; laser.
    8176   00:C80A  95 B7               			dw trail          ; vapour trail.
    8177   00:C80C  01 B7               			dw shrap          ; shrapnel from explosion.
    8178   00:C80E  21 B7               			dw dotl           ; horizontal starfield left.
    8179   00:C810  25 B7               			dw dotr           ; horizontal starfield right.
    8180   00:C812  29 B7               			dw dotu           ; vertical starfield up.
    8181   00:C814  2D B7               			dw dotd           ; vertical starfield down.
    8182   00:C816  C9 91               			dw ptcusr         ; user particle.			
    8183   00:C818                      shrsin: 	dw 0,1024,391,946,724,724,946,391
    8183   00:C818  00 00 00 04 87 01 B2 03 D4 02 D4 02 B2 03 87 01 
    8184   00:C828                      			dw 1024,0,946,65144,724,64811,391,64589
    8184   00:C828  00 04 00 00 B2 03 78 FE D4 02 2B FD 87 01 4D FC 
    8185   00:C838                      			dw 0,64512,65144,64589,64811,64811,64589,65144
    8185   00:C838  00 00 00 FC 78 FE 4D FC 2B FD 2B FD 4D FC 78 FE 
    8186   00:C848                      			dw 64512,0,64589,391,64811,724,65144,946
    8186   00:C848  00 FC 00 00 4D FC 87 01 2B FD D4 02 78 FE B2 03 
    8187   00:C858                      
    8188   00:C858                      
    8189   00:C858                      	endif
    8190   00:C858                      
    8191   00:C858                      
    8192   00:C858                      ; User routine.  Put your own code inside user.asm file to be called with USER instruction.
    8193   00:C858                      ; if USER has an argument it will be passed in the accumulator.
    8194   00:C858                      	if UFLAG
    8195   00:C858                    ~ 	
    8196   00:C858                    ~ 		include "User.asm"
    8197   00:C858                    ~ 
    8198   00:C858                    ~ 	endif
    8199   00:C858                      	
    8200   00:C858                      	include "Pletter_unpack.asm"
       1.  00:C858                      ; pletter v0.5c msx unpacker
       2.  00:C858                      
       3.  00:C858                      ; call unpack with hl pointing to some pletter5 data, and de pointing to the destination.
       4.  00:C858                      ; changes all registers
       5.  00:C858                      
       6.  00:C858                      ; define lengthindata when the original size is written in the pletter data
       7.  00:C858                      
       8.  00:C858                      ;  define LENGTHINDATA
       9.  00:C858                      
      10.  00:C858                        module pletter
      11.  00:C858                      
      12.  00:C858                        macro GETBIT
      13.  00:C858                    <   add a,a
      14.  00:C858                    <   call z,getbit
      15.  00:C858                    <   endmacro
      16.  00:C858                      
      17.  00:C858                        macro GETBITEXX
      18.  00:C858                    <   add a,a
      19.  00:C858                    <   call z,getbitexx
      20.  00:C858                    <   endmacro
      21.  00:C858                      
      22.  00:C858                      @unpack
      23.  00:C858                      
      24.  00:C858                        ifdef LENGTHINDATA
      25.  00:C858                    ~   inc hl
      26.  00:C858                    ~   inc hl
      27.  00:C858                    ~   endif
      28.  00:C858                      
      29.  00:C858  7E                    ld a,(hl)
      30.  00:C859  23                    inc hl
      31.  00:C85A  D9                    exx
      32.  00:C85B  11 00 00              ld de,0
      33.  00:C85E  87                    add a,a
      34.  00:C85F  3C                    inc a
      35.  00:C860  CB 13                 rl e
      36.  00:C862  87                    add a,a
      37.  00:C863  CB 13                 rl e
      38.  00:C865  87                    add a,a
      39.  00:C866  CB 13                 rl e
      40.  00:C868  CB 13                 rl e
      41.  00:C86A  21 F6 C8              ld hl,modes
      42.  00:C86D  19                    add hl,de
      43.  00:C86E  5E                    ld e,(hl)
      44.  00:C86F  DD 6B                 ld ixl,e
      45.  00:C871  23                    inc hl
      46.  00:C872  5E                    ld e,(hl)
      47.  00:C873  DD 63                 ld ixh,e
      48.  00:C875  1E 01                 ld e,1
      49.  00:C877  D9                    exx
      50.  00:C878  FD 21 7E C8           ld iy,loop
      51.  00:C87C                      literal
      52.  00:C87C  ED A0                 ldi
      53.  00:C87E                      loop
      54.  00:C87E                        GETBIT
      54.  00:C87E  87                >   add a,a
      54.  00:C87F  CC EC C8          >   call z,getbit
      55.  00:C882  30 F8                 jr nc,literal
      56.  00:C884  D9                    exx
      57.  00:C885  62                    ld h,d
      58.  00:C886  6B                    ld l,e
      59.  00:C887                      getlen
      60.  00:C887                        GETBITEXX
      60.  00:C887  87                >   add a,a
      60.  00:C888  CC F0 C8          >   call z,getbitexx
      61.  00:C88B  30 1B                 jr nc,.lenok
      62.  00:C88D                      .lus
      63.  00:C88D                        GETBITEXX
      63.  00:C88D  87                >   add a,a
      63.  00:C88E  CC F0 C8          >   call z,getbitexx
      64.  00:C891  ED 6A                 adc hl,hl
      65.  00:C893  D8                    ret c
      66.  00:C894                        GETBITEXX
      66.  00:C894  87                >   add a,a
      66.  00:C895  CC F0 C8          >   call z,getbitexx
      67.  00:C898  30 0E                 jr nc,.lenok
      68.  00:C89A                        GETBITEXX
      68.  00:C89A  87                >   add a,a
      68.  00:C89B  CC F0 C8          >   call z,getbitexx
      69.  00:C89E  ED 6A                 adc hl,hl
      70.  00:C8A0  D8                    ret c
      71.  00:C8A1                        GETBITEXX
      71.  00:C8A1  87                >   add a,a
      71.  00:C8A2  CC F0 C8          >   call z,getbitexx
      72.  00:C8A5  DA 8D C8              jp c,.lus
      73.  00:C8A8                      .lenok
      74.  00:C8A8  23                    inc hl
      75.  00:C8A9  D9                    exx
      76.  00:C8AA  4E                    ld c,(hl)
      77.  00:C8AB  23                    inc hl
      78.  00:C8AC  06 00                 ld b,0
      79.  00:C8AE  CB 79                 bit 7,c
      80.  00:C8B0  CA DD C8              jp z,offsok
      81.  00:C8B3  DD E9                 jp ix
      82.  00:C8B5                      
      83.  00:C8B5                      mode6
      84.  00:C8B5                        GETBIT
      84.  00:C8B5  87                >   add a,a
      84.  00:C8B6  CC EC C8          >   call z,getbit
      85.  00:C8B9  CB 10                 rl b
      86.  00:C8BB                      mode5
      87.  00:C8BB                        GETBIT
      87.  00:C8BB  87                >   add a,a
      87.  00:C8BC  CC EC C8          >   call z,getbit
      88.  00:C8BF  CB 10                 rl b
      89.  00:C8C1                      mode4
      90.  00:C8C1                        GETBIT
      90.  00:C8C1  87                >   add a,a
      90.  00:C8C2  CC EC C8          >   call z,getbit
      91.  00:C8C5  CB 10                 rl b
      92.  00:C8C7                      mode3
      93.  00:C8C7                        GETBIT
      93.  00:C8C7  87                >   add a,a
      93.  00:C8C8  CC EC C8          >   call z,getbit
      94.  00:C8CB  CB 10                 rl b
      95.  00:C8CD                      mode2
      96.  00:C8CD                        GETBIT
      96.  00:C8CD  87                >   add a,a
      96.  00:C8CE  CC EC C8          >   call z,getbit
      97.  00:C8D1  CB 10                 rl b
      98.  00:C8D3                        GETBIT
      98.  00:C8D3  87                >   add a,a
      98.  00:C8D4  CC EC C8          >   call z,getbit
      99.  00:C8D7  30 04                 jr nc,offsok
     100.  00:C8D9  B7                    or a
     101.  00:C8DA  04                    inc b
     102.  00:C8DB  CB B9                 res 7,c
     103.  00:C8DD                      offsok
     104.  00:C8DD  03                    inc bc
     105.  00:C8DE  E5                    push hl
     106.  00:C8DF  D9                    exx
     107.  00:C8E0  E5                    push hl
     108.  00:C8E1  D9                    exx
     109.  00:C8E2  6B                    ld l,e
     110.  00:C8E3  62                    ld h,d
     111.  00:C8E4  ED 42                 sbc hl,bc
     112.  00:C8E6  C1                    pop bc
     113.  00:C8E7  ED B0                 ldir
     114.  00:C8E9  E1                    pop hl
     115.  00:C8EA  FD E9                 jp iy
     116.  00:C8EC                      
     117.  00:C8EC                      getbit
     118.  00:C8EC  7E                    ld a,(hl)
     119.  00:C8ED  23                    inc hl
     120.  00:C8EE  17                    rla
     121.  00:C8EF  C9                    ret
     122.  00:C8F0                      
     123.  00:C8F0                      getbitexx
     124.  00:C8F0  D9                    exx
     125.  00:C8F1  7E                    ld a,(hl)
     126.  00:C8F2  23                    inc hl
     127.  00:C8F3  D9                    exx
     128.  00:C8F4  17                    rla
     129.  00:C8F5  C9                    ret
     130.  00:C8F6                      
     131.  00:C8F6                      modes
     132.  00:C8F6  DD C8                 word offsok
     133.  00:C8F8  CD C8                 word mode2
     134.  00:C8FA  C7 C8                 word mode3
     135.  00:C8FC  C1 C8                 word mode4
     136.  00:C8FE  BB C8                 word mode5
     137.  00:C900  B5 C8                 word mode6
     138.  00:C902                      
     139.  00:C902                        endmodule
     140.  00:C902                      
     141.  00:C902                      ;eof
    8201   00:C902                      	; Music & SFX routines
    8202   00:C902                      	include "PT3-ROM.asm"
       1.  00:C902                      		; --- PT3 REPLAYER WORKING ON ROM ---
       2.  00:C902                      		; --- Can be assembled with asMSX ---
       3.  00:C902                      		; --- ROM version: MSX-KUN        ---
       4.  00:C902                      		; --- asMSX version: SapphiRe     ---
       5.  00:C902                      		; --- tniasm version: theNestruo  ---
       6.  00:C902                      
       7.  00:C902                      ; Based on MSX version of PT3 by Dioniso
       8.  00:C902                      ;
       9.  00:C902                      ; This version of the replayer uses a fixed volume and note table, if you need a 
      10.  00:C902                      ; different note table you can copy it from TABLES.TXT file, distributed with the
      11.  00:C902                      ; original PT3 distribution. This version also allows the use of PT3 commands.
      12.  00:C902                      ;
      13.  00:C902                      ; PLAY and PSG WRITE routines seperated to allow independent calls
      14.  00:C902                      ;
      15.  00:C902                      ; ROM LENGTH: 1528 bytes
      16.  00:C902                      ; RAM LENGTH:  382 bytes
      17.  00:C902                      
      18.  00:C902                      		; --- CONSTANT VALUES DEFINITION ---
      19.  00:C902                      
      20.  00:C902                      ;ChannelsVars
      21.  00:C902                      ;struc	CHNPRM
      22.  00:C902                      ;reset group
      23.  00:C902  (00:0000)           CHNPRM_PsInOr:	equ 0	;RESB 1
      24.  00:C902  (00:0001)           CHNPRM_PsInSm:	equ 1	;RESB 1
      25.  00:C902  (00:0002)           CHNPRM_CrAmSl:	equ 2	;RESB 1
      26.  00:C902  (00:0003)           CHNPRM_CrNsSl:	equ 3	;RESB 1
      27.  00:C902  (00:0004)           CHNPRM_CrEnSl:	equ 4	;RESB 1
      28.  00:C902  (00:0005)           CHNPRM_TSlCnt:	equ 5	;RESB 1
      29.  00:C902  (00:0006)           CHNPRM_CrTnSl:	equ 6	;RESW 1
      30.  00:C902  (00:0008)           CHNPRM_TnAcc:	equ 8	;RESW 1
      31.  00:C902  (00:000A)           CHNPRM_COnOff:	equ 10	;RESB 1
      32.  00:C902                      ;reset group
      33.  00:C902                      
      34.  00:C902  (00:000B)           CHNPRM_OnOffD:	equ 11	;RESB 1
      35.  00:C902                      
      36.  00:C902                      ;IX for PTDECOD here [+12]
      37.  00:C902  (00:000C)           CHNPRM_OffOnD:	equ 12	;RESB 1
      38.  00:C902  (00:000D)           CHNPRM_OrnPtr:	equ 13	;RESW 1
      39.  00:C902  (00:000F)           CHNPRM_SamPtr:	equ 15	;RESW 1
      40.  00:C902  (00:0011)           CHNPRM_NNtSkp:	equ 17	;RESB 1
      41.  00:C902  (00:0012)           CHNPRM_Note:	equ 18	;RESB 1
      42.  00:C902  (00:0013)           CHNPRM_SlToNt:	equ 19	;RESB 1
      43.  00:C902  (00:0014)           CHNPRM_Env_En:	equ 20	;RESB 1
      44.  00:C902  (00:0015)           CHNPRM_Flags:	equ 21	;RESB 1
      45.  00:C902                       ;Enabled - 0,SimpleGliss - 2
      46.  00:C902  (00:0016)           CHNPRM_TnSlDl:	equ 22	;RESB 1
      47.  00:C902  (00:0017)           CHNPRM_TSlStp:	equ 23	;RESW 1
      48.  00:C902  (00:0019)           CHNPRM_TnDelt:	equ 25	;RESW 1
      49.  00:C902  (00:001B)           CHNPRM_NtSkCn:	equ 27	;RESB 1
      50.  00:C902  (00:001C)           CHNPRM_Volume:	equ 28	;RESB 1
      51.  00:C902  (00:001D)           CHNPRM_Size:	equ 29	;RESB 1
      52.  00:C902                      ;endstruc
      53.  00:C902                      
      54.  00:C902                      ;struc	AR
      55.  00:C902  (00:0000)           AR_TonA:	equ 0	;RESW 1
      56.  00:C902  (00:0002)           AR_TonB:	equ 2	;RESW 1
      57.  00:C902  (00:0004)           AR_TonC:	equ 4	;RESW 1
      58.  00:C902  (00:0006)           AR_Noise:	equ 6	;RESB 1
      59.  00:C902  (00:0007)           AR_Mixer:	equ 7	;RESB 1
      60.  00:C902  (00:0008)           AR_AmplA:	equ 8	;RESB 1
      61.  00:C902  (00:0009)           AR_AmplB:	equ 9	;RESB 1
      62.  00:C902  (00:000A)           AR_AmplC:	equ 10	;RESB 1
      63.  00:C902  (00:000B)           AR_Env:		equ 11	;RESW 1
      64.  00:C902  (00:000D)           AR_EnvTp:	equ 13	;RESB 1
      65.  00:C902                      ;endstruc
      66.  00:C902                      
      67.  00:C902                      		; --- CODE STARTS HERE ---
      68.  00:C902                      
      69.  00:C902                      	if YFLAG
      70.  00:C902                    ~ 
      71.  00:C902                    ~ CHECKLP:	
      72.  00:C902                    ~ 		ld hl,PT3_SETUP
      73.  00:C902                    ~ 		set	7,(hl)
      74.  00:C902                    ~ 		bit	0,(hl)
      75.  00:C902                    ~ 		ret z
      76.  00:C902                    ~ 		pop hl
      77.  00:C902                    ~ 		ld hl,DelyCnt
      78.  00:C902                    ~ 		inc	(hl)
      79.  00:C902                    ~ 		ld hl,ChanA+CHNPRM_NtSkCn
      80.  00:C902                    ~ 		inc	(hl)
      81.  00:C902                    ~ 		jp music_mute
      82.  00:C902                    ~ 
      83.  00:C902                    ~ ; -------------------------------------------------------
      84.  00:C902                    ~ 		
      85.  00:C902                    ~ PT3_INIT:	;HL - AddressOfModule - 100
      86.  00:C902                    ~ 		LD [PT3_MODADDR],HL
      87.  00:C902                    ~ 		PUSH HL
      88.  00:C902                    ~ 		LD DE,100
      89.  00:C902                    ~ 		ADD HL,DE
      90.  00:C902                    ~ 		LD A,[HL]
      91.  00:C902                    ~ 		LD [PT3_Delay],A
      92.  00:C902                    ~ 		PUSH HL
      93.  00:C902                    ~ 		POP IX
      94.  00:C902                    ~ 		ADD HL,DE
      95.  00:C902                    ~ 		LD [PT3_CrPsPtr],HL
      96.  00:C902                    ~ 		LD E,[IX+102-100]
      97.  00:C902                    ~ 		ADD HL,DE
      98.  00:C902                    ~ 		INC HL
      99.  00:C902                    ~ 		LD [PT3_LPosPtr],HL
     100.  00:C902                    ~ 		POP DE
     101.  00:C902                    ~ 		LD L,[IX+103-100]
     102.  00:C902                    ~ 		LD H,[IX+104-100]
     103.  00:C902                    ~ 		ADD HL,DE
     104.  00:C902                    ~ 		LD [PT3_PatsPtr],HL
     105.  00:C902                    ~ 		LD HL,169
     106.  00:C902                    ~ 		ADD HL,DE
     107.  00:C902                    ~ 		LD [PT3_OrnPtrs],HL
     108.  00:C902                    ~ 		LD HL,105
     109.  00:C902                    ~ 		ADD HL,DE
     110.  00:C902                    ~ 		LD [PT3_SAMPTRS],HL
     111.  00:C902                    ~ 		LD HL,PT3_SETUP
     112.  00:C902                    ~ 		RES 7,[HL]
     113.  00:C902                    ~ 
     114.  00:C902                    ~ 		; --- CREATE PT3 VOLUME TABLE (c) Ivan Roshin, adapted by SapphiRe ---
     115.  00:C902                    ~ 		ld	hl,$11
     116.  00:C902                    ~ 		ld	d,h
     117.  00:C902                    ~ 		ld	e,h
     118.  00:C902                    ~ 		ld	IX,VT_+16
     119.  00:C902                    ~ 		ld	b,15
     120.  00:C902                    ~ .INITV1:	push	hl
     121.  00:C902                    ~ 		add	hl,de
     122.  00:C902                    ~ 		ex	de,hl
     123.  00:C902                    ~ 		sbc	hl,hl
     124.  00:C902                    ~ 		ld	c,b
     125.  00:C902                    ~ 		ld	b,16
     126.  00:C902                    ~ .INITV2:	ld	a,l
     127.  00:C902                    ~ 		rla
     128.  00:C902                    ~ 		ld	a,h
     129.  00:C902                    ~ 		adc	a,0
     130.  00:C902                    ~ 		ld	[ix],a
     131.  00:C902                    ~ 		inc	ix
     132.  00:C902                    ~ 		add	hl,de
     133.  00:C902                    ~ 		djnz	.INITV2
     134.  00:C902                    ~ 		pop	hl
     135.  00:C902                    ~ 		ld	a,e
     136.  00:C902                    ~ 		cp	$77
     137.  00:C902                    ~ 		jr	nz,.INITV3
     138.  00:C902                    ~ 		inc	e
     139.  00:C902                    ~ .INITV3:	ld	b,c
     140.  00:C902                    ~ 		djnz	.INITV1
     141.  00:C902                    ~ 
     142.  00:C902                    ~ 		; --- INITIALIZE PT3 VARIABLES ---
     143.  00:C902                    ~ 		XOR A
     144.  00:C902                    ~ 		LD HL,VARS
     145.  00:C902                    ~ 		LD [HL],A
     146.  00:C902                    ~ 		LD DE,VARS+1
     147.  00:C902                    ~ 		LD BC,VAR0END-VARS-1
     148.  00:C902                    ~ 		LDIR
     149.  00:C902                    ~ 
     150.  00:C902                    ~ 		INC A
     151.  00:C902                    ~ 		LD [DelyCnt],A
     152.  00:C902                    ~ 		LD HL,$F001 ;H - CHNPRM_Volume, L - CHNPRM_NtSkCn
     153.  00:C902                    ~ 		LD [ChanA+CHNPRM_NtSkCn],HL
     154.  00:C902                    ~ 		LD [ChanB+CHNPRM_NtSkCn],HL
     155.  00:C902                    ~ 		LD [ChanC+CHNPRM_NtSkCn],HL
     156.  00:C902                    ~ 
     157.  00:C902                    ~ 		LD HL,EMPTYSAMORN
     158.  00:C902                    ~ 		LD [PT3_AdInPtA],HL ;ptr to zero
     159.  00:C902                    ~ 		LD [ChanA+CHNPRM_OrnPtr],HL ;ornament 0 is "0,1,0"
     160.  00:C902                    ~ 		LD [ChanB+CHNPRM_OrnPtr],HL ;in all versions from
     161.  00:C902                    ~ 		LD [ChanC+CHNPRM_OrnPtr],HL ;3.xx to 3.6x and VTII
     162.  00:C902                    ~ 
     163.  00:C902                    ~ 		LD [ChanA+CHNPRM_SamPtr],HL ;S1 There is no default
     164.  00:C902                    ~ 		LD [ChanB+CHNPRM_SamPtr],HL ;S2 sample in PT3, so, you
     165.  00:C902                    ~ 		LD [ChanC+CHNPRM_SamPtr],HL ;S3 can comment S1,2,3; see
     166.  00:C902                    ~ 					    ;also EMPTYSAMORN comment
     167.  00:C902                    ~ 						
     168.  00:C902                    ~ 		RET
     169.  00:C902                    ~ 
     170.  00:C902                    ~ 		;pattern decoder
     171.  00:C902                    ~ PD_OrSm:	LD [IX+(CHNPRM_Env_En-12)],0
     172.  00:C902                    ~ 		CALL SETORN
     173.  00:C902                    ~ 		LD A,[BC]
     174.  00:C902                    ~ 		INC BC
     175.  00:C902                    ~ 		RRCA
     176.  00:C902                    ~ 
     177.  00:C902                    ~ PD_SAM:		ADD A,A
     178.  00:C902                    ~ PD_SAM_:	LD E,A
     179.  00:C902                    ~ 		LD D,0
     180.  00:C902                    ~ 		LD HL,[PT3_SAMPTRS]
     181.  00:C902                    ~ 		ADD HL,DE
     182.  00:C902                    ~ 		LD E,[HL]
     183.  00:C902                    ~ 		INC HL
     184.  00:C902                    ~ 		LD D,[HL]
     185.  00:C902                    ~ 		LD HL,[PT3_MODADDR]
     186.  00:C902                    ~ 		ADD HL,DE
     187.  00:C902                    ~ 		LD [IX+(CHNPRM_SamPtr-12)],L
     188.  00:C902                    ~ 		LD [IX+(CHNPRM_SamPtr+1-12)],H
     189.  00:C902                    ~ 		JR PD_LOOP
     190.  00:C902                    ~ 
     191.  00:C902                    ~ PD_VOL:		RLCA
     192.  00:C902                    ~ 		RLCA
     193.  00:C902                    ~ 		RLCA
     194.  00:C902                    ~ 		RLCA
     195.  00:C902                    ~ 		LD [IX+(CHNPRM_Volume-12)],A
     196.  00:C902                    ~ 		JR PD_LP2
     197.  00:C902                    ~ 	
     198.  00:C902                    ~ PD_EOff:	LD [IX+(CHNPRM_Env_En-12)],A
     199.  00:C902                    ~ 		LD [IX+(CHNPRM_PsInOr-12)],A
     200.  00:C902                    ~ 		JR PD_LP2
     201.  00:C902                    ~ 
     202.  00:C902                    ~ PD_SorE:	DEC A
     203.  00:C902                    ~ 		JR NZ,PD_ENV
     204.  00:C902                    ~ 		LD A,[BC]
     205.  00:C902                    ~ 		INC BC
     206.  00:C902                    ~ 		LD [IX+(CHNPRM_NNtSkp-12)],A
     207.  00:C902                    ~ 		JR PD_LP2
     208.  00:C902                    ~ 
     209.  00:C902                    ~ PD_ENV:		CALL SETENV
     210.  00:C902                    ~ 		JR PD_LP2
     211.  00:C902                    ~ 
     212.  00:C902                    ~ PD_ORN:		CALL SETORN
     213.  00:C902                    ~ 		JR PD_LOOP
     214.  00:C902                    ~        
     215.  00:C902                    ~ PD_ESAM:	LD [IX+(CHNPRM_Env_En-12)],A
     216.  00:C902                    ~ 		LD [IX+(CHNPRM_PsInOr-12)],A
     217.  00:C902                    ~ 		CALL NZ,SETENV
     218.  00:C902                    ~ 		LD A,[BC]
     219.  00:C902                    ~ 		INC BC
     220.  00:C902                    ~ 		JR PD_SAM_
     221.  00:C902                    ~ 
     222.  00:C902                    ~ PTDECOD:	LD A,[IX+(CHNPRM_Note-12)]
     223.  00:C902                    ~ 		LD [PT3_PrNote],A
     224.  00:C902                    ~ 		LD L,[IX+(CHNPRM_CrTnSl-12)]
     225.  00:C902                    ~ 		LD H,[IX+(CHNPRM_CrTnSl+1-12)]
     226.  00:C902                    ~ 		LD [PT3_PrSlide],HL
     227.  00:C902                    ~ 
     228.  00:C902                    ~ PD_LOOP:	LD DE,$2010
     229.  00:C902                    ~ PD_LP2:		LD A,[BC]
     230.  00:C902                    ~ 		INC BC
     231.  00:C902                    ~ 		ADD A,E
     232.  00:C902                    ~ 		JR C,PD_OrSm
     233.  00:C902                    ~ 		ADD A,D
     234.  00:C902                    ~ 		JR Z,PD_FIN
     235.  00:C902                    ~ 		JR C,PD_SAM
     236.  00:C902                    ~ 		ADD A,E
     237.  00:C902                    ~ 		JR Z,PD_REL
     238.  00:C902                    ~ 		JR C,PD_VOL
     239.  00:C902                    ~ 		ADD A,E
     240.  00:C902                    ~ 		JR Z,PD_EOff
     241.  00:C902                    ~ 		JR C,PD_SorE
     242.  00:C902                    ~ 		ADD A,96
     243.  00:C902                    ~ 		JR C,PD_NOTE
     244.  00:C902                    ~ 		ADD A,E
     245.  00:C902                    ~ 		JR C,PD_ORN
     246.  00:C902                    ~ 		ADD A,D
     247.  00:C902                    ~ 		JR C,PD_NOIS
     248.  00:C902                    ~ 		ADD A,E
     249.  00:C902                    ~ 		JR C,PD_ESAM
     250.  00:C902                    ~ 		ADD A,A
     251.  00:C902                    ~ 		LD E,A
     252.  00:C902                    ~ 		LD HL,SPCCOMS.HL_VALUE
     253.  00:C902                    ~ 		ADD HL,DE
     254.  00:C902                    ~ 		LD E,[HL]
     255.  00:C902                    ~ 		INC HL
     256.  00:C902                    ~ 		LD D,[HL]
     257.  00:C902                    ~ 		PUSH DE
     258.  00:C902                    ~ 		JR PD_LOOP
     259.  00:C902                    ~ 
     260.  00:C902                    ~ PD_NOIS:	LD [Ns_Base],A
     261.  00:C902                    ~ 		JR PD_LP2
     262.  00:C902                    ~ 
     263.  00:C902                    ~ PD_REL:		RES 0,[IX+(CHNPRM_Flags-12)]
     264.  00:C902                    ~ 		JR PD_RES
     265.  00:C902                    ~ 	
     266.  00:C902                    ~ PD_NOTE:	LD [IX+(CHNPRM_Note-12)],A
     267.  00:C902                    ~ 		SET 0,[IX+(CHNPRM_Flags-12)]
     268.  00:C902                    ~ 		XOR A
     269.  00:C902                    ~ 
     270.  00:C902                    ~ PD_RES:		LD [PT3_PDSP],SP
     271.  00:C902                    ~ 		LD SP,IX
     272.  00:C902                    ~ 		LD H,A
     273.  00:C902                    ~ 		LD L,A
     274.  00:C902                    ~ 		PUSH HL
     275.  00:C902                    ~ 		PUSH HL
     276.  00:C902                    ~ 		PUSH HL
     277.  00:C902                    ~ 		PUSH HL
     278.  00:C902                    ~ 		PUSH HL
     279.  00:C902                    ~ 		PUSH HL
     280.  00:C902                    ~ 		LD SP,[PT3_PDSP]
     281.  00:C902                    ~ 
     282.  00:C902                    ~ PD_FIN:		LD A,[IX+(CHNPRM_NNtSkp-12)]
     283.  00:C902                    ~ 		LD [IX+(CHNPRM_NtSkCn-12)],A
     284.  00:C902                    ~ 		RET
     285.  00:C902                    ~ 
     286.  00:C902                    ~ C_PORTM:	RES 2,[IX+(CHNPRM_Flags-12)]
     287.  00:C902                    ~ 		LD A,[BC]
     288.  00:C902                    ~ 		INC BC
     289.  00:C902                    ~ 		;SKIP PRECALCULATED TONE DELTA [BECAUSE
     290.  00:C902                    ~ 		;CANNOT BE RIGHT AFTER PT3 COMPILATION]
     291.  00:C902                    ~ 		INC BC
     292.  00:C902                    ~ 		INC BC
     293.  00:C902                    ~ 		LD [IX+(CHNPRM_TnSlDl-12)],A
     294.  00:C902                    ~ 		LD [IX+(CHNPRM_TSlCnt-12)],A
     295.  00:C902                    ~ 		LD DE,NT_
     296.  00:C902                    ~ 		LD A,[IX+(CHNPRM_Note-12)]
     297.  00:C902                    ~ 		LD [IX+(CHNPRM_SlToNt-12)],A
     298.  00:C902                    ~ 		ADD A,A
     299.  00:C902                    ~ 		LD L,A
     300.  00:C902                    ~ 		LD H,0
     301.  00:C902                    ~ 		ADD HL,DE
     302.  00:C902                    ~ 		LD A,[HL]
     303.  00:C902                    ~ 		INC HL
     304.  00:C902                    ~ 		LD H,[HL]
     305.  00:C902                    ~ 		LD L,A
     306.  00:C902                    ~ 		PUSH HL
     307.  00:C902                    ~ 		LD A,[PT3_PrNote]
     308.  00:C902                    ~ 		LD [IX+(CHNPRM_Note-12)],A
     309.  00:C902                    ~ 		ADD A,A
     310.  00:C902                    ~ 		LD L,A
     311.  00:C902                    ~ 		LD H,0
     312.  00:C902                    ~ 		ADD HL,DE
     313.  00:C902                    ~ 		LD E,[HL]
     314.  00:C902                    ~ 		INC HL
     315.  00:C902                    ~ 		LD D,[HL]
     316.  00:C902                    ~ 		POP HL
     317.  00:C902                    ~ 		SBC HL,DE
     318.  00:C902                    ~ 		LD [IX+(CHNPRM_TnDelt-12)],L
     319.  00:C902                    ~ 		LD [IX+(CHNPRM_TnDelt+1-12)],H
     320.  00:C902                    ~ 		LD DE,[PT3_PrSlide]
     321.  00:C902                    ~ 		LD [IX+(CHNPRM_CrTnSl-12)],E
     322.  00:C902                    ~ 		LD [IX+(CHNPRM_CrTnSl+1-12)],D
     323.  00:C902                    ~ 		LD A,[BC] ;SIGNED TONE STEP
     324.  00:C902                    ~ 		INC BC
     325.  00:C902                    ~ 		EX AF,AF
     326.  00:C902                    ~ 		LD A,[BC]
     327.  00:C902                    ~ 		INC BC
     328.  00:C902                    ~ 		AND A
     329.  00:C902                    ~ 		JR Z,.NOSIG
     330.  00:C902                    ~ 		EX DE,HL
     331.  00:C902                    ~ .NOSIG:	SBC HL,DE
     332.  00:C902                    ~ 		JP P,SET_STP
     333.  00:C902                    ~ 		CPL
     334.  00:C902                    ~ 		EX AF,AF
     335.  00:C902                    ~ 		NEG
     336.  00:C902                    ~ 		EX AF,AF
     337.  00:C902                    ~ SET_STP:	LD [IX+(CHNPRM_TSlStp+1-12)],A
     338.  00:C902                    ~ 		EX AF,AF
     339.  00:C902                    ~ 		LD [IX+(CHNPRM_TSlStp-12)],A
     340.  00:C902                    ~ 		LD [IX+(CHNPRM_COnOff-12)],0
     341.  00:C902                    ~ 		RET
     342.  00:C902                    ~ 
     343.  00:C902                    ~ C_GLISS:	SET 2,[IX+(CHNPRM_Flags-12)]
     344.  00:C902                    ~ 		LD A,[BC]
     345.  00:C902                    ~ 		INC BC
     346.  00:C902                    ~ 		LD [IX+(CHNPRM_TnSlDl-12)],A
     347.  00:C902                    ~ 		LD [IX+(CHNPRM_TSlCnt-12)],A
     348.  00:C902                    ~ 		LD A,[BC]
     349.  00:C902                    ~ 		INC BC
     350.  00:C902                    ~ 		EX AF,AF
     351.  00:C902                    ~ 		LD A,[BC]
     352.  00:C902                    ~ 		INC BC
     353.  00:C902                    ~ 		JR SET_STP
     354.  00:C902                    ~ 
     355.  00:C902                    ~ C_SMPOS:	LD A,[BC]
     356.  00:C902                    ~ 		INC BC
     357.  00:C902                    ~ 		LD [IX+(CHNPRM_PsInSm-12)],A
     358.  00:C902                    ~ 		RET
     359.  00:C902                    ~ 
     360.  00:C902                    ~ C_ORPOS:	LD A,[BC]
     361.  00:C902                    ~ 		INC BC
     362.  00:C902                    ~ 		LD [IX+(CHNPRM_PsInOr-12)],A
     363.  00:C902                    ~ 		RET
     364.  00:C902                    ~ 
     365.  00:C902                    ~ C_VIBRT:	LD A,[BC]
     366.  00:C902                    ~ 		INC BC
     367.  00:C902                    ~ 		LD [IX+(CHNPRM_OnOffD-12)],A
     368.  00:C902                    ~ 		LD [IX+(CHNPRM_COnOff-12)],A
     369.  00:C902                    ~ 		LD A,[BC]
     370.  00:C902                    ~ 		INC BC
     371.  00:C902                    ~ 		LD [IX+(CHNPRM_OffOnD-12)],A
     372.  00:C902                    ~ 		XOR A
     373.  00:C902                    ~ 		LD [IX+(CHNPRM_TSlCnt-12)],A
     374.  00:C902                    ~ 		LD [IX+(CHNPRM_CrTnSl-12)],A
     375.  00:C902                    ~ 		LD [IX+(CHNPRM_CrTnSl+1-12)],A
     376.  00:C902                    ~ 		RET
     377.  00:C902                    ~ 
     378.  00:C902                    ~ C_ENGLS:	LD A,[BC]
     379.  00:C902                    ~ 		INC BC
     380.  00:C902                    ~ 		LD [PT3_Env_Del],A
     381.  00:C902                    ~ 		LD [CurEDel],A
     382.  00:C902                    ~ 		LD A,[BC]
     383.  00:C902                    ~ 		INC BC
     384.  00:C902                    ~ 		LD L,A
     385.  00:C902                    ~ 		LD A,[BC]
     386.  00:C902                    ~ 		INC BC
     387.  00:C902                    ~ 		LD H,A
     388.  00:C902                    ~ 		LD [PT3_ESldAdd],HL
     389.  00:C902                    ~ 		RET
     390.  00:C902                    ~ 
     391.  00:C902                    ~ C_DELAY:	LD A,[BC]
     392.  00:C902                    ~ 		INC BC
     393.  00:C902                    ~ 		LD [PT3_Delay],A
     394.  00:C902                    ~ 		RET
     395.  00:C902                    ~ 	
     396.  00:C902                    ~ SETENV:		LD [IX+(CHNPRM_Env_En-12)],E
     397.  00:C902                    ~ 		LD [AYREGS+AR_EnvTp],A
     398.  00:C902                    ~ 		LD A,[BC]
     399.  00:C902                    ~ 		INC BC
     400.  00:C902                    ~ 		LD H,A
     401.  00:C902                    ~ 		LD A,[BC]
     402.  00:C902                    ~ 		INC BC
     403.  00:C902                    ~ 		LD L,A
     404.  00:C902                    ~ 		LD [EnvBase],HL
     405.  00:C902                    ~ 		XOR A
     406.  00:C902                    ~ 		LD [IX+(CHNPRM_PsInOr-12)],A
     407.  00:C902                    ~ 		LD [CurEDel],A
     408.  00:C902                    ~ 		LD H,A
     409.  00:C902                    ~ 		LD L,A
     410.  00:C902                    ~ 		LD [CurESld],HL
     411.  00:C902                    ~ C_NOP:		RET
     412.  00:C902                    ~ 
     413.  00:C902                    ~ SETORN:		ADD A,A
     414.  00:C902                    ~ 		LD E,A
     415.  00:C902                    ~ 		LD D,0
     416.  00:C902                    ~ 		LD [IX+(CHNPRM_PsInOr-12)],D
     417.  00:C902                    ~ 		LD HL,[PT3_OrnPtrs]
     418.  00:C902                    ~ 		ADD HL,DE
     419.  00:C902                    ~ 		LD E,[HL]
     420.  00:C902                    ~ 		INC HL
     421.  00:C902                    ~ 		LD D,[HL]
     422.  00:C902                    ~ 		LD HL,[PT3_MODADDR]
     423.  00:C902                    ~ 		ADD HL,DE
     424.  00:C902                    ~ 		LD [IX+(CHNPRM_OrnPtr-12)],L
     425.  00:C902                    ~ 		LD [IX+(CHNPRM_OrnPtr+1-12)],H
     426.  00:C902                    ~ 		RET
     427.  00:C902                    ~ 
     428.  00:C902                    ~ 		;ALL 16 ADDRESSES TO PROTECT FROM BROKEN PT3 MODULES
     429.  00:C902                    ~ SPCCOMS:	dw C_NOP
     430.  00:C902                    ~ 		dw C_GLISS
     431.  00:C902                    ~ 		dw C_PORTM
     432.  00:C902                    ~ 		dw C_SMPOS
     433.  00:C902                    ~ 		dw C_ORPOS
     434.  00:C902                    ~ 		dw C_VIBRT
     435.  00:C902                    ~ 		dw C_NOP
     436.  00:C902                    ~ 		dw C_NOP
     437.  00:C902                    ~ 		dw C_ENGLS
     438.  00:C902                    ~ 		dw C_DELAY
     439.  00:C902                    ~ 		dw C_NOP
     440.  00:C902                    ~ 		dw C_NOP
     441.  00:C902                    ~ 		dw C_NOP
     442.  00:C902                    ~ 		dw C_NOP
     443.  00:C902                    ~ 		dw C_NOP
     444.  00:C902                    ~ 		dw C_NOP
     445.  00:C902                    ~ .HL_VALUE:	equ (SPCCOMS+$DF20) MOD 65536; Adapted from original Speccy version (saves 6 bytes)
     446.  00:C902                    ~ 
     447.  00:C902                    ~ CHREGS:		XOR A
     448.  00:C902                    ~ 		LD [AYREGS+AR_AmplC],A
     449.  00:C902                    ~ 		BIT 0,[IX+CHNPRM_Flags]
     450.  00:C902                    ~ 		PUSH HL
     451.  00:C902                    ~ 		JP Z,.CH_EXIT
     452.  00:C902                    ~ 		LD [PT3_CSP],SP
     453.  00:C902                    ~ 		LD L,[IX+CHNPRM_OrnPtr]
     454.  00:C902                    ~ 		LD H,[IX+CHNPRM_OrnPtr+1]
     455.  00:C902                    ~ 		LD SP,HL
     456.  00:C902                    ~ 		POP DE
     457.  00:C902                    ~ 		LD H,A
     458.  00:C902                    ~ 		LD A,[IX+CHNPRM_PsInOr]
     459.  00:C902                    ~ 		LD L,A
     460.  00:C902                    ~ 		ADD HL,SP
     461.  00:C902                    ~ 		INC A
     462.  00:C902                    ~ 		CP D
     463.  00:C902                    ~ 		JR C,.CH_ORPS
     464.  00:C902                    ~ 		LD A,E
     465.  00:C902                    ~ .CH_ORPS:	LD [IX+CHNPRM_PsInOr],A
     466.  00:C902                    ~ 		LD A,[IX+CHNPRM_Note]
     467.  00:C902                    ~ 		ADD A,[HL]
     468.  00:C902                    ~ 		JP P,.CH_NTP
     469.  00:C902                    ~ 		XOR A
     470.  00:C902                    ~ .CH_NTP:	CP 96
     471.  00:C902                    ~ 		JR C,.CH_NOK
     472.  00:C902                    ~ 		LD A,95
     473.  00:C902                    ~ .CH_NOK:	ADD A,A
     474.  00:C902                    ~ 		EX AF,AF
     475.  00:C902                    ~ 		LD L,[IX+CHNPRM_SamPtr]
     476.  00:C902                    ~ 		LD H,[IX+CHNPRM_SamPtr+1]
     477.  00:C902                    ~ 		LD SP,HL
     478.  00:C902                    ~ 		POP DE
     479.  00:C902                    ~ 		LD H,0
     480.  00:C902                    ~ 		LD A,[IX+CHNPRM_PsInSm]
     481.  00:C902                    ~ 		LD B,A
     482.  00:C902                    ~ 		ADD A,A
     483.  00:C902                    ~ 		ADD A,A
     484.  00:C902                    ~ 		LD L,A
     485.  00:C902                    ~ 		ADD HL,SP
     486.  00:C902                    ~ 		LD SP,HL
     487.  00:C902                    ~ 		LD A,B
     488.  00:C902                    ~ 		INC A
     489.  00:C902                    ~ 		CP D
     490.  00:C902                    ~ 		JR C,.CH_SMPS
     491.  00:C902                    ~ 		LD A,E
     492.  00:C902                    ~ .CH_SMPS:	LD [IX+CHNPRM_PsInSm],A
     493.  00:C902                    ~ 		POP BC
     494.  00:C902                    ~ 		POP HL
     495.  00:C902                    ~ 		LD E,[IX+CHNPRM_TnAcc]
     496.  00:C902                    ~ 		LD D,[IX+CHNPRM_TnAcc+1]
     497.  00:C902                    ~ 		ADD HL,DE
     498.  00:C902                    ~ 		BIT 6,B
     499.  00:C902                    ~ 		JR Z,.CH_NOAC
     500.  00:C902                    ~ 		LD [IX+CHNPRM_TnAcc],L
     501.  00:C902                    ~ 		LD [IX+CHNPRM_TnAcc+1],H
     502.  00:C902                    ~ .CH_NOAC:	EX DE,HL
     503.  00:C902                    ~ 		EX AF,AF
     504.  00:C902                    ~ 		LD L,A
     505.  00:C902                    ~ 		LD H,0
     506.  00:C902                    ~ 		LD SP,NT_
     507.  00:C902                    ~ 		ADD HL,SP
     508.  00:C902                    ~ 		LD SP,HL
     509.  00:C902                    ~ 		POP HL
     510.  00:C902                    ~ 		ADD HL,DE
     511.  00:C902                    ~ 		LD E,[IX+CHNPRM_CrTnSl]
     512.  00:C902                    ~ 		LD D,[IX+CHNPRM_CrTnSl+1]
     513.  00:C902                    ~ 		ADD HL,DE
     514.  00:C902                    ~ 		LD SP,[PT3_CSP]
     515.  00:C902                    ~ 		EX [SP],HL
     516.  00:C902                    ~ 		XOR A
     517.  00:C902                    ~ 		OR [IX+CHNPRM_TSlCnt]
     518.  00:C902                    ~ 		JR Z,.CH_AMP
     519.  00:C902                    ~ 		DEC [IX+CHNPRM_TSlCnt]
     520.  00:C902                    ~ 		JR NZ,.CH_AMP
     521.  00:C902                    ~ 		LD A,[IX+CHNPRM_TnSlDl]
     522.  00:C902                    ~ 		LD [IX+CHNPRM_TSlCnt],A
     523.  00:C902                    ~ 		LD L,[IX+CHNPRM_TSlStp]
     524.  00:C902                    ~ 		LD H,[IX+CHNPRM_TSlStp+1]
     525.  00:C902                    ~ 		LD A,H
     526.  00:C902                    ~ 		ADD HL,DE
     527.  00:C902                    ~ 		LD [IX+CHNPRM_CrTnSl],L
     528.  00:C902                    ~ 		LD [IX+CHNPRM_CrTnSl+1],H
     529.  00:C902                    ~ 		BIT 2,[IX+CHNPRM_Flags]
     530.  00:C902                    ~ 		JR NZ,.CH_AMP
     531.  00:C902                    ~ 		LD E,[IX+CHNPRM_TnDelt]
     532.  00:C902                    ~ 		LD D,[IX+CHNPRM_TnDelt+1]
     533.  00:C902                    ~ 		AND A
     534.  00:C902                    ~ 		JR Z,.CH_STPP
     535.  00:C902                    ~ 		EX DE,HL
     536.  00:C902                    ~ .CH_STPP:	SBC HL,DE
     537.  00:C902                    ~ 		JP M,.CH_AMP
     538.  00:C902                    ~ 		LD A,[IX+CHNPRM_SlToNt]
     539.  00:C902                    ~ 		LD [IX+CHNPRM_Note],A
     540.  00:C902                    ~ 		XOR A
     541.  00:C902                    ~ 		LD [IX+CHNPRM_TSlCnt],A
     542.  00:C902                    ~ 		LD [IX+CHNPRM_CrTnSl],A
     543.  00:C902                    ~ 		LD [IX+CHNPRM_CrTnSl+1],A
     544.  00:C902                    ~ .CH_AMP:	LD A,[IX+CHNPRM_CrAmSl]
     545.  00:C902                    ~ 		BIT 7,C
     546.  00:C902                    ~ 		JR Z,.CH_NOAM
     547.  00:C902                    ~ 		BIT 6,C
     548.  00:C902                    ~ 		JR Z,.CH_AMIN
     549.  00:C902                    ~ 		CP 15
     550.  00:C902                    ~ 		JR Z,.CH_NOAM
     551.  00:C902                    ~ 		INC A
     552.  00:C902                    ~ 		JR .CH_SVAM
     553.  00:C902                    ~ .CH_AMIN:	CP -15
     554.  00:C902                    ~ 		JR Z,.CH_NOAM
     555.  00:C902                    ~ 		DEC A
     556.  00:C902                    ~ .CH_SVAM:	LD [IX+CHNPRM_CrAmSl],A
     557.  00:C902                    ~ .CH_NOAM:	LD L,A
     558.  00:C902                    ~ 		LD A,B
     559.  00:C902                    ~ 		AND 15
     560.  00:C902                    ~ 		ADD A,L
     561.  00:C902                    ~ 		JP P,.CH_APOS
     562.  00:C902                    ~ 		XOR A
     563.  00:C902                    ~ .CH_APOS:	CP 16
     564.  00:C902                    ~ 		JR C,.CH_VOL
     565.  00:C902                    ~ 		LD A,15
     566.  00:C902                    ~ .CH_VOL:	OR [IX+CHNPRM_Volume]
     567.  00:C902                    ~ 		LD L,A
     568.  00:C902                    ~ 		LD H,0
     569.  00:C902                    ~ 		LD DE,VT_
     570.  00:C902                    ~ 		ADD HL,DE
     571.  00:C902                    ~ 		LD A,[HL]
     572.  00:C902                    ~ .CH_ENV:	BIT 0,C
     573.  00:C902                    ~ 		JR NZ,.CH_NOEN
     574.  00:C902                    ~ 		OR [IX+CHNPRM_Env_En]
     575.  00:C902                    ~ .CH_NOEN:	LD [AYREGS+AR_AmplC],A
     576.  00:C902                    ~ 		BIT 7,B
     577.  00:C902                    ~ 		LD A,C
     578.  00:C902                    ~ 		JR Z,.NO_ENSL
     579.  00:C902                    ~ 		RLA
     580.  00:C902                    ~ 		RLA
     581.  00:C902                    ~ 		SRA A
     582.  00:C902                    ~ 		SRA A
     583.  00:C902                    ~ 		SRA A
     584.  00:C902                    ~ 		ADD A,[IX+CHNPRM_CrEnSl] ;SEE COMMENT BELOW
     585.  00:C902                    ~ 		BIT 5,B
     586.  00:C902                    ~ 		JR Z,.NO_ENAC
     587.  00:C902                    ~ 		LD [IX+CHNPRM_CrEnSl],A
     588.  00:C902                    ~ .NO_ENAC:	LD HL,PT3_AddToEn
     589.  00:C902                    ~ 		ADD A,[HL] ;BUG IN PT3 - NEED WORD HERE.
     590.  00:C902                    ~ 			   ;FIX IT IN NEXT VERSION?
     591.  00:C902                    ~ 		LD [HL],A
     592.  00:C902                    ~ 		JR .CH_MIX
     593.  00:C902                    ~ .NO_ENSL:	RRA
     594.  00:C902                    ~ 		ADD A,[IX+CHNPRM_CrNsSl]
     595.  00:C902                    ~ 		LD [AddToNs],A
     596.  00:C902                    ~ 		BIT 5,B
     597.  00:C902                    ~ 		JR Z,.CH_MIX
     598.  00:C902                    ~ 		LD [IX+CHNPRM_CrNsSl],A
     599.  00:C902                    ~ .CH_MIX:	LD A,B
     600.  00:C902                    ~ 		RRA
     601.  00:C902                    ~ 		AND $48
     602.  00:C902                    ~ .CH_EXIT:	LD HL,AYREGS+AR_Mixer
     603.  00:C902                    ~ 		OR [HL]
     604.  00:C902                    ~ 		RRCA
     605.  00:C902                    ~ 		LD [HL],A
     606.  00:C902                    ~ 		POP HL
     607.  00:C902                    ~ 		XOR A
     608.  00:C902                    ~ 		OR [IX+CHNPRM_COnOff]
     609.  00:C902                    ~ 		RET Z
     610.  00:C902                    ~ 		DEC [IX+CHNPRM_COnOff]
     611.  00:C902                    ~ 		RET NZ
     612.  00:C902                    ~ 		XOR [IX+CHNPRM_Flags]
     613.  00:C902                    ~ 		LD [IX+CHNPRM_Flags],A
     614.  00:C902                    ~ 		RRA
     615.  00:C902                    ~ 		LD A,[IX+CHNPRM_OnOffD]
     616.  00:C902                    ~ 		JR C,.CH_ONDL
     617.  00:C902                    ~ 		LD A,[IX+CHNPRM_OffOnD]
     618.  00:C902                    ~ .CH_ONDL:	LD [IX+CHNPRM_COnOff],A
     619.  00:C902                    ~ 		RET
     620.  00:C902                    ~ 
     621.  00:C902                    ~ PT3_PLAY:
     622.  00:C902                    ~ 		ld a,(mutesong)
     623.  00:C902                    ~ 		or a
     624.  00:C902                    ~ 		ret nz
     625.  00:C902                    ~ 		
     626.  00:C902                    ~ 		LD [PT3_AddToEn],A
     627.  00:C902                    ~ 		LD [AYREGS+AR_Mixer],A
     628.  00:C902                    ~ 		DEC A
     629.  00:C902                    ~ 		LD [AYREGS+AR_EnvTp],A
     630.  00:C902                    ~ 		LD HL,DelyCnt
     631.  00:C902                    ~ 		DEC [HL]
     632.  00:C902                    ~ 		JP NZ,.PL2
     633.  00:C902                    ~ 		LD HL,ChanA+CHNPRM_NtSkCn
     634.  00:C902                    ~ 		DEC [HL]
     635.  00:C902                    ~ 		JR NZ,.PL1B
     636.  00:C902                    ~ 		LD BC,[PT3_AdInPtA]
     637.  00:C902                    ~ 		LD A,[BC]
     638.  00:C902                    ~ 		AND A
     639.  00:C902                    ~ 		JR NZ,.PL1A
     640.  00:C902                    ~ 		LD D,A
     641.  00:C902                    ~ 		LD [Ns_Base],A
     642.  00:C902                    ~ 		LD HL,[PT3_CrPsPtr]
     643.  00:C902                    ~ 		INC HL
     644.  00:C902                    ~ 		LD A,[HL]
     645.  00:C902                    ~ 		INC A
     646.  00:C902                    ~ 		JR NZ,.PLNLP
     647.  00:C902                    ~ 		CALL CHECKLP
     648.  00:C902                    ~ 		LD HL,[PT3_LPosPtr]
     649.  00:C902                    ~ 		LD A,[HL]
     650.  00:C902                    ~ 		INC A
     651.  00:C902                    ~ .PLNLP:	LD [PT3_CrPsPtr],HL
     652.  00:C902                    ~ 		DEC A
     653.  00:C902                    ~ 		ADD A,A
     654.  00:C902                    ~ 		LD E,A
     655.  00:C902                    ~ 		RL D
     656.  00:C902                    ~ 		LD HL,[PT3_PatsPtr]
     657.  00:C902                    ~ 		ADD HL,DE
     658.  00:C902                    ~ 		LD DE,[PT3_MODADDR]
     659.  00:C902                    ~ 		LD [PT3_PSP],SP
     660.  00:C902                    ~ 		LD SP,HL
     661.  00:C902                    ~ 		POP HL
     662.  00:C902                    ~ 		ADD HL,DE
     663.  00:C902                    ~ 		LD B,H
     664.  00:C902                    ~ 		LD C,L
     665.  00:C902                    ~ 		POP HL
     666.  00:C902                    ~ 		ADD HL,DE
     667.  00:C902                    ~ 		LD [PT3_AdInPtB],HL
     668.  00:C902                    ~ 		POP HL
     669.  00:C902                    ~ 		ADD HL,DE
     670.  00:C902                    ~ 		LD [PT3_AdInPtC],HL
     671.  00:C902                    ~ 		LD SP,[PT3_PSP]
     672.  00:C902                    ~ 
     673.  00:C902                    ~ .PL1A:		LD IX,ChanA+12
     674.  00:C902                    ~ 		CALL PTDECOD
     675.  00:C902                    ~ 		LD [PT3_AdInPtA],BC
     676.  00:C902                    ~ 
     677.  00:C902                    ~ .PL1B:		LD HL,ChanB+CHNPRM_NtSkCn
     678.  00:C902                    ~ 		DEC [HL]
     679.  00:C902                    ~ 		JR NZ,.PL1C
     680.  00:C902                    ~ 		LD IX,ChanB+12
     681.  00:C902                    ~ 		LD BC,[PT3_AdInPtB]
     682.  00:C902                    ~ 		CALL PTDECOD
     683.  00:C902                    ~ 		LD [PT3_AdInPtB],BC
     684.  00:C902                    ~ 
     685.  00:C902                    ~ .PL1C:		LD HL,ChanC+CHNPRM_NtSkCn
     686.  00:C902                    ~ 		DEC [HL]
     687.  00:C902                    ~ 		JR NZ,.PL1D
     688.  00:C902                    ~ 		LD IX,ChanC+12
     689.  00:C902                    ~ 		LD BC,[PT3_AdInPtC]
     690.  00:C902                    ~ 		CALL PTDECOD
     691.  00:C902                    ~ 		LD [PT3_AdInPtC],BC
     692.  00:C902                    ~ 
     693.  00:C902                    ~ .PL1D:		LD A,[PT3_Delay]
     694.  00:C902                    ~ 		LD [DelyCnt],A
     695.  00:C902                    ~ 
     696.  00:C902                    ~ .PL2:		LD IX,ChanA
     697.  00:C902                    ~ 		LD HL,[AYREGS+AR_TonA]
     698.  00:C902                    ~ 		CALL CHREGS
     699.  00:C902                    ~ 		LD [AYREGS+AR_TonA],HL
     700.  00:C902                    ~ 		LD A,[AYREGS+AR_AmplC]
     701.  00:C902                    ~ 		LD [AYREGS+AR_AmplA],A
     702.  00:C902                    ~ 		LD IX,ChanB
     703.  00:C902                    ~ 		LD HL,[AYREGS+AR_TonB]
     704.  00:C902                    ~ 		CALL CHREGS
     705.  00:C902                    ~ 		LD [AYREGS+AR_TonB],HL
     706.  00:C902                    ~ 		LD A,[AYREGS+AR_AmplC]
     707.  00:C902                    ~ 		LD [AYREGS+AR_AmplB],A
     708.  00:C902                    ~ 		LD IX,ChanC
     709.  00:C902                    ~ 		LD HL,[AYREGS+AR_TonC]
     710.  00:C902                    ~ 		CALL CHREGS
     711.  00:C902                    ~ 		LD [AYREGS+AR_TonC],HL
     712.  00:C902                    ~ 
     713.  00:C902                    ~ 		LD HL,[Ns_Base_AddToNs]
     714.  00:C902                    ~ 		LD A,H
     715.  00:C902                    ~ 		ADD A,L
     716.  00:C902                    ~ 		LD [AYREGS+AR_Noise],A
     717.  00:C902                    ~ 
     718.  00:C902                    ~ 		LD A,[PT3_AddToEn]
     719.  00:C902                    ~ 		LD E,A
     720.  00:C902                    ~ 		ADD A,A
     721.  00:C902                    ~ 		SBC A,A
     722.  00:C902                    ~ 		LD D,A
     723.  00:C902                    ~ 		LD HL,[EnvBase]
     724.  00:C902                    ~ 		ADD HL,DE
     725.  00:C902                    ~ 		LD DE,[CurESld]
     726.  00:C902                    ~ 		ADD HL,DE
     727.  00:C902                    ~ 		LD [AYREGS+AR_Env],HL
     728.  00:C902                    ~ 
     729.  00:C902                    ~ 		XOR A
     730.  00:C902                    ~ 		LD HL,CurEDel
     731.  00:C902                    ~ 		OR [HL]
     732.  00:C902                    ~ 		RET Z
     733.  00:C902                    ~ 		DEC [HL]
     734.  00:C902                    ~ 		RET NZ
     735.  00:C902                    ~ 		LD A,[PT3_Env_Del]
     736.  00:C902                    ~ 		LD [HL],A
     737.  00:C902                    ~ 		LD HL,[PT3_ESldAdd]
     738.  00:C902                    ~ 		ADD HL,DE
     739.  00:C902                    ~ 		LD [CurESld],HL
     740.  00:C902                    ~ 		RET
     741.  00:C902                    ~ 
     742.  00:C902                    ~ EMPTYSAMORN: 	db 0,1,0,$90 ;delete $90 if you don't need default sample
     743.  00:C902                    ~ 
     744.  00:C902                    ~ NT_:	;Note table 2 [if you use another in Vortex Tracker II copy it and paste
     745.  00:C902                    ~ 	;it from TABLES.TXT]
     746.  00:C902                    ~ 
     747.  00:C902                    ~ 		dw $0D10,$0C55,$0BA4,$0AFC,$0A5F,$09CA,$093D,$08B8,$083B,$07C5,$0755,$06EC
     748.  00:C902                    ~ 		dw $0688,$062A,$05D2,$057E,$052F,$04E5,$049E,$045C,$041D,$03E2,$03AB,$0376
     749.  00:C902                    ~ 		dw $0344,$0315,$02E9,$02BF,$0298,$0272,$024F,$022E,$020F,$01F1,$01D5,$01BB
     750.  00:C902                    ~ 		dw $01A2,$018B,$0174,$0160,$014C,$0139,$0128,$0117,$0107,$00F9,$00EB,$00DD
     751.  00:C902                    ~ 		dw $00D1,$00C5,$00BA,$00B0,$00A6,$009D,$0094,$008C,$0084,$007C,$0075,$006F
     752.  00:C902                    ~ 		dw $0069,$0063,$005D,$0058,$0053,$004E,$004A,$0046,$0042,$003E,$003B,$0037
     753.  00:C902                    ~ 		dw $0034,$0031,$002F,$002C,$0029,$0027,$0025,$0023,$0021,$001F,$001D,$001C
     754.  00:C902                    ~ 		dw $001A,$0019,$0017,$0016,$0015,$0014,$0012,$0011,$0010,$000F,$000E,$000D
     755.  00:C902                    ~ 
     756.  00:C902                    ~ ;
     757.  00:C902                    ~ ; WARNING: This routine must always exist
     758.  00:C902                    ~ ; Enables music looping
     759.  00:C902                    ~ ;	
     760.  00:C902                    ~ music_loopon:
     761.  00:C902                    ~ 		xor a
     762.  00:C902                    ~  		ld (PT3_SETUP),a  ; loop enabled!
     763.  00:C902                    ~ 		ret
     764.  00:C902                    ~ 
     765.  00:C902                    ~ ;
     766.  00:C902                    ~ ; WARNING: This routine must always exist
     767.  00:C902                    ~ ; Disables music looping
     768.  00:C902                    ~ ;	
     769.  00:C902                    ~ music_loopoff:
     770.  00:C902                    ~ 		ld a,1
     771.  00:C902                    ~  		ld (PT3_SETUP),a  ; no loop!
     772.  00:C902                    ~ 		ret
     773.  00:C902                    ~ 		
     774.  00:C902                    ~ ;
     775.  00:C902                    ~ ; WARNING: This routine must always exist
     776.  00:C902                    ~ ; Sets the music to be played
     777.  00:C902                    ~ ;	
     778.  00:C902                    ~ music_set:
     779.  00:C902                    ~ 		or a
     780.  00:C902                    ~ 		jr z,music_mute
     781.  00:C902                    ~ 		dec a
     782.  00:C902                    ~ 		ld hl,songtab
     783.  00:C902                    ~ 		add a,a             ; double accumulator.
     784.  00:C902                    ~ 		add a,l			
     785.  00:C902                    ~ 		ld l,a			
     786.  00:C902                    ~ 		adc a,h			
     787.  00:C902                    ~ 		sub l			
     788.  00:C902                    ~ 		ld h,a			
     789.  00:C902                    ~ 		ld a,(hl)
     790.  00:C902                    ~ 		inc	hl
     791.  00:C902                    ~ 		ld h,(hl)
     792.  00:C902                    ~ 		ld l,a				; HL=song pointer	
     793.  00:C902                    ~ 		xor a
     794.  00:C902                    ~ 		ld (mutesong),a	
     795.  00:C902                    ~ 		jp PT3_INIT
     796.  00:C902                    ~ ;
     797.  00:C902                    ~ ; WARNING: This routine must always exist
     798.  00:C902                    ~ ; Plays a music frame. To be called from an interrupt
     799.  00:C902                    ~ ;	
     800.  00:C902                    ~ music_play:
     801.  00:C902                    ~ 		jp PT3_PLAY
     802.  00:C902                    ~ 
     803.  00:C902                    ~ ;
     804.  00:C902                    ~ ; WARNING: This routine must always exist
     805.  00:C902                    ~ ; Mutes music playing (in this engine it also works as a way to initialize)
     806.  00:C902                    ~ ;
     807.  00:C902                    ~ music_init:	
     808.  00:C902                    ~ music_mute:	
     809.  00:C902                    ~ 		ld a,1
     810.  00:C902                    ~ 		ld (mutesong),a
     811.  00:C902                    ~ 
     812.  00:C902                    ~ resetregs:
     813.  00:C902                    ~ 		ld hl,AYREGS
     814.  00:C902                    ~ 		ld de,AYREGS+1
     815.  00:C902                    ~ 		ld bc,13
     816.  00:C902                    ~ 		ld (hl),0
     817.  00:C902                    ~ 		ldir
     818.  00:C902                    ~ 		ret
     819.  00:C902                    ~ 		; needs to continue with psgrout
     820.  00:C902                    ~ ;
     821.  00:C902                    ~ ; WARNING: This routine must always exist
     822.  00:C902                    ~ ; Dumps buffer content (AYREGS) to PSG registers (0-13)
     823.  00:C902                    ~ ;		
     824.  00:C902                    ~ 		
     825.  00:C902                    ~ psgrout:	
     826.  00:C902                    ~ 		xor a
     827.  00:C902                    ~ ; --- fixes bits 6 and 7 of mixer ---
     828.  00:C902                    ~ 		ld	hl,AYREGS+AR_Mixer
     829.  00:C902                    ~ 		set	7,(hl)
     830.  00:C902                    ~ 		res	6,(hl)
     831.  00:C902                    ~ 
     832.  00:C902                    ~ 		ld c,MSX_PSGDW
     833.  00:C902                    ~ 		ld hl,AYREGS
     834.  00:C902                    ~ .lout:		
     835.  00:C902                    ~ 		out (MSX_PSGLW),a
     836.  00:C902                    ~ 		outi 
     837.  00:C902                    ~ 		inc a
     838.  00:C902                    ~ 		cp 13
     839.  00:C902                    ~ 		jr nz,.lout
     840.  00:C902                    ~ 		out (MSX_PSGLW),a
     841.  00:C902                    ~ 		ld a,(hl)
     842.  00:C902                    ~ 		and a
     843.  00:C902                    ~ 		ret m
     844.  00:C902                    ~ 		out (MSX_PSGDW),a
     845.  00:C902                    ~ 		ret
     846.  00:C902                    ~ 			
     847.  00:C902                    ~ 	endif
     848.  00:C902                      	
    8203   00:C902                      	include "ayFX-ROM.asm"
       1.  00:C902                      		; --- ayFX REPLAYER v1.31 ---
       2.  00:C902                      
       3.  00:C902                      		; --- v1.31	Fixed bug on previous version, only PSG channel C worked
       4.  00:C902                      		; --- v1.3	Fixed volume and Relative volume versions on the same file, conditional compilation
       5.  00:C902                      		; ---		Support for dynamic or fixed channel allocation
       6.  00:C902                      		; --- v1.2f/r	ayFX bank support
       7.  00:C902                      		; --- v1.11f/r	If a frame volume is zero then no AYREGS update
       8.  00:C902                      		; --- v1.1f/r	Fixed volume for all ayFX streams
       9.  00:C902                      		; --- v1.1	Explicit priority (as suggested by AR)
      10.  00:C902                      		; --- v1.0f	Bug fixed (error when using noise)
      11.  00:C902                      		; --- v1.0	Initial release
      12.  00:C902                      
      13.  00:C902                      		; --- DEFINE FX_RELATIVE AS 0 FOR FIXED VOLUME VERSION ---
      14.  00:C902                      		; --- DEFINE FX_RELATIVE AS 1 FOR RELATIVE VOLUME VERSION ---
      15.  00:C902                      		
      16.  00:C902                      		if XFLAG
      17.  00:C902                      
      18.  00:C902                      ;
      19.  00:C902                      ; WARNING: This routine must always exist
      20.  00:C902                      ; Setups the SFX playing routine (if needed)
      21.  00:C902                      ;					
      22.  00:C902                      sfx_init:
      23.  00:C902  21 17 CA            		ld hl,sfxbank
      24.  00:C905  CD 0B C9            		call ayFX_SETUP
      25.  00:C908  C3 EB C9            		jp resetregs
      26.  00:C90B                      
      27.  00:C90B                      ;
      28.  00:C90B                      ; WARNING: This routine must always exist
      29.  00:C90B                      ; Plays a frame of an ayFX stream. To be called from interrupt
      30.  00:C90B                      ;			
      31.  00:C90B  (00:C955)           sfx_play:	equ ayFX_PLAY
      32.  00:C90B                      		
      33.  00:C90B                      ;
      34.  00:C90B                      ; core routines
      35.  00:C90B                      ;
      36.  00:C90B                      ayFX_SETUP:	; ---          ayFX replayer setup          ---
      37.  00:C90B                      		; --- INPUT: HL -> pointer to the ayFX bank ---
      38.  00:C90B  22 5E 40            		ld	[ayFX_BANK],hl			; Current ayFX bank
      39.  00:C90E  3E 00               		ld a,FX_MODE				; a:=0
      40.  00:C910  32 5D 40            		ld	[ayFX_MODE],a			; Initial mode: fixed channel
      41.  00:C913  3E 01               		ld a,FX_CHANNEL				; Starting channel (=1=C)
      42.  00:C915  32 67 40            		ld	[ayFX_CHANNEL],a		; Updated
      43.  00:C918                      
      44.  00:C918                      ;ayFX_END:	; --- End of an ayFX stream ---
      45.  00:C918                      
      46.  00:C918                      ;
      47.  00:C918                      ; WARNING: This routine must always exist
      48.  00:C918                      ; Stops & mute a SFX playing
      49.  00:C918                      ;					
      50.  00:C918                      sfx_mute:
      51.  00:C918  3E FF               		ld	a,255				; Lowest ayFX priority		
      52.  00:C91A  32 60 40            		ld	[ayFX_PRIORITY],a	; Priority saved (not playing ayFX stream)
      53.  00:C91D                      	if ( YFLAG = 0 )	
      54.  00:C91D  C3 EB C9            		jp resetregs
      55.  00:C920                      	else
      56.  00:C920                    ~ 		ld a,(mutesong)
      57.  00:C920                    ~ 		or a
      58.  00:C920                    ~ 		jp nz,resetregs
      59.  00:C920                    ~ 		ld a,(ayFX_MODE)
      60.  00:C920                    ~ 		or a
      61.  00:C920                    ~ 		jp nz,resetregs
      62.  00:C920                    ~ 
      63.  00:C920                    ~ 		ld a,(ayFX_CHANNEL)
      64.  00:C920                    ~ 		ld b,a
      65.  00:C920                    ~ 		ld a,11
      66.  00:C920                    ~ 		sub b
      67.  00:C920                    ~ 		ld c,a
      68.  00:C920                    ~ 		ld hl,AYREGS
      69.  00:C920                    ~ 		ADD_HL_A
      70.  00:C920                    ~ 		ld (hl),0
      71.  00:C920                    ~ 		;
      72.  00:C920                    ~ 		ld b,9
      73.  00:C920                    ~ 		ld a,c
      74.  00:C920                    ~ 		sub 8
      75.  00:C920                    ~ 		ld c,a
      76.  00:C920                    ~ 		or a
      77.  00:C920                    ~ 		jr z,reset
      78.  00:C920                    ~ 		rlc b
      79.  00:C920                    ~ 		dec a
      80.  00:C920                    ~ 		jr z,reset
      81.  00:C920                    ~ 		rlc b
      82.  00:C920                    ~ reset:
      83.  00:C920                    ~ 		ld a,b
      84.  00:C920                    ~ 		ld	[AYREGS+7],a
      85.  00:C920                    ~ 		;
      86.  00:C920                    ~ 		ld hl,AYREGS
      87.  00:C920                    ~ 		ld a,c
      88.  00:C920                    ~ 		add a,a
      89.  00:C920                    ~ 		ADD_HL_A
      90.  00:C920                    ~ 		ld (hl),0
      91.  00:C920                    ~ 		inc hl
      92.  00:C920                    ~ 		ld (hl),0
      93.  00:C920                    ~ 		ret
      94.  00:C920                    ~ 	endif
      95.  00:C920                      
      96.  00:C920                      ;
      97.  00:C920                      ; WARNING: This routine must always exist
      98.  00:C920                      ; Initialize a SFX for playing
      99.  00:C920                      ;			
     100.  00:C920                      sfx_set:
     101.  00:C920                      		; ld c,0				; always maximum priority (no variable supported)
     102.  00:C920                      		
     103.  00:C920                      ayFX_INIT:	; ---     INIT A NEW ayFX STREAM     ---
     104.  00:C920                      		; --- INPUT: A -> sound to be played ---
     105.  00:C920                      		; ---        C -> sound priority     ---
     106.  00:C920  C5                  		push	bc				; Store bc in stack
     107.  00:C921  D5                  		push	de				; Store de in stack
     108.  00:C922  E5                  		push	hl				; Store hl in stack
     109.  00:C923                      		; --- Check if the index is in the bank ---
     110.  00:C923  47                  		ld	b,a					; b:=a (new ayFX stream index)
     111.  00:C924  2A 5E 40            		ld	hl,[ayFX_BANK]			; Current ayFX BANK
     112.  00:C927  7E                  		ld	a,[hl]				; Number of samples in the bank
     113.  00:C928  B7                  		or	a					; If zero (means 256 samples)...
     114.  00:C929  28 06               		jr	z,.CHECK_PRI			; ...goto .CHECK_PRI
     115.  00:C92B                      		; The bank has less than 256 samples
     116.  00:C92B  78                  		ld	a,b					; a:=b (new ayFX stream index)
     117.  00:C92C  BE                  		cp	[hl]				; If new index is not in the bank...
     118.  00:C92D  3E 02               		ld	a,2					; a:=2 (error 2: Sample not in the bank)
     119.  00:C92F  30 20               		jr	nc,.INIT_END			; ...we can't init it
     120.  00:C931                      .CHECK_PRI:	; --- Check if the new priority is lower than the current one ---
     121.  00:C931                      		; ---   Remember: 0 = highest priority, 15 = lowest priority  ---
     122.  00:C931  3A 60 40            		ld	a,[ayFX_PRIORITY]	; a:=Current ayFX stream priority
     123.  00:C934  B9                  		cp	c					; If new ayFX stream priority is lower than current one...
     124.  00:C935  3E 01               		ld	a,1					; a:=1 (error 1: A sample with higher priority is being played)
     125.  00:C937  38 18               		jr	c,.INIT_END			; ...we don't start the new ayFX stream
     126.  00:C939                      		; --- Set new priority ---
     127.  00:C939  79                  		ld	a,c					; a:=New priority
     128.  00:C93A  E6 0F               		and	$0F					; We mask the priority
     129.  00:C93C  32 60 40            		ld	[ayFX_PRIORITY],a	; new ayFX stream priority saved in RAM
     130.  00:C93F                      
     131.  00:C93F                       	if FX_RELATIVE			   
     132.  00:C93F                    ~ 		; --- Volume adjust using PT3 volume table ---
     133.  00:C93F                    ~ 		ld	c,a					; c:=New priority (fixed)
     134.  00:C93F                    ~ 		ld	a,15				; a:=15
     135.  00:C93F                    ~ 		sub	c					; a:=15-New priority = relative volume
     136.  00:C93F                    ~ 		jr	z,.INIT_NOSOUND		; If priority is 15 -> no sound output (volume is zero)
     137.  00:C93F                    ~ 		add	a,a					; a:=a*2
     138.  00:C93F                    ~ 		add	a,a					; a:=a*4
     139.  00:C93F                    ~ 		add	a,a					; a:=a*8
     140.  00:C93F                    ~ 		add	a,a					; a:=a*16
     141.  00:C93F                    ~ 		ld	e,a					; e:=a
     142.  00:C93F                    ~ 		ld	d,0					; de:=a
     143.  00:C93F                    ~ 		ld	hl,VT_				; hl:=PT3 volume table
     144.  00:C93F                    ~ 		add	hl,de				; hl is a pointer to the relative volume table
     145.  00:C93F                    ~ 		ld	[ayFX_VT],hl		; Save pointer
     146.  00:C93F                    ~ 	endif
     147.  00:C93F                      
     148.  00:C93F                      		; --- Calculate the pointer to the new ayFX stream ---
     149.  00:C93F  ED 5B 5E 40         		ld	de,[ayFX_BANK]		; de:=Current ayFX bank
     150.  00:C943  13                  		inc	de					; de points to the increments table of the bank
     151.  00:C944  68                  		ld	l,b					; l:=b (new ayFX stream index)
     152.  00:C945  26 00               		ld	h,0					; hl:=b (new ayFX stream index)
     153.  00:C947  29                  		add	hl,hl				; hl:=hl*2
     154.  00:C948  19                  		add	hl,de				; hl:=hl+de (hl points to the correct increment)
     155.  00:C949  5E                  		ld	e,[hl]				; e:=lower byte of the increment
     156.  00:C94A  23                  		inc	hl					; hl points to the higher byte of the correct increment
     157.  00:C94B  56                  		ld	d,[hl]				; de:=increment
     158.  00:C94C  19                  		add	hl,de				; hl:=hl+de (hl points to the new ayFX stream)		
     159.  00:C94D  22 61 40            		ld	[ayFX_POINTER],hl	; Pointer saved in RAM
     160.  00:C950  AF                  		xor	a					; a:=0 (no errors)
     161.  00:C951  E1                  .INIT_END:	pop	hl				; Retrieve hl from stack
     162.  00:C952  D1                  		pop	de					; Retrieve de from stack
     163.  00:C953  C1                  		pop	bc					; Retrieve bc from stack
     164.  00:C954  C9                  		ret						; Return
     165.  00:C955                      
     166.  00:C955                       	if FX_RELATIVE			   
     167.  00:C955                    ~ .INIT_NOSOUND:	; --- Init a sample with relative volume zero -> no sound output ---
     168.  00:C955                    ~ 		ld	a,255				; Lowest ayFX priority
     169.  00:C955                    ~ 		ld	[ayFX_PRIORITY],a	; Priority saved (not playing ayFX stream)
     170.  00:C955                    ~ 		jr	.INIT_END			; Jumps to .INIT_END
     171.  00:C955                    ~ 	endif
     172.  00:C955                      
     173.  00:C955                      ayFX_PLAY:	; --- PLAY A FRAME OF AN ayFX STREAM ---
     174.  00:C955  3A 60 40            		ld	a,[ayFX_PRIORITY]	; a:=Current ayFX stream priority
     175.  00:C958  B7                  		or	a					; If priority has bit 7 on...
     176.  00:C959  F8                  		ret	m					; ...return
     177.  00:C95A                      		; --- Calculate next ayFX channel (if needed) ---
     178.  00:C95A  3A 5D 40            		ld	a,[ayFX_MODE]		; ayFX mode
     179.  00:C95D  E6 01               		and	1					; If bit0=0 (fixed channel)...
     180.  00:C95F  28 08               		jr	z,.TAKECB			; ...skip channel changing
     181.  00:C961  21 67 40            		ld	hl,ayFX_CHANNEL		; Old ayFX playing channel
     182.  00:C964  35                  		dec	[hl]				; New ayFX playing channel
     183.  00:C965  20 02               		jr	nz,.TAKECB			; If not zero jump to .TAKECB
     184.  00:C967  36 03               		ld	[hl],3				; If zero -> set channel 3
     185.  00:C969                      .TAKECB:	; --- Extract control byte from stream ---
     186.  00:C969  2A 61 40            		ld	hl,[ayFX_POINTER]	; Pointer to the current ayFX stream
     187.  00:C96C  4E                  		ld	c,[hl]				; c:=Control byte
     188.  00:C96D  23                  		inc	hl					; Increment pointer
     189.  00:C96E                      		; --- Check if there's new tone on stream ---
     190.  00:C96E  CB 69               		bit	5,c					; If bit 5 c is off...
     191.  00:C970  28 08               		jr	z,.CHECK_NN			; ...jump to .CHECK_NN (no new tone)
     192.  00:C972                      		; --- Extract new tone from stream ---
     193.  00:C972  5E                  		ld	e,[hl]				; e:=lower byte of new tone
     194.  00:C973  23                  		inc	hl					; Increment pointer
     195.  00:C974  56                  		ld	d,[hl]				; d:=higher byte of new tone
     196.  00:C975  23                  		inc	hl					; Increment pointer
     197.  00:C976  ED 53 63 40         		ld	[ayFX_TONE],de		; ayFX tone updated
     198.  00:C97A                      .CHECK_NN:	; --- Check if there's new noise on stream ---
     199.  00:C97A  CB 71               		bit	6,c					; if bit 6 c is off...
     200.  00:C97C  28 0A               		jr	z,.SETPOINTER		; ...jump to .SETPOINTER (no new noise)
     201.  00:C97E                      		; --- Extract new noise from stream ---
     202.  00:C97E  7E                  		ld	a,[hl]				; a:=New noise
     203.  00:C97F  23                  		inc	hl					; Increment pointer
     204.  00:C980  FE 20               		cp	$20					; If it's an illegal value of noise (used to mark end of stream)...
     205.  00:C982  CA 18 C9            		jp	z,sfx_mute			; ...jump to sfx_mute/ayFX_END
     206.  00:C985  32 65 40            		ld	[ayFX_NOISE],a		; ayFX noise updated
     207.  00:C988                      .SETPOINTER:	; --- Update ayFX pointer ---
     208.  00:C988  22 61 40            		ld	[ayFX_POINTER],hl	; Update ayFX stream pointer
     209.  00:C98B                      		; --- Extract volume ---
     210.  00:C98B  79                  		ld	a,c					; a:=Control byte
     211.  00:C98C  E6 0F               		and	$0F					; lower nibble
     212.  00:C98E                      
     213.  00:C98E                       	if FX_RELATIVE
     214.  00:C98E                    ~ 		; --- Fix the volume using PT3 Volume Table ---
     215.  00:C98E                    ~ 		ld	hl,[ayFX_VT]		; hl:=Pointer to relative volume table
     216.  00:C98E                    ~ 		ld	e,a					; e:=a (ayFX volume)
     217.  00:C98E                    ~ 		ld	d,0					; d:=0
     218.  00:C98E                    ~ 		add	hl,de				; hl:=hl+de (hl points to the relative volume of this frame
     219.  00:C98E                    ~ 		ld	a,[hl]				; a:=ayFX relative volume
     220.  00:C98E                    ~ 		or	a					; If relative volume is zero...
     221.  00:C98E                    ~ 	endif
     222.  00:C98E                      
     223.  00:C98E  32 66 40            		ld	[ayFX_VOLUME],a		; ayFX volume updated
     224.  00:C991  C8                  		ret	z					; ...return (don't copy ayFX values in to AYREGS)
     225.  00:C992                      		; -------------------------------------
     226.  00:C992                      		; --- COPY ayFX VALUES IN TO AYREGS ---
     227.  00:C992                      		; -------------------------------------
     228.  00:C992                      		; --- Set noise channel ---
     229.  00:C992  CB 79               		bit	7,c					; If noise is off...
     230.  00:C994  20 06               		jr	nz,.SETMASKS		; ...jump to .SETMASKS
     231.  00:C996  3A 65 40            		ld	a,[ayFX_NOISE]		; ayFX noise value
     232.  00:C999  32 6E 40            		ld	[AYREGS+6],a		; copied in to AYREGS (noise channel)
     233.  00:C99C                      .SETMASKS:	; --- Set mixer masks ---
     234.  00:C99C  79                  		ld	a,c					; a:=Control byte
     235.  00:C99D  E6 90               		and	$90					; Only bits 7 and 4 (noise and tone mask for psg reg 7)
     236.  00:C99F  FE 90               		cp	$90					; If no noise and no tone...
     237.  00:C9A1  C8                  		ret	z					; ...return (don't copy ayFX values in to AYREGS)
     238.  00:C9A2                      		; --- Copy ayFX values in to ARYREGS ---
     239.  00:C9A2  0F                  		rrca					; Rotate a to the right (1 TIME)
     240.  00:C9A3  0F                  		rrca					; Rotate a to the right (2 TIMES) (OR mask)
     241.  00:C9A4  16 DB               		ld	d,$DB				; d:=Mask for psg mixer (AND mask)
     242.  00:C9A6                      		; --- Dump to correct channel ---
     243.  00:C9A6  21 67 40            		ld	hl,ayFX_CHANNEL		; Next ayFX playing channel
     244.  00:C9A9  46                  		ld	b,[hl]				; Channel counter
     245.  00:C9AA                      .CHK1:		; --- Check if playing channel was 1 ---
     246.  00:C9AA  10 0D               		djnz	.CHK2			; Decrement and jump if channel was not 1
     247.  00:C9AC                      .PLAY_C:	; --- Play ayFX stream on channel C ---
     248.  00:C9AC  CD DB C9            		call	.SETMIXER		; Set PSG mixer value (returning a=ayFX volume and hl=ayFX tone)
     249.  00:C9AF  32 72 40            		ld	[AYREGS+10],a		; Volume copied in to AYREGS (channel C volume)
     250.  00:C9B2  CB 51               		bit	2,c					; If tone is off...
     251.  00:C9B4  C0                  		ret	nz					; ...return
     252.  00:C9B5  22 6C 40            		ld	[AYREGS+4],hl		; copied in to AYREGS (channel C tone)
     253.  00:C9B8  C9                  		ret						; Return
     254.  00:C9B9                      .CHK2:		; --- Check if playing channel was 2 ---
     255.  00:C9B9  CB 0A               		rrc	d					; Rotate right AND mask
     256.  00:C9BB  0F                  		rrca					; Rotate right OR mask
     257.  00:C9BC  10 0D               		djnz	.CHK3			; Decrement and jump if channel was not 2
     258.  00:C9BE                      .PLAY_B:	; --- Play ayFX stream on channel B ---
     259.  00:C9BE  CD DB C9            		call .SETMIXER			; Set PSG mixer value (returning a=ayFX volume and hl=ayFX tone)
     260.  00:C9C1  32 71 40            		ld	[AYREGS+9],a		; Volume copied in to AYREGS (channel B volume)
     261.  00:C9C4  CB 49               		bit	1,c					; If tone is off...
     262.  00:C9C6  C0                  		ret	nz				; ...return
     263.  00:C9C7  22 6A 40            		ld [AYREGS+2],hl		; copied in to AYREGS (channel B tone)
     264.  00:C9CA  C9                  		ret						; Return
     265.  00:C9CB                      .CHK3:		; --- Check if playing channel was 3 ---
     266.  00:C9CB  CB 0A               		rrc	d					; Rotate right AND mask
     267.  00:C9CD  0F                  		rrca					; Rotate right OR mask
     268.  00:C9CE                      .PLAY_A:	; --- Play ayFX stream on channel A ---
     269.  00:C9CE  CD DB C9            		call .SETMIXER			; Set PSG mixer value (returning a=ayFX volume and hl=ayFX tone)
     270.  00:C9D1  32 70 40            		ld	[AYREGS+8],a		; Volume copied in to AYREGS (channel A volume)
     271.  00:C9D4  CB 41               		bit	0,c					; If tone is off...
     272.  00:C9D6  C0                  		ret	nz					; ...return
     273.  00:C9D7  22 68 40            		ld	[AYREGS+0],hl		; copied in to AYREGS (channel A tone)
     274.  00:C9DA  C9                  		ret					; Return
     275.  00:C9DB                      .SETMIXER:	; --- Set PSG mixer value ---
     276.  00:C9DB  4F                  		ld	c,a					; c:=OR mask
     277.  00:C9DC  3A 6F 40            		ld	a,[AYREGS+7]		; a:=PSG mixer value
     278.  00:C9DF  A2                  		and	d					; AND mask
     279.  00:C9E0  B1                  		or	c					; OR mask
     280.  00:C9E1  32 6F 40            		ld	[AYREGS+7],a		; PSG mixer value updated
     281.  00:C9E4  3A 66 40            		ld	a,[ayFX_VOLUME]		; a:=ayFX volume value
     282.  00:C9E7  2A 63 40            		ld	hl,[ayFX_TONE]		; ayFX tone value
     283.  00:C9EA  C9                  		ret						; Return
     284.  00:C9EB                      
     285.  00:C9EB                      
     286.  00:C9EB                      	if ( YFLAG = 0 )	
     287.  00:C9EB                      
     288.  00:C9EB                      	; If there's no PSG player we need to provide these routines
     289.  00:C9EB                      resetregs:
     290.  00:C9EB  21 68 40            		ld hl,AYREGS
     291.  00:C9EE  11 69 40            		ld de,AYREGS+1
     292.  00:C9F1  01 0D 00            		ld bc,13
     293.  00:C9F4  36 00               		ld (hl),0
     294.  00:C9F6  ED B0               		ldir
     295.  00:C9F8  C9                  		ret
     296.  00:C9F9                      psgrout:	
     297.  00:C9F9  AF                  		xor a
     298.  00:C9FA                      ; --- fixes bits 6 and 7 of mixer ---
     299.  00:C9FA  21 6F 40            		ld	hl,AYREGS+AR_Mixer
     300.  00:C9FD  CB FE               		set	7,(hl)
     301.  00:C9FF  CB B6               		res	6,(hl)
     302.  00:CA01                      
     303.  00:CA01  0E A1               		ld c,MSX_PSGDW
     304.  00:CA03  21 68 40            		ld hl,AYREGS
     305.  00:CA06                      .lout:		
     306.  00:CA06  D3 A0               		out (MSX_PSGLW),a
     307.  00:CA08  ED A3               		outi 
     308.  00:CA0A  3C                  		inc a
     309.  00:CA0B  FE 0D               		cp 13
     310.  00:CA0D  20 F7               		jr nz,.lout
     311.  00:CA0F  D3 A0               		out (MSX_PSGLW),a
     312.  00:CA11  7E                  		ld a,(hl)
     313.  00:CA12  A7                  		and a
     314.  00:CA13  F8                  		ret m
     315.  00:CA14  D3 A1               		out (MSX_PSGDW),a
     316.  00:CA16  C9                  		ret
     317.  00:CA17                      		
     318.  00:CA17                      	if FX_RELATIVE
     319.  00:CA17                    ~ 
     320.  00:CA17                    ~ 		; --- UNCOMMENT THIS BLOCK if YOU DON'T USE THIS REPLAYER WITH PT3 REPLAYER ---
     321.  00:CA17                    ~ VT_:	db 000h,000h,000h,000h,000h,000h,000h,000h,001h,001h,001h,001h,001h,001h,001h,001h
     322.  00:CA17                    ~ 		db 000h,000h,000h,000h,001h,001h,001h,001h,001h,001h,001h,001h,002h,002h,002h,002h
     323.  00:CA17                    ~ 		db 000h,000h,000h,001h,001h,001h,001h,001h,002h,002h,002h,002h,002h,003h,003h,003h
     324.  00:CA17                    ~ 		db 000h,000h,001h,001h,001h,001h,002h,002h,002h,002h,003h,003h,003h,003h,004h,004h
     325.  00:CA17                    ~ 		db 000h,000h,001h,001h,001h,002h,002h,002h,003h,003h,003h,004h,004h,004h,005h,005h
     326.  00:CA17                    ~ 		db 000h,000h,001h,001h,002h,002h,002h,003h,003h,004h,004h,004h,005h,005h,006h,006h
     327.  00:CA17                    ~ 		db 000h,000h,001h,001h,002h,002h,003h,003h,004h,004h,005h,005h,006h,006h,007h,007h
     328.  00:CA17                    ~ 		db 000h,001h,001h,002h,002h,003h,003h,004h,004h,005h,005h,006h,006h,007h,007h,008h
     329.  00:CA17                    ~ 		db 000h,001h,001h,002h,002h,003h,004h,004h,005h,005h,006h,007h,007h,008h,008h,009h
     330.  00:CA17                    ~ 		db 000h,001h,001h,002h,003h,003h,004h,005h,005h,006h,007h,007h,008h,009h,009h,00Ah
     331.  00:CA17                    ~ 		db 000h,001h,001h,002h,003h,004h,004h,005h,006h,007h,007h,008h,009h,00Ah,00Ah,00Bh
     332.  00:CA17                    ~ 		db 000h,001h,002h,002h,003h,004h,005h,006h,006h,007h,008h,009h,00Ah,00Ah,00Bh,00Ch
     333.  00:CA17                    ~ 		db 000h,001h,002h,003h,003h,004h,005h,006h,007h,008h,009h,00Ah,00Ah,00Bh,00Ch,00Dh
     334.  00:CA17                    ~ 		db 000h,001h,002h,003h,004h,005h,006h,007h,007h,008h,009h,00Ah,00Bh,00Ch,00Dh,00Eh
     335.  00:CA17                    ~ 		db 000h,001h,002h,003h,004h,005h,006h,007h,008h,009h,00Ah,00Bh,00Ch,00Dh,00Eh,00Fh 
     336.  00:CA17                    ~ 		; --- UNCOMMENT THIS if YOU DON'T USE THIS REPLAYER WITH PT3 REPLAYER ---
     337.  00:CA17                    ~ 
     338.  00:CA17                    ~ 	endif
     339.  00:CA17                      	
     340.  00:CA17                      	endif
     341.  00:CA17                      
     342.  00:CA17                      	endif
     343.  00:CA17                      		
    8204   00:CA17                      
    8205   00:CA17                      	if XFLAG
    8206   00:CA17                      	
    8207   00:CA17  (0116)              sfxbank:	incbin "..\resources\sfx.afb"
    8208   00:CB2D                      	
    8209   00:CB2D                      	endif	
    8210   00:CB2D                      
    8211   00:CB2D                      ; Game-specific data and events code generated by the compiler ------------------
    8212   00:CB2D                      
    8213   00:CB2D                      ; ======================================================================================
    8214   00:CB2D                      ;
    8215   00:CB2D                      ; BEGINNING OF RAM AREA: The following data needs to be located in RAM!!!
    8216   00:CB2D                      ;
    8217   00:CB2D                      ; ======================================================================================
    8218   00:CB2D                      
    8219   00:CB2D                      ; Variables that NEED to be initialized and when in RAM mode can be autoinitialized for free
    8220   00:CB2D                      
    8221   00:CB2D                      	if DISTYPE!=ROM
    8222   00:CB2D                    ~ 
    8223   00:CB2D                    ~ score:		db "000000" 		; player's score  000000 .
    8224   00:CB2D                    ~ hiscor:		db "000000" 		; high score  000000 .
    8225   00:CB2D                    ~ bonus:		db "000000" 		; bonus  000000 .
    8226   00:CB2D                    ~ displ0:		db 0,0,0,13+128
    8227   00:CB2D                    ~ 
    8228   00:CB2D                    ~ 	if EFLAG
    8229   00:CB2D                    ~ 
    8230   00:CB2D                    ~ sndtyp:		db 0
    8231   00:CB2D                    ~ 
    8232   00:CB2D                    ~ 	endif
    8233   00:CB2D                    ~ 
    8234   00:CB2D                    ~ 	if PFLAG
    8235   00:CB2D                    ~ 
    8236   00:CB2D                    ~ shrplot:	dw prosh1
    8237   00:CB2D                    ~ 
    8238   00:CB2D                    ~ 	endif
    8239   00:CB2D                    ~ 
    8240   00:CB2D                    ~ 	if SFLAG
    8241   00:CB2D                    ~ 	
    8242   00:CB2D                    ~ scrlyoff:	db 1
    8243   00:CB2D                    ~ 	
    8244   00:CB2D                    ~ 	endif
    8245   00:CB2D                    ~ 	
    8246   00:CB2D                    ~ 	if MFLAG
    8247   00:CB2D                    ~ 	
    8248   00:CB2D                    ~ mod0:	db $C3,0,0
    8249   00:CB2D                    ~ mod1:	db $C3,0,0
    8250   00:CB2D                    ~ mod2:	db $C3,0,0
    8251   00:CB2D                    ~ 
    8252   00:CB2D                    ~ 	endif
    8253   00:CB2D                    ~ 
    8254   00:CB2D                    ~ 	ifdef DATA00
    8255   00:CB2D                    ~ rptr00:		dw rdat00
    8256   00:CB2D                    ~ 	endif
    8257   00:CB2D                    ~ 	ifdef DATA01
    8258   00:CB2D                    ~ rptr01:		dw rdat01
    8259   00:CB2D                    ~ 	endif
    8260   00:CB2D                    ~ 	ifdef DATA02
    8261   00:CB2D                    ~ rptr02:		dw rdat02
    8262   00:CB2D                    ~ 	endif
    8263   00:CB2D                    ~ 	ifdef DATA03
    8264   00:CB2D                    ~ rptr03:		dw rdat03
    8265   00:CB2D                    ~ 	endif
    8266   00:CB2D                    ~ 	ifdef DATA04
    8267   00:CB2D                    ~ rptr04:		dw rdat04
    8268   00:CB2D                    ~ 	endif
    8269   00:CB2D                    ~ 	ifdef DATA05
    8270   00:CB2D                    ~ rptr05:		dw rdat05
    8271   00:CB2D                    ~ 	endif
    8272   00:CB2D                    ~ 	ifdef DATA06
    8273   00:CB2D                    ~ rptr06:		dw rdat06
    8274   00:CB2D                    ~ 	endif
    8275   00:CB2D                    ~ 	ifdef DATA07
    8276   00:CB2D                    ~ rptr07:		dw rdat07
    8277   00:CB2D                    ~ 	endif
    8278   00:CB2D                    ~ 	ifdef DATA08
    8279   00:CB2D                    ~ rptr08:		dw rdat08
    8280   00:CB2D                    ~ 	endif
    8281   00:CB2D                    ~ 	ifdef DATA09
    8282   00:CB2D                    ~ rptr09:		dw rdat09
    8283   00:CB2D                    ~ 	endif
    8284   00:CB2D                    ~ 	ifdef DATA10
    8285   00:CB2D                    ~ rptr10:		dw rdat10
    8286   00:CB2D                    ~ 	endif
    8287   00:CB2D                    ~ 	ifdef DATA11
    8288   00:CB2D                    ~ rptr11:		dw rdat11
    8289   00:CB2D                    ~ 	endif
    8290   00:CB2D                    ~ 	ifdef DATA12
    8291   00:CB2D                    ~ rptr12:		dw rdat12
    8292   00:CB2D                    ~ 	endif
    8293   00:CB2D                    ~ 	ifdef DATA13
    8294   00:CB2D                    ~ rptr13:		dw rdat13
    8295   00:CB2D                    ~ 	endif
    8296   00:CB2D                    ~ 	ifdef DATA14
    8297   00:CB2D                    ~ rptr14:		dw rdat14
    8298   00:CB2D                    ~ 	endif
    8299   00:CB2D                    ~ 	ifdef DATA15
    8300   00:CB2D                    ~ rptr15:		dw rdat15
    8301   00:CB2D                    ~ 	endif
    8302   00:CB2D                    ~ 	ifdef DATA16
    8303   00:CB2D                    ~ rptr16:		dw rdat16
    8304   00:CB2D                    ~ 	endif
    8305   00:CB2D                    ~ 	ifdef DATA17
    8306   00:CB2D                    ~ rptr17:		dw rdat17
    8307   00:CB2D                    ~ 	endif
    8308   00:CB2D                    ~ 	ifdef DATA18
    8309   00:CB2D                    ~ rptr18:		dw rdat18
    8310   00:CB2D                    ~ 	endif
    8311   00:CB2D                    ~ 	ifdef DATA19
    8312   00:CB2D                    ~ rptr19:		dw rdat19
    8313   00:CB2D                    ~ 	endif
    8314   00:CB2D                    ~ 	ifdef DATA20
    8315   00:CB2D                    ~ rptr20:		dw rdat20
    8316   00:CB2D                    ~ 	endif
    8317   00:CB2D                    ~ 
    8318   00:CB2D                    ~ ; Don't change the order of these four.  Menu routine relies on winlft following wintop.
    8319   00:CB2D                    ~ 
    8320   00:CB2D                    ~ wintop		db WINDOWTOP		; top of window.
    8321   00:CB2D                    ~ winlft		db WINDOWLFT		; left edge.
    8322   00:CB2D                    ~ winhgt		db WINDOWHGT		; window height.
    8323   00:CB2D                    ~ winwid		db WINDOWWID		; window width.
    8324   00:CB2D                    ~ 
    8325   00:CB2D                    ~ 	endif
    8326   00:CB2D                      
    8327   00:CB2D                      	if DISTYPE=ROM		
    8328   00:CB2D                      
    8329   00:CB2D  (00:CB2D)           endprogram:	equ $
    8330   00:CB2D                      
    8331   00:CB2D                      	else
    8332   00:CB2D                    ~ 	
    8333   00:CB2D                    ~ endprogram:	equ main + ::0
    8334   00:CB2D                    ~ 
    8335   00:CB2D                    ~ 	endif
    8336   00:CB2D                      	
    8337   00:CB2D                      ; Fill the rest of the page
    8338   00:CB2D                      
    8339   00:CB2D                      ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    8340   00:CB2D                      	include "CV_BIOS.asm"
       1.  00:CB2D                      ;-----------------------------------------------------------
       2.  00:CB2D                      ; Colecovision BIOS calls
       3.  00:CB2D                      ;-----------------------------------------------------------
       4.  00:CB2D                      
       5.  00:CB2D  (00:1FD9)           WRITE_REGISTER:		equ $1fd9
       6.  00:CB2D  (00:00C9)           PATSIZE:		equ (sprgfx-chgfx)/8
       7.  00:CB2D  (00:1105)           CONTROLLER_INIT:	equ $1105
       8.  00:CB2D  (00:1FEB)           POLLER:			equ $1feb
       9.  00:CB2D                      
      10.  00:CB2D                      ;-----------------------------------------------------------
      11.  00:CB2D                      ; - Setup Screen 2,2
      12.  00:CB2D                      ; - Interrupts are disabled
      13.  00:CB2D                      ; - Fill screen 3x with chars 0-255
      14.  00:CB2D                      ; - Clear char table
      15.  00:CB2D                      ;-----------------------------------------------------------
      16.  00:CB2D                      
      17.  00:CB2D                      CV_INIGRP:
      18.  00:CB2D  01 02 00            	ld bc,0002h		; Reg 0: Mode 2
      19.  00:CB30  CD D9 1F            	call WRITE_REGISTER
      20.  00:CB33  01 06 02            	ld bc,0206h        	; Name table 1800h
      21.  00:CB36  CD D9 1F            	call WRITE_REGISTER
      22.  00:CB39  01 FF 03            	ld bc,03ffh        	; Colour table 2000h
      23.  00:CB3C  CD D9 1F            	call WRITE_REGISTER
      24.  00:CB3F  01 03 04            	ld bc,0403h        	; Pattern table 0000h
      25.  00:CB42  CD D9 1F            	call WRITE_REGISTER
      26.  00:CB45  01 36 05            	ld bc,0536h        	; Sprite attribute table 1b00h
      27.  00:CB48  CD D9 1F            	call WRITE_REGISTER
      28.  00:CB4B  01 07 06            	ld bc,0607h        	; Sprite pattern table 3800h
      29.  00:CB4E  CD D9 1F            	call WRITE_REGISTER
      30.  00:CB51  01 00 07            	ld bc,0700h        	; Base colours
      31.  00:CB54  CD D9 1F            	call WRITE_REGISTER
      32.  00:CB57  01 E2 01            	ld bc,01e2h		; Reg 1: Mode 2, 16k, no interrupts, 16x16 sprites
      33.  00:CB5A  CD D9 1F            	call WRITE_REGISTER
      34.  00:CB5D                      
      35.  00:CB5D                      ; Fill screen 3x 0-255
      36.  00:CB5D                      
      37.  00:CB5D  21 00 18            	ld hl,MSX_NAMTBL		
      38.  00:CB60  CD 96 CB            	call CV_SETWRT
      39.  00:CB63  AF                          xor a
      40.  00:CB64  06 03               	ld b,3
      41.  00:CB66                      nxtblk:
      42.  00:CB66  D3 BE               	out (MSX_VDPDRW),a
      43.  00:CB68  3C                  	inc a
      44.  00:CB69  20 FB               	jr nz,nxtblk
      45.  00:CB6B  10 F9               	djnz nxtblk
      46.  00:CB6D                      
      47.  00:CB6D                      ; Clear char table
      48.  00:CB6D                      
      49.  00:CB6D  CD 71 CB            	call CV_CLS		
      50.  00:CB70  C9                  	ret
      51.  00:CB71                      
      52.  00:CB71                      ;-----------------------------------------------------------
      53.  00:CB71                      ; Clear the VDP Pattern table (clears screen)
      54.  00:CB71                      ;-----------------------------------------------------------
      55.  00:CB71                      
      56.  00:CB71                      CV_CLS:
      57.  00:CB71  01 00 18            	ld bc,256/8*192
      58.  00:CB74  C5                  	push bc
      59.  00:CB75  21 00 00            	ld hl,MSX_CHRTBL		; Clear char table
      60.  00:CB78  AF                          xor a
      61.  00:CB79  CD 87 CB            	call FILVRM
      62.  00:CB7C                      
      63.  00:CB7C  21 00 20            	ld hl,MSX_CLRTBL		; Clear colour tabel
      64.  00:CB7F  3A EA 53            	ld a,(MSX_BAKCLR)
      65.  00:CB82  C1                  	pop bc
      66.  00:CB83  CD 87 CB            	call FILVRM
      67.  00:CB86                      
      68.  00:CB86  C9                  	ret
      69.  00:CB87                      
      70.  00:CB87                      ;-----------------------------------------------------------
      71.  00:CB87                      ; Fill a section of VRAM with value in A
      72.  00:CB87                      ; HL = VRAM Address
      73.  00:CB87                      ; BC = Length
      74.  00:CB87                      ;-----------------------------------------------------------
      75.  00:CB87                      
      76.  00:CB87                      FILVRM:
      77.  00:CB87  5F                  	ld e,a
      78.  00:CB88  CD 96 CB            	call CV_SETWRT
      79.  00:CB8B                      FLOOP:
      80.  00:CB8B  7B                  	ld a,e
      81.  00:CB8C  D3 BE               	out (MSX_VDPDRW),a
      82.  00:CB8E  0B                  	dec bc
      83.  00:CB8F  79                  	ld a,c
      84.  00:CB90  B0                  	or b
      85.  00:CB91  FE 00               	cp 0
      86.  00:CB93  20 F6               	jr nz,FLOOP
      87.  00:CB95  C9                  	ret
      88.  00:CB96                      
      89.  00:CB96                      ;-----------------------------------------------------------
      90.  00:CB96                      ; Set write to Video Ram
      91.  00:CB96                      ; HL = VRAM Address
      92.  00:CB96                      ;-----------------------------------------------------------
      93.  00:CB96                      
      94.  00:CB96                      CV_SETWRT:
      95.  00:CB96  F3                  	di
      96.  00:CB97  7D                  	ld a,l
      97.  00:CB98  D3 BF               	out (MSX_VDPCW),a
      98.  00:CB9A  7C                  	ld a,h
      99.  00:CB9B  E6 3F               	and 3Fh
     100.  00:CB9D  F6 40               	or 40h
     101.  00:CB9F  D3 BF               	out (MSX_VDPCW),a
     102.  00:CBA1  FB                  	ei
     103.  00:CBA2  C9                  	ret
     104.  00:CBA3                      
     105.  00:CBA3                      ;-----------------------------------------------------------
     106.  00:CBA3                      ; Set data in VRAM
     107.  00:CBA3                      ; HL = VRAM Address
     108.  00:CBA3                      ;-----------------------------------------------------------
     109.  00:CBA3                      
     110.  00:CBA3                      CV_WRTVRM:
     111.  00:CBA3  F5                  	push af
     112.  00:CBA4  CD 96 CB            	call CV_SETWRT
     113.  00:CBA7  F1                  	pop af
     114.  00:CBA8  D3 BE               	out (MSX_VDPDRW),a
     115.  00:CBAA  C9                  	ret
     116.  00:CBAB                      
     117.  00:CBAB                      
    8341   00:CBAB                      ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    8342   00:CBAB                      	
    8343   00:CBAB                      /*
    8344   00:CBAB                    ~ 	if DISTYPE=ROM
    8345   00:CBAB                    ~ 
    8346   00:CBAB                    ~ 	output rom_filler.bin
    8347   00:CBAB                    ~ 
    8348   00:CBAB                    ~ 	org endprogram
    8349   00:CBAB                    ~ 	
    8350   00:CBAB                    ~ 
    8351   00:CBAB                    ~ 		if ($ & $8000)!=0
    8352   00:CBAB                    ~ 			block $4000-($-8000h),255
    8353   00:CBAB                    ~ 		else
    8354   00:CBAB                    ~ 			block $4000-($-4000h),255
    8355   00:CBAB                    ~ 		endif
    8356   00:CBAB                    ~ 		
    8357   00:CBAB                    ~ 	endif
    8358   00:CBAB                    ~ 	*/
    8359   00:CBAB                      ;
    8360   00:CBAB                      ;
    8361   00:CBAB                      ;
    8362   00:CBAB                      	output ram_vars.tmp
    8363   00:0000                      
    8364   00:0000                      ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    8365   00:0000                      ;	defpage 0, $8080	
    8366   00:0000                      ;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    8367   00:0000                      		
    8368   00:0000                      	if DISTYPE=ROM	
    8369   00:0000                      
    8370   00:0000  (4000)              		phase $4000 ; ROM model variables that need to be initialized. Minimum 8KB RAM needed
    8371   00:4000                      
    8372   00:4000  (00:4000)           varbegin: equ $	
    8373   00:4000                      
    8374   00:4000                      ; Don't change the order of these 5 variables.
    8375   00:4000  00 (6)              score:		ds 6		; player's score  000000 .
    8376   00:4006  00 (6)              hiscor:		ds 6		; high score  000000 .
    8377   00:400C  00 (6)              bonus:		ds 6		; bonus  000000 .
    8378   00:4012  00 (4)              displ0:		ds 4
    8379   00:4016                      
    8380   00:4016                      	if EFLAG
    8381   00:4016                      
    8382   00:4016  00 (1)              sndtyp:		ds 1		; sound type. don't move!
    8383   00:4017                      
    8384   00:4017                      	endif
    8385   00:4017                      
    8386   00:4017                      	if PFLAG
    8387   00:4017                      
    8388   00:4017  00 (2)              shrplot:	ds 2
    8389   00:4019                      
    8390   00:4019                      	endif
    8391   00:4019                      
    8392   00:4019                      	if SFLAG
    8393   00:4019                    ~ 	
    8394   00:4019                    ~ scrlyoff:	ds 1
    8395   00:4019                    ~ 	
    8396   00:4019                    ~ 	endif
    8397   00:4019                      
    8398   00:4019                      	if MFLAG
    8399   00:4019                    ~ 	
    8400   00:4019                    ~ mod0:	ds 3
    8401   00:4019                    ~ mod1:	ds 3
    8402   00:4019                    ~ mod2:	ds 3
    8403   00:4019                    ~ 
    8404   00:4019                    ~ 	endif
    8405   00:4019                      
    8406   00:4019                      	ifdef DATA00
    8407   00:4019                    ~ rptr00:		ds 2
    8408   00:4019                    ~ 	endif
    8409   00:4019                      	ifdef DATA01
    8410   00:4019                    ~ rptr01:		ds 2
    8411   00:4019                    ~ 	endif
    8412   00:4019                      	ifdef DATA02
    8413   00:4019                    ~ rptr02:		ds 2
    8414   00:4019                    ~ 	endif
    8415   00:4019                      	ifdef DATA03
    8416   00:4019                    ~ rptr03:		ds 2
    8417   00:4019                    ~ 	endif
    8418   00:4019                      	ifdef DATA04
    8419   00:4019                    ~ rptr04:		ds 2
    8420   00:4019                    ~ 	endif
    8421   00:4019                      	ifdef DATA05
    8422   00:4019                    ~ rptr05:		ds 2
    8423   00:4019                    ~ 	endif
    8424   00:4019                      	ifdef DATA06
    8425   00:4019                    ~ rptr06:		ds 2
    8426   00:4019                    ~ 	endif
    8427   00:4019                      	ifdef DATA07
    8428   00:4019                    ~ rptr07:		ds 2
    8429   00:4019                    ~ 	endif
    8430   00:4019                      	ifdef DATA08
    8431   00:4019                    ~ rptr08:		ds 2
    8432   00:4019                    ~ 	endif
    8433   00:4019                      	ifdef DATA09
    8434   00:4019                    ~ rptr09:		ds 2
    8435   00:4019                    ~ 	endif
    8436   00:4019                      	ifdef DATA10
    8437   00:4019                    ~ rptr10:		ds 2
    8438   00:4019                    ~ 	endif
    8439   00:4019                      	ifdef DATA11
    8440   00:4019                    ~ rptr11:		ds 2
    8441   00:4019                    ~ 	endif
    8442   00:4019                      	ifdef DATA12
    8443   00:4019                    ~ rptr12:		ds 2
    8444   00:4019                    ~ 	endif
    8445   00:4019                      	ifdef DATA13
    8446   00:4019                    ~ rptr13:		ds 2
    8447   00:4019                    ~ 	endif
    8448   00:4019                      	ifdef DATA14
    8449   00:4019                    ~ rptr14:		ds 2
    8450   00:4019                    ~ 	endif
    8451   00:4019                      	ifdef DATA15
    8452   00:4019                    ~ rptr15:		ds 2
    8453   00:4019                    ~ 	endif
    8454   00:4019                      	ifdef DATA16
    8455   00:4019                    ~ rptr16:		ds 2
    8456   00:4019                    ~ 	endif
    8457   00:4019                      	ifdef DATA17
    8458   00:4019                    ~ rptr17:		ds 2
    8459   00:4019                    ~ 	endif
    8460   00:4019                      ifdef DATA18
    8461   00:4019                    ~ rptr18:		ds 2
    8462   00:4019                    ~ 	endif
    8463   00:4019                      	ifdef DATA19
    8464   00:4019                    ~ rptr19:		ds 2
    8465   00:4019                    ~ 	endif
    8466   00:4019                      	ifdef DATA20
    8467   00:4019                    ~ rptr20:		ds 2
    8468   00:4019                    ~ 	endif
    8469   00:4019                      
    8470   00:4019                      	else
    8471   00:4019                    ~ 	
    8472   00:4019                    ~ 		phase endprogram ; ; if DISTYPE=ROM RAM model variables	
    8473   00:4019                    ~ 		
    8474   00:4019                    ~ varbegin: equ $	
    8475   00:4019                    ~ 	
    8476   00:4019                    ~ 	endif 
    8477   00:4019                      
    8478   00:4019                      ; RAM variables (initialization not needed)
    8479   00:4019                      
    8480   00:4019  00 (1)              loopa:		ds 1			; loop counter system variable. (23681)
    8481   00:401A  00 (1)              loopb:		ds 1			; loop counter system variable. (23728)
    8482   00:401B  00 (1)              loopc:		ds 1			; loop counter system variable. (23729)	
    8483   00:401C  00 (1)              vara:		ds 1			; general-purpose variable.
    8484   00:401D  00 (1)              varb:		ds 1			; general-purpose variable.
    8485   00:401E  00 (1)              varc:		ds 1			; general-purpose variable.
    8486   00:401F  00 (1)              vard:		ds 1			; general-purpose variable.
    8487   00:4020  00 (1)              vare:		ds 1			; general-purpose variable.
    8488   00:4021  00 (1)              varf:		ds 1			; general-purpose variable.
    8489   00:4022  00 (1)              varg:		ds 1			; general-purpose variable.
    8490   00:4023  00 (1)              varh:		ds 1			; general-purpose variable.
    8491   00:4024  00 (1)              vari:		ds 1			; general-purpose variable.
    8492   00:4025  00 (1)              varj:		ds 1			; general-purpose variable.
    8493   00:4026  00 (1)              vark:		ds 1			; general-purpose variable.
    8494   00:4027  00 (1)              varl:		ds 1			; general-purpose variable.
    8495   00:4028  00 (1)              varm:		ds 1			; general-purpose variable.
    8496   00:4029  00 (1)              varn:		ds 1			; general-purpose variable.
    8497   00:402A  00 (1)              varo:		ds 1			; general-purpose variable.
    8498   00:402B  00 (1)              varp:		ds 1			; general-purpose variable.
    8499   00:402C  00 (1)              varq:		ds 1			; general-purpose variable.
    8500   00:402D  00 (1)              varr:		ds 1			; general-purpose variable.
    8501   00:402E  00 (1)              vars:		ds 1			; general-purpose variable.
    8502   00:402F  00 (1)              vart:		ds 1			; general-purpose variable.
    8503   00:4030  00 (1)              varu:		ds 1			; general-purpose variable.
    8504   00:4031  00 (1)              varv:		ds 1			; general-purpose variable.
    8505   00:4032  00 (1)              varw:		ds 1			; general-purpose variable.
    8506   00:4033  00 (1)              varz:		ds 1			; general-purpose variable.
    8507   00:4034  00 (1)              contrl:		ds 1            ; control, 0 = keyboard, 1 = Kempston, 2 = Sinclair, 3 = Mouse.
    8508   00:4035  00 (1)              charx:		ds 1            ; cursor y position.
    8509   00:4036  00 (1)              chary:		ds 1            ; cursor x position.
    8510   00:4037  00 (1)              colpat:		ds 1	
    8511   00:4038  00 (1)              prtmod:		ds 1			; print mode, 0 = standard, 1 = double-height.	
    8512   00:4039  00 (1)              clratt:		ds 1			; color attributes
    8513   00:403A                      	
    8514   00:403A                      ; Scrolly text and puzzle variables.
    8515   00:403A                      
    8516   00:403A                      	if SFLAG
    8517   00:403A                    ~ txtbit:		ds 1			; bit to write.
    8518   00:403A                    ~ txtwid:		ds 1			; width of ticker message.
    8519   00:403A                    ~ txtpos:		ds 2			; 
    8520   00:403A                    ~ txtini:		ds 2			; 
    8521   00:403A                    ~ txtend:		ds 2			; 
    8522   00:403A                    ~ txtbeg:		ds 2			; 
    8523   00:403A                    ~ 	endif
    8524   00:403A                      
    8525   00:403A                      ; beeper variable
    8526   00:403A                      	if EFLAG
    8527   00:403A  00 (1)              snddelay:	ds 1
    8528   00:403B                      	endif
    8529   00:403B                      	
    8530   00:403B  00 (2)              spptr:		ds 2			; spawned sprite pointer.
    8531   00:403D  00 (1)              seed:		ds 1			; seed for random numbers.
    8532   00:403E  00 (2)              grbase:		ds 2			; graphics base address.
    8533   00:4040  00 (1)              joyval:		ds 1			; joystick reading.		
    8534   00:4041  00 (1)              scno:		ds 1            ; present screen number.
    8535   00:4042  00 (2)              ogptr:		ds 2            ; original sprite pointer.
    8536   00:4044  00 (1)              nsprite:	ds 1
    8537   00:4045  00 (1)              numlif:		ds 1            ; number of lives.
    8538   00:4046  00 (1)              curobj:		ds 1
    8539   00:4047  00 (2)              dirthig:	ds 2		
    8540   00:4049  00 (2)              skptr:  	ds 2            ; search pointer.
    8541   00:404B  00 (1)              highslot:	ds 1            ; highest free sprite number
    8542   00:404C  00 (1)              roomtb:		ds 1 	        ; room number.
    8543   00:404D                      
    8544   00:404D                      	if MFLAG
    8545   00:404D                    ~ bwid:		ds 1            ; box/menu width.
    8546   00:404D                    ~ blen:		ds 1            ; box/menu height.
    8547   00:404D                    ~ btop:		ds 1            ; box coordinates.
    8548   00:404D                    ~ blft:		ds 1
    8549   00:404D                    ~ 	endif
    8550   00:404D                      	
    8551   00:404D  00 (1)              frmno:		ds 1            ; current game frame.
    8552   00:404E  00 (1)              combyt:		ds 1			; byte type compressed.
    8553   00:404F                      ;comcnt: 	ds 1            ; compression counter.
    8554   00:404F                      
    8555   00:404F  00 (1)              seed3:		ds 1
    8556   00:4050  00 (1)              nexlev:		ds 1			; db 0               next level flag.
    8557   00:4051  00 (1)              restfl:		ds 1			; db 0               restart screen flag.
    8558   00:4052  00 (1)              deadf:		ds 1			; db 0              dead flag.
    8559   00:4053  00 (1)              gamwon:		ds 1			; db 0               game won flag.
    8560   00:4054  00 (1)              dispx:		ds 1			; db 0              cursor y position.
    8561   00:4055  00 (1)              dispy:		ds 1			; db 0              cursor x position.
    8562   00:4056  00 (1)              varrnd:		ds 1			; db 255             last random number.
    8563   00:4057  00 (1)              varobj:		ds 1			; db 254             last object number.
    8564   00:4058  00 (1)              varopt:		ds 1			; db 255             last option chosen from menu.
    8565   00:4059  00 (1)              varblk:		ds 1			; db 255             block type.
    8566   00:405A  00 (1)              offset:		ds 1
    8567   00:405B  00 (1)              select:		ds 1			; frames to wait until next SELECT key is accepted
    8568   00:405C  00 (1)              ticks:		ds 1			; PAL=50, NTSC=60
    8569   00:405D                      ; nohide:		ds 1
    8570   00:405D                      
    8571   00:405D                      	if RTFLAG
    8572   00:405D                    ~ usrsgn:		ds 1            ; sign.
    8573   00:405D                    ~ usrspd:		ds 1            ; speed.
    8574   00:405D                    ~ 	endif
    8575   00:405D                      	
    8576   00:405D  (00:405D)           varend:		equ $
    8577   00:405D                      
    8578   00:405D                      	include "PT3-RAM.asm"
       1.  00:405D                      	if YFLAG
       2.  00:405D                    ~ 	
       3.  00:405D                    ~ 		; --- THIS FILE MUST BE COMPILED IN RAM ---
       4.  00:405D                    ~ 
       5.  00:405D                    ~ 		; --- PT3 WORKAREA [self-modifying code patched] ---
       6.  00:405D                    ~ 
       7.  00:405D                    ~ PT3_MODADDR:	ds 2
       8.  00:405D                    ~ PT3_CrPsPtr:	ds 2
       9.  00:405D                    ~ PT3_SAMPTRS:	ds 2
      10.  00:405D                    ~ PT3_OrnPtrs:	ds 2
      11.  00:405D                    ~ PT3_PDSP:		ds 2
      12.  00:405D                    ~ PT3_CSP:		ds 2
      13.  00:405D                    ~ PT3_PSP:		ds 2
      14.  00:405D                    ~ PT3_PrNote:		ds 1
      15.  00:405D                    ~ PT3_PrSlide:	ds 2
      16.  00:405D                    ~ PT3_AdInPtA:	ds 2
      17.  00:405D                    ~ PT3_AdInPtB:	ds 2
      18.  00:405D                    ~ PT3_AdInPtC:	ds 2
      19.  00:405D                    ~ PT3_LPosPtr:	ds 2
      20.  00:405D                    ~ PT3_PatsPtr:	ds 2
      21.  00:405D                    ~ PT3_Delay:		ds 1
      22.  00:405D                    ~ PT3_AddToEn:	ds 1
      23.  00:405D                    ~ PT3_Env_Del:	ds 1
      24.  00:405D                    ~ PT3_ESldAdd:	ds 2
      25.  00:405D                    ~ 
      26.  00:405D                    ~ mutesong:		ds 1
      27.  00:405D                    ~ 
      28.  00:405D                    ~ PT3_SETUP:		ds 1	;set bit0 to 1, if you want to play without looping
      29.  00:405D                    ~ 						;bit7 is set each time, when loop point is passed
      30.  00:405D                    ~ 
      31.  00:405D                    ~ VARS:
      32.  00:405D                    ~ 
      33.  00:405D                    ~ ChanA:			ds 29			;CHNPRM_Size
      34.  00:405D                    ~ ChanB:			ds 29			;CHNPRM_Size
      35.  00:405D                    ~ ChanC:			ds 29			;CHNPRM_Size
      36.  00:405D                    ~ ;GlobalVars
      37.  00:405D                    ~ DelyCnt:		ds 1
      38.  00:405D                    ~ CurESld:		ds 2
      39.  00:405D                    ~ CurEDel:		ds 1
      40.  00:405D                    ~ Ns_Base_AddToNs:
      41.  00:405D                    ~ Ns_Base:		ds 1
      42.  00:405D                    ~ AddToNs:		ds 1
      43.  00:405D                    ~ 
      44.  00:405D                    ~ AYREGS:
      45.  00:405D                    ~ VT_:			ds 14
      46.  00:405D                    ~ EnvBase:		ds 2
      47.  00:405D                    ~ 
      48.  00:405D                    ~ VAR0END:		ds 240
      49.  00:405D                    ~ 
      50.  00:405D                    ~ 
      51.  00:405D                    ~ 	endif
      52.  00:405D                      	
    8579   00:405D                      	include "ayFX-RAM.asm"
       1.  00:405D                      		; --- ayFX REPLAYER v1.31 ---
       2.  00:405D                      
       3.  00:405D                      		; --- THIS FILE MUST BE COMPILED IN RAM ---
       4.  00:405D                      	if XFLAG
       5.  00:405D                      	
       6.  00:405D  00 (1)              ayFX_MODE:		ds 1			; ayFX mode
       7.  00:405E  00 (2)              ayFX_BANK:		ds 2			; Current ayFX Bank
       8.  00:4060  00 (1)              ayFX_PRIORITY:	ds 1			; Current ayFX stream priotity
       9.  00:4061  00 (2)              ayFX_POINTER:	ds 2			; Pointer to the current ayFX stream
      10.  00:4063  00 (2)              ayFX_TONE:		ds 2			; Current tone of the ayFX stream
      11.  00:4065  00 (1)              ayFX_NOISE:		ds 1			; Current noise of the ayFX stream
      12.  00:4066  00 (1)              ayFX_VOLUME:	ds 1			; Current volume of the ayFX stream
      13.  00:4067  00 (1)              ayFX_CHANNEL:	ds 1			; PSG channel to play the ayFX stream
      14.  00:4068                      
      15.  00:4068                       	if FX_RELATIVE
      16.  00:4068                    ~ 
      17.  00:4068                    ~ ayFX_VT:		ds 2			; ayFX relative volume table pointer
      18.  00:4068                    ~ 
      19.  00:4068                    ~ 	endif
      20.  00:4068                      
      21.  00:4068                      	if ( YFLAG = 0 )	
      22.  00:4068                      		
      23.  00:4068  00 (14)             AYREGS:			ds 14
      24.  00:4076                      
      25.  00:4076                      	endif
      26.  00:4076                      	
      27.  00:4076                      	endif
    8580   00:4076                      
    8581   00:4076  00 (2)              sprptr:		ds 2
    8582   00:4078  00 (2)              pblkptr:	ds 2
    8583   00:407A  00 (2)              stack:		ds 2
    8584   00:407C  00 (1)              time:		ds 1
    8585   00:407D                      
    8586   00:407D                      
    8587   00:407D                      	if DISTYPE=ROM
    8588   00:407D                      
    8589   00:407D  00 (22)             keys:		ds 22
    8590   00:4093                      
    8591   00:4093                      ; Don't change the order of these four.  Menu routine relies on winlft following wintop.
    8592   00:4093  00 (1)              wintop		ds 1		; top of window.
    8593   00:4094  00 (1)              winlft		ds 1		; left edge.
    8594   00:4095  00 (1)              winhgt		ds 1		; window height.
    8595   00:4096  00 (1)              winwid		ds 1		; window width.
    8596   00:4097                      
    8597   00:4097                      	endif
    8598   00:4097                      
    8599   00:4097                      CONTROLLER_BUFFER:
    8600   00:4097  00 (12)             	ds 12
    8601   00:40A3                      	
    8602   00:40A3                      
    8603   00:40A3                      ; Sprite table.
    8604   00:40A3                      ;
    8605   00:40A3                      ; ix+0  = type.	(TYPE)
    8606   00:40A3                      ; ix+1  = sprite image number. (IMAGE)
    8607   00:40A3                      ; ix+2  = frame. (FRAME)
    8608   00:40A3                      ; ix+3  = y coord. (Y)
    8609   00:40A3                      ; ix+4  = x coord. (X)
    8610   00:40A3                      
    8611   00:40A3                      ; ix+5  = color
    8612   00:40A3                      ; ix+6  = Not used
    8613   00:40A3                      ; ix+7  = Not used
    8614   00:40A3                      ; ix+8  = y coord backup
    8615   00:40A3                      ; ix+9  = x coord backup
    8616   00:40A3                      
    8617   00:40A3                      ; ix+10 = direction.
    8618   00:40A3                      ; ix+11 = parameter 1. (SETTINGA)
    8619   00:40A3                      ; ix+12 = parameter 2. (SETTINGB)
    8620   00:40A3                      ; ix+13 = jump pointer low. (AIRBORNE)
    8621   00:40A3                      ; ix+14 = jump pointer high. (JUMPSPEED)
    8622   00:40A3                      ; ix+15 = data pointer low.
    8623   00:40A3                      ; ix+16 = data pointer high.
    8624   00:40A3                      
    8625   00:40A3  00 (17)             ssprit:		ds TABSIZ
    8626   00:40B4  00 (544)            sprtab:		ds SPRBUF	   
    8627   00:42D4                      		
    8628   00:42D4                      	if (MAPSIZE > 128)
    8629   00:42D4  00 (472)            mapbuf:		ds MAPSIZE - 128	; spratr2+unaligned bytes are recycled
    8630   00:44AC                      	else
    8631   00:44AC                    ~ mapbuf:		equ $				; spratr2 is enough
    8632   00:44AC                    ~ 	endif
    8633   00:44AC                      ;
    8634   00:44AC                      ; aligned tables
    8635   00:44AC                      ;
    8636   00:44AC                      ; move wisely!
    8637   00:44AC                      ;
    8638   00:44AC  (0054)              		ALIGN 256
    8639   00:4500                      		
    8640   00:4500  00 (128)            spratr2:	ds 128			; secondary sprite attribute table
    8641   00:4580  00 (128)            spratr:		ds 128			; full sprite attribute table. Cannot cross a 256 byte boundary
    8642   00:4600  00 (768)            MAP:		ds 768			; main attributes map. Stores tile attributes		
    8643   00:4900                      	
    8644   00:4900                      	if OFLAG
    8645   00:4900  00 (256)            objlist:	ds 256			; Objects coords list (max. 128 objects). Needs exact 256 alignment
    8646   00:4A00                      	endif
    8647   00:4A00                      
    8648   00:4A00  00 (768)            scrmap:		ds 768			; Blocks map. Keeps tile codes
    8649   00:4D00                      
    8650   00:4D00  00 (128)            mapspr:		ds 128			; Sprite mapping list (max. 64 sprites). Needs exact 256 alignment		
    8651   00:4D80                      
    8652   00:4D80  00 (64)             colltab:	ds 16*4			; Support till 16 Y-aligned sprites. Must not cross a 256 byte boundary
    8653   00:4DC0                      
    8654   00:4DC0                      ; end of aligned tables or data areas
    8655   00:4DC0                      
    8656   00:4DC0                      	if SFLAG
    8657   00:4DC0                    ~ scrbuf:		ds 256+8
    8658   00:4DC0                    ~ 	endif
    8659   00:4DC0                      	
    8660   00:4DC0                      	if PFLAG
    8661   00:4DC0  00 (2)              shraddr:	ds 2
    8662   00:4DC2  00 (486)            SHRAPN:		ds NUMSHR*SHRSIZ
    8663   00:4FA8                      	endif
    8664   00:4FA8                      		
    8665   00:4FA8                      	if (OFLAG and DISTYPE=ROM)
    8666   00:4FA8  00 (120)            objatr:		ds NUMOBJ*3
    8667   00:5020                      	endif
    8668   00:5020                      
    8669   00:5020                      	; if (DISTYPE=ROM and DISSIZE=48) or (DISTYPE!=ROM and DISSIZE=64)
    8670   00:5020                      	ifdef NOBIOS
    8671   00:5020                    ~ biosvars:	ds $38	
    8672   00:5020                    ~ 	endif
    8673   00:5020                      	
    8674   00:5020                      frames_passed:
    8675   00:5020  00                  	db 0
    8676   00:5021                      
    8677   00:5021  (00:5021)           eop:		equ $
    8678   00:5021                      
    8679   00:5021  (1021)              	dephase
    8680   00:1021                      
    8681   00:1021                      ;
    8682   00:1021                      ; Extra binary. Loaders for disk/tape versions
    8683   00:1021                      ;
    8684   00:1021                      
    8685   00:1021                      	if (DISTYPE!=ROM and DISSIZE>32)
    8686   00:1021                    ~ 	
    8687   00:1021                    ~ 		output loader.bin
    8688   00:1021                    ~ 
    8689   00:1021                    ~ 		db $FE
    8690   00:1021                    ~ 		dw slots
    8691   00:1021                    ~ 		dw endslots-1
    8692   00:1021                    ~ 		dw slots
    8693   00:1021                    ~ 
    8694   00:1021                    ~ 		org $F41F				; KBUF F41F-F55C(318 bytes available)
    8695   00:1021                    ~ 		
    8696   00:1021                    ~ slots:	equ $
    8697   00:1021                    ~ 	
    8698   00:1021                    ~ mvpage0:
    8699   00:1021                    ~ 		di
    8700   00:1021                    ~ 		call saveslots
    8701   00:1021                    ~ 		push de
    8702   00:1021                    ~ 		call enapage1
    8703   00:1021                    ~ 		call enapage0
    8704   00:1021                    ~ 		ld de,$0000
    8705   00:1021                    ~ 		jr putram
    8706   00:1021                    ~ mvpage1:  
    8707   00:1021                    ~ 		di
    8708   00:1021                    ~ 		call saveslots
    8709   00:1021                    ~ 		push de
    8710   00:1021                    ~ 		call enapage1
    8711   00:1021                    ~ 		ld de,$4000
    8712   00:1021                    ~ putram:
    8713   00:1021                    ~ 		ld hl,$8080
    8714   00:1021                    ~ 		ld bc,$4000
    8715   00:1021                    ~ 		ldir 
    8716   00:1021                    ~ 		pop de
    8717   00:1021                    ~ 		call loadslots
    8718   00:1021                    ~ 		ei
    8719   00:1021                    ~ 		ret
    8720   00:1021                    ~ 
    8721   00:1021                    ~ runpage0:
    8722   00:1021                    ~ 		jp runpage0a
    8723   00:1021                    ~ 
    8724   00:1021                    ~ runpage1:
    8725   00:1021                    ~ 		jp runpage1a
    8726   00:1021                    ~ 				
    8727   00:1021                    ~ saveslots:
    8728   00:1021                    ~ 		ld a,(MSX_SSSREG)
    8729   00:1021                    ~ 		cpl			; reverse all bits
    8730   00:1021                    ~ 		ld d,a		; Store the current secondary slots register
    8731   00:1021                    ~ 		in a,(MSX_PPIA)
    8732   00:1021                    ~ 		ld e,a		; Store the current primary slots register
    8733   00:1021                    ~ 		ret
    8734   00:1021                    ~ 		
    8735   00:1021                    ~ loadslots:		
    8736   00:1021                    ~ 		ld a,e
    8737   00:1021                    ~ 		out	(MSX_PPIA),a	; Restore the register as at start
    8738   00:1021                    ~ 		ld a,d
    8739   00:1021                    ~ 		ld (MSX_SSSREG),a	; Restore the register as at start				
    8740   00:1021                    ~ 		ret
    8741   00:1021                    ~ 
    8742   00:1021                    ~ runpage1a:
    8743   00:1021                    ~ 		di
    8744   00:1021                    ~ 		call inipage1
    8745   00:1021                    ~ 		jr run				
    8746   00:1021                    ~ 		
    8747   00:1021                    ~ runpage0a:
    8748   00:1021                    ~ 		di
    8749   00:1021                    ~ 		call inipage1
    8750   00:1021                    ~ 	if DISSIZE=64
    8751   00:1021                    ~ 		call cpbiosvars
    8752   00:1021                    ~ 	endif
    8753   00:1021                    ~ 		call enapage0
    8754   00:1021                    ~ run:		
    8755   00:1021                    ~ 		jp $4000
    8756   00:1021                    ~ 
    8757   00:1021                    ~ turboon:		
    8758   00:1021                    ~ 		ld a,(MSX_CHGCPU)
    8759   00:1021                    ~ 		cp $C3
    8760   00:1021                    ~ 		ld a,$81
    8761   00:1021                    ~ 		jp z,MSX_CHGCPU
    8762   00:1021                    ~ 		ret
    8763   00:1021                    ~ 		
    8764   00:1021                    ~ 	if DISTYPE=DISK
    8765   00:1021                    ~ drvmotoff:
    8766   00:1021                    ~ 		ld a,(MSX_MSLOT)	; motor off entry present?
    8767   00:1021                    ~ 		ld hl,MSX_MTOFF
    8768   00:1021                    ~ 		call MSX_RDSLT
    8769   00:1021                    ~ 		and	a
    8770   00:1021                    ~ 		ret	z				; no, no way....
    8771   00:1021                    ~ 		ld iy,(MSX_MSLOT-1)	; we have it! call it now
    8772   00:1021                    ~ 		ld ix,MSX_MTOFF
    8773   00:1021                    ~ 		jp MSX_CALSLT
    8774   00:1021                    ~ 	endif
    8775   00:1021                    ~ 
    8776   00:1021                    ~ 	if DISSIZE=64
    8777   00:1021                    ~ cpbiosvars:		
    8778   00:1021                    ~ 		ld hl,0
    8779   00:1021                    ~ 		ld de,biosvars
    8780   00:1021                    ~ 		ld bc,$0038
    8781   00:1021                    ~ 		ldir
    8782   00:1021                    ~ 		ret		
    8783   00:1021                    ~ 	endif
    8784   00:1021                    ~ 
    8785   00:1021                    ~ enapage0:
    8786   00:1021                    ~ 		ld d,$00
    8787   00:1021                    ~ 		ld hl,MSX_ENASLT
    8788   00:1021                    ~ 		jr setcall
    8789   00:1021                    ~ 
    8790   00:1021                    ~ inipage1:
    8791   00:1021                    ~ 	if DISTYPE=DISK
    8792   00:1021                    ~ 		call drvmotoff
    8793   00:1021                    ~ 	endif
    8794   00:1021                    ~ 		call turboon
    8795   00:1021                    ~ 		; falls through to enapage1
    8796   00:1021                    ~ enapage1:
    8797   00:1021                    ~ 		ld d,$40
    8798   00:1021                    ~ 		ld hl,($0025)
    8799   00:1021                    ~ setcall:
    8800   00:1021                    ~ 		ld (VEC_ENASLT+1),hl
    8801   00:1021                    ~ 
    8802   00:1021                    ~ 	
    8803   00:1021                    ~ ;	find a valid RAM page with the aid of BIOS
    8804   00:1021                    ~ ;	Input:
    8805   00:1021                    ~ ;		D = MSB of page address
    8806   00:1021                    ~ ;
    8807   00:1021                    ~ putRAMpgX:
    8808   00:1021                    ~ 		ld b,4
    8809   00:1021                    ~ sl_loop:
    8810   00:1021                    ~ 		ld c,b
    8811   00:1021                    ~ 		dec	c
    8812   00:1021                    ~ 		push de
    8813   00:1021                    ~ 		push bc
    8814   00:1021                    ~ 		call chkExp	;modifies B,AF,HL
    8815   00:1021                    ~ 		jp p,isNotExp
    8816   00:1021                    ~ 		call sub_chk
    8817   00:1021                    ~ 		jr nz,found
    8818   00:1021                    ~ 		jr sl_end
    8819   00:1021                    ~ isNotExp:            	
    8820   00:1021                    ~ 		;ld	h,#80
    8821   00:1021                    ~ 		ld	h,d
    8822   00:1021                    ~ 		ld	a,c
    8823   00:1021                    ~ 		push	hl
    8824   00:1021                    ~ 		push	af	
    8825   00:1021                    ~ 		call	VEC_ENASLT	;select unexpanded slot
    8826   00:1021                    ~ 		pop	de	;D contains the slot/subslot/expn bit
    8827   00:1021                    ~ 		pop	hl
    8828   00:1021                    ~ 		call	chkWrite
    8829   00:1021                    ~ 		jr	nz,found	;is RAM
    8830   00:1021                    ~ sl_end:	
    8831   00:1021                    ~ 		pop	bc
    8832   00:1021                    ~ 		pop	de
    8833   00:1021                    ~ 		djnz	sl_loop
    8834   00:1021                    ~ 		;if nothing jumped to "found", then A must be -1
    8835   00:1021                    ~ 		ld	a,-1
    8836   00:1021                    ~ 		jr	found2
    8837   00:1021                    ~ 
    8838   00:1021                    ~ found:
    8839   00:1021                    ~ 		pop	hl	;balance stack
    8840   00:1021                    ~ 		pop	hl
    8841   00:1021                    ~ 		;D = slot/sub/slot/expand bit
    8842   00:1021                    ~ found2:			;exit if stack is balanced
    8843   00:1021                    ~ 		ret
    8844   00:1021                    ~ 
    8845   00:1021                    ~ sub_chk:
    8846   00:1021                    ~ 		ld	a,c
    8847   00:1021                    ~ 		or	#80	;set expanded bit
    8848   00:1021                    ~ 		ld	b,4
    8849   00:1021                    ~ 		ld	h,d	;prepare page address in H
    8850   00:1021                    ~ sub_loop:
    8851   00:1021                    ~ 		push	bc
    8852   00:1021                    ~ 		ld	c,b
    8853   00:1021                    ~ 		dec	c
    8854   00:1021                    ~ 		rl	c
    8855   00:1021                    ~ 		rl	c
    8856   00:1021                    ~ 		or	c
    8857   00:1021                    ~ 		;ld	h,#80
    8858   00:1021                    ~ 		push	hl
    8859   00:1021                    ~ 		push	af
    8860   00:1021                    ~ 		call	VEC_ENASLT
    8861   00:1021                    ~ 		pop	af
    8862   00:1021                    ~ 		ld	d,a	;save slot/subslot/exp on D register
    8863   00:1021                    ~ 		and	#f3	;clean subslot bits for next iteration
    8864   00:1021                    ~ 		ld	e,a
    8865   00:1021                    ~ 		pop	hl
    8866   00:1021                    ~ 		call	chkWrite
    8867   00:1021                    ~ 		jr	nz,sub_end	;is RAM
    8868   00:1021                    ~ 		ld	a,e
    8869   00:1021                    ~ 		pop	bc
    8870   00:1021                    ~ 		djnz	sub_loop
    8871   00:1021                    ~ 		jr 	sub_end2
    8872   00:1021                    ~ 
    8873   00:1021                    ~ sub_end:
    8874   00:1021                    ~ 		pop	hl; 	balance stack
    8875   00:1021                    ~ 	;	pop	hl
    8876   00:1021                    ~ 
    8877   00:1021                    ~ sub_end2:	;exit if stack is balanced
    8878   00:1021                    ~ 		ret
    8879   00:1021                    ~ 
    8880   00:1021                    ~ chkWrite:
    8881   00:1021                    ~ 		;**********************************************		
    8882   00:1021                    ~ 		;chkWrite
    8883   00:1021                    ~ 		;
    8884   00:1021                    ~ 		;Checks whether address WRTTST is writable or not
    8885   00:1021                    ~ 		;
    8886   00:1021                    ~ 		;Input: none
    8887   00:1021                    ~ 		;Output: flag Z if non writable
    8888   00:1021                    ~ 		;Modified: AF
    8889   00:1021                    ~ 		;
    8890   00:1021                    ~ 
    8891   00:1021                    ~ 		ld	a,(hl)
    8892   00:1021                    ~ 		inc	(hl)
    8893   00:1021                    ~ 		cp	(hl)
    8894   00:1021                    ~ 		ld (hl),a
    8895   00:1021                    ~ 		ret
    8896   00:1021                    ~ 	
    8897   00:1021                    ~ 
    8898   00:1021                    ~ chkExp:
    8899   00:1021                    ~ 		;**********************************************	
    8900   00:1021                    ~ 		;chkExp
    8901   00:1021                    ~ 
    8902   00:1021                    ~ 		;Checks whether slot C is expanded or not
    8903   00:1021                    ~ 		;Result is returned in S flag (jp M or jp P)
    8904   00:1021                    ~ 		;
    8905   00:1021                    ~ 		;Input registers:
    8906   00:1021                    ~ 		;
    8907   00:1021                    ~ 		; C = primary slot
    8908   00:1021                    ~ 		;
    8909   00:1021                    ~ 		;Output:
    8910   00:1021                    ~ 		;
    8911   00:1021                    ~ 		; S flag
    8912   00:1021                    ~ 		;
    8913   00:1021                    ~ 		;Modified:
    8914   00:1021                    ~ 		;
    8915   00:1021                    ~ 		; B,HL,AF
    8916   00:1021                    ~ 		
    8917   00:1021                    ~ 		ld	b,0
    8918   00:1021                    ~ 		ld	hl,MSX_EXPTBL
    8919   00:1021                    ~ 		add	hl,bc
    8920   00:1021                    ~ 		ld	a,(hl)          ;see if this slot is expanded or not
    8921   00:1021                    ~ 		and	#80             
    8922   00:1021                    ~ 		ret
    8923   00:1021                    ~ 	
    8924   00:1021                    ~ VEC_ENASLT:
    8925   00:1021                    ~ 		db $C3
    8926   00:1021                    ~ 		ds 2
    8927   00:1021                    ~ 		
    8928   00:1021                    ~ 		
    8929   00:1021                    ~ endslots:	equ $
    8930   00:1021                    ~ 		
    8931   00:1021                    ~ 	endif
    8932   00:1021                      
    8933   00:1021                      
    8934   00:1021                      		end

    LABELS
-------------------------------------------------
00:00000000 X DISTYPE
00:00000020 X DISSIZE
00:00000000 X AFLAG
00:00000000 X MFLAG
00:00000001 X PFLAG
00:00000000 X SFLAG
00:00000000 X DFLAG
00:00000000 X CFLAG
00:00000001 X OFLAG
00:00000000 X LFLAG
00:00000001 X EFLAG
00:00000000 X YFLAG
00:00000001 X XFLAG
00:00000000 X QFLAG
00:00000000 X CRFLAG
00:00000000 X MBFLAG
00:00000000 X UFLAG
00:00000000 X RTFLAG
00:00000000 X HCFLAG
00:00000000 X TVFREQ
00:00000000 X FX_RELATIVE
00:00000000   FX_MODE
00:00000001   FX_CHANNEL
00:00004000 X PageSize
00:0000800C X rst_8
00:0000800F X rst_10
00:00008012 X rst_18
00:00008015 X rst_20
00:00008018 X rst_28
00:0000801B X rst_30
00:0000801E X rst_38
00:00008021 X nmi_vec
00:00001FDC   READ_REGISTER
00:0000803D   init
00:00008049   NMI
00:00000000 X MSX_CHKRAM
00:00000010 X MSX_CHRGTR
00:00000014 X MSX_WRSLT
00:00000018 X MSX_OUTDO
00:00000020 X MSX_DCOMPR
00:00000028 X MSX_GETYPR
00:00000030 X MSX_CALLF
00:00000038 X MSX_KEYINT
00:0000003B X MSX_INITIO
00:0000003E X MSX_INIFNK
00:0000005F X MSX_CHGMOD
00:00000062 X MSX_CHGCLR
00:00000066 X MSX_NMI
00:00000069 X MSX_CLRSPR
00:0000006C X MSX_INITXT
00:0000006F X MSX_INIT32
00:00000075 X MSX_INIMLT
00:00000078 X MSX_SETTXT
00:0000007B X MSX_SETT32
00:0000007E X MSX_SETGRP
00:00000081 X MSX_SETMLT
00:00000084 X MSX_CALPAT
00:00000087 X MSX_CALATR
00:0000008A X MSX_GSPSIZ
00:0000008D X MSX_GRPPRT
00:00000090 X MSX_GICINI
00:00000093 X MSX_WRTPSG
00:00000096 X MSX_RDPSG
00:00000099 X MSX_STRTMS
00:0000009C X MSX_CHSNS
00:0000009F X MSX_CHGET
00:000000A2 X MSX_CHPUT
00:000000A5 X MSX_LPTOUT
00:000000A8 X MSX_LPTSTT
00:000000AB X MSX_CNVCHR
00:000000AE X MSX_PINLIN
00:000000B1 X MSX_INLIN
00:000000B4 X MSX_QINLIN
00:000000B7 X MSX_BREAKX
00:000000BA X MSX_ISCNTC
00:000000BD X MSX_CKCNTC
00:000000C0 X MSX_BEEP
00:000000C6 X MSX_POSIT
00:000000C9 X MSX_FNKSB
00:000000CC X MSX_ERAFNK
00:000000CF X MSX_DSPFNK
00:000000D2 X MSX_TOTEXT
00:000000DB X MSX_GTPAD
00:000000DE X MSX_GTPDL
00:000000E1 X MSX_TAPION
00:000000E4 X MSX_TAPIN
00:000000E7 X MSX_TAPIOF
00:000000EA X MSX_TAPOON
00:000000ED X MSX_TAPOUT
00:000000F0 X MSX_TAPOOF
00:000000F3 X MSX_STMOTR
00:000000F6 X MSX_LFTQ
00:000000F9 X MSX_PUTQ
00:000000FC X MSX_RIGHTC
00:000000FF X MSX_LEFTC
00:00000102 X MSX_UPC
00:00000105 X MSX_TUPC
00:00000108 X MSX_DOWNC
00:0000010B X MSX_TDOWNC
00:0000010E X MSX_SCALXY
00:00000111 X MSX_MAPXY
00:00000114 X MSX_FETCHC
00:00000117 X MSX_STOREC
00:0000011A X MSX_SETATR
00:0000011D X MSX_READC
00:00000120 X MSX_SETC
00:00000123 X MSX_NSETCX
00:00000126 X MSX_GTASPC
00:00000129 X MSX_PNTINI
00:0000012C X MSX_SCANR
00:0000012F X MSX_SCANL
00:00000132 X MSX_CHGCAP
00:00000135 X MSX_CHGSND
00:0000013B X MSX_WSLREG
00:0000013E X MSX_RDVDP
00:00000144 X MSX_PHYDIO
00:00000147 X MSX_FORMAT
00:0000014A X MSX_ISFLIO
00:0000014D X MSX_OUTDLP
00:00000150 X MSX_GETVCP
00:00000153 X MSX_GETVC2
00:00000156 X MSX_KILBUF
00:00000159 X MSX_CALBAS
00:0000000C X MSX_RDSLT
00:0000001C X MSX_CALSLT
00:00000138 X MSX_RSLREG
00:00000180 X MSX_CHGCPU
00:00004029 X MSX_MTOFF
00:00000000   MSX_CHRTBL
00:00001800   MSX_NAMTBL
00:00002000   MSX_CLRTBL
00:00003800   MSX_SPRTBL
00:00001B00   MSX_SPRATR
00:00000007   MSX_VDPPRT
00:0000002D X MSX_MSXVER
00:00005348 X MSX_MSLOT
00:000053C7 X MSX_GRPNAM
00:000053C9 X MSX_GRPCOL
00:000053CB X MSX_GRPCGP
00:000053CD X MSX_GRPATR
00:000053CF X MSX_GRPPAT
00:000053DB X MSX_CLIKSW
00:000053E9   MSX_FORCLR
00:000053EA   MSX_BAKCLR
00:000053EB   MSX_BDRCLR
00:000053DF X MSX_RG0SAV
00:000053E0 X MSX_RG1SAV
00:000053E1 X MSX_RG2SAV
00:000053E2 X MSX_RG3SAV
00:000053E3 X MSX_RG4SAV
00:000053E4 X MSX_RG5SAV
00:000053E5 X MSX_RG6SAV
00:000053E6 X MSX_RG7SAV
00:00005FE7 X MSX_RG8SAV
00:00005FE8   MSX_RG9SAV
00:000053E7   MSX_STATFL
00:000053F6 X MSX_SCNCNT
00:000053F7 X MSX_REPCNT
00:0000587F X MSX_FNKSTR
00:00005BE5 X MSX_NEWKEY
00:00005C4A X MSX_HIMEM
00:00005C9E   MSX_JIFFY
00:00005CA2 X MSX_INTCNT
00:00005CC1 X MSX_EXPTBL
00:00005CC5 X MSX_SLTTBL
00:00005D9A X MSX_HKEYI
00:00005D9F X MSX_HTIMI
00:00005FFF X MSX_SSSREG
00:00003000   CV_STACK
00:00000040 X MSX_DEVID
00:00000041 X MSX_SWTIO
00:000000A0   MSX_PSGLW
00:000000A1   MSX_PSGDW
00:000000A2 X MSX_PSGDR
00:0000000E X MSX_PSGPA
00:0000000F X MSX_PSGPB
00:000000BE   MSX_VDPDRW
00:000000BF   MSX_VDPCW
00:000000BF X MSX_VDPSR
00:0000009B X MSX_VDPPAL
00:000000A8 X MSX_PPIA
00:000000A9 X MSX_PPIB
00:000000AA X MSX_PPIC
00:000000AB X MSX_PPICM
00:000000FC X MSX_MMAP0
00:000000FD X MSX_MMAP1
00:000000FE X MSX_MMAP2
00:000000FF X MSX_MMAP3
00:000000D0   MSX_HIDE_SPRITES
00:000000D1   MSX_HIDE_SPRITE
00:00000024 X MSX_ENASLT
00:00000041   MSX_DISSCR
00:00000044   MSX_ENASCR
00:00000047   MSX_WRTVDP
00:0000004A X MSX_RDVRM
00:0000CBA3   MSX_WRTVRM
00:00000050 X MSX_SETRD
00:0000CB96   MSX_SETWRT
00:00000056 X MSX_FILVRM
00:00000059 X MSX_LDIRMV
00:0000005C X MSX_LDIRVM
00:00000072 X MSX_INIGRP
00:0000CB71   MSX_CLS
00:000000D5 X MSX_GTSTCK
00:000000D8 X MSX_GTTRIG
00:00000141 X MSX_SNSMAT
00:00000001   WINDOWTOP
00:00000001   WINDOWLFT
00:00000014   WINDOWHGT
00:0000001E   WINDOWWID
00:0000000D   MAPWID
00:0000806D X mapedge
00:0000807A   mapdat
00:000080A1   stmap
00:000080A2   evnt00
00:000080B6   a00039
00:000080F0   a00143
00:000080F6   a00152
00:000080FA   a00161
00:00008128   a00248
00:00008165   a00357
00:00008183   a00411
00:000081C0   a00520
00:000081EB   a00599
00:00008215   a00678
00:00008238   a00739
00:00008244   a00763
00:00008272   a00847
00:00008298   a00918
00:000082B4   a00965
00:000082C1   a00990
00:000082E5   a01054
00:000082E9   a01062
00:00008305   a01113
00:00008335   a01211
00:0000835C   a01285
00:0000835D   evnt01
00:0000836A   b00025
00:00008381   b00066
00:00008392   b00098
00:000083A3   b00129
00:000083B4   b00161
00:000083C8   b00197
00:000083D9   b00229
00:000083EA   b00261
00:000083FB   b00293
00:00008407   b00317
00:0000840A   b00321
00:00008413   b00338
00:00008414   evnt02
00:00008421   c00025
00:00008439   c00068
00:0000843C   c00072
00:00008445   c00089
00:00008446   evnt03
00:00008453   d00025
00:00008478   d00093
00:0000847B   d00097
00:00008485   d00115
00:00008486   evnt04
00:00008493   e00025
00:000084A8   e00066
00:000084AB   e00070
00:000084C3   e00113
00:000084C6   e00118
00:000084D0   e00135
00:000084D1   evnt05
00:000084DE   f00025
00:000084F5   f00067
00:000084F8   f00071
00:0000851C   f00139
00:0000851D   evnt06
00:0000852A   g00025
00:00008552   g00097
00:00008556   g00105
00:00008557   evnt07
00:0000856B   h00043
00:0000858E   h00104
00:000085A9   h00152
00:000085C2   h00204
00:000085D3   h00239
00:000085E4   h00275
00:000085F0   h00301
00:000085F3   h00305
00:000085F8   h00314
00:00008614   h00362
00:00008622   h00388
00:00008630   h00413
00:0000863E   h00439
00:00008651   h00473
00:0000866D   h00521
00:00008680   h00556
00:00008693   h00590
00:000086A6   h00625
00:000086B9   h00659
00:000086CC   h00694
00:000086E8   h00742
00:000086F6   h00767
00:00008704   h00793
00:00008712   h00818
00:00008720   h00844
00:0000873C   h00891
00:0000874F   h00925
00:00008762   h00960
00:00008775   h00994
00:00008783   h01020
00:0000879F   h01067
00:000087B2   h01101
00:000087C5   h01136
00:000087D8   h01170
00:000087EB   h01204
00:000087F9   h01230
00:00008815   h01277
00:00008828   h01312
00:0000883B   h01346
00:0000884E   h01380
00:0000885C   h01406
00:0000886F   h01440
00:0000888B   h01487
00:00008899   h01513
00:000088AC   h01547
00:000088BA   h01573
00:000088CD   h01607
00:000088E9   h01654
00:000088FC   h01688
00:0000890F   h01723
00:00008922   h01757
00:00008935   h01791
00:00008951   h01838
00:00008964   h01872
00:00008977   h01907
00:00008985   h01932
00:00008998   h01966
00:000089A6   h01992
00:000089C2   h02039
00:000089D5   h02073
00:000089E8   h02108
00:000089F6   h02133
00:00008A09   h02167
00:00008A1C   h02201
00:00008A1D   evnt08
00:00008A29   i00028
00:00008A54   i00104
00:00008A70   i00151
00:00008A83   i00186
00:00008A96   i00220
00:00008AA9   i00254
00:00008ABC   i00288
00:00008AD8   i00335
00:00008AEB   i00369
00:00008AFE   i00404
00:00008B11   i00438
00:00008B1F   i00464
00:00008B3B   i00511
00:00008B4E   i00545
00:00008B5C   i00571
00:00008B6F   i00605
00:00008B82   i00639
00:00008B9E   i00687
00:00008BB1   i00721
00:00008BC4   i00755
00:00008BD7   i00789
00:00008BEA   i00823
00:00008C06   i00871
00:00008C19   i00905
00:00008C2C   i00939
00:00008C3F   i00973
00:00008C5B   i01020
00:00008C6E   i01054
00:00008C81   i01089
00:00008C94   i01122
00:00008CA2   i01148
00:00008CB5   i01182
00:00008CD1   i01228
00:00008CE4   i01263
00:00008CF2   i01288
00:00008D00   i01313
00:00008D1C   i01360
00:00008D2F   i01394
00:00008D42   i01429
00:00008D55   i01463
00:00008D71   i01510
00:00008D7F   i01536
00:00008D80   evnt09
00:00008D8C   j00024
00:00008D9D   j00054
00:00008DAE   j00083
00:00008DBF   j00113
00:00008DD0   j00142
00:00008DD1   evnt10
00:00008E0B   evnt11
00:00008E1B   l00032
00:00008E22   l00045
00:00008E2D   l00066
00:00008E34   l00079
00:00008EAC   l00313
00:00008EAD   evnt12
00:00008FB7   m00550
00:00008FD0   m00602
00:00008FE1   m00638
00:00008FF2   m00673
00:00008FFE   m00699
00:00009001   m00704
00:0000900D   evnt13
00:00009072   evnt14
00:000090BD   o00160
00:00009138   o00424
00:00009139   evnt15
00:00009144   p00025
00:00009145   evnt16
00:00009158   evnt17
00:000091BD   evnt18
00:000091C7   evnt19
00:000091C8 X evnt20
00:000091C9   ptcusr
00:000091CA   msgdat
00:000092A2 X nummsg
00:000092A3   scdat
00:00009787   numsc
00:00009788   chgfx
00:00009D78   bprop
00:00009DD7   sprgfx
00:0000A4F7   frmlst
00:0000A51D   nmedat
00:00000028   NUMOBJ
00:0000A72C   objdta
00:0000B1A4 X palett
00:0000B1C4   font
00:0000B4C4   jtab
00:0000B4C5   keytab
00:00000000 X ROM
00:00000001 X DISK
00:00000002 X TAPE
00:00000001 X PAL
00:00000002 X NTSC
00:00000018   MSX_MAXROWS
00:00000020   MSX_MAXCOLS
00:000000FF X MSX_MAXCX
00:000000BF   MSX_MAXCY
00:00000010   MSX_SPRHS
00:00000010   MSX_SPRVS
00:00000001   PLATFM
00:00000002   WALL
00:00000003   LADDER
00:00000004   FODDER
00:00000005   DEADLY
00:00000006   CUSTOM
00:00000007   WATER
00:00000008   COLECT
00:00000009 X NUMTYP
00:00000007 X CRUMBLING_SPEED
00:00000043   OBJSIZ
00:00000003   ODTSIZ
00:00000020   NUMSPR
00:00000011   TABSIZ
00:00000220   SPRBUF
00:00000005   NMESIZ
00:00000003   X
00:00000004   Y
00:00000005 X PAM1ST
00:00000258   MAPSIZE
00:00000036   NUMSHR
00:00000009   SHRSIZ
00:0000000A   VAPTIM
00:0000B4DB   start
00:0000B544   numob
00:0000B545   wntopx
00:0000B546   wnlftx
00:0000B547   wnbotx
00:0000B548   wnrgtx
00:0000B549   frmptr
00:0000B54B   blkptr
00:0000B54D   proptr
00:0000B54F   scrptr
00:0000B551   nmeptr
00:0000B553 X isr
00:0000B574 X chkkey
00:0000B574   prskey
00:0000B593   debkey
00:0000B5B0   delay
00:0000B5B8   xspr
00:0000B5C9   xspr0
00:0000B5D7   iniob
00:0000B5E1   iniob.loop
00:0000B5F2   vsync
00:0000B5FD   check_if_enough_frames_passed
00:0000B610 X beeper
00:0000B610 X redraw
00:0000B62E X rpblc1
00:0000B634 X swaphz
00:0000B642   cls
00:0000B665 X setpal
00:0000B677   fdchk
00:0000B69D   cspr
00:0000B6A1   proshr
00:0000B6A4   proshrnoset
00:0000B6BC   proshr0
00:0000B6C2   proshloop
00:0000B6D5   setshr
00:0000B6D8   setshr0
00:0000B6E1   setshr0.shrodd
00:0000B6E5   proshx
00:0000B6E9   prosh1
00:0000B6F8   prosh2
00:0000B701   shrap
00:0000B721   dotl
00:0000B725   dotr
00:0000B729   dotu
00:0000B72D   dotd
00:0000B731   chkxy
00:0000B753   kilshr
00:0000B758   plot
00:0000B767 X plot0
00:0000B779   pltwrt
00:0000B786   plot1
00:0000B795   trail
00:0000B7A8   trail.traill
00:0000B7AC   trail.trailv
00:0000B7B3   trail.trailu
00:0000B7B7   trailk
00:0000B7BC   laser
00:0000B7C6   laserl
00:0000B7C8   laserm
00:0000B7E8   laserm.exit
00:0000B7E9   plotde
00:0000B7EF X shoot
00:0000B7F3 X shoot1
00:0000B80F   shoot0
00:0000B816   shootr
00:0000B81B X vapour
00:0000B823 X vapou3
00:0000B82C   vapou2
00:0000B82F   vapou1
00:0000B843   vapou0
00:0000B848 X ptusr
00:0000B859   ptusr.ptusr1
00:0000B86A X star
00:0000B872   star0
00:0000B875   star7
00:0000B884   star8
00:0000B88A   star9
00:0000B89B   star1
00:0000B8A9   star2
00:0000B8B5   star3
00:0000B8BD   fpslot
00:0000B8C6   fpslt0
00:0000B8D0   explod
00:0000B8E2   expld0
00:0000B8E8   expld2
00:0000B8EC   expld3
00:0000B8EF   expld1
00:0000B915   qrand
00:0000B922   dshrp
00:0000B93E   delshr
00:0000B944   delshr.loop
00:0000B94F   delshr.noshr
00:0000B957   inishr
00:0000B965 X lcol
00:0000B96D   lcol.loop
00:0000B971   lcol.nxtshr
00:0000B975   lcol.chkcol
00:0000B98B   lcol.missed
00:0000B98E   lcol.exit
00:0000B990   game
00:0000B993 X evintr
00:0000B9B4 X mapst
00:0000B9BA X inipbl
00:0000B9C1 X evini
00:0000B9C4   rstrt
00:0000B9D2   rstrtn
00:0000B9E1   rstrt0
00:0000B9F4 X rpblc0
00:0000B9FA   mloop
00:0000BA04 X evlp1
00:0000BA0E X evlp2
00:0000BA39 X qoff
00:0000BA3C   newlev
00:0000BA4C   evwon
00:0000BA52   pdead
00:0000BA56 X evdie
00:0000BA66   tidyup
00:0000BA6E   tidyup.tidyu2
00:0000BA78   tidyu0
00:0000BA7B   tidyu1
00:0000BA8E   rsevt
00:0000BA92 X evrs
00:0000BA95   num2ch
00:0000BA9A   numdg3
00:0000BAA0   numdg2
00:0000BAAB   numdg
00:0000BAAD   numdg1
00:0000BAB6   numdg0
00:0000BABD X num2dd
00:0000BACC X num2td
00:0000BAD3   inisc
00:0000BAD5   inisc0
00:0000BADB   imul
00:0000BADD X imul0
00:0000BAE3   imul0.loop
00:0000BAE9   imul0.imul2
00:0000BAF0 X idiv
00:0000BAF3   idiv.loop
00:0000BAFB   idiv.nodiv
00:0000BAFE   shwob
00:0000BB05   shwob.loop0
00:0000BB1E   dobj
00:0000BB2D   putobj
00:0000BB50   putrow
00:0000BB58   putrow0
00:0000BB5A   putrow0.loop
00:0000BB60   objimg
00:0000BB79 X remob
00:0000BB89   getob
00:0000BBA8   getob.notinscr
00:0000BBAB   objptr
00:0000BBB6   wobj
00:0000BBBE   robj
00:0000BBF8   robjs
00:0000BC02   robjs.loop
00:0000BC0F X drpob
00:0000BC38   skobj
00:0000BC42   skobj.sk0
00:0000BC4F   skobj.sk1
00:0000BC6D   skobj.sk3
00:0000BC6E   skobj.sk2
00:0000BC70   gotob
00:0000BC79   gotob.gotob1
00:0000BC7C   gotob.gotob0
00:0000BC80   findob
00:0000BC8F X spawn
00:0000BC92 X numsp1
00:0000BC97   numsp1.nxtslot
00:0000BCA1   numsp1.spaw1
00:0000BCDA X rtssp
00:0000BCDE X evis1
00:0000BCE3   hslot
00:0000BCED   hslot.nxtslot
00:0000BCF3   hslot.found
00:0000BCF8   checkx
00:0000BCFE X dscor
00:0000BD0B   dscor0
00:0000BD20   dscor2
00:0000BD27   bscor0
00:0000BD35 X addsc
00:0000BD57   incsc
00:0000BD66   incsc0
00:0000BD68   incsc2
00:0000BD74 X addbo
00:0000BD7E   addbo0
00:0000BD89   addbo1
00:0000BD8F X swpsb
00:0000BD97   swpsb0
00:0000BDA1   gp2tp
00:0000BDB8   gprad
00:0000BDC3   pradd
00:0000BDDC X chradd
00:0000BDF7   ptxt
00:0000BE16   ldirvm0
00:0000BE2A   ldirvm0.nxtrow
00:0000BE2F   pattr
00:0000BE2F   pattr2
00:0000BE43   pattr1
00:0000BE57   pchr
00:0000BE77   pchr.ldirvm0
00:0000BE88   pchr.loop
00:0000BE8D   pattrnxt
00:0000BE92   groom
00:0000BE95 X groomx
00:0000BE9B   groom1
00:0000BEA8   groom0
00:0000BEB5   droom
00:0000BEBB X droom2
00:0000BED1   droom0
00:0000BEDB   droom1
00:0000BEF1   cangu
00:0000BF13   cangd
00:0000BF19 X numsp3
00:0000BF32   plchk
00:0000BF3F   plchk0
00:0000BF41   plchkx
00:0000BF4A   cangl
00:0000BF55   cangr
00:0000BF5E   cangh
00:0000BF61 X cangh2
00:0000BF69   cangh0
00:0000BF6F   cangh1
00:0000BF77   lrchk
00:0000BF80 X always
00:0000BF82   lrchkx
00:0000BF85   tded
00:0000BFA7   tded.tded0
00:0000BFB8   tded.tded1
00:0000BFCD   tstbl
00:0000BFE8 X jump
00:0000BFEB X jump0
00:0000BFF7 X hop
00:0000C005   random
00:0000C017   ktest
00:0000C028   keypressed
00:0000C02C   jtest
00:0000C03D   jkeypressed
00:0000C041   joykey
00:0000C04F   joyjoy1
00:0000C054   joyjoy2
00:0000C057   readkeys
00:0000C05B   readkeys.loop
00:0000C06C   joykey1
00:0000C07A   joykey2
00:0000C088   dmsg
00:0000C08E   dmsg3
00:0000C0A2   dmsg0
00:0000C0B5   dmsg2
00:0000C0CB   dmsg2.btzero
00:0000C0D4   dmsg2.strseg
00:0000C0E2   dmsg2.wrapped
00:0000C0F7   dmsg2.bottom
00:0000C0FF   dmsg2.nxtchr
00:0000C103   dmsg1
00:0000C10E   dmsg4
00:0000C113   bmsg1
00:0000C11E   bmsg1.bmsg3
00:0000C138   bmsg1.btzero
00:0000C156   bmsg1.bmsg2
00:0000C167   bchar
00:0000C17B   bchar.nxtchar
00:0000C187   bchar.nxtrow
00:0000C1A1   nxtchar2
00:0000C1A9   nxtfile2
00:0000C1B1 X bchar1
00:0000C1B7   bchar3
00:0000C1BB   bchar2
00:0000C1BE X achar
00:0000C1D6   nexpos
00:0000C1E0   nexlin
00:0000C1E8   preprt
00:0000C1EF X prescr
00:0000C1F8   getwrd
00:0000C1FB   getwd0
00:0000C204   pspr
00:0000C20E   pspr.loop
00:0000C220   pspr2
00:0000C23A   pspr3
00:0000C23D X pspr4
00:0000C243   jumphl
00:0000C248   evtyp0
00:0000C24A X evtyp1
00:0000C24C X evtyp2
00:0000C24E X evtyp3
00:0000C250 X evtyp4
00:0000C252 X evtyp5
00:0000C254 X evtyp6
00:0000C256 X evtyp7
00:0000C258 X evtyp8
00:0000C25A   chkimg
00:0000C263   chkimg.loop
00:0000C27D   chkimg.nxtspr
00:0000C282 X disscreen
00:0000C285 X enascreen
00:0000C288   dissprs
00:0000C290   ram2vram
00:0000C29B   ram2vram.loop
00:0000C2AF   ram2vram_slow
00:0000C2BA   ram2vram_slow.loop
00:0000C2C0   buildspr
00:0000C2D0   buildspr.loop
00:0000C2DE   buildspr.ison
00:0000C300   buildspr.nxtspr
00:0000C30B X sprflick
00:0000C31C   sprflick.flick
00:0000C338   sprflick.lp
00:0000C33E   sprflick.bottom
00:0000C34E   sprflick.noovlp
00:0000C35E   sprflick.nxt
00:0000C372   sprflick.noreset
00:0000C380   sprflick.fullsat
00:0000C38E   sprflick.no5th
00:0000C392   dumpspr
00:0000C3A8   scadd
00:0000C3C1   animsp
00:0000C3D5   anims0
00:0000C3D9 X animbk
00:0000C3EC   animbk.rtanb0
00:0000C3EF   sktyp
00:0000C3F8   sktyp.loop
00:0000C400   sktyp.sktyp1
00:0000C413 X sktyp.nocoll
00:0000C414   coltyp
00:0000C41A   coltyp.colty0
00:0000C429   coltyp.colc1a
00:0000C436   coltyp.colc1b
00:0000C441   coltyp.colty1
00:0000C44D   disply
00:0000C453 X displ1
00:0000C45E   initsc
00:0000C46B   tstsc
00:0000C477 X scrl
00:0000C47B   scrl0
00:0000C484   scrl1
00:0000C48D X scrr
00:0000C493 X scru
00:0000C49A X scrd
00:0000C4A1 X nwscr
00:0000C4A7   nwscr0
00:0000C4AF   nwscr1
00:0000C4B5 X grav
00:0000C4D3   grav0
00:0000C4DE X gravd
00:0000C4DF   gravd0
00:0000C4EA   gravu
00:0000C4ED   gravu0
00:0000C4F9   gravst
00:0000C506   evftf
00:0000C50A   ogrv
00:0000C51C   ogrv0
00:0000C51F   ogrv1
00:0000C525 X ogrvd
00:0000C526   ogrvd0
00:0000C531   ogrvu
00:0000C534   ogrvu0
00:0000C53F   ogrvst
00:0000C556   ogrv2
00:0000C55B   ogrv4
00:0000C564   ogrv3
00:0000C568   ifall
00:0000C591   ifalls
00:0000C599 X tfall
00:0000C5AC   gfrm
00:0000C5B6   sprlst
00:0000C5C2   sprlst.loop
00:0000C5C9   sprlst.nxtscr
00:0000C5CD   nspr
00:0000C5D6   nspr.loop
00:0000C5E0   nspr.loop1
00:0000C5E5   ispr
00:0000C5EF   ispr.loop2
00:0000C5F3   ispr.loop1
00:0000C602   ispr.copyspr
00:0000C607   ispr.exit
00:0000C60A   kspr
00:0000C619   kspr.loop2
00:0000C62D   kspr.loop1
00:0000C63C   kspr.copyspr
00:0000C641   kspr.exit
00:0000C644   cpsp
00:0000C682   mapsprite
00:0000C6A2   nxtsprbyt
00:0000C6AA   nomap
00:0000C6AD   spradr
00:0000C6C2   mult32
00:0000C6CE   clrobjlst
00:0000C6D8   clrscrmap
00:0000C6DF   fastfill
00:0000C6E1   fastfill.loop1
00:0000C6EF X clw
00:0000C707   clw.loop3
00:0000C70C   clw.loop1
00:0000C71B   clw.loop2
00:0000C800   dots
00:0000C808   shrptr
00:0000C818   shrsin
00:0000C858   unpack
00:0000C87C   pletter.literal
00:0000C87E   pletter.loop
00:0000C887 X pletter.getlen
00:0000C88D   pletter.getlen.lus
00:0000C8A8   pletter.getlen.lenok
00:0000C8B5   pletter.mode6
00:0000C8BB   pletter.mode5
00:0000C8C1   pletter.mode4
00:0000C8C7   pletter.mode3
00:0000C8CD   pletter.mode2
00:0000C8DD   pletter.offsok
00:0000C8EC   pletter.getbit
00:0000C8F0   pletter.getbitexx
00:0000C8F6   pletter.modes
00:00000000 X CHNPRM_PsInOr
00:00000001 X CHNPRM_PsInSm
00:00000002 X CHNPRM_CrAmSl
00:00000003 X CHNPRM_CrNsSl
00:00000004 X CHNPRM_CrEnSl
00:00000005 X CHNPRM_TSlCnt
00:00000006 X CHNPRM_CrTnSl
00:00000008 X CHNPRM_TnAcc
00:0000000A X CHNPRM_COnOff
00:0000000B X CHNPRM_OnOffD
00:0000000C X CHNPRM_OffOnD
00:0000000D X CHNPRM_OrnPtr
00:0000000F X CHNPRM_SamPtr
00:00000011 X CHNPRM_NNtSkp
00:00000012 X CHNPRM_Note
00:00000013 X CHNPRM_SlToNt
00:00000014 X CHNPRM_Env_En
00:00000015 X CHNPRM_Flags
00:00000016 X CHNPRM_TnSlDl
00:00000017 X CHNPRM_TSlStp
00:00000019 X CHNPRM_TnDelt
00:0000001B X CHNPRM_NtSkCn
00:0000001C X CHNPRM_Volume
00:0000001D X CHNPRM_Size
00:00000000 X AR_TonA
00:00000002 X AR_TonB
00:00000004 X AR_TonC
00:00000006 X AR_Noise
00:00000007   AR_Mixer
00:00000008 X AR_AmplA
00:00000009 X AR_AmplB
00:0000000A X AR_AmplC
00:0000000B X AR_Env
00:0000000D X AR_EnvTp
00:0000C902   sfx_init
00:0000C955   sfx_play
00:0000C90B   ayFX_SETUP
00:0000C918   sfx_mute
00:0000C920   sfx_set
00:0000C920 X ayFX_INIT
00:0000C931   ayFX_INIT.CHECK_PRI
00:0000C951   ayFX_INIT.INIT_END
00:0000C955   ayFX_PLAY
00:0000C969   ayFX_PLAY.TAKECB
00:0000C97A   ayFX_PLAY.CHECK_NN
00:0000C988   ayFX_PLAY.SETPOINTER
00:0000C99C   ayFX_PLAY.SETMASKS
00:0000C9AA X ayFX_PLAY.CHK1
00:0000C9AC X ayFX_PLAY.PLAY_C
00:0000C9B9   ayFX_PLAY.CHK2
00:0000C9BE X ayFX_PLAY.PLAY_B
00:0000C9CB   ayFX_PLAY.CHK3
00:0000C9CE X ayFX_PLAY.PLAY_A
00:0000C9DB   ayFX_PLAY.SETMIXER
00:0000C9EB   resetregs
00:0000C9F9   psgrout
00:0000CA06   psgrout.lout
00:0000CA17   sfxbank
00:0000CB2D X endprogram
00:00001FD9   WRITE_REGISTER
00:000000C9 X PATSIZE
00:00001105   CONTROLLER_INIT
00:00001FEB   POLLER
00:0000CB2D   CV_INIGRP
00:0000CB66   nxtblk
00:0000CB71   CV_CLS
00:0000CB87   FILVRM
00:0000CB8B   FLOOP
00:0000CB96   CV_SETWRT
00:0000CBA3   CV_WRTVRM
00:00004000   varbegin
00:00004000   score
00:00004006   hiscor
00:0000400C   bonus
00:00004012   displ0
00:00004016   sndtyp
00:00004017   shrplot
00:00004019   loopa
00:0000401A X loopb
00:0000401B X loopc
00:0000401C   vara
00:0000401D   varb
00:0000401E   varc
00:0000401F   vard
00:00004020   vare
00:00004021   varf
00:00004022   varg
00:00004023   varh
00:00004024   vari
00:00004025   varj
00:00004026   vark
00:00004027   varl
00:00004028   varm
00:00004029 X varn
00:0000402A X varo
00:0000402B X varp
00:0000402C X varq
00:0000402D X varr
00:0000402E X vars
00:0000402F X vart
00:00004030 X varu
00:00004031 X varv
00:00004032 X varw
00:00004033 X varz
00:00004034   contrl
00:00004035   charx
00:00004036   chary
00:00004037   colpat
00:00004038   prtmod
00:00004039   clratt
00:0000403A X snddelay
00:0000403B   spptr
00:0000403D   seed
00:0000403E   grbase
00:00004040   joyval
00:00004041   scno
00:00004042   ogptr
00:00004044   nsprite
00:00004045   numlif
00:00004046   curobj
00:00004047 X dirthig
00:00004049   skptr
00:0000404B   highslot
00:0000404C   roomtb
00:0000404D   frmno
00:0000404E X combyt
00:0000404F   seed3
00:00004050   nexlev
00:00004051   restfl
00:00004052   deadf
00:00004053   gamwon
00:00004054   dispx
00:00004055   dispy
00:00004056   varrnd
00:00004057   varobj
00:00004058 X varopt
00:00004059 X varblk
00:0000405A   offset
00:0000405B X select
00:0000405C X ticks
00:0000405D   varend
00:0000405D   ayFX_MODE
00:0000405E   ayFX_BANK
00:00004060   ayFX_PRIORITY
00:00004061   ayFX_POINTER
00:00004063   ayFX_TONE
00:00004065   ayFX_NOISE
00:00004066   ayFX_VOLUME
00:00004067   ayFX_CHANNEL
00:00004068   AYREGS
00:00004076   sprptr
00:00004078 X pblkptr
00:0000407A   stack
00:0000407C   time
00:0000407D   keys
00:00004093   wintop
00:00004094   winlft
00:00004095   winhgt
00:00004096   winwid
00:00004097   CONTROLLER_BUFFER
00:000040A3   ssprit
00:000040B4   sprtab
00:000042D4   mapbuf
00:00004500   spratr2
00:00004580   spratr
00:00004600   MAP
00:00004900   objlist
00:00004A00   scrmap
00:00004D00   mapspr
00:00004D80   colltab
00:00004DC0   shraddr
00:00004DC2   SHRAPN
00:00004FA8   objatr
00:00005020 X frames_passed
00:00005021 X eop


 Output: BALDY.out
-------------------------------------------------

 Page: 00
  Org: 00000000  Size: *  Used: 00000000

    No output

 Output: BALDY.rom
-------------------------------------------------

 Page: 00
  Org: 00008000  Size: 00008000  Used: 00004BAB

   Address   Length Align   Label
   00008000   19371     @   rst_8
   0000CBAB   13397       <empty>

 Output: ram_vars.tmp
-------------------------------------------------

 Page: 00
  Org: 00000000  Size: *  Used: 00001021

   Address   Length Align   Label
   00000000    4129         score
